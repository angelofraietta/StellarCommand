%#% extstart input preamble.tex
%
% This has been built from Memoir class
%             Author: Peter Wilson
%             Copyright 2001, 2002, 2003, 2004, 2008, 2009 Peter R. wilson
%
\listfiles
\documentclass[10pt,a4paper,extrafontsizes]{memoir}
\usepackage{comment}


% For (non-printing) notes  \PWnote{date}{text}
\newcommand{\PWnote}[2]{} 
\PWnote{2009/04/29}{Added fonttable to the used packages}
\PWnote{2009/08/19}{Made Part I a separate doc (memdesign.tex).}

% same
\newcommand{\LMnote}[2]{} 


\usepackage{memsty}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{titlepages}  % code of the example titlepages
\usepackage{memlays}     % extra layout diagrams
\usepackage{dpfloat}     % floats on facing pages
\usepackage{fonttable}[2009/04/01]   % font tables
%%%%\usepackage{xr-hyper} \externaldocument{memdesign} Doesn't work, 
%%%%                      Idea won't work in general for memman/memdesign
%%%%                      as at display time, who knows where everything
%%%%                      will be located on the individual's computer.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%% Change section heading styles
%%%\memmansecheads

%%%% Use the built-in division styling
\headstyles{memman}

%%% ToC down to subsections
\settocdepth{subsection}
%%% Numbering down to subsections as well
\setsecnumdepth{subsection}

%%%% extra index for first lines
\makeindex[lines]


% this 'if' is used to determine whether we are compiling the memoir
% master in the subversion repository, or the public memman.tex
\newif\ifMASTER
\MASTERfalse
%\MASTERtrue

\ifMASTER

% add patch to fink, such that \AtEndFile still work
\makeatletter
\AtEndFile{fink.sty}{
  \typeout{patching fink} 
  \renewcommand{\InputIfFileExists}[2]{%
    \IfFileExists{##1}%
    {##2\@addtofilelist{##1}%
      \m@matbeginf{##1}%
      \fink@prepare{##1}%
      %\@@input \@filef@und
      \expandafter\fink@input%
      \expandafter\fink@restore\expandafter{\finkpath}%
     \m@matendf{##1}%
     \killm@matf{##1}}%
 }
}
\makeatother
% private package, not in circulation
% enables us to gather svn information on a single file basis
%\usepackage[filehooks]{svn-multi-private}
% use the current version
\usepackage[filehooks]{svn-multi}


% \svnidlong
% {}
% {$LastChangedDate: 2018-12-12 12:53:37 +0100 (Wed, 12 Dec 2018) $}
% {$LastChangedRevision: 622 $}
% {$LastChangedBy: daleif@math.au.dk $}



\makeatletter
\newcommand\addRevisionData{%
  \begin{picture}(0,0)%
    \put(0,-20){%
      \tiny%
      \expandafter\@ifmtarg\expandafter{\svnfiledate}{}{%
        \textit{\textcolor{darkgray}{Chapter last updated \svnfileyear/\svnfilemonth/\svnfileday
         \enspace (revision \svnfilerev)}}
     }%
    }%
  \end{picture}%
}
\makeatother

% we add this to the first page of each chapter

\makepagestyle{chapter}
\makeoddfoot{chapter}{\addRevisionData}{\thepage}{}
\makeevenfoot{chapter}{\addRevisionData}{\thepage}{}

\else
% disable svn info collecting
\newcommand\svnidlong[4]{}
\fi



%% end preamble
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%#% extend

\usepackage[draft]{fixme}
\fxsetup{
  multiuser,
  marginface=\normalfont\tiny,
  innerlayout=noinline,
  layout=marginnote,
}
\usepackage{tikz,ragged2e}
\makeatletter
% extra feature, vadj=length kan flytte på fxnotes hvis de overlapper
\@fxdefinekey{layout}{vadj}{\def\marginnotevadjust{#1}}

% endnu mere ekstra feature, kræver tikz og calc tikz lib

\renewcommand*\FXLayoutMarginNote[3]{%
  \tikz[overlay,remember picture]\coordinate (A) at (0,0);%
  \marginnote[%
    \RaggedLeft%
    \rlap{\tikz[overlay,remember picture]\coordinate(C) at (0,0);}%
    \@fxuseface{margin}%
    \@fxtextstd{#1}{#2}{#3}%
    {\tikz[overlay,remember picture,ultra thin,cyan]\draw(A) -| ++(0,-2pt) -|(C);}%
  ]{%
    \RaggedRight%
    \tikz[overlay,remember picture]\coordinate(B) at (0,0);%
    \@fxuseface{margin}%
    \@fxtextstd{#1}{#2}{#3}%
    \tikz[overlay,remember picture,ultra thin,cyan]\draw(A) -| ++(0,-2pt) -|(B);%
  }%
}
\makeatother



\begin{document}


%#% extstart input intro.tex





%\tightlists
\firmlists
\midsloppy
\raggedbottom
\chapterstyle{demo3}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\input{memnoidxnum}

\frontmatter
\pagestyle{empty}


% title page
\vspace*{\fill}
\begin{center}
\HUGE\textsf{The Stellar Command Module}\par
\end{center}
\begin{center}
\LARGE\textsf{for}\par
\end{center}
\begin{center}
\HUGE\textsf{Integrating Astronomy and Art}\par
\end{center}

\begin{center}
\Huge\textsf{User Guide}\par
\end{center}
\begin{center}
\LARGE\textsf{Angelo Fraietta}\par
\bigskip
\LARGE\textsf{University of New South Wales}\par
%\normalsize\textsf{Maintained by Angelo Fraietta}\par
\medskip

\end{center}
\vspace*{\fill}
\def\THP{T\kern-0.2em H\kern-0.4em P}%   OK for CMR
\def\THP{T\kern-0.15em H\kern-0.3em P}%   OK for Palatino
\newcommand*{\THPress}{The Herries Press}%
\begin{center}

%\includegraphics[width=\droptitle]{anvil2.mps}
\setlength{\droptitle}{0pt}%
\end{center}
\clearpage

\PWnote{2009/06/26}{Updated the copyright page for 9th impression}
% copyright page
\begingroup
\footnotesize
\setlength{\parindent}{0pt}
\setlength{\parskip}{\baselineskip}


\begin{tabular}{@{} l l}
  \textcopyright{} 2018\:---\:2019 &Angelo Fraietta \\
\end{tabular}


All rights reserved



\begin{center}
\begin{tabular}{ll}
First edition:                        & 6 June 2019 \\

\end{tabular}
\end{center}
\ifMASTER
Manual last changed \svnyear/\svnmonth/\svnday
\fi

\endgroup

\clearpage

\pagestyle{headings}
%%%%\pagestyle{Ruled}

\setupshorttoc
\tableofcontents
\clearpage
\setupparasubsecs
\setupmaintoc

\begingroup

% important point here: We need \endlineshar=-1 here for the inline
% list of subsections. Why? Beacause we have subsection subsubsection
% subsection, and under hyperref running the l@subsubsection for
% subsubsection, which typesets nothing, ruins our \ignorespaces in
% our redefinition of \l@subsection (it cannot see and ignore the space after the
% \contentsline line for subsubsection). Easiest solution: use
% change \endlinechar
%
% Special thanks to David Carlisle in the tex.stackexchange.com chat
% for suggesting it


\endlinechar=-1


\tableofcontents

\endgroup


\setlength{\unitlength}{1pt}
\clearpage
\listoffigures
\clearpage
\listoftables
\clearpage
\listofegresults

%#% extend


%#% extstart include preface.tex
%\chapter{Foreword}

\svnidlong
{$Ignore: $}
{$LastChangedDate: 2014-11-05 16:28:11 +0100 (Wed, 05 Nov 2014) $}
{$LastChangedRevision: 501 $}
{$LastChangedBy: daleif $}

\chapter{Preface}

    From personal experience and also from lurking on the \url{comp.text.tex}
newsgroup the major problems with using \ltx\ are related to document
design. Some years ago most questions on \ctt\ were answered by
someone providing a piece of code that solved a particular problem, and
again and again. More recently these questions are answered along the
lines of `Use the ---------{} package', and again and again.

    I have used many of the more common of these packages but my filing system
is not always well ordered and I tend to mislay the various user manuals,
even for the packages I have written. The \Pclass{memoir} class is an attempt
to integrate some of the more design-related packages with the LaTeX
\Pclass{book} class. I chose the \Pclass{book} class as the \Pclass{report} class
is virtually identical to \Pclass{book}, except that \Pclass{book} does
not have an \Ie{abstract} environment while \Pclass{report} does; however it is 
easy to fake an \Ie{abstract} if it is needed. With a little bit of tweaking,
\Pclass{book} class documents can be made to look just like \Pclass{article}
class documents, and the \Pclass{memoir} class is designed with tweaking very
much in mind.

    The \Pclass{memoir} class effectively incorporates the facilties that
are usually accessed by using external packages. In most cases the class
code is new code reimplementing package functionalities. The exceptions
tend to be where I have cut and pasted code from some of my packages.
I could not have written the \Pclass{memoir} class without the excellent 
work presented by the implementors of \ltx\ and its many packages.

    Apart from packages that I happen to have written I have gained many
ideas from the other packages listed in the \bibname. One way or another
their authors have all contributed, albeit unknowingly. 
The participants in the
\url{comp.text.tex} newsgroup have also provided valuable input, partly
by questioning how to do something in \ltx, and partly by providing
answers. It is a friendly and educational forum.

{\raggedleft{\scshape Peter Wilson} \\ Seattle, WA \\ June 2001\par}


%#% extend

%#% extstart include intro-8.tex

\svnidlong
{$Ignore: $}
{$LastChangedDate: 2015-04-22 17:17:51 +0200 (Wed, 22 Apr 2015) $}
{$LastChangedRevision: 527 $}
{$LastChangedBy: daleif $}

\chapter{Introduction}


\chapter{Terminology}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    Like all professions and trades, typographers and printers have their
specialised vocabulary.

    First there is the question of pages, leaves and sheets. 
The trimmed sheets of paper\index{paper} that make up a book are called 
\emph{leaves}\index{leaf},
and I will call the untrimmed sheets the \emph{stock}\index{stock} material. 
A leaf
has two sides, and a \emph{page}\index{page} is one side of a leaf. 
If you think of a book
being opened flat, then you can see two leaves. The front of the righthand
leaf, is called the \emph{recto}\index{recto} page of that leaf, 
and the side of the
lefthand leaf that you see is called the \emph{verso}\index{verso} page 
of that leaf. 
So, a leaf has a recto and a verso page. Recto pages are the odd-numbered 
pages and verso pages are even-numbered.

   Then there is the question of folios. The typographical term for
the number of a page is \emph{folio}\index{folio}.
This is not to be confused with
the same term as used in `Shakespeare's First Folio' where the reference is
to the height and width of the book, nor to its use in the phrase
`\emph{folio} signature'\index{signature} where the term refers to the 
number of times a printed sheet is folded. 
Not every page in a book has a printed
folio, and there may be pages that do not have a folio at all. Pages with
folios, whether printed or not, form the \emph{pagination}\index{pagination} 
of the book. Pages
that are not counted in the pagination have no folios.

 I have not been able to find what I think is a good
definition for `type' as it seems to be used in different contexts with
different meanings. It appears to be a kind of generic word; for instance
there are type designers, type cutters, type setters, type foundries,...
For my purposes I propose that \emph{type}\index{type|seealso{typeface}} is 
one or more printable characters (or variations or extensions to this idea).  
Printers use the term \emph{sort}\index{sort} to refer to one piece of lead
type.

   A \emph{typeface}\index{typeface} is a set of one or more fonts, in one
or more sizes, designed as a stylistic whole. 

   A \emph{font}\index{font} is a set of characters. In the days of 
metal type and hot lead a font meant a complete alphabet and auxiliary
characters in a given size. More recently it is taken to mean a complete
set of characters regardless of size. A font of roman type normally
consists of CAPITAL LETTERS, \textsc{small capitals}, lowercase letters,
numbers, punctuation marks, ligatures (such as `fi' and `ffi'), and a
few special symbols like \&.

   A \emph{font family}\index{font!family} is a set of fonts designed to
work harmoniously together, such as a pair of roman and italic fonts.

   The size of a font\index{font} is expressed in points\index{point} 
(72.27 points equals 1 inch
equals 25.4 millimeters). The size is a rough indication of the height
of the tallest character, but different fonts with the same size may have
very different actual heights. Traditionally font sizes were referred to
by names (see \tref{tab:fontsizes}) but nowadays just the number of points 
is used.


\begin{table}
\centering
\caption{Traditional font size designations} \label{tab:fontsizes}
\begin{tabular}{cl@{\hspace{2em}}cl} \toprule
Points & Name & Points & Name \\ \midrule
%%3      & Excelsior \\
\phantom{0}3      & Excelsior &
11     &  Small Pica \\
\phantom{0}3\rlap{\slashfrac{1}{2}} & Brilliant &
12     & Pica \\
\phantom{0}4      & Diamond &
14     & English \\
\phantom{0}5      & Pearl &
18     & Great Primer \\
\phantom{0}5\rlap{\slashfrac{1}{2}} & Agate &
24     & Double (or Two Line) Pica \\
\phantom{0}6      & Nonpareil &
28     & Double (or Two Line) English \\
\phantom{0}6\rlap{\slashfrac{1}{2}} & Mignonette &
36     & Double (or Two Line) Great Primer \\
\phantom{0}7      & Minion &
48     & French Canon (or Four Line Pica) \\
\phantom{0}8      & Brevier &
60     & Five Line Pica \\
\phantom{0}9      & Bourgeois &
72     & Six line Pica \\
10     & Long Primer &
%%16     & Columbian \\
%%20     & Paragon \\
%%22     & Double Small Pica \\
%%32     & Four Line Brevier \\
%%40     & Double Paragon \\
%%44     & Meridian \\
96     & Eight Line Pica \\ \bottomrule
\end{tabular}
\end{table}



    The typographers' and printers' term for the vertical space between
the lines of normal text is \emph{leading}\index{leading}, which is also
usually expressed in points and is usually larger than the font size.
A convention for describing the font and leading is to give the font size 
and leading separated by a slash; for instance $10/12$ for a
10pt font set with a 12pt leading, or $12/14$ for a 12pt font set with a
14pt leading.

    The normal length of a line of text is often called the 
\emph{measure}\index{measure} and is normally specified in terms of
picas\index{pica} where 1 pica equals 12 points (1pc = 12pt).

    Documents may be described as being typeset with a particular font
with a particular size and a particular leading on a particular measure;
this is normally given in a shorthand form. 
A 10pt font with 11pt leading on a 20pc measure is described as
\abyb{10/11}{20}, and \abyb{14/16}{22} describes a 14pt font
with 16pt leading set on a a 22pc measure.

\section{Units of measurement}

    Typographers and printers use a mixed system of units, some of which
we met above. The fundamental unit is the point; \tref{tab:units} lists 
the most common units employed.


%#% extend

\cleardoublepage
\pagenumbering{arabic}

% body
\mainmatter


%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%\part{Practice} \label{part:practice}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%#% extstart include start-off.tex


\chapter{Starting off} \label{chap:starting}


    
%#% extend

\clearpage
\pagestyle{ruled}

%#% extstart include laying-out-page.tex


\chapter{Laying out the page} \label{chap:layingpage}




    You may run into problems if the \cmd{\sidebar} command comes near 
a pagebreak, or if the sidebar text gets typeset alongside main text that
has non-uniform line spacing (like around a \cmd{\section}). Further,
the contents of sidebars may not be typeset if they are too near to the
end of the document.

\begin{syntax}
\lnc{\sidebarwidth} \lnc{\sidebarhsep} \lnc{\sidebarvsep} \\
\end{syntax}
\glossary(sidebarwidth)%
  {\cs{sidebarwidth}}%
  {Width of sidebars.}
\glossary(sidebarhsep)%
  {\cs{sidebarhsep}}%
  {Space between the edge of the main text and sidebars.}
\glossary(sidebarvsep)%
  {\cs{sidebarvsep}}%
  {Vertical space between sidebars that fall on the same page.}
The \meta{text} of a \cmd{\sidebar} is typeset in a column of width 
\lnc{\sidebarwidth} and there is a horizontal gap of \lnc{\sidebarhsep}
between the main text and the sidebar. The length \lnc{\sidebarvsep}
is the vertical gap between sidebars that fall on the same page; it also
has a role in controlling the start of sidebars with respect to the
top of the page.

\begin{syntax}
\lnc{\sidebartopsep} \\
\cmd{\setsidebarheight}\marg{height} \\
\end{syntax}
\glossary(sidebartopsep)%
  {\cs{sidebartopsep}}%
  {Controls the vertical position of a sidebar. The default is 0pt which
   aligns the tops of the typeblock and the sidebar.}
\glossary(setsidebarheight)%
  {\cs{setsidebarheight}\marg{height}}%
  {Sets the height of sidebars. The default is \cs{textheight}.}
The length \lnc{\sidebartopsep} controls the vertical position of the top
of a sidebar. The default is 0pt which aligns it with the top of the
typeblock.
The command \cmd{\setsidebarheight} sets the height of sidebars to
\meta{height}, without making any allowance for \lnc{\sidebartopsep}.
The \meta{length} argument should be equivalent to an integral number 
of lines. For example:
\begin{lcode}
\setsidebarheight{15\onelineskip}
\end{lcode}
The default is the \lnc{\textheight}.

    Perhaps you would like sidebars to start two lines below the top of
the typeblock but still end at the bottom of the typeblock? If so, and
you are using the \Lpack{calc} package~\cite{CALC}, then the following
will do the job:
\begin{lcode}
\setlength{\sidebartopskip}{2\onelineskip}
\setsidebarheight{\textheight-\sidebartopskip}
\end{lcode}


    The alignment of the text in a sidebar with the main text may not
be particularly good and you may wish to do some experimentation
(possibly through a combination of \lnc{\sidebarvsep} and 
\cmd{\setsidebarheight}) to improve matters.

    Although you can set the parameters for your sidebars individually it
is more efficient to use the \cmd{\setsidebars} command; it \emph{must} be 
used if you change the font and/or the height.
\begin{syntax}
\cmd{\setsidebars}\marg{hsep}\marg{width}\marg{vsep}\marg{topsep}\marg{font}\marg{height} \\
\end{syntax}
\glossary(setsidebars)%
  {\cs{setsidebars}\marg{hsep}\marg{width}\marg{vsep}\marg{topsep}\marg{font}\marg{height}}%
  {Sets the several sidebar parameters.}

The \cmd{\setsidebars} command can be used to set the sidebar parameters.
\lnc{\sidebarhsep} is set to \meta{hsep}, \lnc{\sidebarwidth} is set to
\meta{width}, \lnc{\sidebarvsep} is set to \meta{vsep}, \lnc{\sidebartopsep}
is set to \meta{topsep}, \cmd{\sidebarfont} is set to \meta{font}, 
and finally \cmd{\setsidebarheight} is used to set the height to \meta{height}.
The default is:
\LMnote{2010/02/07}{the default was wrong compared to the class}
\begin{lcode}
\setsidebars{\marginparsep}{\marginparwidth}{\onelineskip}%
            {0pt}{\normalsize\normalfont}{\textheight}
\end{lcode}
Any, or all, of the arguments can be a \verb?*?, in which case the parameter
corresponding to that argument is unchanged. Repeating the above example of 
changing the topskip and the height, assuming that the other defaults are 
satisfactory except that the width should be 3cm and an italic font should 
be used:
\begin{lcode}
\setsidebars{*}{3cm}{*}{2\onelineskip}{\itshape}%
            {\textheight-\sidebartopsep}
\end{lcode}

   Changing the marginpar parameters, for example with \cmd{\setmarginnotes},
will not affect the sidebar parameters.

   Note that \cmd{\checkandfixthelayout} neither checks nor fixes any of
the sidebar parameters. This means, for instance, that if you change the
\lnc{\textheight} from its default value and you want sidebars to have 
the same height then after changing the \lnc{\textheight} you have to 
call \cmd{\checkandfixthelayout}  and then call \cmd{\setsidebars} with
the (new) \lnc{\textheight}. For instance:
\begin{lcode}
...
\settypeblocksize{40\baselineskip}{5in}{*}
...
\checkandfixthelayout
\setsidebars{...}{...}{...}{...}{...}{\textheight}
\end{lcode}

    Unfortunately if a sidebar is on a double column page that either includes
a double column float or starts a new chapter then the top of the sidebar
comes below the float or the chapter title. I have been unable to eliminate 
this `feature'.


\section{Side footnotes}
\label{sec:side-footnotes}

Besides three already mentioned macros for writing in the margin
(\cmd{\marginpar}, \cmd{\sidepar}, and \cmd{\sidebar}) \theclass\ also
provide a functionality to add side footnotes. Actually two ways: one
is to internally make \cmd{\footnote} use \cmd{\marginpar} to write
in the margin, the other is to collect all side footnotes bottom up in
the margin.
\begin{syntax}
  \cmd{\footnotesatfoot}\\
  \cmd{\footnotesinmargin}\\
\end{syntax}
\cmd{\footnotesatfoot} (the default) causes \cmd{\footnote} to place
its text at the bottom of the page. By issuing \cmd{footnotesinmargin}
\cmd{\footnote} (and friends like \cmd{\footnotetext})will internally
use \cmd{\marginpar} to write the footnote to the page.



\subsection{Bottom aligned side footnotes}
\label{sec:bottom-aligned-side}

Bottom aligned footnotes works just like regular footnotes, just with
a separate macro \cmd{\sidefootenote}\marg{text}, and here the side
footnotes are placed at the bottom of the specified margin (more or
like as if one had taken the footnotes from the bottom of the page and
moved it to the margin instead). All the major functionality is the
same as for the normal \cmd{\footnote}
command.\footnote{\cs{sidefootnote} does not make sense inside
  minipages\dots}
\begin{syntax}
  \cmd{\sidefootnote}\oarg{num}\marg{text}\\
  \cmd{\sidefootnotemark}\oarg{num}\\
  \cmd{\sidefootnotetext}\oarg{num}\marg{text}\\
\end{syntax}

By default the regular footnotes and the side footnotes use different
counters. If one would like them to use the same counter, issue the
following in the preamble:
\begin{lcode}
  \letcountercounter{sidefootnote}{footnote}
\end{lcode}


\subsection{Setting the layout for
  \texorpdfstring{\cs{sidefootnote}}{sidefootnote}} 
\label{sec:sett-layo-texorpdfst}



There are several possibilities to change the appearance of the
\cmd{\sidefootnote}:

Specifying the margin in which the side footnote should go, is done by 
\begin{syntax}
  \cmd{\sidefootmargin}\marg{keyword}\\
\end{syntax}
where \meta{keyword} can be \emph{left}, \emph{right}, \emph{outer}, and
\emph{inner}, and their meaning is explained in
\fref{fig:xmargin}. The default is \emph{outer}.

\begin{syntax}
  \lnc{\sidefoothsep}\\
  \lnc{\sidefootwidth}\\
  \lnc{\sidefootvsep}\\
\end{syntax}
\cmd{\sidefoothsep} is a length controlling the separation from the
text to the side footnote column, default
\cmd{\marginparsep}. \cmd{\sidefootwidth} is length controlling the
width of the side footnote column, default \cmd{\marginparwidth}, and
\cmd{\sidefootvsep} is the vertical distance between two side
footnotes, default \cmd{\onelineskip}.

\begin{syntax}
  \lnc{\sidefootadjust}\\
  \cmd{\setsidefootheight}\marg{height}\\
  \cmd{\sidefootfont}\\
\end{syntax}
\cmd{\sidefootadjust} is a length which specifies the placement of the
side footnote column in relation to the bottom of the text block, the
default is 0pt. \cmd{\setsidefootheight} sets the maximal height of
the side footnote column, default \cmd{textwidth}. Lastly
\cmd{\sidefootfont} holds the general font setting for the side
footnote,\footnote{There is a similar macro to control the font of the
  text alone.} default \verb?\normalfont\footnotesize?.


The macro
\begin{syntax}
   \cmd{\setsidefeet}\marg{hsep}\marg{width}\marg{vsep}\marg{adj}\marg{font}\marg{height}\\
\end{syntax}
sets the specifications all six settings above in one go.. An `*'
means `use the current value'. So \theclass\ internally use the
following default
\begin{lcode}
  \setsidefeet{\marginparsep}{\marginparwidth}%
  {\onelineskip}{0pt}%
  {\normalfont\footnotesize}{\textheight}%
\end{lcode}
It is recommended to use this macro along with the other macros in the
preamble to specify document layout.

\subsection{Styling 
  \texorpdfstring{\cs{sidefootnote}}{sidefootnote}} 


\begin{syntax}
  \cmd{\sidefootmarkstyle}\marg{code}\\
\end{syntax}
controls how the side footnote counter is typeset in the side
footnote. The default is
\begin{lcode}
  \sidefootmarkstyle{\textsuperscript{#1}}
\end{lcode}

The mark is typeset in a box of width \lnc{\sidefootmarkwidth}
If this is negative, the mark is outdented
into the margin, if zero the mark is flush left, and when positive
the mark is indented. The mark is followed by the 
text\index{side footnote!text} of the footnote. Second and later lines of the
text are offset by the length \lnc{\sidefootmarksep} from the end of the box.
The first line of a paragraph within a footnote is indented by
\lnc{\sidefootparindent}. The default values for these lengths are:
\begin{lcode}
  \setlength{\sidefootmarkwidth}{0em}
  \setlength{\sidefootmarksep}{0em}
  \setlength{\sidefootparindent}{1em}
\end{lcode}


\fancybreak{}

Caveat: It is natural to specify a length as \lnc{\sidefootparindent}
as a \LaTeX\ length, but it has a down side. If, as we do here, set
the value to 1em, then since the size of the em unit changes with the
current font size, one will actually end up with an indent
corresponding to the font size being used when the
\begin{lcode}
  \setlength{\sidefootparindent}{1em}
\end{lcode}
was issued, not when it has used (where the font size most often will
be \cmd{\footnotesize}).

At this point we consider this to be a \emph{feature} not an
error. One way to get pass this problem it the following
\begin{lcode}
\begingroup% keep font change local
\sidefoottextfont
\global\setlength\sidefootparindent{1em}
\endgroup  
\end{lcode}
Then it will store the value of em corresponding to the font being
used. 


\LMnote{2010/02/07}{explained the rest, left the side footnote hook
  out of it for now}
\begin{syntax}
  \cmd{\sidefoottextfont}\\
\end{syntax}
holds the font being used by the side footnote, default
\verb+\normalfont\footnotesize+. 
\begin{syntax}
  \cmd{\sidefootform}\\
\end{syntax}
is used to specify the raggedness of the text. Default
\begin{lcode}
  \newcommand*{\sidefootform}{\rightskip=\z@ \@plus 2em}
\end{lcode}
which is much like \cs{raggedright} but allows some hyphenation. One
might consider using
\begin{lcode}
  \usepackage{ragged2e}
  \newcommand*{\sidefootform}{\RaggedRight}
\end{lcode}
Which does something similar.





\subsection{Side footnote example}
\label{sec:side-footn-example}



In the margin you will find the result of the following code:
\begin{verbatim}
  Testing\sidefootnote{This is test} bottom aligned
  footnotes.\sidefootnote{This is another side 
  footnote, spanning several lines.

  And several paragraphs}\sidefootnote{And number three}
\end{verbatim}
  Testing\sidefootnote{This is test} bottom aligned
  footnotes.\sidefootnote{This is another side 
  footnote, spanning several lines.

  And several paragraphs}\sidefootnote{And number three}


\LMnote{2013/05/02}{Moved here from backmatter.tex}

\section{Endnotes}
\label{sec:endnotes}

\LMnote{2010/10/28}{several \cs{printpagenotes} was spelled wrong}

\reimplemented{December 2010}{The former implementation had some
  difficulties handling certain types of input. A few of the macros
  used to format the output are no longer supported/used in the new
  implementation.}


    Endnotes are often used instead of footnotes so as not to interrupt the
flow of the main text. Although endnotes are normally put at the end of 
the document, they may instead be put at the end of each chapter.

    The \Lpack{endnotes} package already uses the command \cmd{\endnote} for
an endnote, so the class uses \cmd{\pagenote} for an endnote so as not 
to clash if you prefer to use the package. 
\LMnote{2011/01/23}{The implementation has nothing to do with the
  current pagenote package, thus the remark is removed}
% The following was originally supplied as the \Lpack{pagenote}
% package~\cite{PAGENOTE}. 

\begin{syntax}
\cmd{\makepagenote} \\
\cmd{\pagenote}\oarg{id}\marg{text} \\
\cmd{\printpagenotes} \cmd{\printpagenotes*} \\
\end{syntax}
\glossary(makepagenote)%
  {\cs{makepagenote}}%
  {Preamble command for enabling page/end notes.}%
\glossary(printpagenotes)%
  {\cs{printpagenotes}}%
  {Input the pagenote \file{ent} file for printing, then close it to any 
   more notes.}%
\glossary(printpagenotes*)%
  {\cs{printpagenotes*}}%
  {Input the pagenote \file{ent} file for printing, then empty it ready for 
   further notes.}%

   The general principle is that notes are written out to a file which
is then input at the place where the notes are to be printed. The note 
file has an \pixfile{ent} extension, like the table of contents file
has a \pixfile{toc} extension.

    You have to put \cmd{\makepagenote} in your preamble if you want 
endnotes. This will open the \pixfile{ent} note file which is called
\verb?\jobname.ent?.

   In the body of the text use use \cmd{\pagenote} to create an endnote, just
as you would use \cmd{\footnote} to create a footnote. In the books that I have
checked there are two common methods of identifying an endnote:
\begin{enumerate}
\item Like a footnote, put a number in the text at the location 
of the note and use the same number to identify the note when it
finally gets printed.\label{pagenote:id1}
\item Put no mark in the text, but when it is finally 
      printed\pagenote[Put no mark \ldots finally printed]{This manual uses
      both footnotes and endnotes. For identifying the endnotes I have used the
      `words' method for identifying the parent location of an endnote, so as not
      to start confusing the reader with two sets of note marks in the body of the
      text. Typically either footnotes or endnotes are used, not both, so the
      question of distinguishing them does not normally arise.}
use a few words from the text to identify the origin of the note. The page number
is often used as well with this method.\label{pagenote:id2}
\end{enumerate}
The \meta{text} argument of \cmd{\pagenote} is the contents of the note and
if the optional \meta{id} argument is not used the
result is similar to having used \cmd{\footnote} --- a number in the main text
and the corresponding number in the endnotes listing (as 
in \ref{pagenote:id1} above). For the second reference style 
(\ref{pagenote:id2} above) use the 
optional \meta{id} argument for the `few words', and no mark will be put
into the main text but \meta{id} will be used as the identification in
the listing.

   For one set of endnotes covering the whole document put 
\cmd{\printpagenotes} where you want them printed, typically before
any bibliography or index. The \cmd{\printpagenotes} macro inputs the
\pixfile{ent} endnote file for printing and then closes it to any further
notes.

For notes
at the end of each chapter put \cmd{\printpagenotes*}, which inputs
the \pixfile{ent} file for printing then empties it ready for more notes,
at the end of each chapter.

   The simple use is like this:
\begin{lcode}
\documentclass[...]{memoir}
...
\makepagenote
...
\begin{document}
\chapter{One}
...\pagenote{An end note.} ...
...\pagenote{Fascinating information.}
...
\chapter{Last}% chapter 9
...\pagenote{Another note.}% 30th note
...
...
\printpagenotes
...
\end{document}
\end{lcode}
This will result in an endnote listing looking like \fref{fig:endnote}.

\begin{figure}
\centering
\begin{minipage}{0.8\textwidth}
\begin{framed}
\noindent{\bfseries\Large Notes}\\[\baselineskip]
{\bfseries Chapter 1 One} \\[\baselineskip]
1. An end note \\
2. Fascinating information. \\
.............. \\[\baselineskip]
{\bfseries Chapter 9 Last} \\[\baselineskip]
1. Another note \\[\baselineskip]
\end{framed}
\end{minipage}
\caption{Example endnote listing}\label{fig:endnote}
\end{figure}

For notes at the end of each chapter:
\begin{lcode}
\documentclass[...]{memoir}
...
\makepagenote
...
\begin{document}
\chapter{One}
...\pagenote{An end note.} ...
...
\printpagenotes*
\chapter{Last}
...\pagenote{Another note.} ...
...
\printpagenotes*
%%% no more chapters
...
\end{document}
\end{lcode}

\begin{syntax}
\cmd{\continuousnotenums} \\
\cmd{\notepageref} \\
\end{syntax}
\glossary(continuousnotenums)%
  {\cs{continuousnotenums}}%
  {Declaration to make the numbering of endnotes continuous throughout the
   document.}%
\glossary(notepageref)%
  {\cs{notepageref}}%
  {Declaration that page numbers are available to notes in the endnote listing.}
   The \Icn{pagenote} counter is used for the notes. By default the endnotes 
are numbered per chapter. If you want the numbering
to be continuous throughout the document use the \cmd{\continuousnotenums}
declaration. Normally the information on which page a note was created is
discarded but will be made available to notes in the endnote listing
following the \cmd{\notepageref} declaration.  Both
\cmd{\continuousnotenums} and \cmd{\notepageref} can only be used in
the preamble.

\LMnote{2011/01/23}{Because of the new implementation this is no
  longer needed as the writing to file is no longer delayed.}
% Because of how TeX writes information to files, when the
% \cmd{\notepageref} declaration is used there must be no notes on the
% page where \cmd{\printpagenotes} or \cmd{\printpagenotes*} closes the
% \pixfile{ent} file.  If necessary, a \cmd{\clearpage} or similar must
% be used before the print command.

\begin{syntax}
\cmd{\notesname} \\
\cmd{\notedivision} \\
\end{syntax}
\glossary(notesname)%
  {\cs{notesname}}%
  {Name for endnotes, default \texttt{Notes}.}%
\glossary(notedivision)%
  {\cs{notedivision}}%
  {Heading printed by the \cs{printpagenotes} and \cs{printpagenotes*} macros.}

  When \cmd{\printpagenotes} (or \cmd{\printpagenotes*}) is called the
  first thing it does is call the macro \cmd{\notedivision}. By
  default this is defined as:
\begin{lcode}
\newcommand*{\notedivision}{\chapter{\notesname}}
\end{lcode}
with
\begin{lcode}
  \newcommand*{\notesname}{Notes}
\end{lcode}
In other words, it will print out a heading for the notes that will be read
from the \file{ent} file. \verb?\print...? then closes the \pixfile{ent} file 
for writing and after this \verb?\input?s it to get and process the notes.


\subsection{Changing the appearance}

 If the something is like a figure\index{figure} with a numbered caption and the numbering
 depends on the chapter numbering, then the numbers have to be hand set (unless
 you define a special chapter command for the purpose). For example:
\begin{lcode}
 ... end previous chapter.
 \cleartoevenpage[\thispagestyle{empty}] % a skipped page to be empty
 \thispagestyle{plain}
 \addtocounter{chapter}{1} % increment the chapter number
 \setcounter{figure}{0}    % initialise figure counter
 \begin{figure}
 ...
 \caption{Pre chapter figure}
 \end{figure}

 \addtocounter{chapter}{-1} % decrement the chapter number
 \chapter{Next chapter}     % increments chapter & resets figure numbers
 \addtocounter{figure}{1}   % to account for pre-chapter figure
\end{lcode}
 

 \subsection{Epigraphs on book or part pages}

\index{epigraph|(}

    If you wish to put an epigraphs on \cmd{\book} or \cmd{\part}
pages you have to do a little more work than in other cases. This
is because these division commands do some page flipping before and
after typesetting the title.

   One method is to put the epigraph into the page header as for epigraphs
before \cmd{\chapter} titles. By suitable adjustments the epigraph can be
placed anywhere on the page, independently of whatever else is on the page.
     A similar scheme may be used for epigraphs on other kinds of pages. 
 The essential
 trick is to make sure that the \pstyle{epigraph} pagestyle is used for
 the page.
    For an epigraphed bibliography\index{bibliography} 
or index\index{index}, the macros \cmd{\prebibhook}
or \cmd{\preindexhook} can be appropriately modified to do this.

    The other method is to subvert the \cmd{\beforepartskip} command 
for epigraphs before the title, or the \cmd{\afterpartskip} command
for epigraphs after the title (or the equivalents for \cmd{\book} pages).

    For example:
\begin{lcode}
\let\oldbeforepartskip\beforepartskip % save definition
\renewcommand*{\beforepartskip}{%
  \epigraph{...}{...}% an epigraph
  \vfil}
\part{An epigraphed part}
...
\renewcommand*{\beforepartskip}{%
  \epigraph{...}{...}% another epigraph
  \vfil}
\part{A different epigraphed part}
...
\let\beforepartskip\oldbeforepartskip % restore definition
\part{An unepigraphed part}
...
\end{lcode}


\index{epigraph|)}

%#% extend
%#% extstart include poetry.tex

\svnidlong
{$Ignore: $}
{$LastChangedDate: 2013-04-24 17:14:15 +0200 (Wed, 24 Apr 2013) $}
{$LastChangedRevision: 442 $}
{$LastChangedBy: daleif $}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\clearpage
%\pagestyle{Ruled}
%%\chapterstyle{demo}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Poetry} \label{chap:verse}


    The typesetting of a poem should ideally be dependent on the
particular poem. Individual problems do not usually admit of a
general solution, so this manual and code should be used more
as a guide towards some solutions rather than providing a ready
made solution for any particular piece of verse.

    The doggerel used as illustrative material has been taken 
from~\cite{RUMOUR}.

    Note that for the examples in this section I have made no attempt
to do other than use the minimal \alltx\ capabilities; in particular
I have made no attempt to do any special page breaking so some stanzas
may cross onto the next page --- most undesireable for publication.

\index{verse|(}
\index{verse!typesetting environments|(}

    The standard \ltx\ classes provide the \Ie{verse} environment which 
is defined as a particular kind of list. Within the environment you 
use \cmd{\\}\index{verse!end a line} to end a line, 
and a blank line will end\index{verse!end a stanza}\index{stanza!end} a 
stanza. For example, here is the text of a single stanza poem:
\begin{lcode}
\newcommand{\garden}{
I used to love my garden \\
But now my love is dead \\
For I found a bachelor's button \\
In black-eyed Susan's bed.
}
\end{lcode}
\newcommand{\garden}{
I used to love my garden \\
But now my love is dead \\
For I found a bachelor's button \\
In black-eyed Susan's bed.
}
When this is typeset as a normal \ltx\ paragraph\index{paragraph} 
(with no paragraph indentation), i.e.,
\begin{lcode}
\noident\garden
\end{lcode}
it looks like: \\[\baselineskip]
\garden{}

\vspace*{\onelineskip}

   Typesetting it within the \Ie{verse} environment produces:% \\[\baselineskip]

\begin{verse}\index[lines]{I used to love my garden}  
\garden
\end{verse}

%\ablankline

The stanza could also be typeset within the \Ie{alltt} environment, defined
in the standard \Lpack{alltt} package~\cite{ALLTT}, 
using a normal font and no \cmd{\\} line endings.
\begin{lcode}
\begin{alltt}\normalfont
I used to love my garden 
But now my love is dead 
For I found a bachelor's button 
In black-eyed Susan's bed.
\end{alltt}
\end{lcode}
which produces:

\begin{alltt}\normalfont
I used to love my garden 
But now my love is dead 
For I found a bachelor's button 
In black-eyed Susan's bed.
\end{alltt}

The \Ie{alltt} environment is like the \Ie{verbatim} environment except that
you can use LaTeX macros inside it. 
   In the \Ie{verse} environment long lines\index{verse!long lines}  
will be wrapped and indented
but in the \Ie{alltt} environment there is no indentation. 

Some stanzas have certain lines\index{verse!indent line} indented, 
often alternate ones. To
typeset stanzas like this you have to add your own spacing. For
instance:
\begin{lcode}
\begin{verse}
There was an old party of Lyme \\
Who married three wives at one time. \\
\hspace{2em} When asked: `Why the third?' \\
\hspace{2em} He replied: `One's absurd, \\
And bigamy, sir, is a crime.'
\end{verse}
\end{lcode}
is typeset as: 
\begin{verse}\index[lines]{There was an old party of Lyme}
There was an old party of Lyme \\
Who married three wives at one time. \\
\hspace{2em} When asked: `Why the third?' \\
\hspace{2em} He replied: `One's absurd, \\
And bigamy, sir, is a crime.'
\end{verse}
\vspace{\onelineskip}

Using the \Ie{alltt} environment you can put in the spacing via ordinary
spaces. That is, this:
\begin{lcode}
\begin{alltt}\normalfont
There was an old party of Lyme
Who married three wives at one time.
      When asked: `Why the third?' 
      He replied: `One's absurd, 
And bigamy, sir, is a crime.'
\end{alltt}
\end{lcode}
is typeset as

\begin{alltt}
\normalfont
There was an old party of Lyme
Who married three wives at one time.
      When asked: `Why the third?' 
      He replied: `One's absurd, 
And bigamy, sir, is a crime.'
\end{alltt}

More exotically you could use the TeX \cmd{\parshape} 
command\footnote{See the \btitle{\tx book} for how to use this.}:
\begin{lcode}
\parshape = 5 0pt \linewidth 0pt \linewidth 
              2em \linewidth 2em \linewidth 0pt \linewidth
\noindent There was an old party of Lyme \\
Who married three wives at one time. \\
When asked: `Why the third?' \\
He replied: `One's absurd, \\
And bigamy, sir, is a crime.' \par
\end{lcode}
which will be typeset as:

\vspace*{\onelineskip}

\parshape = 5 0pt \linewidth 0pt \linewidth 
              2em \linewidth 2em \linewidth 0pt \linewidth
\noindent There was an old party of Lyme \\
Who married three wives at one time. \\
When asked: `Why the third?' \\
He replied: `One's absurd, \\
And bigamy, sir, is a crime.' \par


\vspace*{\onelineskip}

   This is about as much assistance as standard \alltx\ provides, except
to note that in the \Ie{verse} environment the \cmd{\\*} version of \cmd{\\}
will prevent\index{verse!prevent page break} a following page break. 
You can also make judicious use
of the \cmd{\needspace} macro to keep things together.

\index{verse!typesetting environments|)}

   Some books of poetry, and especially anthologies, have two or more
indexes\index{index}\index{verse!multiple indexes}, one, say for the 
poem titles and another for the 
first lines, and maybe even a third for the poets' names. 
If you are not using \Lclass{memoir} then 
the \Lpack{index}~\cite{INDEX} and \Lpack{multind}~\cite{MULTIND}
packages provide support for multiple indexes\index{index!multiple} 
in one document.

%\clearpage
\section{Classy verse} 

    The code provided by the \Lclass{memoir} class is meant to help
with some aspects of typesetting poetry but does not, and cannot,
provide a comprehensive solution to all the requirements that
will arise.

    The main aspects of typesetting poetry that differ from typesetting
plain text are:
\begin{itemize}
\item Poems are usually visually centered\index{verse!centering} on the page.
\item Some lines\index{verse!indent line} are indented, and often there 
      is a pattern\index{verse!indent pattern} to the indentation.
\item When a line is too wide\index{verse!long line} for the page it is 
      broken and the
      remaining portion indented with respect to the original start
      of the line.
\end{itemize}
These are the ones that the class attempts to deal with.

\begin{syntax}
\senv{verse}\oarg{length} ... \eenv{verse} \\
\lnc{\versewidth} \\
\end{syntax}
\glossary(verse)%
  {\senv{verse}\oarg{length}}%
  {Environment for typesetting verse; if given the midpoint of \meta{length}
   is placed at the center of the typeblock measure.}
\glossary(versewidth)%
  {\cs{versewidth}}%
  {Scratch length, typically for use in verse typesetting.}
The \Ie{verse} environment provided by the class is an extension
of the usual LaTeX environment. The environment takes one optional
parameter, which is a length; for example \verb?\begin{verse}[4em]?.
You may have noticed that the earlier verse examples are all
near the left margin\index{margin!left}, whereas verses usually look better 
if they
are typeset about the center of the page. The length parameter,
if given, should be about the length of an average line, and then
the entire contents\index{verse!centering} will be typeset with the mid 
point of the length centered horizontally on the page.

The length \lnc{\versewidth} is provided as a convenience. It may be used,
for example, to calculate the length of a line of text for use
as the optional argument to the \Ie{verse} environment: 
\begin{lcode}
\settowidth{\versewidth}{This is the average line,}
\begin{verse}[\versewidth]
\end{lcode}

\begin{syntax}
\lnc{\vleftmargin} \\
\end{syntax}
\glossary(vleftmargin)%
  {\cs{vleftmargin}}%
  {General verse indent from the left of the typeblock.}
In the basic \ltx\ \Ie{verse} environment the body of the verse is indented
from the left of the typeblock by an amount \lnc{\leftmargini}, as is the
text in many other environments based on the basic \ltx\ \Ie{list}
environment. For the class's version of \Ie{verse} the default indent
is set by the length \lnc{\vleftmargin} (which is initially set to
\lnc{leftmargini}). For poems with particularly long 
lines\index{verse!long line} it could perhaps be
advantageous to eliminate any general indentation by:
\begin{lcode}
\setlength{\vleftmargin}{0em}
\end{lcode}
If necessary the poem could even be moved into the left margin by giving
\lnc{\vleftmargin} a negative length value, such as -1.5em.

\begin{syntax}
\lnc{\stanzaskip} \\
\end{syntax}
\glossary(stanzaskip)%
  {\cs{stanzaskip}}%
  {Vertical space between verse stanzas.}
    The vertical space\index{stanza!space} between stanzas is the 
length \lnc{\stanzaskip}. It can be changed by the usual methods.

\begin{syntax}
\cmd{\vin} \\
\lnc{\vgap} \\
\lnc{\vindent} \\
\end{syntax}
The command \cmd{\vin} is shorthand for \verb?\hspace*{\vgap}? for use
at the start of an indented\index{verse!indent space} line of verse. 
The length \lnc{\vgap}
(initially 1.5em) can be changed by \cmd{\setlength} or \cmd{\addtolength}.
When a verse line\index{verse!long line} is too long to fit within the 
typeblock\index{typeblock} it is wrapped\index{verse!wrapped line indent} 
to the next line with an initial indent given by the value of the length
\lnc{vindent}. Its initial value is twice the default value of \lnc{\vgap}.

\begin{syntax}
\cmd{\\}\oarg{length} \\
\cmd{\\*}\oarg{length} \\
\cmdprint{\\!}\oarg{length} \\
\end{syntax}
\glossary(\\)%
  {\Vprint{\\}\oarg{length}}%
  {Ends a verse line, and adds \meta{length} vertical space.}
\glossary(\\*)%
  {\Vprint{\\*}\oarg{length}}%
  {Ends a line while preventing a pagebreak, and adds \meta{length} vertical space.}
\glossary(\\!)
  {\Vprint{\\!}\oarg{length}}%
  {Ends a verse stanza, and adds \meta{length} vertical space.}

Each line in the \Ie{verse} environment, except possibly for the last line
in a stanza\index{stanza!last line}, 
must be ended by \cmd{\\}, which comes in several variants. In each variant
the optional \meta{length} is the vertical space to be left before the next
line. The \cmd{\\*} form prohibits a page 
break\index{stanza!prevent page break} after the line. 
The \pixslashbang\ form is to be used only for the last 
line\index{stanza!last line!numbering} in a stanza
when the lines are being numbered; this is because the line 
numbers\index{line number} are incremented by the \cmd{\\} macro. 
It would normally be followed by a blank line.

\begin{syntax}
\cmd{\verselinebreak}\oarg{length} \\
\cmdprint{\\>}\oarg{length} \\
\end{syntax}
\glossary(verselinebreak)
  {\cs{verselinebreak}\oarg{length}}%
  {Makes a break in a verse line, indenting the next part by twice \cs{vgap},
   or by \meta{length} if it is given.}
\glossary(\\>)
  {\Vprint{\\>}\oarg{length}}%
  {Shorthand for \cs{verselinebreak}.}
Using \cmd{\verselinebreak} will cause later\index{stanza!line break}
text in the line to be typeset 
indented\index{stanza!line break!indent} on the following line. 
If the optional \meta{length} is not given
the indentation is twice \lnc{\vgap}, otherwise it is \meta{length}.
The broken line will count as a single line as far as the \Ie{altverse}
and \Ie{patverse} environments are concerned. The macro \cmd{\\>} is
shorthand for \cmd{\verselinebreak}, and unlike other members of the \cmd{\\}
family the optional \meta{length} is the indentation of the following 
partial\index{stanza!line break!indent} line, not a vertical skip. 
Also, the \cmd{\\>} macro does not increment any 
line number\index{line number}.

\begin{syntax}
\cmd{\vinphantom}\marg{text} \\
\end{syntax}
\glossary(vinphantom)%
  {\cs{vinphantom}\marg{text}}%
  {Leaves a space as wide as \meta{text}.}
Verse lines are sometimes indented according to the space taken by
the text on the previous line. The macro \cmd{\vinphantom} can be used
at the start of a line\index{verse!indent space} to give an indentation 
as though the
line started with \meta{text}. For example here are a few lines from
the portion of \textit{Fridthjof's Saga} where Fridthjof and Ingeborg part:
\begin{egsource}{eg:fridthjof}
\settowidth{\versewidth}{Nay, nay, I leave thee not, 
                         thou goest too}
\begin{verse}[\versewidth]
\ldots \\* 
His judgement rendered, he dissolved the Thing. \\*
\flagverse{Ingeborg} And your decision? \\*
\flagverse{Fridthjof} \vinphantom{And your decision?} 
                      Have I ought to choose? \\*
Is not mine honour bound by his decree? \\*
And that I will redeem through Angantyr \\*
His paltry gold doth hide in Nastrand's flood. \\*
Today will I depart. \\*
\flagverse{Ingeborg} \vinphantom{Today will I depart.} 
                     And Ingeborg leave? \\*
\flagverse{Fridthjof} Nay, nay, I leave thee not, 
                      thou goest too. \\*
\flagverse{Ingeborg} Impossible! \\*
\flagverse{Fridthjof} \vinphantom{Impossible!} 
                      O! hear me, ere thou answerest.
\end{verse}
\end{egsource}

\begin{egresult}[Phantom text in verse]{eg:fridthjof}%
\settowidth{\versewidth}{Nay, nay, I leave thee not, 
                         thou goest too}%
\begin{verse}[\versewidth]
\ldots\index[lines]{His judgement rendered, he dissolved the Thing} \\*
His judgement rendered, he dissolved the Thing. \\*
\flagverse{Ingeborg} And your decision? \\*
\flagverse{Fridthjof} \vinphantom{And your decision?} 
                      Have I ought to choose? \\*
Is not mine honour bound by his decree? \\*
And that I will redeem through Angantyr \\*
His paltry gold doth hide in Nastrand's flood. \\*
Today will I depart. \\*
\flagverse{Ingeborg} \vinphantom{Today will I depart.} 
                      And Ingeborg leave? \\*
\flagverse{Fridthjof} Nay, nay, I leave thee not, 
                      thou goest too. \\*
\flagverse{Ingeborg} Impossible! \\*
\flagverse{Fridthjof} \vinphantom{Impossible!} 
                       O! hear me, ere thou answerest.
\end{verse}
\end{egresult}

    Use of \cmd{\vinphantom} is not restricted to the start of verse lines ---
it may be used anywhere in text to leave some some 
blank\index{blank space} space.
For example, compare the two lines below, which are produced by this code:
\begin{lcode}
   \noindent Come away with me and be my love --- Impossible. \\
Come away with me \vinphantom{and be my love} --- Impossible.
\end{lcode}
\noindent Come away with me and be my love --- Impossible. \\
          Come away with me \vinphantom{and be my love} --- Impossible.

\begin{syntax}
\cmd{\vleftofline}\marg{text} \\
\end{syntax}
\glossary(vleftofline)%
  {\cs{vleftofline}\marg{text}}%
  {`Hanging left' \meta{text} at the start of a verse line.}
A verse line may start with something, for example open quote marks, 
where it is desireable that it is ignored as far as the alignment of the
rest of the line is concerned\footnote{Requested by Matthew 
Ford\index{Ford, Matthew} who also provided the example text.} --- a sort
of `hanging left punctuation'. When it is put at the start of a line
in the \Ie{verse} environment the \meta{text} is typeset but ignored as 
far as horizontal indentation is concerned.
Compare the two examples.

\begin{egsource}{eg.joel1}
\noindent ``No, this is what was spoken by the prophet Joel:
\begin{verse}
``\,`\,``In the last days,'' God says, \\
``I will pour out my spirit on all people. \\
Your sons and daughters will prophesy, \\
\ldots \\
And everyone who calls \ldots ''\,'
\end{verse}
\end{egsource}

\begin{egresult}[Verse with regular quote marks]{eg.joel1}
\noindent ``No, this is what was spoken by the prophet Joel:
\begin{verse}
``\,`\,``In the last days,'' God says, \\
``I will pour out my spirit on all people. \\
Your sons and daughters will prophesy, \\
\ldots \\
And everyone who calls \ldots ''\,'
\end{verse}
\end{egresult}

\begin{egsource}{eg.joel2}
\noindent ``No, this is what was spoken by the prophet Joel:
\begin{verse}
\vleftofline{``\,`\,``}In the last days,'' God says, \\
\vleftofline{``}I will pour out my spirit on all people. \\
Your sons and daughters will prophesy, \\
\ldots \\
And everyone who calls \ldots ''\,'
\end{verse}
\end{egsource}

\begin{egresult}[Verse with hanging left quote marks]{eg.joel2}
\noindent ``No, this is what was spoken by the prophet Joel:
\begin{verse}
\vleftofline{``\,`\,``}In the last days,'' God says, \\
\vleftofline{``}I will pour out my spirit on all people. \\
Your sons and daughters will prophesy, \\
\ldots \\
And everyone who calls \ldots ''\,'
\end{verse}
\end{egresult}



\subsection{Indented lines}

Within the \Ie{verse} environment stanzas are normally separated by a 
blank line in the input. 

\begin{syntax}
\senv{altverse} ... \eenv{altverse} \\
\end{syntax}
\glossary(altverse)%
  {\senv{altverse}}%
  {Alternate lines in the stanza are indented.}
Individual stanzas within \Ie{verse} may, however, 
be enclosed in the \Ie{altverse}\index{stanza!indent alternate lines} 
environment. This has the effect of
indenting the 2nd, 4th, etc., lines of the stanza by the length \lnc{\vgap}.

\begin{syntax}
\senv{patverse} ... \eenv{patverse} \\
\senv{patverse*} ... \eenv{patverse*} \\
\cmd{\indentpattern}\marg{digits} \\
\end{syntax}
\glossary(patverse)%
  {\senv{patverse}}%
  {Stanza lines are indented according to the \cs{indentpattern};
   lines after the pattern is completed are not indented.}
\glossary(patverse*)%
  {\senv{patverse*}}%
  {Like \Pe{patverse} except that the pattern will keep repeating.}
\glossary(indentpattern)%
  {\cs{indentpattern}\marg{digits}}%
  {Stanza lines in \Pe{patverse} environment are indented according to
   the \meta{digits} pattern.}
As an alternative to the \Ie{altverse} environment, 
individual stanzas within the \Ie{verse} environment may be enclosed
in the \Ie{patverse} environment. Within this environment the indentation
of each line is specified by an indentation\index{stanza!indent pattern} 
pattern, which consists
of an array of digits, \(d_{1}\) to \(d_{n}\), and the \(n\)th line is
indented by \(d_{n}\) times \lnc{\vgap}. However, the first line is
not indented, irrespective of the value of \(d_{1}\).

    The indentation pattern for a \Ie{patverse} or \Ie{patverse*}
environment is specified
via the \cmd{\indentpattern} command, where \meta{digits} is a string
of digits (e.g., \texttt{3213245281}). With the \Ie{patverse}
environment, if the pattern is
shorter than the number of lines in the stanza, the trailing lines will
not be indented. However, in the \Ie{patverse*} environment the pattern
keeps repeating until the end of the stanza.

\subsection{Numbering}

\begin{syntax}
\cmd{\flagverse}\marg{flag} \\
\lnc{\vleftskip} \\
\end{syntax}
\glossary(flagverse)%
  {\cs{flagverse}\marg{flag}}%
  {Used at the start of a verse line to put \meta{flag} distance
  \cs{vleftskip} before the start of the line.}
\glossary(vleftskip)%
  {\cs{vleftskip}}%
  {Space between the argument to \cs{flageverse} and \cs{flagverse}.}
Putting \cmd{\flagverse} at the start of a line will typeset \meta{flag},
for example the stanza\index{stanza!number} number,
ending at a distance \lnc{\vleftskip} before the line. The default for
\lnc{\vleftskip} is 3em.

The lines in a poem may be numbered.

\begin{syntax}
\cmd{\linenumberfrequency}\marg{nth} \\
\cmd{\setverselinenums}\marg{first}\marg{startat} \\
\end{syntax}
\glossary(setverselinenums)%
  {\cs{setverselinenums}\marg{first}\marg{startat}}%
  {The first line of the following verse is number \marg{first} and the
   first printed line number should be \meta{startat}.}
The declaration \cmd{\linenumberfrequency}\marg{nth} will cause every 
\meta{nth} line\index{line number!frequency} 
of succeeding verses to be numbered. 
For example, 
\verb?\linenumberfrequency{5}?
will number every fifth line. The default is \verb?\linenumberfrequency{0}? 
which prevents any numbering. The \cmd{\setverselinenums} macro can be
used to specify that the number of the first line of the following \Ie{verse}
shall be \meta{first} and the first printed number shall be \meta{startat}.
For example, perhaps you are quoting part of a numbered poem. The original
numbers every tenth line but if your extract starts with line 7, then
\begin{lcode}
\linenumberfrequency{10}
\setverselinenums{7}{10}
\end{lcode}
is what you will need.

\begin{syntax}
\cmd{\thepoemline} \\
\cmd{\linenumberfont}\marg{font-decl} \\
\end{syntax}
\glossary(thepoemline)%
  {\cs{thepoemline}}%
  {The numeric representation of verse line numbers (default arabic).}
    The \Icn{poemline} counter is used in numbering the lines, so the
number representation is \cmd{\thepoemline}, which defaults to 
arabic numerals, and they are typeset using the font 
specified\index{line number!font}
via \cmd{\linenumberfont}; the default is 
\begin{lcode}
\linenumberfont{\small\rmfamily}
\end{lcode}
for small numbers in the roman font. 

\begin{syntax}
\cmd{\verselinenumbersright} \\
\cmd{\verselinenumbersleft} \\
\lnc{\vrightskip} \\
\end{syntax}
\glossary(verselinenumbersright)%
  {\cs{verselinenumbersright}}%
  {Following this declaration verse line numbers are set at the right of the
   verse lines.}
\glossary(verselinenumbersleft)%
  {\cs{verselinenumbersleft}}%
  {Following this declaration verse line numbers are set at the left of the
   verse lines.}
\glossary(vrightskip)
  {\cs{vrightskip}}%
  {Verse line numbers are set distance \cs{vrightskip} into the margin.}
Following the declaration
\cmd{\verselinenumbersright}, which is the default, any verse line numbers
will be set\index{line number!position} in the righthand margin. 
The \cmd{\verselinenumbersleft}
declaration will set any subsequent line numbers to the left of the lines.
The numbers are set at a distance
\lnc{\vrightskip} (default 1em) into the margin. 


\section{Titles}

    The \cmd{\PoemTitle} command is provided for typesetting titles
of poems.

\begin{syntax}
\cmd{\PoemTitle}\oarg{fortoc}\oarg{forhead}\marg{title} \\
\cmd{\NumberPoemTitle} \\
\cmd{\PlainPoemTitle} \\
\cmd{\thepoem} \\
\end{syntax}
\glossary(PoemTitle)%
  {\cs{PoemTitle}\oarg{fortoc}\oarg{forhead}\marg{title}}%
  {Typesets the title for a poem and puts it into the ToC.}
\glossary(NumberPoemTitle)%
  {\cs{NumberPoemTitle}}%
  {Declaration for \cs{PoemTitle} to be numbered.}
\glossary(PlainPoemTitle)%
  {\cs{PlainPoemTitle}}%
  {Declaration for \cs{PoemTitle} to be unnumbered.}
\glossary(thepoem)%
  {\cs{thepoem}}%
  {Typeset the current Poem Title number}%
The \cmd{\PoemTitle} command takes the same arguments as the 
\cmd{\chapter} command; it typesets the title for a poem\index{poem title} 
and adds it to the ToC\index{poem title!in ToC}. 
Following the declaration \cmd{\NumberPoemTitle}
the title is numbered but there is no numbering after the
\cmd{\PlainPoemTitle} declaration. 

\begin{syntax}
\cmd{\poemtoc}\marg{sec} \\
\end{syntax}
\glossary(poemtoc)%
  {\cs{poemtoc}}%
  {Kind of entry for a \cs{PoemTitle} in the ToC.}
The kind of entry made in the \toc\ by\index{poem title!in ToC} 
\cmd{\PoemTitle} is defined by \cmd{\poemtoc}. The initial definition is: 
\begin{lcode}
\newcommand{\poemtoc}{section}
\end{lcode}
for a section-like \toc\ entry. This can be changed to, say, \texttt{chapter}
or \texttt{subsection} or \ldots.

\begin{syntax}
\cmd{\poemtitlemark}\marg{forhead} \\
\cmd{\poemtitlepstyle} \\
\end{syntax}
\glossary(poemtitlemark)%
  {\cs{poemtitlemark}\marg{forhead}}%
  {Used to set marks for a \cs{PoemTitle}.}
\glossary(poemtitlepstyle)%
  {\cs{poemtitlepstyle}}%
  {Page style for a \cs{PoemTitle}.}
    The macro \cmd{\poemtitlemark}
is called with the argument \meta{forhead} so that it may be used
to set marks for use in a page header via the normal mark process. 
The \cmd{\poemtitlepstyle}
macro, which by default does nothing, is provided as a hook so that,
for example, it can be redefined to specify a particular pagestyle that should
be used. For example:
\begin{lcode}
\renewcommand*{\poemtitlemark}[1]{\markboth{#1}{#1}}
\renewcommand*{\poemtitlepstyle}{%
  \pagestyle{headings}%
  \thispagestyle{empty}}
\end{lcode}

\begin{syntax}
\cmd{\PoemTitle*}\oarg{forhead}\marg{title} \\
\cmd{\poemtitlestarmark}\marg{forhead} \\
\cmd{\poemtitlestarpstyle} \\
\end{syntax}
\glossary(PoemTitle*)%
  {\cs{PoemTitle*}\oarg{fortoc}\oarg{forhead}\marg{title}}%
  {Typesets an unnumbered title for a poem but does not add it to the ToC.}
\glossary(poemtitlestarmark)%
  {\cs{poemtitlestarmark}\marg{forhead}}%
  {Used to set marks for a \cs{PoemTitle*}.}
\glossary(poemtitlestarpstyle)%
  {\cs{poemtitlestarpstyle}}%
  {Page style for a \cs{PoemTitle*}.}

    The \cmd{\PoemTitle*} command produces an unnumbered title that is
not added to the ToC. Apart from that it operates in the same manner
as the unstarred version. The \cmd{\poemtitlestarmark} and 
\cmd{\poemtitlestarpstyle} can be redefined to set marks and pagestyles.

\subsection{Main Poem Title layout parameters}

\begin{syntax}
\cmd{\PoemTitleheadstart} \\
\cmd{\printPoemTitlenonum} \\
\cmd{\printPoemTitlenum} \\
\cmd{\afterPoemTitlenum} \\
\cmd{\printPoemTitletitle}\marg{title} \\
\cmd{\afterPoemTitle} \\
\end{syntax}
\glossary(PoemTitleheadstart)%
  {\cs{PoemTitleheadstart}}%
  {Called at the start of typesetting a \cs{PoemTitle}.}
\glossary(printPoemTitlenum)%
  {\cs{printPoemTitlenum}}%
  {Typesets the number for a \cs{PoemTitle}.}
\glossary(printPoemTitlenonum)%
  {\cs{printPoemTitlenonum}}%
  {Used instead of \cs{printPoemTitlenum} for an unnumbered \cs{PoemTitle}.}
\glossary(afterPoemTitlenum)%
  {\cs{afterPoemTitlenum}}%
  {Called after printing the number of a \cs{PoemTitle}.}
\glossary(printPoemTitletitle)%
  {\cs{printPoemTitletitle}\marg{title}}%
  {Typesets the title of a \cs{PoemTitle}.}
\glossary(afterPoemTitle)%
  {\cs{afterPoemTitle}}%
  {Called after printing the title of a \cs{PoemTitle}.}


    The essence of the code used to typeset a numbered \meta{title} from
a \cmd{\PoemTitle} is:
\begin{lcode}
\PoemTitleheadstart
\printPoemTitlenum
\afterPoemTitlenum
\printPoemTitletitle{title}
\afterPoemTitle
\end{lcode}
If the title is unnumbered then \cmd{\printPoemTitlenonum} is used
instead of the \cmd{\printPoemTitlenum} and 
\cmd{\afterPoemTitlenum} pair of macros.

    The various elements of this can be modified to change the layout.
By default the number is centered above the title, which is also typeset 
centered, and all in a \cmd{\large} font.

    The elements are detailed in the next section.

\subsection{Detailed Poem Title layout parameters}

\begin{syntax}
\lnc{\beforePoemTitleskip} \\
\cmd{\PoemTitlenumfont} \\
\lnc{\midPoemTitleskip} \\
\cmd{\PoemTitlefont} \\
\lnc{\afterPoemTitleskip} \\
\end{syntax}
\glossary(beforePoemTitleskip)%
  {\cs{beforePoemTitleskip}}%
  {Vertical space before a poem title.}
\glossary(midPoemTitleskip)%
  {\cs{midPoemTitleskip}}%
  {Vertical space between the number and text of a poem title.}
\glossary(afterPoemTitleskip)%
  {\cs{afterPoemTitleskip}}%
  {Vertical space after a poem title}
\glossary(PoemTitlenumfont)%
  {\cs{PoemTitlenumfont}}%
  {Font for the number of a poem title}
\glossary(PoemTitlefont)%
  {\cs{PoemTitlefont}}%
  {Font for the text of a poem title}


As defined, \cmd{\PoemTitleheadstart} inserts vertical space 
before a poem title. The default definition is:
\begin{lcode}
\newcommand*{\PoemTitleheadstart}{\vspace{\beforePoemTitleskip}}
\newlength{\beforePoemTitleskip}
  \setlength{\beforePoemTitleskip}{1\onelineskip}
\end{lcode}

\cmd{\printPoemTitlenum} typesets the number for a poem title.
The default definition, below, prints the number centered and in
a large font.
\begin{lcode}
\newcommand*{\printPoemTitlenum}{\PoemTitlenumfont \thepoem}
\newcommand*{\PoemTitlenumfont}{\normalfont\large\centering}
\end{lcode}

The definition of \cmd{\printPoemTitlenonum}, which is used
when there is no number, is simply
\begin{lcode}
\newcommand*{\printPoemTitlenonum}{}
\end{lcode}

\cmd{\afterPoemTitlenum} is called between setting the number 
and the title. It ends a paragraph (thus making sure any previous
\cmd{\centering} is used) and then may add some vertical
space. The default definition is:
\begin{lcode}
\newcommand*{\afterPoemTitlenum}{\par\nobreak\vskip \midPoemTitleskip}
\newlength{\midPoemTitleskip}
  \setlength{\midPoemTitleskip}{0pt}
\end{lcode}

The default definition of \cmd{\printPoemTitletitle} is below.
It typesets the title centered and in a large font.
\begin{lcode}
\newcommand*{\printPoemTitletitle}[1]{\PoemTitlefont #1}
\newcommand*{\PoemTitlefont}{\normalfont\large\centering}
\end{lcode}

The macro \cmd{\afterPoemTitle} finishes off the title 
typesetting. The default definition is:
\begin{lcode}
\newcommand*{\afterPoemTitle}{\par\nobreak\vskip \afterPoemTitleskip}
\newlength{\afterPoemTitleskip}
  \setlength{\afterPoemTitleskip}{1\onelineskip}
\end{lcode}



%\clearpage
\section{Examples}

   Here are some sample verses using the class facilities.

First a Limerick, but titled\index{poem title} and centered:
\begin{lcode}
\renewcommand{\poemtoc}{subsection}
\PlainPoemTitle
\PoemTitle{A Limerick}
\settowidth{\versewidth}{There was a young man of Quebec}
\begin{verse}[\versewidth]
There was a young man of Quebec \\
Who was frozen in snow to his neck. \\
\vin When asked: `Are you friz?' \\
\vin He replied: `Yes, I is, \\
But we don't call this cold in Quebec.'
\end{verse}
\end{lcode}
which gets typeset as below. The \cmd{\poemtoc} is redefined
to \texttt{subsection} so that the \cmd{\poemtitle} titles
are entered\index{poem title!in ToC} into the \toc\ as 
subsections. The titles will not be numbered because of the
\cmd{\PlainPoemTitle} declaration.

\renewcommand{\poemtoc}{subsection}
\PlainPoemTitle
\PoemTitle{A Limerick}
\settowidth{\versewidth}{There was a young man of Quebec}
\begin{verse}[\versewidth] \index[lines]{There was a young man of Quebec}
There was a young man of Quebec \\
Who was frozen in snow to his neck. \\
\vin When asked: `Are you friz?' \\
\vin He replied: `Yes, I is, \\
But we don't call this cold in Quebec.'
\end{verse}

\vspace{\onelineskip}
%\ablankline

    Next is the Garden verse within the \Ie{altverse} environment. Unlike
earlier renditions this one is titled\index{poem title} and centered. 
\begin{lcode}
\settowidth{\versewidth}{But now my love is dead}
\PoemTitle{Love's lost}
\begin{verse}[\versewidth]
\begin{altverse}
\garden
\end{altverse}
\end{verse}
\end{lcode}
Note how the alternate lines\index{stanza!indent alternate lines} 
are automatically indented in the typeset result below.

\settowidth{\versewidth}{But now my love is dead}
\PoemTitle{Love's lost}
\begin{verse}[\versewidth]\index[lines]{I used to love my garden}
\begin{altverse}
\garden
\end{altverse}
\end{verse}

\vspace{\onelineskip}
% \ablankline

It is left up to you how you might want to add information about
the author\index{poem!author} of a poem. Here is one example of a 
macro for this:
\begin{lcode}
\newcommand{\attrib}[1]{%
   \nopagebreak{\raggedleft\footnotesize #1\par}}
\end{lcode}
\providecommand{\attrib}[1]{%
   \nopagebreak{\raggedleft\footnotesize #1\par}}

   This can be used as in the next bit of doggerel.
\begin{lcode}
\PoemTitle{Fleas}
\settowidth{\versewidth}{What a funny thing is a flea}
\begin{verse}[\versewidth]
What a funny thing is a flea. \\
You can't tell a he from a she. \\
But he can. And she can. \\
Whoopee!
\end{verse}
\attrib{Anonymous}
\end{lcode}

\PoemTitle{Fleas}
\settowidth{\versewidth}{What a funny thing is a flea}
\begin{verse}[\versewidth]\index[lines]{What a funny thing is a flea}
What a funny thing is a flea. \\
You can't tell a he from a she. \\
But he can. And she can. \\
Whoopee!
\end{verse}
\attrib{Anonymous}

\vspace{\onelineskip}
%\ablankline

The next example demonstrates the automatic line wrapping for 
overlong\index{stanza!long line} lines.
\begin{lcode}
\PoemTitle{In the beginning}
\settowidth{\versewidth}{And objects at rest tended to 
                         remain at rest}
\begin{verse}[\versewidth]
Then God created Newton, \\
And objects at rest tended to remain at rest, \\
And objects in motion tended to remain in motion, \\
And energy was conserved
   and momentum was conserved
   and matter was conserved \\
And God saw that it was conservative.
\end{verse}
\attrib{Possibly from \textit{Analog}, circa 1950}
\end{lcode}

%%\enlargethispage{\baselineskip}
\PoemTitle{In the beginning}
\settowidth{\versewidth}{And objects at rest tended to remain at rest}
\begin{verse}[\versewidth]\index[lines]{Then God created Newton}
Then God created Newton, \\
And objects at rest tended to remain at rest, \\
And objects in motion tended to remain in motion, \\
And energy was conserved
   and momentum was conserved
   and matter was conserved \\
And God saw that it was conservative.
\end{verse}
\attrib{Possibly from \textit{Analog}, circa 1950}

\vspace{\onelineskip}
%\ablankline

The following verse demonstrates the use of a forced\index{stanza!line break} 
linebreak; I have
used the \cmd{\\>} command instead of the more descriptive,
but discursive, \cmd{\verselinebreak}. It also
has a slightly different title\index{poem title!styling} style.
\begin{lcode}
\renewcommand{\PoemTitlefont}{%
              \normalfont\large\itshape\centering}
\poemtitle{Mathematics}
\settowidth{\versewidth}{Than Tycho Brahe, or Erra Pater:}
\begin{verse}[\versewidth]
In mathematics he was greater \\
Than Tycho Brahe, or Erra Pater: \\
For he, by geometric scale, \\
Could take the size of pots of ale;\\ 
\settowidth{\versewidth}{Resolve by}%
Resolve, by sines \\>[\versewidth] and tangents straight, \\
If bread or butter wanted weight; \\
And wisely tell what hour o' the day \\
The clock does strike, by Algebra.
\end{verse}
\attrib{Samuel Butler (1612--1680)}
\end{lcode}

%%\clearpage

\renewcommand{\PoemTitlefont}{\normalfont\large\itshape\centering}
\PoemTitle{Mathematics}
\settowidth{\versewidth}{Than Tycho Brahe, or Erra Pater:}
\begin{verse}[\versewidth]\index[lines]{In mathematics he was greater}
In mathematics he was greater \\
Than Tycho Brahe, or Erra Pater: \\
For he, by geometric scale, \\
Could take the size of pots of ale;\\ 
\settowidth{\versewidth}{Resolve by}%
Resolve, by sines \\>[\versewidth] and tangents straight, \\
If bread or butter wanted weight; \\
And wisely tell what hour o' the day \\
The clock does strike, by Algebra.
\end{verse}
\attrib{Samuel Butler (1612--1680)}

\vspace{\onelineskip}
%\ablankline
%\clearpage

Another limerick, but this time taking advantage of 
the \Ie{patverse}\index{verse!indent pattern}
environment. If you are typesetting a series of limericks 
a single \cmd{\indentpattern} will do for all of them.
\begin{lcode}
\settowidth{\versewidth}{There was a young lady of Ryde}
\indentpattern{00110}
\needspace{7\onelineskip}
\PoemTitle{The Young Lady of Ryde}
\begin{verse}[\versewidth]
\begin{patverse}
There was a young lady of Ryde \\
Who ate some apples and died. \\
The apples fermented \\
Inside the lamented \\
And made cider inside her inside.
\end{patverse}
\end{verse}
\end{lcode}
Note that I used the \cmd{\needspace} command to ensure that 
the limerick will not get broken across a page.

\settowidth{\versewidth}{There was a young lady of Ryde}
\indentpattern{00110}
\needspace{7\onelineskip}
\PoemTitle{The Young Lady of Ryde}
\begin{verse}[\versewidth]\index[lines]{There was a young lady of Ryde}
\begin{patverse}
There was a young lady of Ryde \\
Who ate some apples and died. \\
The apples fermented \\
Inside the lamented \\
And made cider inside her inside.
\end{patverse}
\end{verse}

\vspace{\onelineskip}


    The next example is a song you may have heard of. This uses 
\cmd{\flagverse} for labelling\index{stanza!number} the stanzas, 
and because the lines are numbered\index{line number} they can be referred to. 

\begin{lcode}
\settowidth{\versewidth}{In a cavern, in a canyon,}
\PoemTitle{Clementine}
\begin{verse}[\versewidth]
\linenumberfrequency{2}
\begin{altverse}
\flagverse{1.} In a cavern, in a canyon, \\
Excavating for a mine, \\
Lived a miner, forty-niner, \label{vs:49} \\
And his daughter, Clementine. \\!
\end{altverse}

\begin{altverse}
\flagverse{\textsc{chorus}} Oh my darling, Oh my darling, \\
Oh my darling Clementine. \\
Thou art lost and gone forever, \\
Oh my darling Clementine.
\end{altverse}
\linenumberfrequency{0}
\end{verse}
The `forty-niner' in line~\ref{vs:49} of the song
refers to the gold rush of 1849.
\end{lcode}

\settowidth{\versewidth}{In a cavern, in a canyon,}
\PoemTitle{Clementine}
\begin{verse}[\versewidth]\index[lines]{In a cavern, in a canyon}
\linenumberfrequency{2}
\begin{altverse}
\flagverse{1.} In a cavern, in a canyon, \\
Excavating for a mine, \\
Lived a miner, forty-niner, \label{vs:49} \\
And his daughter, Clementine. \\!
\end{altverse}

\begin{altverse}
\flagverse{\textsc{chorus}} Oh my darling, Oh my darling, \\
Oh my darling Clementine. \\
Thou art lost and gone forever, \\
Oh my darling Clementine.
\end{altverse}
\linenumberfrequency{0}
\end{verse}

\vspace{\onelineskip}

The `forty-niner' in line~\ref{vs:49} of the song
refers to the gold rush of 1849.

%\ablankline

 The last example is a much more ambitious use\index{stanza!indent pattern} 
of \cmd{\indentpattern}. In
this case it is defined as: 
\begin{lcode}
\indentpattern{0135554322112346898779775545653222345544456688778899}
\end{lcode}
and the result is shown on the next page.


\clearpage
\PoemTitle{Mouse's Tale}
\settowidth{\versewidth}{a mouse that morning}
\indentpattern{0135554322112346898779775545653222345544456688778899}
\begin{verse}[\versewidth]\index[lines]{Fury said to}
\setlength{\vgap}{1em}
\begin{patverse}
\large Fury said to \\
  a mouse, That \\
  he met \\
  in the \\
  house, \\
\normalsize `Let us \\
  both go \\
  to law: \\
  \emph{I} will \\
  prosecute \\
  \textit{you.} --- \\
  Come, I'll \\
\small take no \\
  denial; \\
  We must \\
  have a \\
  trial: \\
  For \\
\footnotesize really \\
  this \\
  morning \\
  I've \\
  nothing \\
  to do.' \\
  Said the \\
  mouse to \\
\scriptsize the cur, \\
  Such a \\
  trial, \\
  dear sir, \\
  With no \\
  jury or \\
  judge, \\
  would be \\
  wasting \\
  our breath.' \\
\tiny  `I'll be \\
  judge, \\
  I'll be \\
  jury.' \\
  Said \\
  cunning \\
  old Fury; \\
  `I'll try \\
  the whole \\
  cause \\
  and \\
  condemn \\
  you \\
  to \\
  death.'  \par
\end{patverse}
\end{verse}
\attrib{Lewis Carrol, \textit{Alice's Adventures in Wonderland}, 1865}


\index{verse|)}

%#% extend
%#% extstart include boxes-verbatims-and-files.tex

\svnidlong
{$Ignore: $}
{$LastChangedDate: 2018-03-06 15:58:01 +0100 (Tue, 06 Mar 2018) $}
{$LastChangedRevision: 584 $}
{$LastChangedBy: daleif@math.au.dk $}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%% membook


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Boxes, verbatims and files} \label{chap:bvf}\label{chap:boxes}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    The title of this chapter indicates that it deals with three 
disconnected topics, but there is method in the seeming peculiarity.
By the end of the chapter you will be able to write \ltx\ code that
lets you put things in your document source at one place and have them
typeset at a different place, or places. For example, if you are writing
a text book that includes questions and answers then you could write 
a question and answer together yet have the answer typeset at the
end of the book. 

    Writing in one place and printing in another is based on outputting
stuff to a file\index{file!write} and then inputting 
it\index{file!read} for processing at another place 
or time. This is just how \ltx\ produces the \toc. It is often important
when writing to a file that \ltx\ does no processing of any macros, which
implies that we need to be able to write verbatim. One use of verbatim
in \ltx\ is to typeset computer code or the like, and to clearly
distinguish the code from the main text it is often typeset within a box.
Hence the chapter title.

    The class extends the kinds of boxes\index{box} normally provided, 
extends the default verbatims\index{verbatim}, and provides a simple means 
of writing\index{file!write} and reading\index{file!read} files.

    One problem with verbatims\index{verbatim!in argument} is that they 
can not be used as part of
an argument to a command. For example to typeset something in a 
framed\index{frame!minipage}
\Ie{minipage} the obvious way is to use the \Ie{minipage} as the argument
to the \cmd{\fbox} macro:
\begin{lcode}
\fbox{\begin{minipage}{6cm} 
      Contents of framed minipage 
      \end{minipage}}
\end{lcode}
This works perfectly well until the contents includes some verbatim
material, whereupon you will get nasty 
error\index{\cs{verb} illegal in command argument} messages. However this 
particular conundrum is solvable, even if the solution is not particularly
obvious. Here it is.

    We can put things into a box, declared via \cmd{\newsavebox}, and typeset
the contents of the box later via \cmd{\usebox}. The most common way
of putting things into a save box is by the \cmd{\sbox} or \cmd{\savebox}
macros, but as the material for saving is one of the arguments to these 
macros this approach fails. But, \Ie{lrbox} is an environment form of
\cmd{\sbox}, so it can handle verbatim material. The code below,
after getting a new save box, defines a new \Ie{framedminipage} 
environment\index{frame!minipage!verbatim} which is used just 
like the standard \Ie{minipage}. 
The \Ie{framedminipage} 
starts an \Ie{lrbox} environment and then
starts a \Ie{minipage} environment, after which comes the contents.
At the end it closes the two environments and calls \cmd{\fbox} with its
argument being the contents of the saved box \emph{which have already been
typeset}.
\begin{lcode}
\newsavebox{\minibox}
\newenvironment{framedminipage}[1]{%
  \begin{lrbox}{\minibox}\begin{minipage}{#1}}%
  {\end{minipage}\end{lrbox}\fbox{\usebox{\minibox}}}
\end{lcode}

\vspace{\onelineskip}
\noindent\textbf{Question 1.} Can you think of any improvements to
  the definition of the \Ie{framedminipage} environment?

\vspace{\onelineskip}
\noindent\textbf{Question 2.} An answer to question 1 is at the end of this
  chapter. Suggest how it was put there.



\section{Boxes}

\index{box!framed|(}
\index{frame!box|(}

    \ltx\ provides some commands to put a box round some text. The class
extends the available kinds of boxes.


\begin{syntax}
\senv{framed} text \eenv{framed} \\
\senv{shaded} text \eenv{shaded} \\
\senv{snugshade} text \eenv{snugshade} \\
%%%%%\cmd{\frameasnormaltrue} \cmd{\frameasnormalfalse} \\
\end{syntax}
\glossary(framed)%
  {\senv{framed}}%
  {Put a ruled box around the contents of the environment; the box can include
   pagebreaks.}
\glossary(shaded)%
  {\senv{shaded}}%
  {Put a colored background behind the contents of the environment, which
   can include pagebreaks. The color extends into the margins a little.}
\glossary(snugshade)%
  {\senv{snugshade}}%
  {Like \Pe{shaded} but does not bleed into the margins.}
The \Ie{framed}, \Ie{shaded}, and \Ie{snugshade}  
environments, which were created by Donald Arseneau\index{Arseneau, Donald} 
as part of his \Lpack{framed} package~\cite{FRAMED},
put their contents
into boxes\index{box!include pagebreak} that break across pages. 
The \Ie{framed} environment delineates
the box by drawing a rectangular frame. If there is a pagebreak in
the middle of the box, frames are drawn on both pages.

    The \Ie{shaded} environment typesets the box with a 
shaded\index{box!shaded background} or
colored background. This requires the use of the \Lpack{color} 
package~\cite{COLOR}, which is one of the required \ltx\ packages,
or the \Lpack{xcolor} package~\cite{XCOLOR}.
The shading color is \texttt{shadecolor}, which you have to define before
using the environment. For
example, to have a light gray background:
\begin{lcode}
\definecolor{shadecolor}{gray}{0.9}
\end{lcode}
For complete information on this see the documentation for the
\Lpack{color} or \Lpack{xcolor} packages, or one of the \ltx\ books like the
\textit{Graphics Companion}~\cite{GCOMPANION}.
In the \Ie{snugshaded} environment the box clings more closely to its
contents than it does in the \Ie{shaded} environment.

\begin{recommended}
  Since the class was originally written, much have happened in the
  gfx generating capabilities in LaTeX, especially the popularity of
  TikZ has provided many more extensive box and graphics generating
  packages.

  As of 2018 one of the most impressive packages for all sorts of
  boxes is the \Lpack{tcolorbox} package by Thomas~F.~Sturm.
\end{recommended}



%%    Following the declaration \cmd{\frameasnomaltrue}, which is the
%default, normal paragraphing is used for the framed text. On the
%%other hand, following the declaration \cmd{\frameasnormalfalse}
%the paragraphing follows the \Ie{minipage} style layout (i.e.,
%%no indentation of the first line).

Be aware that the boxes we present in this manual are somewhat
delicate; they do not work in all circumstances. For example they will
not work with the \Lpack{multicol} package~\cite{MULTICOL}, and any
floats or footnotes in the boxes will disappear.

\begin{syntax}
\lnc{\FrameRule} \lnc{\FrameSep} \lnc{\FrameHeightAdjust} \\
\end{syntax}
\glossary(FrameRule)%
  {\cs{FrameRule}}%
  {Thickness of the rules around an \Pe{framed} environment.}
\glossary(FrameSep)%
  {\cs{FrameSep}}%
  {Separation between the surrounding box and text in a \Pe{framed} or
   \Pe{shaded} environment.}
\glossary(FrameHeightAdjust)%
  {\cs{FrameHeightAdjust}}%
  {Height of the top of a frame in a \Pe{framed} environment
  above the baseline at the top of a page.}
The \Ie{framed} environment puts the text into an `\cmd{\fbox}' with
the settings:
\begin{lcode}
\setlength{\FrameRule}{\fboxrule}
\setlength{\FrameSep}{3\fboxsep}
\end{lcode}
The macro \cmd{\FrameHeightAdjust} specifies the height of the top of the frame
above the baseline at the top of a page; its initial definition is:
\begin{lcode}
\providecommand*{\FrameHeightAdjust}{0.6em}
\end{lcode}

\index{frame!box!styling}
\begin{syntax}
\cmd{\MakeFramed}\marg{settings} \cmd{\endMakeFramed} \\
\cmd{\FrameCommand} \cmd{\FrameRestore} \\
\end{syntax}
\glossary(MakeFramed)%
  {\cs{MakeFramed}\marg{settings}}%
  {The \Pe{MakeFramed} environment is the workhorse for the
   \Pe{framed}, \Pe{shaded}, etc., environments.
   The \meta{settings} argument controls the final appearance and
   should include a \cs{FrameRestore} to reset things back to normal.}
\glossary(endMakeFramed)%
  {\cs{endMakeFramed}}%
  {Ends the \Pe{MakeFramed} environment.}
\glossary(FrameCommand)%
  {\cs{FrameCommand}}%
  {Draws a `frame'.}
\glossary(FrameRestore)%
  {\cs{FrameRestore}}%
  {Restores settings after a `frame'.}
Internally, the environments are specified using the \Ie{MakeFramed}
environment. The \meta{setting} should contain any adjustments to the 
text width
(applied to \lnc{\hsize} and using the \lnc{\width} of the frame itself)
and a `restore' command, which is normally the provided \cmd{\FrameRestore}
macro. The frame itself is drawn via the 
\cmd{\FrameCommand}, which can be changed to obtain other boxing styles. The
default definition equates to an \cmd{\fbox} and is:
\begin{lcode}
\newcommand*{\FrameCommand}{%
  \setlength{\fboxrule}{\FrameRule}\setlength{\fboxsep}{\FrameSep}%
  \fbox}
\end{lcode}
For example, the \Ie{framed}, \Ie{shaded} and \Ie{snugshade} environments 
are defined as
\begin{lcode}
\newenvironment{framed}{% % uses default \FrameCommand
  \MakeFramed{\advance\hsize -\width \FrameRestore}}%
  {\endMakeFramed}
\newenvironment{shaded}{% % redefines \FrameCommand as \colorbox
  \def\FrameCommand{\fboxsep=\FrameSep \colorbox{shadecolor}}%
  \MakeFramed{\FrameRestore}}%
  {\endMakeFramed}
\newenvironment{snugshade}{% A tight version of shaded
  \def\FrameCommand{\colorbox{shadecolor}}%
  \MakeFramed{\FrameRestore\@setminipage}}%
  {\par\unskip\endMakeFramed}
\end{lcode}

    If you wanted a narrow, centered, framed\index{frame!narrow box} 
environment you could do something like this:
\begin{lcode}
\newenvironment{narrowframed}{%
  \MakeFramed{\setlength{\hsize}{22pc}\FrameRestore}}%
  {\endMakeFramed}
\end{lcode}
where \texttt{22pc} will be the width of the new framed environment.


\begin{syntax}
\senv{leftbar} text \eenv{leftbar} \\
\end{syntax}
\glossary(leftbar)%
  {\senv{leftbar}}%
  {Draws a thick vertical line in the left margin alongside the contents 
   of the environment.}

The \Ie{leftbar} environment draws a thick vertical line at the 
left\index{rule!in margin} of the text. It is defined as
\begin{lcode}
\newenvironment{leftbar}{%
  \def\FrameCommand{\vrule width 3pt \hspace{10pt}}%
  \MakeFramed{\advance\hsize -\width \FrameRestore}}%
  {\endMakeFramed}
\end{lcode}

    By changing the \meta{setting} for \cmd{\MakeFramed} and the
definition of \cmd{\FrameCommand} you can obtain a variety of framing
styles. For instance, to have rounded corners to the 
frame\index{frame!rounded corners} instead of
the normal sharp ones, you can use the \Lpack{fancybox} 
package~\cite{FANCYBOX} and the following code:
\begin{lcode}
\usepackage{fancybox}
\newenvironment{roundedframe}{%
  \def\FrameCommand{%
    \cornersize*{20pt}%
    \setlength{\fboxsep}{5pt}%
    \ovalbox}%
  \MakeFramed{\advance\hsize-\width \FrameRestore}}%
  {\endMakeFramed}
\end{lcode}

\index{frame!title|(}
     A framed environment is normally used to distinguish its contents
from the surrounding text. A title for the environment may be useful, and
if there was a pagebreak in the middle, a title on the continuation could
be desireable. Doing this takes a bit more work than I have shown so far.
This first part was inspired by a posting to \ctt\ by 
Donald Arseneau\index{Arseneau, Donald}.\footnote{On 2003/10/24 in the thread
\textit{framed.sty w/heading?}. The particulars are no longer applicable as 
the framing code in question then has since been revised.}.
\PWnote{2009/06/25}{Rewrote section and code for titled frames.}
\begin{comment}
This first part is from a posting to \ctt\ by 
Donald Arseneau\index{Arseneau, Donald}.\footnote{On 2003/10/24 in the thread
\textit{framed.sty w/heading?}}.

\begin{lcode}
\newcommand{\FrameTitle}[2]{%
  \fboxrule=\FrameRule \fboxsep=\FrameSep
  \fbox{\vbox{\nobreak \vskip -0.7\FrameSep
    \rlap{\strut#1}\nobreak\nointerlineskip% left justified
    \vskip 0.7\FrameSep
    \hbox{#2}}}}
\newenvironment{framewithtitle}[2][\FrameFirst@Lab\ (cont.)]{%
  \def\FrameFirst@Lab{\textbf{#2}}%
  \def\FrameCont@Lab{\textbf{#1}}%
  \def\FrameCommand##1{%
    \FrameTitle{\FrameCurrent@Lab}{##1}%
    \global\let\FrameCurrent@Lab\FrameNext@Lab
    \global\let\FrameNext@Lab\FrameCont@Lab
  }%
  \global\let\FrameCurrent@Lab\FrameFirst@Lab
  \global\let\FrameNext@Lab\FrameFirst@Lab
  \MakeFramed{\advance\hsize-\width \FrameRestore}}%
  {\endMakeFramed}
\end{lcode}
\end{comment}

\begin{lcode}
\newcommand{\FrameTitle}[2]{%
  \fboxrule=\FrameRule \fboxsep=\FrameSep
  \fbox{\vbox{\nobreak \vskip -0.7\FrameSep
    \rlap{\strut#1}\nobreak\nointerlineskip% left justified
    \vskip 0.7\FrameSep
    \hbox{#2}}}}
\newenvironment{framewithtitle}[2][\FrameFirst@Lab\ (cont.)]{%
  \def\FrameFirst@Lab{\textbf{#2}}%
  \def\FrameCont@Lab{\textbf{#1}}%
  \def\FrameCommand##1{%
    \FrameTitle{\FrameFirst@Lab}{##1}}%
  \def\FirstFrameCommand##1{%
    \FrameTitle{\FrameFirst@Lab}{##1}}%
  \def\MidFrameCommand##1{%
    \FrameTitle{\FrameCont@Lab}{##1}}%
  \def\LastFrameCommand##1{%
    \FrameTitle{\FrameCont@Lab}{##1}}%
  \MakeFramed{\advance\hsize-\width \FrameRestore}}%
  {\endMakeFramed}
\end{lcode}

The \Ie{framewithtitle} environment, which is the end goal of this
exercise, acts like the \Ie{framed} environment except that it puts
a left-justified title just after the top of the frame box and before the
regular contents.
\begin{syntax}
\senv{framewithtitle}\oarg{cont-title}\marg{title} text \\
 \eenv{framewithtitle} \\
\end{syntax}
The \meta{title} is set in a bold font. If the optional \meta{cont-title}
argument is given then \meta{cont-title} is used as the title on
any suceeding pages, otherwise the phrase `\meta{title} (cont.)' is used
for the continuation title.

    If you would like the titles centered, replace the line 
marked `left justified' in the code for \cmd{\FrameTitle} with the line:
\begin{lcode}
\rlap{\centerline{\strut#1}}\nobreak\nointerlineskip% centered
\end{lcode}

    The code for the \Ie{frametitle} environment is not obvious. The difficulty
in creating the environment was that the underlying framing code goes through
the `stuff' to be framed by first trying to fit it all onto one page 
(\cs{FrameCommand}). If it does not fit, then it takes as much as will fit
and typesets that using \cs{FirstFrameCommand}, then tries to typeset the 
remainder on the next page. If it all fits then it uses \cs{LastFrameCommand}.
If it doesn't fit, it typesets as much as it can using \cs{MidFrameCommand}, 
and then tries to set the remainder on the following page. The process repeats
until all has been set.

    If you would prefer to have the title at the top outside the frame the 
above code needs adjusting.
\begin{comment}
\begin{lcode}
\newcommand{\TitleFrame}[2]{%
  \fboxrule=\FrameRule \fboxsep=\FrameSep
  \vbox{\nobreak \vskip -0.7\FrameSep
    \rlap{\strut#1}\nobreak\nointerlineskip% left justified
    \vskip 0.7\FrameSep
    \noindent\fbox{#2}}}
\newenvironment{titledframe}[2][\FrameFirst@Lab\ (cont.)]{%
  \def\FrameFirst@Lab{\textbf{#2}}%
  \def\FrameCont@Lab{\textbf{#1}}%
  \def\FrameCommand##1{%
    \TitleFrame{\FrameCurrent@Lab}{##1}
    \global\let\FrameCurrent@Lab\FrameNext@Lab
    \global\let\FrameNext@Lab\FrameCont@Lab
  }%
  \global\let\FrameCurrent@Lab\FrameFirst@Lab
  \global\let\FrameNext@Lab\FrameFirst@Lab
  \MakeFramed{\hsize\textwidth
              \advance\hsize -2\FrameRule
              \advance\hsize -2\FrameSep
              \FrameRestore}}%
  {\endMakeFramed}
\end{lcode}
\end{comment}

\begin{lcode}
\newcommand{\TitleFrame}[2]{%
  \fboxrule=\FrameRule \fboxsep=\FrameSep
  \vbox{\nobreak \vskip -0.7\FrameSep
    \rlap{\strut#1}\nobreak\nointerlineskip% left justified
    \vskip 0.7\FrameSep
    \noindent\fbox{#2}}}
\newenvironment{titledframe}[2][\FrameFirst@Lab\ (cont.)]{%
  \def\FrameFirst@Lab{\textbf{#2}}%
  \def\FrameCont@Lab{\textbf{#1}}%
  \def\FrameCommand##1{%
    \TitleFrame{\FrameFirst@Lab}{##1}}
  \def\FirstFrameCommand##1{%
    \TitleFrame{\FrameFirst@Lab}{##1}}
  \def\MidFrameCommand##1{%
    \TitleFrame{\FrameCont@Lab}{##1}}
  \def\LastFrameCommand##1{%
    \TitleFrame{\FrameCont@Lab}{##1}}
  \MakeFramed{\hsize\textwidth
              \advance\hsize -2\FrameRule
              \advance\hsize -2\FrameSep
              \FrameRestore}}%
  {\endMakeFramed}
\end{lcode}

\begin{syntax}
\senv{titledframe}\oarg{cont-title}\marg{title} text \eenv{titledframe} \\
\end{syntax}
The \Ie{titledframe} environment is identical to \Ie{framewithtitle}
except that the title is placed just before the frame. Again, if
you would like a centered title, replace the line marked `left justified'
in \cmd{\TitleFrame} by
\begin{lcode}
\rlap{\centerline{\strut#1}}\nobreak\nointerlineskip% centered
\end{lcode}

    You can adjust the code for the \Ie{framewithtitle} and \Ie{titledframe}
environments to suit your own purposes, especially as they are not 
part of the class so you would have to type them in yourself anyway
if you wanted to use them, using whatever names you felt suitable.

\index{frame!title|)}

    The class provides two further environments in addition to those
from the \Lpack{framed} package.
\begin{syntax}
\senv{qframe} text \eenv{qframe} \\
\senv{qshade} text \eenv{qshade} \\
\end{syntax}

   When used within, say, a \Ie{quotation} environment, the \Ie{framed}
and \Ie{shaded} environments do not closely box the indented text. The
\Ie{qframe} and \Ie{qshade} environments do provide close 
boxing.\footnote{Donald Arseneau has said that he may put something similar
in a later version the \Ie{framed} package.}
The difference can be seen in the following \Ie{quotation}.

\begin{quotation}
This is the start of a \Ie{quotation} environment. It forms the basis showing
the difference between the \Ie{framed} and \Ie{qframe} environments.

\begin{qframe}
This is the second paragraph in the \Ie{quotation} environment and in turn it 
is within the \Ie{qframe} environment.
\end{qframe}

\begin{framed}
This is the third paragraph in the \Ie{quotation} environment and in turn it 
is within the \Ie{framed} environment.
\end{framed}

This is the fourth and final paragraph within the \Ie{quotation} environment
and is not within either a \Ie{qfame} or \Ie{framed} environment.
\end{quotation}

    If you want to put a frame inside an \Ie{adjustwidth} environment
then you may well find that \Ie{qframe} or \Ie{qshade} meet your
expections better than \Ie{framed} of \Ie{shaded}. Of course, it does
depend on what your expectations are.

\index{frame!box|)}
\index{box!framed|)}

\section{Long comments}

    The \% comment character can be used to comment out (part of) a
line of \tx\ code, but this gets tedious if you need to comment out
long chunks of code.

\begin{syntax}
\senv{comment} text to be skipped over \eenv{comment} \\
\end{syntax}
\glossary(comment)%
  {\senv{comment}}%
  {Skip over the environment.}
\index{comment out text}
As an extreme form of font changing, although it doesn't actually work that 
way, anything in a \Ie{comment} environment will not appear in the
document; effectively, \ltx\ throws it all away. This can be useful
to temporarily discard chunks of stuff instead of having to mark each line
with the \% comment character. 

\begin{syntax}
\cmd{\newcomment}\marg{name} \\
\cmd{\commentsoff}\marg{name} \\
\cmd{\commentson}\marg{name} \\
\end{syntax}
\glossary(newcomment)%
  {\cs{newcomment}\marg{name}}%
  {Define a new comment environment called \meta{name}.}
\glossary(commentsoff)%
  {\cs{commentsoff}\marg{name}}%
  {Process contents of the \meta{name} comment environment.}
\glossary(commentson)%
  {\cs{commentson}\marg{name}}%
  {Skip contents of the \meta{name} comment environment.}
The class lets you define your own comment environment via the 
\cmd{\newcomment} command which defines a comment environment called
\meta{name}. In fact the class itself uses \verb?\newcomment{comment}? to
define the \Ie{comment} environment. A comment environment \meta{name}
may be switched off so that its contents are not ignored by using the
\cmd{\commentsoff} declaration. It may be switched on later by the
\cmd{\commentson} declaration. In either case \meta{name} must have
been previously declared as a comment environment via \cmd{\newcomment}.

    Suppose, for example, that you are preparing a draft document for 
review by some others and you want to include some notes for the reviewers.
Also, you want to include some private comments in the source for yourself.
You could use the \Ie{comment} environment for your private comments and
create another environment for the notes to the reviewers. These notes
should not appear in the final document. Your source might then look like:
\begin{lcode}
\newcomment{review}
\ifdraftdoc\else
  \commentsoff{review}
\fi
...
\begin{comment}
Remember to finagle the wingle!
\end{comment}
...
\begin{review}
\textit{REVIEWERS: Please pay particular attention to this section.}
\end{review}
...
\end{lcode}

    Comment environments cannot be nested, nor can they overlap. 
The environments in the code below will not work in the manner that might
be expected:
\begin{lcode}
\newcomment{acomment} \newcomment{mycomment}
\begin{comment}
  \begin{acomment} %% comments cannot be nested
  ...
  \end{acomment}
  ...
  \begin{mycomment}
  ...
\end{comment}
...
  \end{mycomment}  %% comments cannot overlap
\end{lcode}

    More encompassing \Ie{comment} environments are available if you
use Victor Eijkhout's \Lpack{comment} package~\cite{COMMENT}.


\section{Verbatims}

\index{verbatim|(}

    Standard \ltx\ defines the \cmd{\verb} and \cmd{\verb*} commands
for typesetting short pieces of text verbatim, short because they
cannot include a linebreak. For longer verbatim texts the
\Ie{verbatim} or \Ie{verbatim*} environments can be used. The star forms
indicate spaces in the verbatim text by outputing a \verb*? ? mark for 
each space. The class extends the standard verbatims in various ways.

\index{verbatim!short}
    If you have to write a lot of \cmd{\verb} text, as I have had to do for
this book, it gets tedious to keep on typing this sort of thing:
\verb?\verb!verbatim text!?. Remember that the character immediately after
the \cmd{\verb}, or \cmd{\verb*}, ends the verbatim processing.
\begin{syntax}
\cmd{\MakeShortVerb}\marg{backslash-char} \\
\cmd{\DeleteShortVerb}\marg{backslash-char} \\
\end{syntax}
\glossary(MakeShortVerb)%
  {\cs{MakeShortVerb}\marg{backslash-char}}%
  {Makes \meta{char} a shorthand for \cs{verb}\meta{char}.}
\glossary(DeleteShortVerb)%
  {\cs{DeleteShortVerb}\marg{backslash-char}}%
  {Returns \meta{char} to its normal meaning instead of being a shorthand 
   for \cs{verb}\meta{char}.}
The \cmd{\MakeShortVerb} macro takes a character preceded by a backslash
as its argument, say \verb?\!?, and makes that character equivalent to 
\verb?\verb!?. Using the character a second time will stop the verbatim 
processing.
Doing, for example \verb?\MakeShortVerb{\!}?, lets you then use 
\verb?!verbatim text!?
instead of the longer winded \verb?\verb!verbatim text!?. 

    You have to pick
as the short verb character one that you are unlikely to use; a good choice
is often the \verb?|? bar character as this rarely used in normal text.
This choice, though may be unfortunate if you want to have any tabulars with
vertical lines, as the bar character is used to specify those. The
\cmd{\DeleteShortVerb} macro is provided for this contingency; give it the
same argument as an earlier \cmd{\MakeShortVerb} and it will restore
the short verb character to its normal state.

    The \cmd{\MakeShortVerb} and \cmd{\DeleteShortVerb} macros come from the
\Lpack{shortvrb} package which is part of the \ltx\ base system, but I 
have found them so convenient that I added them to the class.

\begin{syntax}
\cmd{\setverbatimfont}\marg{font-declaration} \\
\end{syntax}
\glossary(setverbatimfont)%
  {\cs{setverbatimfont}\marg{fontspec}}%
  {Sets the font to be used for verbatim text.}
The default font\index{verbatim!changing font} for verbatims is the normal 
sized monospaced font. The declaration
\cmd{\setverbatimfont} can be used to specify a different font.
The class default is 
\begin{lcode}
\setverbatimfont{\normalfont\ttfamily}
\end{lcode}
To use a smaller version simply say 
\begin{lcode}
\setverbatimfont{\normalfont\ttfamily\small}
\end{lcode}

    A monospaced font is normally chosen as verbatim text is often used 
to present program code or typewritten text. If you want a more exotic
font, try this
\begin{lcode}
\setverbatimfont{\fontencoding{T1}\fontfamily{cmss}\selectfont}
\end{lcode}
and your verbatim text will then look like %%
\setverbatimfont{\fontencoding{T1}\fontfamily{cmss}\selectfont}
\begin{verbatim}
We are no longer using the boring old typewriter font
for verbatim text. We used the T1 encoding 
to make sure that characters that are often ligatures
like ``, or '', or ---, or <, or >, print as expected.
After this we will switch back to the default verbatim font via
\setverbatimfont{\normalfont\ttfamily}
\end{verbatim}
\setverbatimfont{\normalfont\ttfamily}
In the normal way of things with an OT1 fontencoding, 
typesetting the ligatures mentioned above
in the sans font produces: 
{\fontencoding{OT1}\fontfamily{cmss}\selectfont ligatures like ``, or '', or ---, or <, or >}, 
which is not what happens in the \cmd{\verbatim} environment.


\begin{syntax}
\senv{verbatim} anything \eenv{verbatim} \\
\senv{verbatim*} anything \eenv{verbatim*} \\
\end{syntax}
\glossary(verbatim)%
  {\senv{verbatim}}%
  {Typeset the contents verbatim.}
In the \Ie{verbatim} environment\footnote{This version of the \Ie{verbatim}
environment is heavily based on the \Lpack{verbatim} package~\cite{VERBATIM}
but does provide some extensions.}
 you can write anything you want (except
\eenv{verbatim}), and it will be typeset exactly as written. The \Ie{verbatim*}
environment is similar except, like with \cmd{\verb*}, spaces will be
indicated with a \verb*? ? mark.

\begin{syntax}
\cmd{\tabson}\oarg{number} \\
\cmd{\tabsoff} \\
\end{syntax}
\glossary(tabson)%
  {\cs{tabson}\oarg{number}}%
  {Set \meta{number} of spaces in a verbatim for a TAB character;
   default 4.}
\glossary(tabsoff)%
  {\cs{tabsoff}}%
  {Ignore extra TAB spaces in a verbatim.} 
\index{verbatim!with tab spaces}
The standard \Ie{verbatim} environment ignores any TAB characters; with
the class's environment after calling the \cmd{\tabson} declaration 
the environment will handle TAB characters. By default 4 spaces are used
to represent a TAB; the optional \meta{number} argument to the declaration
will set the number of spaces for a TAB to be \meta{number}.
Some folk like to use 8 spaces for a TAB, in which case they would need
to declare \verb?\tabson[8]?. Unremarkably, the declaration \cmd{\tabsoff}
switches off TABs. The class default is \cmd{\tabsoff}.

\begin{syntax}
\cmd{\wrappingon} \\
\cmd{\wrappingoff} \\
\lnc{\verbatimindent} \\
\cmd{\verbatimbreakchar}\marg{char} \\
\end{syntax}
\glossary(wrappingon)%
  {\cs{wrappingon}}%
  {Wrap overlong verbatim lines.}
\glossary(wrappingoff)%
  {\cs{wrappingoff}}%
  {The normal behaviour of not wrapping overlong verbatim lines.}
\glossary(verbatimindent)%
  {\cs{verbatimindent}}%
  {Indent for wrapped overlong verbatim lines.}
\glossary(verbatimbreakchar)%
  {\cs{verbatimbreakchar}\marg{char}}%
  {Character indicating a verbatim line is being wrapped.}
As noted, whatever is written in a \Ie{verbatim} environment is output
just as written, even if lines are too long\index{verbatim!wrap long lines} 
to fit on the page. The
declaration \cmd{\wrappingon} lets the environment break lines so that they
do not overflow. The declaration \cmd{\wrappingoff} restores the normal
behaviour.

    The following is an example of how a wrapped verbatim line looks. In
the source the contents of the \Ie{verbatim} was written as a single line.
\wrappingon
\begin{verbatim}
This is an example of line wrapping in the verbatim environment. It is a single line in the source and the \wrappingon declaration has been used.
\end{verbatim}
\wrappingoff

   The wrapped portion of verbatim lines are indented from the left margin
by the length \lnc{\verbatimindent}. The value can be changed by the usual
length changing commands. The end of each line that has been wrapped is marked
with the \meta{char} character of the \cmd{\verbatimbreakchar} macro.
The class default is \verb?\verbatimbreakchar{\char`\%}?, so that lines are 
marked with \verb?%?.
To put a `/' mark at the end of wrapped lines you can do
\begin{lcode}
\setverbatimbreak{\char'\/}
\end{lcode}
or similarly if you would like another character. Another possibility
is
\begin{lcode}
\setverbatimchar{\char'\/\char'\*}
\end{lcode}
which will make `/*' the end marker.

\subsection{Boxed verbatims}

    Verbatim environments are often used to present program code or, as
in this book, \ltx\ code. For such applications it can be useful to
put the code in a box, or to number the code lines, or perhaps both.

\begin{syntax}
\senv{fboxverbatim} anything \eenv{fboxverbatim} \\
\end{syntax}
\glossary(fboxverbatim)%
  {\senv{fboxverbatim}}%
  {Puts a frame around the verbatim material. Page breaks are not allowed.}
The \Ie{fboxverbatim} environment\index{frame!verbatim}\index{verbatim!frame} 
typesets its contents verbatim and
puts a tightly fitting frame around the result; in a sense it is similar
to the \cmd{\fbox} command.

\begin{syntax}
\senv{boxedverbatim} anything \eenv{boxedverbatim} \\
\senv{boxedverbatim*} anything \eenv{boxedverbatim*} \\
\end{syntax}
\glossary(boxedverbatim)%
  {\senv{boxedverbatim}}%
  {May put a box around the verbatim material; lines may be numbered and page
   breaks are allowed.}
\glossary(boxedverbatim*)%
  {\senv{boxedverbatim*}}%
  {May put a box around the verbatim* material; lines may be numbered and page
   breaks are allowed.}
The \Ie{boxedverbatim} and \Ie{boxedverbatim*} environments are like
the \Ie{verbatim} and \Ie{verbatim*} environments except that a box,
allowing page breaks, may be put around the verbatim text and the lines
of text\index{line number} may be numbered.\index{boxed verbatim}\index{numbered lines}
The particular format of the output can be 
controlled as described below.
\begin{syntax}
\cmd{\bvbox} \cmd{\bvtopandtail} \cmd{\bvsides} \cmd{\nobvbox} \\
\lnc{\bvboxsep} \\
\end{syntax}
\glossary(bvbox)%
  {\cs{bvbox}}%
  {Rectangular boxes will be drawn for \Pe{boxedverbatim} environments.}
\glossary(nobvbox)%
  {\cs{nobvbox}}%
  {\Pe{boxedverbatim} environments will not be framed in any way.}
\glossary(bvtopandtail)%
  {\cs{bvtopandtail}}%
  {Draw horizontal rules before and after \Pe{boxedverbatim} environments.}
\glossary(bvsides)%
  {\cs{bvsides}}%
  {Draw vertical rules on each side of \Pe{boxedverbatim} environments.}
\glossary(bvboxsep)%
  {\cs{bvboxsep}}%
  {Separation between text and framing in \Pe{boxedverbatim} environments.}
Four styles of boxes are provided and you can extend these. Following
the \cmd{\bvbox} declaration, a box is drawn round the verbatim text, breaking
at page boundaries if necessary; this is the default style. Conversely,
no boxes are drawn after the \cmd{\nobvbox} declaration. With the
\cmd{\bvtopandtail} declaration horizontal lines are drawn at the start and 
end of the verbatim text, and with the \cmd{\bvsides} declarations, vertical
lines are drawn at the left and right of the text. The separation between
the lines and the text is given by the length \lnc{\bvboxsep}.

    The following hooks are provided to set your own 
boxing\index{frame!verbatim!styling}\index{verbatim!frame!styling} style.
\begin{syntax}
\cmd{\bvtoprulehook} \cmd{\bvtopmidhook} \cmd{\bvendrulehook} \\
\cmd{\bvleftsidehook} \cmd{\bvrightsidehook} \\
\end{syntax}
\glossary(bvtoprulehook)%
  {\cs{bvtoprulehook}}%
  {Called at the start of a \Pe{boxedverbatim} environment and after a pagebreak.}
\glossary(bvtopmidhook)%
  {\cs{bvtopmidhook}}%
  {Called after \cs{bvtoprulehook} at the start of a \Pe{boxedverbatim} environment.}
\glossary(bvendrulehook)%
  {\cs{bvendrulehook}}%
  {Called at the end of a \Pe{boxedverbatim} environment, and before a pagebreak.}
\glossary(bvleftsidehook)%
  {\cs{bvleftsidehook}}%
  {Called before each line in a \Pe{boxedverbatim} environment.}
\glossary(bvrightsidehook)%
  {\cs{bvrightsidehook}}%
  {Called after each line in a \Pe{boxedverbatim} environment.}
The macros \cmd{\bvtoprulehook} and \cmd{\bvendrulehook} are called at
the start and end of the \Ie{boxedverbatim} environment, and before and after
page breaks. The macros
\cmd{\bvleftsidehook} and \cmd{\bvrightsidehook} are called at the start
and end of each verbatim line. The macro \cmd{\bvtopmidhook} is
called after \cmd{\bvtoprulehook} at the start of the environment.
It can be used to add some space if \cmd{\bvtoprulehook} is empty.

\begin{syntax}
\cmd{\bvperpagetrue} \cmd{\bvperpagefalse} \\
\cmd{\bvtopofpage}\marg{text} \cmd{\bvendofpage}\marg{text} \\
\end{syntax}
\glossary(bvperpagetrue)%
  {\cs{bvperpagetrue}}%
  {Visibly break a \Pe{boxedverbatim} at a page break using \cs{bvtopofpage}
   and \cs{bvendofpage}.}
\glossary(bvperpagefalse)%
  {\cs{bvperpagefalse}}%
  {Do not mark page breaks in a \Pe{boxedverbatim}.}
\glossary(bvtopofpage)%
  {\cs{bvtopofpage}\marg{text}}%
  {Use \meta{text} as the \Pe{boxedverbatim} page break marker at the top of 
   a page.}
\glossary(bvendofpage)%
  {\cs{bvendofpage}\marg{text}}%
  {Use \meta{text} as the \Pe{boxedverbatim} page break marker at the bottom 
   of a page.}
The command \cmd{\bvperpagetrue} indicates
that a box should be visibly broken at a pagebreak, while there should
be no visible break for \cmd{\bvperpagefalse}. 
If the box continues on to another page then it may be advantageous
to place some sort of heading before the verbatim continues. Following
the declaration \cmd{\bvperpagetrue} the \meta{text} argument to
\cmd{\bvtopofpage} will be typeset after any pagebreak. For example you
could set:
\begin{lcode}
\bvtopofpage{continued}
\end{lcode}
to print `continued' in the normal text font. 

By default, the class sets
\begin{lcode}
\bvendofpage{\hrule\kern-.4pt}
\end{lcode}
which causes the \cmd{\hrule} to be drawn at the end of a page as the
visible break (the rule is 0.4pt thick and the kern backs up
that amount after the rule, so it effectively takes no vertical space).
This is not always suitable. For instance, if there will be
a `continued' message at the top of the following page it may seem odd
to draw a line at the bottom of the previous page. In this case, setting
\begin{lcode}
\bvendofpage{}
\end{lcode}
will eliminate the rule.

As examples of the use of
these hooks, here is how some of the boxed verbatim styles are defined.

The default style is \cmd{\bvbox}, 
which puts separate full boxes on each page. 
\begin{lcode}
\newcommand{\bvbox}{%
  \bvperpagetrue
  \renewcommand{\bvtoprulehook}{\hrule \nobreak \vskip-.1pt}%
  \renewcommand{\bvleftsidehook}{\vrule}%
  \renewcommand{\bvrightsidehook}{\vrule}%
  \renewcommand{\bvendrulehook}{\hrule}%
  \renewcommand{\bvtopmidhook}{\rule{0pt}{2\fboxsep} \hss}%
}
\end{lcode}
The \cmd{\nobvbox} turns off all boxing, and is defined as
\begin{lcode}
\newcommand{\nobvbox}{%
  \bvperpagefalse
  \renewcommand{\bvtoprulehook}{}%
  \renewcommand{\bvleftsidehook}{}%
  \renewcommand{\bvrightsidehook}{}%
  \renewcommand{\bvendrulehook}{}%
  \renewcommand{\bvtopmidhook}{\rule{0pt}{2\fboxsep} \hss}%
}
\end{lcode}
The definitions of the other styles, \cmd{\bvtopandtail} and \cmd{\bvsides},
are intermediate between \cmd{\bvbox} and \cmd{\nobvbox} in the obvious
manner.


\begin{syntax}
\cmd{\linenumberfrequency}\marg{nth} \\
\cmd{\resetbvlinenumber} \\
\cmd{\setbvlinenums}\marg{first}\marg{startat} \\
\cmd{\linenumberfont}\marg{font declaration} \\
\end{syntax}
\glossary(linenumberfrequency)%
  {\cs{linenumberfrequency}\marg{nth}}%
  {Number every \meta{nth} line in a \Pe{boxedverbatim} or a \Pe{verse}.}
\glossary(resetbvlinenumber)%
  {\cs{resetbvlinenumber}}%
  {Resets the \Pe{boxedverbatim} line number to zero.}
\glossary(setbvlinenums)%
  {\cs{setbvlinenums}\marg{first}\marg{startat}}%
  {The first line of the following \Pe{boxedverbatim} is number \marg{first} 
   and the
   first printed line number should be \meta{startat}.}
\glossary(linenumberfont)%
  {\cs{linenumberfont}\marg{fontspec}}%
  {Specify the font for line numbers.}

The command \cmd{\linenumberfrequency} controls the 
numbering\index{line number!frequency} of lines in
a \Ie{boxedverbatim} --- every \meta{nth} line will be numbered. 
If \meta{nth} is 0 or less, 
then no lines are numbered, if \meta{nth} is 1 then each line is numbered,
and if \meta{nth} is \texttt{n}, where \texttt{n} is 2 or more, then 
only every \texttt{n}th line is numbered. Line numbering is continuous 
from one instance
of the \Ie{boxedverbatim} environment to the next. Outside the environment
the line numbers\index{line number!reset} can be reset at any time by the 
command \cmd{\resetbvlinenumber}.

The \cmd{\setbvlinenums} macro can be
used to specify that the number of the first line of the following 
\Ie{boxedverbatim}
shall be \meta{first} and the first printed number shall be \meta{startat}.

The \cmd{\linenumberfont} declaration sets
\meta{font declaration} as the font\index{line number!font} for the 
line numbers. The default specification for this is:
\begin{lcode}
\linenumberfont{\footnotesize\rmfamily}
\end{lcode}
Line numbers\index{line number!position} are always set at the left of 
the lines because there
is no telling how long a line might be and it might clash with a line number
set at the right.
\begin{syntax}
\cmd{\bvnumbersinside} \\
\cmd{\bvnumbersoutside} \\
\end{syntax}
\glossary(bvnumbersinside)%
  {\cs{bvnumbersinside}}%
  {Line numbers typeset inside a \Pe{boxedverbatim} box.}
\glossary(bvnumbersoutside)%
  {\cs{bvnumbersoutside}}%
  {Line numbers typeset outside a \Pe{boxedverbatim} box.}
Line numbers are typeset inside the box after the declaration 
\cmd{\bvnumberinside} and are typeset outside the box after the
declaration \cmd{\bvnumbersoutside}. The default is to print
the numbers inside the box.

    Verbatim tabbing, but not wrapping, applies to the \Ie{boxedverbatim}
environment.

\begin{recommended}
  Again the \Lpack{tcolorbox} package offers boxes vs verbatim text.
\end{recommended}


\subsection{New verbatims}

\index{verbatim!new|(}
    The class implementation of verbatims lets you define your
own kind of verbatim environment. Unfortunately this is not quite
as simple as saying
\begin{lcode}
\newverbatim{myverbatim}{...}{...} 
\end{lcode}
as you can for defining normal environments. Instead, the general scheme
is
\begin{lcode}
\newenvironment{myverbatim}%
{<non-verbatim stuff> \verbatim <more non-verbatim stuff>}%
{\endverbatim}
\end{lcode}
In particular, you cannot use either the \cmd{\begin} or \cmd{\end}
macros inside the definition of the new verbatim environment. For example,
the following code will not work
\begin{lcode}
\newenvironment{badverbatim}%
  {NBG\begin{verbatim}}{\end{verbatim}}
\end{lcode}
and this won't work either
\begin{lcode}
\newenvironment{badverbatim}%
  {\begin{env}\verbatim}{\endverbatim\end{env}}
\end{lcode}
And, as with the standard \Ie{verbatim} environment, you cannot use
the new one in the definition of a new command.

    For an example of something that does work, this next little piece of 
typesetting was done in a new verbatim environment I have called 
\texttt{verbexami}, which starts and ends with a horizontal rule, and it
shows the definition of \texttt{verbexami}.
\newenvironment{verbexami}%
  {\par\noindent\hrule The verbexami environment \verbatim}%
  {\endverbatim\hrule}

\vspace{0.5\onelineskip}
\begin{verbexami}
\newenvironment{verbexami}%
  {\par\noindent\hrule The verbexami environment \verbatim}%
  {\endverbatim\hrule}
\end{verbexami}
\vspace{0.5\onelineskip}

    And this is a variation on the theme, with the environment again being
enclosed by horizontal rules.
\newenvironment{verbexamii}%
  {\vspace{0.5\baselineskip}\hrule 
   \vspace{0.2\baselineskip} Verbexamii \verbatim \textsc{Is this fun?}}%
  {\endverbatim\hrule\vspace{0.3\baselineskip}}

\vspace{0.5\onelineskip}
\begin{verbexamii}
\newenvironment{verbexamii}%
  {\vspace{0.5\baselineskip}\hrule \vspace{0.2\baselineskip}
    Verbexamii \verbatim \textsc{Is this fun?}}%
  {\endverbatim\hrule\vspace{0.3\baselineskip}}
\end{verbexamii}
\vspace{0.5\onelineskip}

    As no doubt you agree, these are not memorable examples of
the typesetter's art but do indicate that you can define your own
verbatim environments and may need to take a bit of care to get something
that passes muster.

    I will give some more useful examples, but mainly based on environments
for writing verbatim files as I think that these provide a broader
scope. 


\subsection{Example: the \texttt{lcode} environment}

    In this manual all the example \ltx\ code has been typeset in
the \Ie{lcode} environment; this is a verbatim environment defined
especially for the purpose. Below I describe the
code for defining my \Ie{lcode} environment, but first here 
is a simple definition of a verbatim environment, which I will 
call \texttt{smallverbatim},
that uses the \cmd{\small} font\index{verbatim!font} instead of the 
normalsize font.
\begin{lcode}
\newenvironment{smallverbatim}%
  {\setverbatimfont{\normalfont\ttfamily\small}%
   \verbatim}%
  {\endverbatim}
\end{lcode}

    The \Ie{verbatim} environment is implemented as a kind of \Ie{trivlist},
and lists usually have extra vertical space before and after them. For
my environment I did not want any extra spacing\index{list!spaces} 
so I defined the
macro \cmd{\@zeroseps} to zero the relevant list spacings. I also wanted
the code lines to be inset a little, so I defined a new length
called \lnc{\gparindent} to use as the indentation.
\begin{lcode}
\makeatletter
\newcommand{\@zeroseps}{\setlength{\topsep}{\z@}%
                        \setlength{\partopsep}{\z@}%
                        \setlength{\parskip}{\z@}}
\newlength{\gparindent} \setlength{\gparindent}{\parindent}
\setlength{\gparindent}{0.5\parindent}
% Now, the environment itself
\newenvironment{lcode}{\@zeroseps
  \renewcommand{\verbatim@startline}{%
                \verbatim@line{\hskip\gparindent}}
  \small\setlength{\baselineskip}{\onelineskip}\verbatim}%
  {\endverbatim
   \vspace{-\baselineskip}%
  \noindent
 }
\makeatother
\end{lcode}

    Unless you are intimately familiar with the inner workings of the
\Ie{verbatim} processing you deserve an explanation of the \Ie{lcode}
definition.

    Extremely roughly, the code for \cmd{\verbatim} looks like this:
\begin{lcode}
\def\verbatim{%
  \verbatim@font
  % for each line, until \end{verbatim}
    \verbatim@startline 
    % collect the characters in \verbatim@line 
    \verbatim@processline{\the\verbatim@line\par}
    % repeat for the next line
}
\end{lcode}
The code first calls \cmd{\verbatim@font} to set the font to be used.
Then, for each line it does the following:
\begin{itemize}
\item Calls the macro \cmd{\verbatim@startline} to start
      off the output version of the line.
\item Collects all the characters comprising the line 
      as a single token called \cmd{\verbatim@line}.
\item If the characters are the string `\verb?\end{verbatim}?' it finishes
      the verbatim environment.
\item Otherwise it calls the macro \cmd{\verbatim@processline} whose 
      argument is the characters in the 
      line, treated as a paragraph. It then starts all over again with
      the next line.
\end{itemize}

    I configured the \cmd{\verbatim@startline}
macro to indent the line of text using a horizontal skip of \lnc{\gparindent}.
The rest of the initialisation code, before calling \cmd{\verbatim}
to do the real processing, just sets up the vertical spacing. 


\index{verbatim!new|)}

\index{verbatim|)}




\section{Files}

\index{file|(}

    \ltx\ reads and writes various files as it processes a document.
Obviously it reads the document source file, or files, and it writes
the \pixfile{log} file recording what it has done. It also reads and writes
the \pixfile{aux} file, and may read and write other files like a 
\pixfile{toc} file. 

    On occasions it can be useful to get \ltx\ to read and/or write 
other files of your own choosing. Unfortunately standard \ltx\ does
not provide any easy method for doing this. The \Mname\ class
tries to rectify this.

\begin{syntax}
\cmd{\jobname} \\
\end{syntax}
\glossary(jobname)%
  {\cs{jobname}}%
  {The name of the document's main source file.}
When you run \ltx\ on your source file, say \texttt{fred.tex}, \ltx\
stores the name of this file (\texttt{fred}) in the macro \cmd{\jobname}.
\ltx\ uses this to name the various files that it writes out --- the
\pixfile{dvi} or \pixfile{pdf} file, the \pixfile{log} file, the
\pixfile{aux} file, etc.

\index{stream|(}

    \tx\ can read from 16 input streams\index{stream!limited number} 
and can write to 16 output
streams. Normally an input stream\index{stream!input} is allocated for each 
kind of file that will be read\index{file!read} and an 
output\index{stream!output} stream for each kind of file that will
be written\index{file!write}. On the input side, then, at least two 
streams are allocated, one for the source \pixfile{tex} file and 
one for the \pixfile{aux} file. 
On the output side again at least two streams are allocated, one for 
the \pixfile{log} file and one for the \pixfile{aux} file. 
When \pixfile{toc} and other similar
files are also part of the \ltx\ process you can see that many of the
16 input and output streams may be allocated before you can get to use one
yourself.

\begin{syntax}
\cmd{\newoutputstream}\marg{stream} \\
\cmd{\newinputstream}\marg{stream} \\
\end{syntax}
\glossary(newoutputstream)%
  {\cs{newoutputstream}\marg{stream}}%
  {Creates a new output stream called \meta{stream}.}
\glossary(newinputstream)%
  {\cs{newinputstream}\marg{stream}}%
  {Creates a new input stream called \meta{stream}.}
The macros \cmd{\newoutputstream} and \cmd{\newinputstream} respectively
create a new output\index{stream!new output} and input\index{stream!new input} 
stream called \meta{stream}, where \meta{stream}
should be a string of alphabetic characters, like \texttt{myout} or 
\texttt{myin}.
The \meta{stream} names must be unique, you cannot use the same name 
for two streams even if one is a input stream and the other is an output 
stream. If all the 16 streams of the given type have already been allocated
\tx\ will issue a message telling you about this, of the form:%
\index{No room for a new write}\index{No room for a new read}
\begin{lcode}
No room for a new write   % for an output stream
No room for a new read    % for an input stream
\end{lcode}

    The two \cs{new...stream} commands also provide two empty macros called
\verb?\atstreamopen<stream>? and \verb?\atstreamclose<stream>?. 
If these macros already exist then they are left undisturbed. 
For example if you do:
\begin{lcode}
\newcommand{\atstreamopenmyout}{...}
\newoutputstream{myout}
\newinputstream{myin}
\end{lcode}
Then you will find that three new commands have been created like:
\begin{lcode}
\newcommand{\atstreamclosemyout}{}
\newcommand{\atstreamopenmyin}{}
\newcommand{\atstreamclosemyin}{}
\end{lcode}
You can use \cmd{\renewcommand} to change the definitions of these if you
wish.

\begin{syntax}
\cmd{\IfStreamOpen}\marg{stream}\marg{true-code}\marg{false-code} \\
\end{syntax}
\glossary(IfStreamOpen)%
  {\cs{IfStreamOpen}\marg{stream}\marg{yes}\marg{no}}%
  {If \meta{stream} is open then the \meta{yes} argument is processed
   otherwise the \meta{no} argument is processed.}
The macro \cmd{\IfStreamOpen} checks whether or not the \meta{stream}
stream\index{stream!check open} is open. If it is then 
the \meta{true-code} argument is processed,
while when it is not open the \meta{false-code} argument is processed.

\subsection{Writing to a file}

\index{file!write|(}

    One stream may be used for writing to several different files, although not
simultaneously.

\begin{syntax}
\cmd{\openoutputfile}\marg{filename}\marg{stream} \\
\cmd{\closeoutputstream}\marg{stream} \\
\end{syntax}
\glossary(openoutputfile)%
  {\cs{openoutputfile}\marg{filename}\marg{stream}}%
  {Attaches the file \meta{filename} to the output \meta{stream}.}
\glossary(closeoutputstream)%
  {\cs{closeoutputstream}\marg{stream}}%
  {Detaches and closes the file associated with the output \meta{stream}.}
The command \cmd{\openoutputfile} opens\index{file!open} the file 
called \meta{filename},
either creating it if it does not exist, or emptying it if it already exists.
It then attaches the file to the output\index{stream!output} 
stream called \meta{stream} so that
it can be written to, and then finally calls the macro 
named \verb?\atstreamopen<stream>?. 

    The command \cmd{\closeoutputstream} firstly calls the macro named
\verb?\atstreamclose<stream>? then closes\index{stream!close output} the
output stream \meta{stream}, and finally detaches and 
closes\index{file!close} the associated file.

\begin{syntax}
\cmd{\addtostream}\marg{stream}\marg{text} \\
\end{syntax}
\glossary(addtostream)%
  {\cs{addtostream}\marg{stream}\marg{text}}%
  {Adds \meta{text} to the file associated with the output \meta{stream}.}
The \cmd{\addtostream} command writes \meta{text} to the output stream
\meta{stream}, and hence to whatever file is currently attached to the
stream. The \meta{stream} must be open. Any commands within the \meta{text}
argument will be processed before being written. To prevent command
expansion, precede the command in question with \cmd{\protect}.

    Writing\index{file!write!verbatim} verbatim text to a file is 
treated specially as it is likely
to be the most common usage.
\begin{syntax}
\senv{verbatimoutput}\marg{file} anything \eenv{verbatimoutput} \\
\senv{writeverbatim}\marg{stream} anything \eenv{writeverbatim} \\
\end{syntax}
\glossary(verbatimoutput)%
  {\senv{verbatimoutput}\marg{file}}%
  {The contents of the environment are written verbatim to the \meta{file} 
   file, overwriting anything previously in the file.}
\glossary(writeverbatim)%
  {\senv{writeverbatim}\marg{stream}}%
  {The contents of the environment are written verbatim to the \meta{stream} 
   stream.}
The text within a \Ie{verbatimoutput} environment is written verbatim
to the \meta{file} file. Alternatively, the contents of the
\Ie{writeverbatim} environment are written verbatim to the \meta{stream} 
stream. 

    Specifically, \Ie{verbatimoutput} opens the specified file, writes
to it, and then closes the file. This means that if \Ie{verbatimoutput}
is used more than once to write to a given
file, then only the contents of the last of these outputs is captured 
in the file.
On the other hand, you can use \Ie{writeverbatim} several times to write
to the file attached to the stream and, providing the stream has not
been closed in the meantime, all will be captured.

\index{file!write|)}

\subsection{Reading from a file}

\index{file!read|(}

   One stream may be used for reading from several files, although not
simultaneously.

\begin{syntax}
\cmd{\openinputfile}\marg{filename}\marg{stream} \\
\cmd{\closeinputstream}\marg{stream} \\
\end{syntax}
\glossary(openinputfile)%
  {\cs{openinputfile}\marg{filename}\marg{stream}}%
  {Attaches the file \meta{filename} to the input \meta{stream}.}
\glossary(closeinputstream)%
  {\cs{closeinputstream}\marg{stream}}%
  {Detaches and closes the file associated with the input \meta{stream}.}
The command \cmd{\openinputfile} opens\index{file!open} the file 
called \meta{filename}
and attaches it to the input\index{stream!input} stream called 
\meta{stream} so that
it can be read from. Finally it calls the macro named 
\verb?\atstreamopen<stream>?.
It is an error if \meta{filename} can not be found.

    The command \cmd{\closeinputstream} calls the macro named
\verb?\atstreamclose<stream>?, closes\index{stream!close input} the
output stream \meta{stream}, and then detaches and closes\index{file!close} 
the associated file.

\begin{syntax}
\cmd{\readstream}\marg{stream} \\
\end{syntax}
\glossary(readstream)%
  {\cs{readstream}\marg{stream}}%
  {Reads the entire contents of the file associated with the input \meta{stream}.}
The command \cmd{\readstream} reads the entire contents of the file
currently associated with the input stream \meta{stream}. This
provides the same functionality as \cmd{\input}\marg{filename}.

\begin{syntax}
\cmd{\readaline}\marg{stream} \\
\end{syntax}
\glossary(readaline)%
  {\cs{readaline}\marg{stream}}%
  {Reads a single line from the file associated with the input \meta{stream}.}
The \cmd{\readaline} reads\index{file!read!single line} what \tx\ 
considers to be one line from
the file that is currently associated with the input stream \meta{stream}.

Multiple lines can be read by calling \cmd{\readaline} multiple times.
A warning is issued if there are no more lines to be read (i.e., the
end of the file has been reached).

Just as for writing, reading files\index{file!read!verbatim} 
verbatim is treated specially.
\begin{syntax}
\cmd{\verbatiminput}\marg{file} \cmd{\verbatiminput*}\marg{file} \\
\cmd{\boxedverbatiminput}\marg{file} \cmd{\boxedverbatiminput*}\marg{file} \\
\cmd{\readverbatim}\marg{stream} \cmd{\readverbatim*}\marg{stream} \\
\cmd{\readboxedverbatim}\marg{stream} \cmd{\readboxedverbatim*}\marg{stream} \\
\end{syntax}
\glossary(verbatiminput)%
  {\cs{verbatiminput}\marg{file}}%
  {Acts like \Pe{verbatim} except the contents is read from the \meta{file} file.}
\glossary(verbatiminput*)%
  {\cs{verbatiminput*}\marg{file}}%
  {Acts like \Pe{verbatim*} except the contents is read from the \meta{file} file.}
\glossary(boxedverbatiminput)%
  {\cs{boxedverbatiminput}\marg{file}}%
  {Acts like \Pe{boxedverbatim} except the contents is read from the \meta{file} file.}
\glossary(boxedverbatiminput*)%
  {\cs{boxedverbatiminput*}\marg{file}}%
  {Acts like \Pe{boxedverbatim*} except the contents is read from the \meta{file} file.}
\glossary(readverbatim)%
  {\cs{readverbatim}\marg{stream}}%
  {Acts like \Pe{verbatim} except the contents is read from the file 
   associated with the input \meta{stream}.}
\glossary(readverbatim*)%
  {\cs{readverbatim*}\marg{stream}}%
  {Acts like \Pe{verbatim*} except the contents is read from the file 
   associated with the input \meta{stream}.}
\glossary(readboxedverbatim)%
  {\cs{readboxedverbatim}\marg{stream}}%
  {Acts like \Pe{boxedverbatim} except the contents is read from the file 
   associated with the input \meta{stream}.}
\glossary(readboxedverbatim*)%
  {\cs{readboxedverbatim*}\marg{stream}}%
  {Acts like \Pe{boxedverbatim*} except the contents is read from the file 
   associated with the input \meta{stream}.}
The commands \cmd{\verbatiminput} and 
\cmd{\boxedverbatiminput},\index{frame!verbatim}\index{verbatim!frame} 
 and their
starred versions, act like the \Ie{verbatim} and \Ie{boxedverbatim}
environments, except that they get their text from the \meta{file} file.
It is an error if \meta{file} cannot be found.
Similarly, \cmd{\readverbatim} and \cmd{\readboxedverbatim} get their
text from the file currently attached to the \meta{stream} input stream.
It is an error if \meta{stream} is not open for input.

\index{file!read|)}

\subsection{Example: endnotes}

\LMnote{2010/10/28}{It is confusing for users that the manual contain
  an example as to how one manual provide endnotes, when memoir
  actually provide the functionality in a later section.}
\index{endnotes}
\begin{itshape}
  In an earier version of the manual, this section contained an
  example as to how one could make endnotes. The example is now
  irrelevant, since \theclass\ contain something similar to end notes
  called page notes, see section~\ref{sec:endnotes} on
  page~\pageref{sec:endnotes}. 

  Those interested in the code from the old example, can find it in
  the manual source (it has just been commented out).
\end{itshape}

\begin{comment}
\index{endnotes|(}

    Books like biographies often quote sources for quotations by the subject,
or sources for statements of fact and so on, at the end of the book or chapter.
These are often like a collected set of footnotes. The example shows
a somewhat rough and ready approach to implementing endnotes.

    Typically endnotes come in one of two forms: they are like a normal
footnote, except that the note text is on another page, or; there is
no mark in the body of the text and the note is identified via a small
quote from the text and its page number. 
The example is for the footnote-like form and for endnotes collected
at the end of the document, with an appropriate heading to distinguish
notes from different chapters.

     We have to be careful in choosing names for the macros we will be
defining for endnotes. Remember, you cannot use \cmd{\newcommand}
to define a new command whose name starts \cs{end...}, so \cs{endnote} 
appears to be out.
However, the \tx\ primitive \cmd{\def} command does let you define
a command starting with \cs{end...}. The syntax of the \cmd{\def} command, 
like 
that of many of \tx\ macros, looks strange to \ltx\ eyes. The major
disadvantage in using \cmd{\def} is that it will merrily overwrite any
previous definition with the same name (the \ltx\ \cmd{\newcommand} won't
let you do that). I could use \cmd{\def} for an \cs{endnote} macro, like
\begin{lcode}
\long\def\endnote#1{...}
\end{lcode}
I won't do that, though, as there is at least one \ltx\ class that includes
a \texttt{note} environment and that means that \cs{endnote} is already defined
in that class. To avoid potential pitfalls like that I'll use \cs{enote}
rather than the more evocative \cs{endnote}.

    We need a new counter for the endnotes, starting afresh with each chapter,
and to print in arabic numerals. 
\begin{lcode}
\newcounter{enote}[chapter]
  \renewcommand{\theenote}{\arabic{enote}}
\end{lcode}
And we need a macro to typeset the text of the note. This will take two
arguments, the number of the note, and the text.
\begin{lcode}
\DeclareRobustCommand{\enotetext}[2]{%
  \par\noindent \textsuperscript{#1} #2\par
      \vspace{\baselineskip}}
\end{lcode}
This makes sure that it starts a new non-indented paragraph, then typesets
the first argument (the number) as a superscript and then processes the
second argument (the text of the note). After that it makes sure that 
any paragraph is ended and puts some vertical space in case there is
another note following.

    The basic idea is to define a command, \cs{enote}\marg{text}, like
\cmd{\footnote}, that will write \meta{text} to a file\index{file!write} 
which will be read in later to typeset the \meta{text}. 

    To this end, we need an output stream, and we will use a file with 
extension \pixfile{ent}, the first
part of the file name being the name of the \ltx\ source file; this is
available via the \cmd{\jobname} macro.
\begin{lcode}
\newoutputstream{notesout}
  \openoutputfile{\jobname.ent}{notesout}
\newcommand{\printendnotes}{%
  \closeoutputstream{notesout}%
  \input{\jobname.ent}}
\end{lcode}
The \cmd{\printendnotes} macro can be called at the appropriate place in the
document to print any endnotes. It closes the output file and 
then inputs it\index{file!read} to print the endnotes.

    As well as putting the notes into the file we are also going to
add a heading indicating the chapter. Rather than invent a completely
new kind of heading I'll simply use \cmd{\subsection*} --- the starred
form so that there will be no \prtoc{} entry.
\begin{lcode}
\DeclareRobustCommand{\enotehead}[1]{%
  \subsection*{Notes for chapter #1}}
\end{lcode}
The argument to the \cs{enotehead} macro is the number of a chapter. Also
needed is a method for determining when this heading should be added to 
the endnote file. One simple way is using a counter holding the chapter
number. Initialise the counter to something that is an invalid
chapter number.
\begin{lcode}
\newcounter{savechap}
  \setcounter{savechap}{-1000}
\end{lcode}

    We have the pieces ready, and all that remains is to define
the \cs{enote} macro, which will take one argument --- the text of the
note.
\begin{lcode}
\newcommand{\enote}[1]{%
  \refstepcounter{enote}%      increment the counter
  \textsuperscript{\theenote}% typeset it as a superscript
  \ifnum\value{savechap}=\value{chapter}\else % in a new chapter
    \setcounter{savechap}{\value{chapter}%      save the number
    \addtostream{notesout}{\enotehead{\thechapter}}% the heading
  \fi
  \addtostream{notesout}{\enotetext{\theenote}{#1}}}
\end{lcode}
\cs{enote}, which is used just like \cmd{\footnote}, increments the 
counter for endnotes, typesets that as a superscript, and then writes
the \cs{enotetext} command to the endnotes file. Entries in the \pixfile{ent}
file will look like:
\begin{lcode}
...
\enotehead{3}     % for chapter 3
\enotetext{1}{First end note in chapter 3.}
\enotetext{2}{The next end note.}
...
\end{lcode}

    You can try this, perhaps changing the definition of \cs{enotetext}
to give a better looking presentation of an endnote. There is, however,
a caveat if you use \cs{enote}. 

\vspace{\onelineskip}
\noindent\textbf{Question 3.} What is the caveat?

If you can't
think what it might be, don't worry as it will be dealt with in another
example. 

\index{endnotes|)}
\end{comment}

\subsection{Example: end floats}

\index{end floats|(}

    There are some documents where all figures are required to be grouped
in one place, for instance at the end of the document or perhaps at the
end of each chapter. Grouping at the end of a document with 
chapters is harder, so we'll tackle that one.

   The basic idea is to write out verbatim\index{verbatim!write} 
each figure environment and then read them all back in at the end. 
We will use a stream,\index{stream} let's call
it \texttt{tryout}, and call our file for figures \file{tryout.fig}.
\begin{lcode}
\newoutputstream{tryout}
\openoutputfile{tryout.fig}{tryout}
\end{lcode}

    If all were simple, in the document we could then just do
\begin{lcode}
\begin{writeverbatim}{tryout}
\begin{figure} ... \end{figure}
\end{writeverbatim}
...
\closeoutputstream{tryout}
\input{tryout.fig}
\end{lcode}

    So, what's the problem?

    By default figure captions are numbered per chapter, and are preceeded
by the chapter number; more precisely, the definition of a figure number
is 
\begin{lcode}
\thechapter.\arabic{figure}
\end{lcode}
If we simply lump all the figures at 
the end, then they
will all be numbered as if they were in the final chapter. 
For the sake of argument assume that the last chapter is number 10.
The nth figure will then be numbered 10.n.
One thing that we
can do rather simply is to change the definition of the figure by using
another counter, let's call it \texttt{pseudo}, instead of the chapter.
\begin{lcode}
\newcounter{pseudo}
  \renewcommand{\thepseudo}{\arabic{pseudo}}
\renewcommand{\thefigure}{\thepseudo.\arabic{figure}}
\end{lcode}
Now, all we should have to do is arrange that the proper value of 
\texttt{pseudo}
is available before each figure is typeset at the end. The code around
the \Ie{figure} environments might then look like this
\begin{lcode}
\addtostream{tryout}{\protect\setcounter{pseudo}{\thechapter}}
\begin{writeverbatim}{tryout}
\begin{figure}...
\end{lcode}
and a part of the file might then look like
\begin{lcode}
...
\setcounter{pseudo}{4}
\begin{figure}...
\end{lcode}
The \cmd{\protect} before the \cmd{\setcounter} command will stop it
from expanding before it is written to the file, while the \cmd{\thechapter}
command \emph{will} be expanded to give the actual number of the current 
chapter. This looks better as now at least the figure will be numbered 4.n 
instead of 10.n.

    There is one last snag --- figure numbers are reset at the start of each
chapter --- but if we just dump the figures at the end of the document
then although the chapter part of the number will alter appropriately
because of the \texttt{pseudo} process,
the second part of the number will just increase continuously. It looks
as though we should write out a change to the chapter counter at the start
of each chapter. If we do that, then we should be able to get rid of the
\texttt{pseudo} counter, which sounds good. But, and this is almost the 
last but,
what if there are chapters after we have read in the figure file? To
cater for this the chapter number of the last chapter before the file must
be saved, and then restored after the figures have been processed.

    Finally, wouldn't it be much better for the user if everything was
wrapped up in an environment that handled all the messy stuff?

    Here is the final code that I am going to produce which, by the way,
is displayed in the \Ie{boxedverbatim} environment\index{line number} 
with line numbers and the following settings, just in case there is
a page break in the middle of the box.
\begin{lcode}
\nobvbox
\bvperpagetrue
\bvtopofpage{\begin{center}\normalfont%
             (Continued from previous page)\end{center}}
\bvendofpage{}
\resetbvlinenumber
\linenumberfrequency{1}
\bvnumbersoutside
\linenumberfont{\footnotesize\rmfamily}
\begin{boxedverbatim}
...
\end{lcode}

\nobvbox
\bvperpagetrue
\bvtopofpage{\begin{center}\normalfont%
             (Continued from previous page)\end{center}}
\bvendofpage{}
\resetbvlinenumber
\linenumberfrequency{1}
\bvnumbersoutside
\linenumberfont{\footnotesize\rmfamily}
\begin{boxedverbatim}
\newoutputstream{tryout}
\openoutputfile{\jobname.fig}{tryout}
\newcounter{pseudo}
\renewcommand{\thefigure}{\thepseudo.\arabic{figure}}
\newenvironment{writefigure}{%
  \ifnum\value{chapter}=\value{pseudo}\else
    \setcounter{pseudo}{\value{chapter}}
    \addtostream{tryout}{\protect\stepcounter{chapter}}
    \addtostream{tryout}{\protect\addtocounter{chapter}{-1}}
    \addtostream{tryout}{%
      \protect\setcounter{pseudo}{\thechapter}}
  \fi
  \addtostream{tryout}{\protect\begin{figure}}
  \writeverbatim{tryout}}%
 {\endwriteverbatim\finishwritefigure}
\newcommand{\finishwritefigure}{%
  \addtostream{tryout}{\protect\end{figure}}}
\newcommand{\printfigures}{%
  \closeoutputstream{tryout}%
  \input{\jobname.fig}%
}
\end{boxedverbatim}
\linenumberfrequency{0}
    The above code should be either put in the preamble\index{preamble} 
or in a separate package\index{package} file.

   The first four lines of the code perform the initial setup described
earlier. Lines 1 and 2 set up for outputting\index{file!write} to a file 
\verb?\jobname.fig?, which
is where the figures will be collected. Lines 3 and 4 create the 
new counter\index{new!counter}
we need and change the construction of the figure number. The rest of the code
defines a new environment\index{new!environment} \Ie{writefigure} 
which is to be used instead 
of the \Ie{figure} environment. It writes its content out to the 
\texttt{tryout} stream.

    In line 6 a check is made to see if the current values of the 
\Icn{chapter} and \Icn{pseudo} counters are the same; 
nothing is done if they are. If they are
different, it means that this is the first figure in the chapter and we have
to put appropriate information into the figure file. Line 7 sets the
\Icn{pseudo} counter to the value of the \Icn{chapter} counter 
(if there is another \Ie{writefigure} in the chapter it will then 
skip over the code in lines 7 to 11).
The next lines put (where N is the number of the current chapter):
\begin{lcode}
\stepcounter{chapter}
\addtocounter{chapter}{-1}
\setcounter{pseudo}{N}
\end{lcode}
into the figure file. Stepping the chapter number (by one) resets the 
following figure number, and then subtracting one from the stepped number
returns the chapter number to its original value. 
Finally the counter \Icn{pseudo} is set to the number of the 
current chapter.

    Line 13 puts
\begin{lcode}
\begin{figure}
\end{lcode}
into the figure file, and line 14 starts the 
\Ie{writeverbatim}\index{verbatim!write} environment.

    For the end of the \Ie{writefigure} environment (line 15), the 
\Ie{writeverbatim} environment is ended and after that the 
\cmd{\finishwritefigure} macro
is called. This is defined in lines 16 and 17, and simply writes
\begin{lcode}
\end{figure}
\end{lcode}
out to the figure file. The \cmd{\endwriteverbatim}, and any other kind of
\cs{end...verbatim}, command is very sensitive to anything that follows it,
and in this case did not like to be immediately followed by an
\verb?\addtostream{...}?, but did not mind it being wrapped up in 
the \cmd{\finishwritefigure} macro.

    The \cmd{\printfigures} macro defined in the last three lines of the code
simply closes the output stream\index{stream!output} and then inputs the 
figures\index{file!read} file.

    As an example of how this works, if we have the following source code:
\begin{lcode}
\chapter{The fifth chapter}
...
\begin{writefigure}
%% illustration and caption
\end{writefigure}
...
\begin{writefigure}
%% another illustration and caption
\end{writefigure}
\end{lcode}
then the figure file will contain the following (shown verbatim in the 
\Ie{fboxverbatim}\index{framed!verbatim} environment).

\begin{fboxverbatim}
\stepcounter{chapter}
\addtocounter{chapter}{-1}
\setcounter{pseudo}{5}
\begin{figure}
%% illustration and caption
\end{figure}
\begin{figure}
%% another illustration and caption
\end{figure}
\end{fboxverbatim}

\index{end floats|)}


\subsection{Example: questions and answers}

\index{questions and answers|(}

    Text books often have questions at the end of a chapter. Sometimes answers
are also provided at the end of the book, or in a separate teachers guide.
During the draft stages of such a book it is useful to keep the
questions and answers together in the source and paper drafts, only removing
or repositioning the answers towards the end of the writing process.

    This example provides an outline for meeting these desires. For 
pedagogical purposes I use a \cmd{\label} and \cmd{\ref} technique although
there are better methods. The example also shows that not
everything works as expected --- it is a reasonably accurate rendition
of the process that I actually went through in designing it.

    First we need a counter for the questions and we'll use an 
environment\index{environment!new}
for questions as these may be of any complexity. The environment takes one
argument --- a unique key to be used in a \cmd{\label}.
\begin{lcode}
\newcounter{question} \setcounter{question}{0}
\renewcommand{\thequestion}{\arabic{question}}
\newenvironment{question}[1]%
  {\refstepcounter{question}
   \par\noindent\textbf{Question \thequestion:}\label{#1}}%
  {\par}
\end{lcode}
I have used \cmd{\refstepcounter} to increment\index{counter!increment} 
the counter so that
the \cmd{\label} will refer to it, and not some external counter.

    We will use a file, called \verb?\jobname.ans? to collect the answers
and this will be written\index{file!write} to by a stream.\index{stream} 
There is also a convenience
macro, \cmd{\printanswers}, for the user to call to print the answers.
\begin{lcode}
\newoutputstream{ansout}
\end{lcode}


    A matching environment\index{environment!new} for answers is required. 
The argument to the environment is the key of the question.

   In \Lopt{draft} mode it is simple, just typeset the answer and no need to
bother with any file printing (remember that \piif{ifdraftdoc} is \ptrue\ for a 
\Lopt{draft} mode document). 
\begin{lcode}
\ifdraftdoc                       % when in draft mode
\newenvironment{answer}[1]%
  {\par\noindent\textbf{Answer \ref{#1}:}}%
  {\par}
\newcommand{\printanswers}{}
\else                             % when not in draft mode
\end{lcode}

   In \Lopt{final} mode the \Ie{answer} environment must write its contents 
verbatim to the \pixfile{ans} file for printing by \cmd{\printanswers}.
Dealing with these in reverse order, this is the definition of
\cmd{\printanswer} when not in \Lopt{draft} mode.
\begin{lcode}
\newcommand{\printanswers}{%
  \closeoutputstream{ansout}
  \input{\jobname.ans}}
\end{lcode}
 
    Now for the tricky bit, the \Ie{answer} environment. First define an
environment\index{environment!new} that makes sure our 
output\index{stream!output} stream is open, and which then
writes the answer title to the stream.
\begin{lcode}
\newenvironment{@nswer}[1]{\@bsphack
  \IfStreamOpen{ansout}{}{%
    \openoutputfile{\jobname.ans}{ansout}%
  }%
  \addtostream{ansout}{\par\noindent\textbf{Answer \ref{#1}:}}%
  }{\@esphack}
\end{lcode}
The macros \cmd{\@bsphack} and \cmd{\@esphack} are \ltx\ kernel macros
that will gobble\index{space!gobble} extraneous spaces around the 
environment. In other words,
this environment will take no space in the typeset result. The
\cmd{\IfStreamOpen} macro is used to test whether or not the stream is open, 
and if it isn't then it opens it. The answer title is then written
out to the stream. Now we can define the \Ie{answer} environment so that
its contents get written out\index{write!verbatim} verbatim.
\begin{lcode}
\newenvironment{answer}[1]%
  {\@bsphack\@nswer{#1}\writeverbatim{ansout}}%
  {\par\endwriteverbatim\end@nswer\@esphack}
\fi                               % end of \ifdraftdoc ...\else ...
\end{lcode}

    When I was testing this code I had a surprise as I got nasty error messages
from \ltx\ the first time around, but it worked fine when I processed the
source a second time! The problem lies in the code line
\begin{lcode}
\addtostream{ansout}{\par\noindent\textbf{Answer \ref{#1}:}}%
\end{lcode}  

    The first time around, \ltx\ processed the \cmd{\ref} command and of
course it was undefined. In this case \cmd{\ref} gets replaced by the
code to print the error message, which involves macros that have \texttt{@}
in their names, which \ltx\ only understands under special circumstances.
The second time around \cmd{\ref} gets replaced by the question number
and all is well. I then remembered that some commands need 
protecting\index{protect}
when they are written out, so I tried (I've wrapped the line to fit)
\begin{lcode}
\addtostream{ansout}{\par\noindent
  \protect\makeatletter\textbf{Answer 
  \protect\ref{#1}:}\protect\makeatother}%
\end{lcode}  
which did work but seemed very clumsy.

    I then took another line of attack, and looked at the definition
of \cmd{\ref} to see if I could come up with something that didn't
expand into \texttt{@} names. The result of this was
\begin{lcode}
\addtostream{ansout}{\par\noindent\textbf{Answer 
                                          \quietref{#1}:}}%
\end{lcode}  
In the kernel file \file{ltxref.dtx} I found the definition of \cmd{\ref}
and it used a macro \cmd{\@setref} (shown below) to do its work.
My \cmd{\quietref} locally changes the definition of \cmd{\@setref} 
and then calls \cmd{\ref}, which will then use the modified \cmd{\@setref}.
\begin{lcode}
\def\@setref#1#2#3{%        %% kernel definition
  \ifx#1\relax
    \protect\G@refundefinedtrue
    \nfss@text{\reset@font\bfseries ??}%
    \@latex@warning{Reference `#3' on page \thepage \space
                    undefined}%
  \else
    \expandafter#2#1\null
  \fi}

\DeclareRobustCommand{\quietref}[1]{\begingroup
  \def\@setref##1##2##3{%
    \ifx##1\relax ??\else
      \expandafter##2##1\null
    \fi
  \ref{#1}\endgroup}
\end{lcode}

    Having gone all round the houses, the simplest solution was actually
one that I had skipped over
\begin{lcode}
\addtostream{ansout}{\par\noindent\textbf{Answer 
                                          \protect\ref{#1}:}}%
\end{lcode}  

    The advantage of using the \cmd{\label} and \cmd{\ref} mechanism is that
a question and its answer need not be adjacent in the source; I think that
you have seen some of the disadvantages. Another disadvantage is that it
is difficult to use, although not impossible, if you want the answers in
a separate document.

    The real answer to all the problems is force an answer to come immediately
after the question in the source and to use the \Icn{question} counter
directly, as in the endnotes\index{endnotes} example. In the traditional manner,
this is left as an exercise for the 
reader.

\index{questions and answers|)}

\index{stream|)}

\index{file|)}

\section{Answers}

\noindent\textbf{Question 1.} As a convenience, the 
argument\index{argument!optional} to the 
environment could be made optional, defaulting, say, to the current
line width. If the default width is used the frame will be wider
than the line width, so we really ought to make the width argument
specify the width of the frame instead of the minipage. This 
means calculating a reduced width for the minipage based on
the values of \lnc{\fboxsep} and \lnc{\fboxrule}.
\begin{lcode}
\newsavebox{\minibox}
\newlength{\minilength}
\newenvironment{framedminipage}[1][\linewidth]{%
  \setlength{\minilength}{#1}
  \addtolength{\minilength}{-2\fboxsep} 
  \addtolength{\minilength}{-2\fboxrule}
  \begin{lrbox}{\minibox}\begin{minipage}{\minilength}}%
  {\end{minipage}\end{lrbox}\fbox{\usebox{\minibox}}}
\end{lcode}


\vspace{\onelineskip}
\noindent\textbf{Question 2.} There are at least three reasonable answers.
In increasing or decreasing order of probability (your choice) they are:
\begin{itemize}
\item I took Sherlock Holmes' advice and followed the methods outlined
   in the chapter;
\item I used a package, such as the \Lpack{answer} package which is designed
  for the purpose;
\item I just wrote the answers here.
\end{itemize}

\LMnote{2010/10/28}{Removed this answer as we have removed the question}
% \vspace{\onelineskip}
% \noindent\textbf{Question 3.} If \ltx\ writes text out to an external
% file which will be read by \ltx\ at some time, any 
% fragile\index{fragile} commands 
% in the text must be \cmd{\protect}ed.\index{protect}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%% mbook

%#% extend
%#% extstart include cross-referencing.tex

\svnidlong
{$Ignore: $}
{$LastChangedDate: 2013-04-24 17:14:15 +0200 (Wed, 24 Apr 2013) $}
{$LastChangedRevision: 442 $}
{$LastChangedBy: daleif $}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Cross referencing} \label{chap:xref}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\section{Introduction}

    A significant aspect of \ltx\ is that it provides a variety of
cross referencing\index{cross reference} methods, many of 
which are automatic. An example
of an automatic\index{cross reference!automatic} cross reference is the way in which a \cmd{\chapter}
command automatically adds its title and page number to the \toc,
or where a \cmd{\caption} adds itself to a \listofx.

    Some cross references have to be 
specifically\index{cross reference!specified} specified, such as
a reference in the text to a particular chapter number, and for
these \ltx\ provides a general mechanism that does not require you
to remember the particular number and more usefully does not require
you to remember to change the reference if the chapter number is later 
changed.

\section{Labels and references} \label{sec:lab&ref}

\index{reference!by number|(}

    The general \ltx\ cross reference method uses a pair of macros.
\begin{syntax}
\cmd{\label}\marg{labstr} \\
 \cmd{\ref}\marg{labstr} \cmd{\pageref}\marg{labstr} \\
\end{syntax}
\glossary(label)%
  {\cs{label}\marg{labstr}}%
  {Associates the current (section, caption, \ldots) number, and page number,
   to \meta{labstr}.}
\glossary(ref)%
  {\cs{ref}\marg{labstr}}%
  {Prints the (section, or other) number associated with \meta{labstr}
   from a \cs{label}.}
\glossary(pageref)%
  {\cs{pageref}\marg{labstr}}%
  {Prints the page number associated with \meta{labstr}
   from a \cs{label}.}
You can put a \cmd{\label} command where you want to label\index{label} 
some numbered
element in case you might want to refer to the number from elsewhere in
the document. The \meta{labstr} argument is a sequence of letters, digits, 
and punctuation symbols; upper and lower case letters are different.
The \cmd{\ref} macro prints the number\index{reference!to label} 
associated with \meta{labstr}. 
The \cmd{\pageref} macro prints the number of the 
page\index{reference!to page} where the
\cmd{\label} specifying the \meta{labstr} was placed.

    The \cmd{\label} and \cmd{\ref} mechanism is simple to use and
works well but
on occasions you might be surprised\index{reference!unexpected result}  
at what \cmd{\ref} prints.

    \ltx\ maintains a current \textit{ref} 
value\index{reference!current value} which is 
set\index{reference!set current value} by
the \cmd{\refstepcounter} command. This command is used by the sectioning
commands, by \cmd{\caption}, by numbered environments like
\Ie{equation}, by \cmd{\item} in an \Ie{enumerate} environment, and
so on. The \cmd{\label} command\index{label} writes an entry in the 
\pixfile{aux} file consisting of the \meta{labstr}, the current 
\textit{ref} value\index{reference!current value} and the curent 
page\index{page!current number} number. 
A \cmd{\ref} command picks up the \textit{ref}
value for \meta{labstr} and prints it. Similarly \cmd{\pageref} prints
the page number for \meta{labstr}.

    The critical point is that the \cmd{\label} command picks up the
value set by the \emph{most recent} visible\footnote{Remember, a
change within a group, such as an environment, is not visible
outside the group.}  \cmd{\refstepcounter}. 
\begin{itemize}
\item A \cmd{\label} after a \cmd{\section} picks up the \cmd{\section}
      number, not the \cmd{\chapter} number.
\item A \cmd{\label} after a \cmd{\caption} picks up the caption number.
\item A \cmd{\label} \emph{before} a \cmd{\caption} picks up the surrounding
      sectional number.
\end{itemize}
If you are defining your own macro that sets a counter, the counter value
will be invisible to any \cmd{\label} unless it is 
set\index{reference!set current value} using \cmd{\refstepcounter}. 



\begin{syntax}
\cmd{\fref}\marg{labstr} \cmd{\figurerefname} \\
\cmd{\tref}\marg{labstr} \cmd{\tablerefname} \\
\cmd{\pref}\marg{labstr} \cmd{\pagerefname} \\
\end{syntax}
\glossary(fref)%
  {\cs{fref}\marg{labstr}}%
  {Prints a named (\cs{figurerefname}) reference to a \cs{label}ed figure.}
\glossary(figurerefname)%
  {\cs{figurerefname}}%
  {Name for a figure used by \cs{fref}.}
\glossary(tref)%
  {\cs{tref}\marg{labstr}}%
  {Prints a named (\cs{tablerefname}) reference to a \cs{label}ed table.}
\glossary(tablerefname)%
  {\cs{tablerefname}}%
  {Name for a table used by \cs{tref}.}
\glossary(pref)%
  {\cs{pref}\marg{labstr}}%
  {Prints a named (\cs{pagerefname}) reference to a \cs{label} page reference.}
\glossary(pagerefname)%
  {\cs{pagerefname}}%
  {Name for a page used by \cs{pref}.}
    The class provides these more particular named\index{reference!to figure} 
references to a figure\index{figure!reference},
table\index{table!reference}\index{reference!to table} or 
page\index{page!reference}\index{reference!to page}. For example the 
default definitions of \cmd{\fref} and 
\cmd{\pref} are
\begin{lcode}
\newcommand{\fref}[1]{\figurerefname~\ref{#1}}
\newcommand{\pref}[1]{\pagerefname~\pageref{#1}}
\end{lcode}
and can be used as 
\begin{lcode}
\ldots footnote parameters are shown in~\fref{fig:fn} 
on~\pref{fig:fn}.
\end{lcode}
which in this document prints as: 
\begin{syntax}
\ldots footnote parameters are shown in~\fref{fig:fn} on~\pref{fig:fn}. \\
\end{syntax}

\begin{syntax}
\cmd{\Aref}\marg{labstr} \cmd{\appendixrefname} \\
\cmd{\Bref}\marg{labstr} \cmd{\bookrefname} \\
\cmd{\Pref}\marg{labstr} \cmd{\partrefname} \\
\cmd{\Cref}\marg{labstr} \cmd{\chapterrefname} \\
\cmd{\Sref}\marg{labstr} \cmd{\sectionrefname} \\
\end{syntax}
\glossary(Aref)%
  {\cs{Aref}\marg{labstr}}%
  {Prints a named (\cs{appendixrefname}) reference to a \cs{label}ed appendix.}
\glossary(appendixrefname)%
  {\cs{appendixrefname}}%
  {Name for an appendix used by \cs{Aref}.}
\glossary(Bref)%
  {\cs{Bref}\marg{labstr}}%
  {Prints a named (\cs{bookrefname}) reference to a \cs{label}ed book.}
\glossary(bookrefname)%
  {\cs{bookrefname}}%
  {Name for a book used by \cs{Bref}.}
\glossary(Pref)%
  {\cs{Pref}\marg{labstr}}%
  {Prints a named (\cs{partrefname}) reference to a \cs{label}ed part.}
\glossary(partrefname)%
  {\cs{partrefname}}%
  {Name for a part used by \cs{Pref}.}
\glossary(Cref)%
  {\cs{Cref}\marg{labstr}}%
  {Prints a named (\cs{chapterrefname}) reference to a \cs{label}ed chapter.}
\glossary(chapterrefname)%
  {\cs{chapterrefname}}%
  {Name for a chapter used by \cs{Cref}.}
\glossary(Sref)%
  {\cs{Sref}\marg{labstr}}%
  {Prints a named (\cs{sectionrefname}) reference to a \cs{label}ed section.}
\glossary(sectionrefname)%
  {\cs{sectionrefname}}%
  {Name for a section used by \cs{Sref}.}
Similarly, specific commands are supplied for referencing sectional 
divisions; \cmd{\Aref}\index{reference!to appendix} for \appendixrefname,
\cmd{\Bref}\index{reference!to book} for \bookrefname,
\cmd{\Pref}\index{reference!to part} for \partrefname, 
\cmd{\Cref}\index{reference!to chapter} for \chapterrefname,
and \cmd{\Sref}\index{reference!to section} for divisions 
below \chapterrefname. For example:
\begin{lcode}
This is \Sref{sec:lab&ref} in \Cref{chap:xref}.
\end{lcode}
This is \Sref{sec:lab&ref} in \Cref{chap:xref}.

\index{reference!by number|)}

\section{Reference by name} \label{sec:nxref}

\index{reference!by name|(}

    In technical works it is common to reference a chapter, say, by its
number. In non-technical works such cross references are likely to be
rare, and when they are given it is more likely that the chapter title
would be used instead of the number, as in:
\begin{lcode}
The chapter \textit{\titleref{chap:bringhurst}} describes \ldots
\end{lcode}
The chapter \textit{\titleref{chap:bringhurst}} describes \ldots

    There are two packages, \Lpack{nameref}~\cite{NAMEREF} and 
\Lpack{titleref}~\cite{TITLEREF},
 that let you refer to things by name instead of number.

    Name references were added to the class as a consequence of adding
a second optional argument to the sectioning commands. I found
that this broke the \Lpack{nameref} package, and hence the
\Lpack{hyperref} package as well, so they had to be fixed. The change 
also broke Donald Arseneau's \Lpack{titleref} package, and it turned out
that \Lpack{nameref} also clobbered \Lpack{titleref}. The class also
provides titles, like \cmd{\poemtitle}, that are not recognised by
either of the packages. From my viewpoint the most efficient
thing to do was to enable the class itself to provide name 
referencing.


\begin{syntax}
\cmd{\titleref}\marg{labstr} \\
\end{syntax}
\glossary(titleref)%
  {\cs{titleref}\marg{labstr}}%
  {Prints the (section, or other) title of the number associated 
   with \meta{labstr} from a \cs{label}.}
The macro \cmd{\titleref} is a class addition to the usual set of
cross referencing commands. Instead of printing a number it typesets
the title associated with the labelled number. This is really only useful
if there \emph{is} a title, such as from a \cmd{\caption} or
\cmd{\section} command. For example, look at this code 
and its result.

\begin{egsource}{eg:sec:nxref:1}
Labels may be applied to:
\begin{enumerate}
\item Chapters, sections, etc.            \label{sec:nxref:1}
...
\item Items in numbered lists, etc. \ldots \label{sec:nxref:5}
\end{enumerate}
Item \ref{sec:nxref:1} in section \textit{\titleref{sec:nxref}} 
mentions sections while item \titleref{sec:nxref:5}, on page 
\pageref{sec:nxref:5} in the same section, mentions things like
items in enumerated lists that should not be referenced 
by \verb?\titleref?.
\end{egsource}

\begin{egresult}[Named references should be to titled elements]{eg:sec:nxref:1}
Labels may be applied to:
\begin{enumerate}
\item Chapters, sections, etc.            \label{sec:nxref:1}
\item Captions
\item Legends
\item Poem titles
\item Items in numbered lists, etc. \ldots \label{sec:nxref:5}
\end{enumerate}
Item \ref{sec:nxref:1} in section \textit{\titleref{sec:nxref}} 
mentions sections while item\index{reference!unexpected result} 
\titleref{sec:nxref:5}, on page 
\pageref{sec:nxref:5} in the same section, mentions things like
items in enumerated lists 
that should not be referenced by \verb?\titleref?.
\end{egresult}

    As the above example shows, you have to be a little careful in using
\cmd{\titleref}.
Generally speaking, \cmd{\titleref}\marg{key} produces the last named 
thing before the \cmd{\label} that defines the \meta{key}. 

\begin{syntax}
\cmd{\headnameref} \cmd{\tocnameref} \\
\end{syntax}
\glossary(headnameref)%
  {\cs{headnameref}}%
  {Use header title for sectional title references.}
\glossary(tocnameref)%
  {\cs{tocnameref}}%
  {Use \prtoc{} title for sectional title references.}
There can be three possibilities for the name of a sectional division;
the full name, the name in the \toc, and the name in the page header.
As far as \cmd{\titleref} is concerned it does not use the fullname, 
and so the choice simplifies to the \toc{} or page header. Following
the declaration \cmd{\headnameref} it uses the page header name.
Following the opposite declaration \cmd{\tocnameref}, which is the
default, it uses the \toc\ name.

\Note{} Specifically with the \Lclass{memoir} class, 
do not put a \cmd{\label} command inside an
argument to a \cmd{\chapter} or \cmd{\section} or \cmd{\caption}, etc.,
command. Most likely it will either be ignored or referencing it will
produce incorrect values. This restriction does not apply to the standard
classes, but in any case I think it is good practice not to embed any 
\cmd{\label} commands.

\begin{syntax}
\cmd{\currenttitle} \\
\end{syntax}
\glossary(currenttitle)%
  {\cs{currenttitle}}%
  {Gives the title of the last sectional division command.}
    If you just want to refer to the current title you can do so with
\cmd{\currenttitle}. This acts as though there had been a label associated
with the title and then \cmd{\titleref} had been used to refer to that label.
For example:
\begin{egsource}{eg:sec:nxref:2}
This sentence in the section titled `\currenttitle' is an example of the
use of the command \verb?\currenttitle?.
\end{egsource}

\begin{egresult}[Current title]{eg:sec:nxref:2}
This sentence in the section titled `\currenttitle' is an example of the
use of the command \verb?\currenttitle?.
\end{egresult}

\begin{syntax}
\cmd{\theTitleReference}\marg{num}\marg{text} \\
\end{syntax}
\glossary(theTitleReference)%
  {\cs{theTitleReference}\marg{num}\marg{text}}
  {Called by \cs{titleref} and \cs{currenttitle} with the number and
   text of the title to print the values.}
Both \cmd{\titleref} and \cmd{\currenttitle} use the \cmd{\theTitleReference}
to typeset the title. This is called with two arguments --- 
the number, \meta{num}, and the text, \meta{text}, of the title. The
default definition is:
\begin{lcode}
\newcommand{\theTitleReference}[2]{#2}
\end{lcode}
so that only the \meta{text} argument is printed. You could, for example,
change the definition to
\begin{lcode}
\renewcommand{\theTitleReference}[2]{#1\space \textit{#2}}
\end{lcode}
to print the number followed by the title in italics. If you do this, only use
\cmd{\titleref} for numbered titles, as a printed number for an 
unnumbered title (a) makes no sense, and (b) will in any case be 
incorrect.

    The commands \cmd{\titleref}, \cmd{\theTitleReference} and 
\cmd{\currenttitle} are direct equivalents of those in the \Lpack{titleref}
package~\cite{TITLEREF}.

\begin{syntax}
\cmd{\namerefon} \cmd{\namerefoff} \\
\end{syntax}
\glossary(namerefon)%
  {\cs{namerefon}}%
  {Makes \cs{titleref} operative.}
\glossary(namerefoff)%
  {\cs{namerefoff}}%
  {Makes \cs{titleref} inoperative.}

    The capability for referencing by name has one potentially
unfortunate side effect --- it causes some arguments, such as that
for \cmd{\legend}, to be moving\index{moving argument} arguments 
and hence any fragile\index{fragile} command
in the argument will need \cmd{\protect}ing. However, not every document
will require the use of \cmd{\titleref} and so the declaration
\cmd{\namerefoff} is provided to switch it off (the argument to
\cmd{\legend} would then not be moving). The declaration
\cmd{\namerefon}, which is the default, enables name referencing.

\index{reference!by name|)}


%#% extend
%#% extstart include backmatter.tex

\svnidlong
{$Ignore: $}
{$LastChangedDate: 2014-03-31 11:34:44 +0200 (Mon, 31 Mar 2014) $}
{$LastChangedRevision: 480 $}
{$LastChangedBy: daleif $}


\LMnote{2010/06/09}{Several \cs{ixfile}'s changed to \cs{pixfile},
  with \cs{ixfile} only, no text appears in the output }


\chapter{\prBackmatter} \label{chap:backmatter}

The \pixbackmatter\ consists of reference and supportive elements for 
the \pixmainmatter;
things like bibliographies, indexes, glossaries, endnotes, and other
material. The class provides additional elements and features of such 
matter that are not in the standard classes.

\section{Bibliography} \label{sec:xref:bibliography}

\index{bibliography|(}

Just as a reminder the bibliography is typeset within the 
\Ie{thebibliography} environment.
\begin{syntax}
\cmd{\bibname} \\
\senv{thebibliography}\marg{exlabel} \\
\cmd{\bibitem} ... \\
\eenv{thebibliography} \\
\end{syntax}
\glossary(bibname)%
  {\cs{bibname}}%
  {The title for a bibliography}
\glossary(thebibliography)%
  {\senv{thebibliography}\marg{exlabel}}%
  {Environment for typesetting a bibliography. \meta{exlabel} is an arbitrary
    piece of text as wide as the widest label for the bibliographic items.}
\glossary(bibitem)%
  {\cs{bibitem}}%
  {Starts a new bibliographic entry in a \Pe{thebibliography} listing.}
The environment takes one required argument, \meta{exlabel}, which is a 
piece of text
as wide as the widest label in the bibliography. The value of 
\cmd{\bibname} (default `Bibliography') is used
as the title. 

\begin{syntax}
\cmd{\bibintoc} \cmd{\nobibintoc} \\
\end{syntax}
\glossary(bibintoc)%
  {\cs{bibintoc}}%
  {Title of \Pe{thebibliography} will be added to the \prtoc.}
\glossary(nobibintoc)%
  {\cs{nobibintoc}}%
  {Title of \Pe{thebibliography} is not added to the \prtoc.}
The declaration \cmd{\bibintoc} will cause the \Ie{thebibliography}
environment to add the title\index{bibliography!title in ToC} to 
the \toc, while the declaration
\cmd{\nobibintoc} ensures that the title is not added to the \toc. 
The default is \cmd{\bibintoc}.

\begin{syntax}
\cmd{\cite}\oarg{detail}\marg{labstr-list} \\
\end{syntax}
\glossary(cite)%
  {\cs{cite}\oarg{detail}\marg{labstr-list}}%
  {Citation in the text to bibliographic items specified in the 
   \meta{labstr-list} of comma-separated bibliographic identifiers;
  optional information, e.g., page number, is supplied via \meta{detail}.}
Within the text you call out a bibliographic\index{cite bibliographic item} 
reference using the
\cmd{\cite} command, where \meta{labstr-list} is a comma-separated
list of identifiers for the cited works; there must be no spaces in this 
list. The optional \meta{detail} argument is for any additional
information regarding the citation such as a chapter or page number;
this is printed after the main reference. 

    Various aspects of a bibliography can be changed and at this point
it may be helpful to look at some of the internals of the \Ie{thebibliography}
environment, which is defined like this
\begin{lcode}
\newenvironment{thebibliography}[1]{%
  \bibsection
  \begin{bibitemlist}{#1}}%
  {\end{bibitemlist}\postbibhook}
\end{lcode}
The bibliographic entries are typeset as a list, the \Ie{bibitemlist}.

\begin{syntax}
\cmd{\bibsection} \\
\end{syntax}
\glossary(bibsection)%
  {\cs{bibsection}}%
  {Initialises the bibliography and typesets the title.}
The macro \cmd{\bibsection} defines the heading\index{bibliography!heading} 
for the \Ie{thebibliography}
environment; that is, everything before the actual list of items.
It is effectively defined as
\begin{lcode}
\newcommand{\bibsection}{%
  \chapter*{\bibname}
  \bibmark
  \ifnobibintoc\else
    \phantomsection
    \addcontentsline{toc}{chapter}{\bibname}
  \fi
  \prebibhook}
\end{lcode}
If you want to change the heading, redefine \cmd{\bibsection}. For example,
to have the bibliography as a numbered section instead of an unnumbered
chapter, redefine it like
\begin{lcode}
\renewcommand{\bibsection}{%
  \section{\bibname}
  \prebibhook}
\end{lcode}
If you use the \Lpack{natbib}~\cite{NATBIB} and/or the 
\Lpack{chapterbib}~\cite{CHAPTERBIB} packages with the \Lopt{sectionbib}
option, then they change \cmd{\bibsection} appropriately to typeset the
heading as a numbered section.

\begin{syntax}
\cmd{\bibmark} \\
\end{syntax}
\glossary(bibmark)%
  {\cs{bibmark}}%
  {Can be used in pagestyles for page headers in a bibliography.}
\cs{bibmark} may be used in pagestyles for page headers in a bibliography.
Its default definition is: 
\begin{lcode}
\newcommand*{\bibmark}{}
\end{lcode}
but could be redefined like, say,
\begin{lcode}
\renewcommand*{\bibmark}{\markboth{\bibname}{}}
\end{lcode}


\begin{syntax}
\cmd{\prebibhook} \cmd{\postbibhook} \\
\end{syntax}
\glossary(prebibhook)%
  {\cs{prebibhook}}%
  {Called between typesetting the title of a bibliography and starting
   the list of bibliographic entries.}
\glossary(postbibhook)%  
  {\cs{postbibhook}}%
  {Called after typesetting the list of of bibliographic entries.}
The commands \cmd{\prebibhook} and \cmd{postbibhook} are called after 
typesetting the title of the bibliography and after typesetting the list of
entries, respectively. By default, they are defined to do nothing. You may
wish to use one or other of these to provide some general 
information\index{bibliography!explanatory text} about
the bibliography. For example:
\begin{lcode}
\renewcommand{\prebibhook}{%
CTAN is the Comprehensive \tx\ Archive Network and URLS for the 
several CTAN mirrors can be found at \url{http://www.tug.org}.}
\end{lcode}

\index{bibliography!list styling|(}

\begin{syntax}
\cmd{\biblistextra} \\
\end{syntax}
\glossary(biblistextra)%
  {\cs{biblistextra}}%
  {Called immediately after the \Pe{bibitemlist} is set up.}
Just at the end of setting up the \Ie{bibitemlist} the \cmd{\biblistextra}
command is called. By default this does nothing but you may change it to
do something useful. For instance, it can be used to change
the list parameters so that the entries are 
typeset flushleft.\index{bibliography!flushleft entries}
\begin{lcode}
\renewcommand*{\biblistextra}{%
  \setlength{\leftmargin}{0pt}%
  \setlength{\itemindent}{\labelwidth}%
  \addtolength{\itemindent}{\labelsep}}
\end{lcode}

\begin{syntax}
\cmd{\setbiblabel}\marg{style} \\
\end{syntax}
\glossary(setbiblabel)%
  {\cs{setbiblabel}\marg{style}}%
  {Define the look of the bibliographic entry identifiers.}
The style of the labels\index{bibliography!label styling} marking the 
bibliographic entries can be set
via \cmd{\setbiblabel}. The default definition is
\begin{lcode}
\setbiblabel{[#1]\hfill}
\end{lcode}
where \verb?#1? is the citation mark position, which generates flushleft 
marks enclosed in square brackets. To have marks just
followed by a dot
\begin{lcode}
\setbiblabel{#1.\hfill}
\end{lcode}

\begin{syntax}
\cmd{\bibitem}\oarg{label}\marg{labstr} \\
\cmd{\newblock} \\
\end{syntax}
\glossary(bibitem)%
  {\cs{bibitem}\oarg{label}\marg{labstr}}%
  {Introduces an entry in the bibliography. The \meta{labstr} argument
   corresponds to a \cs{cite}'s \meta{labstr} argument. The optional
   \meta{label} overides the default numerical printed entry label.}
\glossary(newblock)%
  {\cs{newblock}}%
  {Used in a bibliography to indicate a convenient place in an entry to
   have a pagebreak.}
Within the \Ie{bibitemlist} environment the entries are introduced
by \cmd{\bibitem} instead of the more normal \cmd{\item} macro.
The required \meta{labstr} argument is the identifier for the citation and
corresponds to a \meta{labstr} for \cmd{\cite}. The items in the list
are normally labelled numerically but this can be overriden by using
the optional \meta{label} argument. The \cmd{\newblock} command can be used
at appropriate places in the entry for encouraging a linebreak (this is
used by the \Lopt{openbib} option).

\begin{syntax}
\lnc{\bibitemsep} \\
\end{syntax}
\glossary(bibitemsep)%
  {\cs{bibitemsep}}%
  {Vertical space between entries in a bibliography.}
In the listing the vertical space between entries is controlled by the
length \lnc{\bibitemsep}, which by default is set to the normal 
\lnc{\itemsep} value. The vertical space is 
\texttt{(\lnc{\bibitemsep} + \lnc{\parsep})}. If you wish to eliminate
the space between items do
\begin{lcode}
\setlength{\bibitemsep}{-\parsep}
\end{lcode}

\index{bibliography!list styling|)}

\subsection{BibTex}

     Often the \Lbibtex\ program~\cite{BIBTEX} is used to generate the 
bibliography list from database(s) of 
bibliographic\index{bibliographic database} data. For \Lbibtex\ 
a bibliographic data base is a \pixfile{bib} file containing information
necessary to produce entries in a bibliography. \Lbibtex\ 
extracts the raw data from the files for each citation in the text and 
formats it for typesetting according to a particular style.


\begin{syntax}
\cmd{\bibliography}\marg{bibfile-list} \\
\end{syntax}
\glossary(bibliography)%
  {\cs{bibliography}\marg{bibfile-list}}%
  {Print the bibliography having used \Pbibtex\ to extract entries from
   the \meta{bibfile-list} of comma-separated names of \file{bib} files.}
    The bibliography will be printed at the location of the \cmd{\bibliography}
command. Its argument is a comma-separated list of \Pbibtex\ \pixfile{bib} files 
which will be searched by \Lbibtex\ to generate the bibliography.
Only the file name(s) should be supplied, the extension must not be given.


\begin{syntax}
\cmd{\nocite}\marg{labstr} \verb?\nocite{*}? \\
\end{syntax}
\glossary(nocite)%
  {\cs{nocite}\marg{labstr}}%
  {Add entry \meta{labstr} to the bibliography, but with no in-text citation.}
The command \cmd{\nocite} causes \Lbibtex\ to make an entry 
in the bibliography but no citation will appear in the text. The special
case \verb?\nocite{*}? causes \emph{every} entry in the database to be
listed in the bibliography.

\begin{syntax}
\cmd{\bibliographystyle}\marg{style} \\
\end{syntax}
\glossary(bibliographystyle)%
  {\cs{bibliographystyle}\marg{style}}%
  {Typeset the bibliographic entries according to \meta{style}.}
Many different \Pbibtex\ styles\index{BibTeX style?\Pbibtex\ style}
are available and the particular one to be used is specified
by calling \cmd{\bibliographystyle} before the bibliography itself.
The `standard' bibliography \meta{style}s follow the general schemes
for mathematically oriented papers and are:
\begin{itemize}
\item[\texttt{plain}]\index{BibTeX style?\Pbibtex\ style!plain?\texttt{plain}} 
     The entry format is similar to one suggested by
     Mary-Claire van Leunen~\cite{LEUNEN92}, and entries are sorted
     alphabetically and labelled with numbers.
\item[\texttt{unsrt}]\index{BibTeX style?\Pbibtex\ style!unsrt?\texttt{unsrt}} 
     The format is the same as \texttt{plain} but
     that entries are ordered by the citation order in the text.
\item[\texttt{alpha}]\index{BibTeX style?\Pbibtex\ style!alpha?\texttt{alpha}} 
     The same as \texttt{plain} but entries are 
     labelled like `Wil89', formed from the author and publication date.
\item[\texttt{abbrv}]\index{BibTeX style?\Pbibtex\ style!abbrv?\texttt{abbrv}} 
     The same as \texttt{plain} except that some elements, like month 
     names, are abbreviated.
\end{itemize}
There are many other styles available, some of which are used
in collaboration with a package, one popular one being 
Patrick Daly's \Lpack{natbib}~\cite{NATBIB} package for the kinds of 
author-year citation styles used in the natural sciences. 
Another package is \Lpack{jurabib}~\cite{JURABIB} for citation styles
used in legal documents where the references are often given in footnotes
rather than listed at the end of the document.

    I assume you know how to 
generate\index{running BibTeX?running \Pbibtex} a bibliography using \Lbibtex,
so this is just a quick reminder. You first run \ltx\
on your document, having specified the bibliography style, cited
your reference material and listed the relevant \Lbibtex\ database(s). 
You then run \Lbibtex, and after running \ltx\ twice more the
bibliography should be complete. After a change to your citations you have to
run \ltx\ once, \Lbibtex\ once, and then \ltx\ twice more to get an 
updated set of references.

    The format and potential contents of a \Pbibtex\
database\index{BibTeX database?\Pbibtex\ database} file 
(a \pixfile{bib} file) are specified in detail in Lamport~\cite{LAMPORT94} 
and the first of the \btitle{Companions}~\cite{COMPANION}. 
Alternatively
there is the documentation by Oren Patashnik~\cite{BIBTEX} who wrote the
\Lbibtex\ program.

\index{BibTeX style?\Pbibtex\ style!changing|(}

    A \Pbibtex\ style, specified in a \pixfile{bst} file, is written 
using an anonymous stack based language
created specifically for this purpose. If you can't find a 
\Pbibtex\ style\index{BibTeX style?\Pbibtex\ style}
that provides what you want you can either use the 
\Lpack{makebst}~\cite{MAKEBST} package
which leads you through creating your own style via a question and answer
session, or you can directly write your own. If you choose the latter
approach then Patashnik's \textit{Designing BibTeX files}~\cite{BIBTEXHACK}
is essential reading. As he says, it is best to take an existing style and
modify it rather than starting from scratch. 

\begin{comment}

This is what I did for the
style for this book, as all I wanted was a slight change and extension
to the standard 
\texttt{alpha}\index{BibTeX style?\Pbibtex\ style!alpha?\texttt{alpha}}  
style, which is in \file{alpha.bst}\ixfile{bst}.

    There were three things that I wanted to do:
\begin{itemize}
\item Add an `isbn' field to the entries so an ISBN\index{ISBN} number 
      could be easily quoted;
\item Add an `annote' field so that I could perhaps provide an 
      annotated\index{bibliography!annotated}
      bibliography;
\item Use the modern \cmd{\emph} command instead of the deprecated \cmd{\em}
      command for titles;
\end{itemize}

    If you aren't interested in how I did it, skip the next part, 
but if you are you might find it easier to follow if you have a copy 
of the \pixfile{alpha.bst} file to hand. 

This is what I did, although not in this order as I kept flitting
back and forth in order to resolve the problems that arose.
\begin{itemize}
\item Copied the \pixfile{alpha.bst} file to a new file I called 
      \pixfile{typo.bst} as my new style was to be called \texttt{typo}.

\item Near the start of the file are some lines:
\begin{lcode}
ENTRY
  { address
    author
    ...
    year
    isbn
    annote
  }
\end{lcode}
at the end of which I added the \texttt{isbn} and \texttt{annote}. These are
the fields that may apear in an entry. Later I have to describe how these
fields are to be dealt with.

\item
    Shortly after the \texttt{ENTRY} list there is a set of \texttt{FUNCTION}
specifications, the 17th of which is called \texttt{emphasize}. This is the 
only place in the file where the \cmd{\em} macro appears, so this is what I 
have to modify so that the \texttt{typo} style will use \cmd{\emph} instead
of \cmd{\em}. My revised definition is:
\begin{lcode}
FUNCTION {emphasize}
{ duplicate$ empty$ 
    { pop$ "" }
%%    { "{\em " swap$ * "}" * }  % original, change to
    { "\emph{ " swap$ * "}" * }  % PW mod
  if$
}
\end{lcode}
I didn't (and still don't) know just how the function operated but my
modification worked.

\item
    After this were a lot of functions of the form \verb?{format.something}?
which I took to be the formatting instructions for the fields. Looking
at the various functions I added the following ones.
\begin{lcode}
%% PW added format.isbn
FUNCTION {format.isbn}
{ isbn empty$
  { "" }
  { new.block " ISBN " isbn * }
    if$
}

%% PW added format.annote
{ annote empty$
  { "" }
  { " \begin{quotation}\noindent " annote * 
    " \end{quotation} " * }
    if$
}

%% PW added fin.annote
{ annote empty$
  {  }
  { newline$ }
    if$
}
\end{lcode}
%$

\item
    The last thing that I had to do was to get the entries to write
out the new \texttt{annote} and \texttt{isbn} fields. As an example, here 
is the revised function for a \texttt{booklet} entry, which is one of the
shorter ones.
\begin{lcode}
FUNCTION {booklet}
{ output.bibitem
  format.authors output
  new.block
  format.title "title" output.check
  howpublished address new.block.checkb
  howpublished output
  address output
  format.date output
  format.isbn output    %% PW added
  new.block
  note output
  fin.entry
  format.annote write$  %% PW added
  fin.annote            %% PW added
}
\end{lcode}
%$

I added similar lines to all the other entry functions except, for example, 
the \texttt{article} function where I only added the \texttt{annote}
lines as I assumed that an article would not have an ISBN\index{ISBN}.

\end{itemize}

    It took me three or four attempts to make it all work as I didn't 
really know what I was doing. I basically copied something that looked
close to what I might need, changed some names, and tried it out. If it
didn't work then I tried something a bit different until it did.
For someone who knew what they were doing it would have been a trivial
task and they would probably have used a more elegant solution, but
it works and didn't take too long.
\end{comment}

\index{BibTeX style?\Pbibtex\ style!changing|)}


\index{bibliography|)}

\section{Index} \label{sec:xref:index}


   It is time to take a closer look at indexing. The class allows 
multiple indexes\index{index!multiple} and an index may be typeset as a 
single\indextwo{index}{single column} or a 
double\indextwo{index}{double column} column.

    The general process is to put indexing commands into your source text, 
and \ltx\ will write this raw indexing data to an \pixfile{idx} file. 
The raw index data is then processed, not by \ltx\ but by yourself if you 
have plenty of spare time on your hands, or more usually by a separate 
program, to create a sorted list of indexed items in a second file (usually
an \pixfile{ind} file). This can then be input to \ltx\ to print the sorted
index data.

\subsection{Printing an index}
\index{index!printing|(}

\begin{syntax}
\cmd{\makeindex}\oarg{file} \\
\cmd{\printindex}\oarg{file} \\
\end{syntax}
\glossary(makeindex)%
  {\cs{makeindex}\oarg{file}}%
  {Preamble command to collect raw index information. By default this
   is written to file \cs{jobname}\texttt{.idx}. If the optional argument
   is used it may be written to file \meta{file}\texttt{.idx}.}
\glossary(printindex)%
  {\cs{printindex}\oarg{file}}%
  {Print the sorted index. By default this is read from file 
   \cs{jobname}\texttt{.ind}. If the optional argument is given
   it will read the data from file \meta{file}\texttt{.ind}.}
In order to make \ltx\ collect indexing information the declaration 
\cmd{\makeindex} must be put in the preamble\index{preamble}. By default
the raw index data is put into the \file{jobname.idx}\ixfile{idx} file. If
the optional \meta{file} argument is given then index data can be
output to \file{file.idx}. Several \cmd{\makeindex} declarations
can be used provided they each call for a different file.

    The \cmd{\printindex} command will print\index{index!print} an index 
where by default the indexed items are assumed to be in a file called 
\pixfile{jobname.ind}\ixfile{ind}. If the optional \meta{file} argument 
is given
then the indexed items are read from the file called \file{file.ind}.

%    The typical method of generating an \pixfile{ind} file containing
%the sorted index entries from the raw index data in an
%\pixfile{idx} file is to use the \Lmakeindex\ program~\cite{CHEN88}.


\begin{syntax}
\senv{theindex} entries \eenv{theindex} \\
\cmd{\onecolindex} \cmd{\twocolindex} \\
\cmd{\indexname} \\
\end{syntax}
\glossary(theindex)%
  {\senv{theindex}}%
  {Environment for typesetting an index}
\glossary(onecolindex)%
  {\cs{onecolindex}}%
  {Typeset index in one column.}
\glossary(twocolindex)%
  {\cs{twocolindex}}%
  {Typeset index in two columns (the default).}
\glossary(indexname)%
  {\cs{indexname}}%
  {Name used for the theindex title.}
The index entries are typeset within the \Ie{theindex} 
environment. By default it is typeset with two 
columns\indextwo{double column}{index}
but following the \cmd{\onecolindex} declaration the environment
uses a single\indextwo{index}{single column} column. 
The default two column behaviour is restored
after the \cmd{\twocolindex} declaration.
The index\indextwo{index}{name} title is given by the current value of 
\cmd{\indexname} (default `Index').

\begin{syntax}
\cmd{\indexintoc} \cmd{\noindexintoc} \\
\end{syntax}
\glossary(indexintoc)%
  {\cs{indexintoc}}%
  {Add the index title to the \prtoc\ (the default).}
\glossary(noindexintoc)%
  {\cs{noindexintoc}}%
  {Do not add the index title to the \prtoc.}
The declaration \cmd{\indexintoc} will cause the \Ie{theindex}
environment to add the title\index{index!title in ToC} to the \toc, 
while the declaration
\cmd{\noindexintoc} ensures that the title is not added to the \toc. 
The default is \cmd{\indexintoc}.

\begin{syntax}
\lnc{\indexcolsep} \\
\lnc{\indexrule} \\
\end{syntax}
\glossary(indexcolsep)%
  {\ls{indexcolsep}}%
  {Width of the gutter in two column indexes.}
\glossary(indexrule)%
  {\ls{indexrule}}%
  {Width of the inter-column rule in two column indexes.}
The length \lnc{\indexcolsep} is the width of the gutter between the two
index columns\index{index!double column!gutter}
The length \lnc{\indexrule}, default
value 0pt, is the thickness of a vertical rule separating the two columns.


\begin{syntax}
\cmd{\preindexhook} \\
\end{syntax}
\glossary(preindexhook)%
  {\cs{preindexhook}}%
  {Called between typesetting an index's title and the start of the list.}
    The macro \cmd{\preindexhook}\index{index!explanatory text} 
is called after the title is typeset and
before the index listing starts. By default it does nothing but
can be changed. For example
\begin{lcode}
\renewcommand{\preindexhook}{Bold page numbers are used 
  to indicate the main reference for an entry.}
\end{lcode}

\begin{syntax}
\cmd{\indexmark} \\
\end{syntax}
\glossary(indexmark)%
  {\cs{indexmark}}%
  {Can be used in pagestyles for page headers in an index.}
\cs{indexmark} may be used in pagestyles for page headers in an index.
Its default definition is: 
\begin{lcode}
\newcommand*{\indexmark}{}
\end{lcode}
but could be redefined like, say,
\begin{lcode}
\renewcommand*{\indexmark}{\markboth{\indexname}{\indexname}}
\end{lcode}




\begin{syntax}
\cmd{\ignorenoidxfile} \\
\cmd{\reportnoidxfile} \\
\end{syntax}
\glossary(ignorenoidxfile)%
  {\cs{ignorenoidxfile}}%
  {Do not report attempts to use an \file{idx} file that has not been
   declared by \cs{makeindex}.}
\glossary(reportnoidxfile)%
  {\cs{reportnoidxfile}}%
  {Report attempts to use an \file{idx} file that has not been
   declared by \cs{makeindex}.}
Following the declaration \cmd{\ignorenoidxfile}, which is the default,
LaTeX will silently pass over attempts to use an \pixfile{idx} file which has
not been declared via \cmd{\makeindex}. After the declaration
\cmd{\reportnoidxfile} LaTeX will whine about any attempts to 
write to an unopened file.

\index{index!printing|)}

\subsection{Preparing an index}

\index{index!preparation|(}

    It it is easy for a computer to provide a list of all the words you
have used, and where they were used. This is called a 
concordance\index{concordance}. 
Preparing an index, though, is not merely a gathering of words but 
is an intellectual
process that involves recognising and naming concepts, constructing a
logical hierarchy of these and providing links between related concepts.
No computer can do that for you though it can help with some tasks, such as
sorting things into alphabetical order, eliminating duplicates, and so forth.

    Several iterations may be required before you have an acceptable index.
Generally you pick out the important words or phrases used on the first pass.
Part of the skill of indexing is finding appropriate words to describe things
that may not be obvious from the text. If there are several ways of describing
something they may all be included using a `see' 
reference\index{index!see reference} to the most
obvious of the terms, alternatively you could 
use `see also'\index{index!see also reference} references
between the items. Entries should be broken down into subcategories so
that any particular item will not have a long string of page numbers and
your reader is more likely to quickly find the relevant place. After having 
got the first index you will most probably have to go back and correct
all the sins of ommission and commission, and start the cycle again.

    I found that indexing this manual was the most difficult part of preparing
it. It was easy to index the names of all the macros, environments, and so on
as I had commands that would simultaneously print and index these. It was
the concepts that was difficult. I inserted \cmd{\index} commands as I went
along at what seemed to be appropriate places but turned out not to be.
I would use slightly different words for the same thing, and what was worse
the same word for different things. It took a long time to improve it to 
its present rather pitiful state.

\begin{syntax}
\cmd{\index}\oarg{file}\marg{stuff} \\
\end{syntax}
\glossary(index)%
  {\cs{index}\oarg{file}\marg{stuff}}%
  {Add \meta{stuff} and the current page number to the raw index data. 
   By default this is written to
   file \cs{jobname}\texttt{.idx}. If the optional argument
   is given it will be written to file \meta{file}\texttt{.idx}.}
The \cmd{\index} macro specifies that \meta{stuff} is to appear in
an index. By default the raw index data --- the \meta{stuff} and the 
page number --- will be output
to the \pixfile{jobname.idx}\ixfile{idx} file, but if the optional \meta{file}
argument is given then output will be to the \file{file.idx} file.

    This book has two\index{index!multiple} indexes. 
The main index uses the default indexing
commands, while the second index does not. They are set up like this:
\begin{lcode}
% in preamble
\makeindex
\makeindex[lines]
% in body
...\index{main} ...\index[lines]{First line} ...
...
% at the end
\clearpage
% main index
\pagestyle{Index}
\renewcommand{\preindexhook}{%
The first page number is usually, but not always,
the primary reference to the indexed topic.\vskip\onelineskip}
\printindex

% second index
\clearpage
\pagestyle{ruled}
\renewcommand{\preindexhook}{}
\renewcommand{\indexname}{Index of first lines}
\onecolindex
\printindex[lines]
\end{lcode}


\begin{syntax}
\cmd{\specialindex}\marg{file}\marg{counter}\marg{stuff} \\
\end{syntax}
\glossary(specialindex)%
  {\cs{specialindex}\marg{file}\marg{counter}\marg{stuff}}%
  {Add \meta{stuff} and the current value of \meta{counter}
   to the raw index data file \meta{file}\texttt{.idx}.}
The \cmd{\index} command uses the page number\index{reference!to page} 
as the reference for 
the indexed item. In contrast the \cmd{\specialindex} command uses
the \meta{counter} as the reference\index{reference!to counter} 
for the indexed \meta{stuff}.
It writes \meta{stuff} to the \file{file.idx} file, and also writes
the page number (in parentheses) and the value of the \meta{counter}.
This means that indexing can be with respect to something other than page 
numbers. However, if the \Lpack{hyperref} package is used the special
index links will be to pages even though they will appear to be with 
respect to the \meta{counter}; for example, if figure numbers are used
as the index reference the hyperref link will be to the page where the
figure caption appears and not to the figure itself.


\begin{syntax}
\cmd{\showindexmarks} \cmd{\hideindexmarks} \\
\cmd{\indexmarkstyle} \\
\end{syntax}
\glossary(showindexmarks)%
  {\cs{showindexmarks}}%
  {The \meta{stuff} argument to \cs{index} and \cs{specialindex} will
   be printed in the margin (for use in noting what has been indexed where).}
\glossary(hideindexmarks)%
  {\cs{hideindexmarks}}%
  {The \meta{stuff} argument to \cs{index} and \cs{specialindex} will
   not be printed in the margin (the default).}
\glossary(indexmarkstyle)%
  {\cs{indexmarkstyle}}%
  {Font style for printing index marks in the margin.}
The declaration \cmd{\showindexmarks} causes the argument to practically 
any \cmd{\index} and \cmd{\specialindex} to be 
printed\index{index!show indexed items} in the margin of the
page where the indexing command was issued. The argument is printed using
the \cmd{\indexmarkstyle} which is initially specified as
\begin{lcode}
\indexmarkstyle{\normalfont\footnotesize\ttfamily}
\end{lcode}
For reasons I don't fully understand, spaces in the argument are displayed
as though it was typeset using the starred version of \cmd{\verb}.
The \cmd{\hideindexmarks}, which is the default, turns off 
\cmd{\showindexmarks}.

    The standard classes just provide the plain \cmd{\index} command with
no optional \meta{file} argument. In those classes the contents of the
\file{jobname.idx} file is limited to the index entries actually seen in 
the document. In particular, if you are using \cmd{\include} for
some parts of the document and \cmd{\includeonly} to exclude one or more
files, then any \cmd{\index} entries in an excluded file will not appear
in the \file{jobname.idx} file. The new implementation of indexing eliminates 
that potential problem.

\begin{syntax}
\cmd{\item} \cmd{\subitem} \cmd{\subsubitem} \\
\end{syntax}
\glossary(item)%
  {\cs{item}}%
  {Introduces a main index entry.}
\glossary(subitem)%
  {\cs{subitem}}%
  {Introduces a subsidiary index entry.}
\glossary(subsubitem)%
  {\cs{subsubitem}}%
  {Introduces a third level index entry.}
The \Ie{theindex} environment\index{index!entry levels} supports 
three levels of entries.
A \cmd{\item} command
flags a main\index{index!main entry} entry; a subentry\index{index!subentry} 
of a main entry is indicated by
\cmd{\subitem} and a subentry\index{index!subentry!subsubentry} 
of a subentry is flagged by 
\cmd{\subsubitem}. For example a portion of an index might look like:
\egstart[-2em]
\begin{lcode}
\item bridge, 2,3,7
\subitem railway, 24
\subsubitem Tay, 37
\end{lcode}
\egmid
bridge, 2, 3, 7\\
\hspace*{2em} railway, 24 \\
\hspace*{4em} Tay, 37
\egend
\noindent if the Tay Bridge\footnote{A railway (railroad) bridge in Scotland
that collapsed in 1879 killing 90 people. The disaster lives for ever in
the poem \textit{The Tay Bridge Disaster} by William McGonagall (1830--?), 
the first verse of which goes:
\begin{verse}
Beautiful Railway Bridge of the Silv'ry Tay!\index[lines]{Beautiful 
  Railway Bridge of the Silv'ry Tay} \\
Alas! I am very sorry to say \\
That ninety lives have been taken away \\
On the last Sabbath day of 1879, \\
Which will be remember'd for a very long time.
\end{verse}}
was mentioned on page 37.


\subsection{MakeIndex}

    It is possible, but time consuming and error prone, to create your
index by hand from the output of the \cmd{\index} commands you have scattered
throughout the text. Most use the \Lmakeindex\ program to do this
for them; there is also the \Lprog{xindy} program~\cite{XINDY} 
but this is much less known. 


\begin{syntax}
\cmd{\xindyindex} \\
\end{syntax}
It turns out that \Lprog{xindy} cannot handle a \Mname\ 
hyperindex\index{hyperindex} (which
can be obtained with the aid of the \Lpack{hyperref} package), although
\Lmakeindex\ can do so.\footnote{This deficiency in \Pprog{xindy}
was discovered by Frederic Connes\index{Connes, Frederic}, who also provided
the \cs{xindyindex} command.}
If you are going to use \Lprog{xindy} to process
the raw index data put \cmd{\xindyindex} in the preamble, which will prevent
hyperindexing\index{hyperindex}.

%%\index{MakeIndex?\Pmakeindex!raw data|(}
\Iprogsub{MakeIndex}{raw data|(}%

   \Lmakeindex\ reads an \pixfile{idx} file containg the raw index
data (which may include some commands to \Lmakeindex\ itself), sorts
the data, and then outputs an \pixfile{ind} file containing the sorted data,
perhaps with some \ltx\ commands to control the printing.
\Lmakeindex\ was created as a general purpose index processing program
and its operation can be controlled by a 
`makeindex configuration file'%
%%\index{MakeIndex?\Pmakeindex!configuration file}%
\Iprogsub{MakeIndex}{configuration file}%
\index{configuration file!MakeIndex?\Pmakeindex} 
(by default this is an \pixfile{ist} file). Such a file consists of two 
parts. The first
part specifies \Pmakeindex\ commands that can be included in the
\meta{stuff} argument to \cmd{\index}. The second part controls how 
the sorted index data is to be output.

    I will only describe the most common elements of what you can put in 
an \pixfile{ist} file; consult the \Pmakeindex\
manual~\cite{CHEN88}, or the \btitle{Companion}~\cite{COMPANION}, for all 
the details.

You can embed commands, in the form of single characters,
in the argument to \cmd{\index} that guide 
\Lmakeindex\ in converting the raw \pixfile{idx} file into an 
\pixfile{ind} file for final typesetting. The complete set of these
is given in \tref{tab:configin}. They all have defaults and you can modify
these via a \Lmakeindex\ configuration file.

\newcommand*{\kwd}[1]{\texttt{#1}}
\newcommand*{\kty}[1]{\textit{(#1)}}

\begin{table}
\centering
\caption{\Pmakeindex\ configuration file input parameters} \label{tab:configin}
\begin{tabular}{llp{0.5\textwidth}}\toprule
\multicolumn{1}{c}{Keyword} & \multicolumn{1}{c}{Default} & \multicolumn{1}{c}{Description} \\ \midrule
\kwd{keyword} \kty{s} & \verb?"\\indexentry"? & 
  The argument to this command is a \Pmakeindex{} index entry \\
\kwd{arg\_open} \kty{c} & \verb?'{'? &
  Argument start delimeter \\
\kwd{arg\_close} \kty{c} & \verb?'}'? &
  Argument end delimeter \\
\kwd{range\_open} \kty{c} & \verb?'('? &
  Start of an explicit page range \\
\kwd{range\_close} \kty{c} & \verb?')'? &
  End of an explicit page range \\
\kwd{level} \kty{c} & \verb?'!'? &
  Character denoting a new subitem level \\
\kwd{actual} \kty{c} & \verb?'@'? &
  Character denoting that the following text is to appear in the
  actual index file \\
\kwd{encap} \kty{c} & \verb?'|'? &
  Character denoting that the rest of the argument is to be used as
  an encapsulating command for the page number \\
\kwd{quote} \kty{c} & \verb?'"'? &
  Character that escapes the following character \\
\kwd{escape} \kty{c} & \verb?'\\'? &
  Symbol with no special meaning unless followed by the \kwd{quote}
  character, when both characters will be printed. The \kwd{quote}
  and \kwd{escape} characters must be different. \\
\kwd{page\_compositor} \kty{s} & \verb?"-"? &
  Composite number separator \\
\bottomrule
\multicolumn{3}{c}{\kty{s} of type string, \kty{c} of type character} 
\end{tabular}
\end{table}

    In the simplest case you just use the name of the index item as the 
argument to the \cmd{\index} command. However, spaces are significant as far
as \Lmakeindex\ is concerned. The following three uses of \cmd{\index}
will result in three different entries in the final index \\
\verb*?\index{ entry}? \verb*?\index{entry}? \verb*?\index{entry }?

\begin{figure}
\centering
\begin{small}
\begin{tabular}{ll|l}
p. v: & \verb?\index{Alf}? & \verb?\indexentry{Alf}{v}? \\
p. 1:  & \verb?\index{Alf}? & \verb?\indexentry{Alf}{1}? \\
p. 2:  & \verb?\index{Alf}? & \verb?\indexentry{Alf}{2}? \\
p. 3:  & \verb?\index{Alf}? & \verb?\indexentry{Alf}{3}? \\
p. 5: & \verb?\index{Alfabet|see{Bet}}? & \verb?\indexentry{Alfabet|see{Bet}}{5}? \\
p. 7: & \verb?\index{Alf@\textit{Alf}}? & \verb?\indexentry{Alf@\textit{Alf}}{7}? \\
         & \verb?\index{Bet|textbf}? & \verb?\indexentry{Bet|textbf}{7}? \\
p. 8:  & \verb?\index{Alf!Bet!Con}? & \verb?\indexentry{Alf!Bet!Con}{8}? \\
p. 9: & \verb?\index{Alf!Dan}? & \verb?\indexentry{Alf!Dan}{9}? \\
\end{tabular}\par
\end{small}
\caption{Raw indexing: (left) index commands in the source text; (right)
         \file{idx} file entries}
\end{figure}

\begin{figure}
\centering
\egstart
\begin{lcode}
\begin{theindex}
\item Alf, v, 1-3
  \subitem Bet
    \subsubitem Con, 8
  \subitem Dan, 9
\item \textit{Alf}, 7
\item Alfabet, \see{Bet}{5}
\indexspace
\item Bet, \textbf{7}
\end{theindex}
\end{lcode}
\egmid
Alf, v, 1-3 \\
\hspace*{2em} Bet \\
\hspace*{4em} Con, 8 \\
\hspace*{2em} Dan, 9 \\
\textit{Alf}, 7 \\
Alfabet, \textit{see} Bet \\[0.5\onelineskip]
Bet, \textbf{7}
\egend
\caption{Processed index: (left) alphabeticized \file{ind} file;
         (right) typeset index}
\end{figure}

\subsubsection{The \texttt{!} character}

    The \texttt{level} specifier starts a new minor level, or subitem,
with a maximum of two sub-levels. The default \texttt{level} specifier
is the special character \texttt{!}\index{"! (ls)?\texttt{"!} (level specifier)}. For example:
\begin{lcode}
\index{item!sub item!sub sub item}
\end{lcode}

\subsubsection{The \texttt{@} character}

    An indexable item may be represented in two portions, separated
by the \texttt{actual} specifier, which by default is the
\texttt{@} character\index{@ (as)?\texttt{@} (actual specifier)}. 
The portion before the \texttt{@} is used
when \Lmakeindex\ sorts the raw index data, and the portion after
the \texttt{@} is used as the entry text. For example:
\begin{lcode}
\index{MakeIndex@\textit{MakeIndex}}
\end{lcode}
will result in the final index entry of \verb?\textit{MakeIndex}? in the 
alphabetic position accorded to \verb?MakeIndex?. 
The same treatment can be applied for subitems:
\begin{lcode}
\index{program!MakeIndex@\textit{MakeIndex}!commands}
\end{lcode}

\subsubsection{The \texttt{|} character}

    Anything after the \texttt{encap} specifier, which by default
is the \texttt{|} character\index{"| (es)?\texttt{"|} (encap specifier)}, 
is treated as applying to the page number. In general
\begin{lcode}
\index{...|str}
\end{lcode}
will produce a page number, say n, in the form
\begin{lcode}
\str{n}
\end{lcode}
For example, if you wanted the page number of one particular entry
to be in a bold font, say to indicate that this is where the entry
is defined, you would do
\begin{lcode}
\index{entry|textbf}
\end{lcode}

    As a special case, if you want an index item to have a page range 
put the two
characters \verb?|(? at the end of the argument on the first page, and 
the character pair \verb?|)? at the end of the argument on the last page.
For example:
\begin{lcode}
... \index{range|(} pages about range  \index{range|)} ...
\end{lcode}
The two arguments must match exactly except for the final \verb?(? 
and \verb?)?. You can also do
\begin{lcode}
\index{...|(str}
\end{lcode}
which will produce a page range of the form
\begin{lcode}
\str{n-m}
\end{lcode}
In this case, if the range is only a single page, the result is simply
\begin{lcode}
\str{n}
\end{lcode}

\begin{syntax}
\cmd{\see}\marg{text}\marg{page} \cmd{seename} \\
\cmd{\seealso}\marg{text}\marg{page} \cmd{alsoname} \\
\end{syntax}
\glossary(see)%
  {\cs{see}}%
  {\textit{see} entry in an index using \cs{seename} for the wording.} 
\glossary(seename)%
  {\cs{seename}}%
  {Wording for a \textit{see} index entry.}
\glossary(seealso)%
  {\cs{seealso}}%
  {\textit{see also} entry in an index using \cs{alsoname} for the wording.} 
\glossary(alsoname)%
  {\cs{alsoname}}%
  {Wording for a \textit{see also} index entry.}
The macros \cmd{\see}\index{index!see reference} and 
\cmd{\seealso}\index{index!see also reference} are specifically for use in
an \cmd{\index} command after the \texttt{|}. The \cmd{\see} command
replaces the page number by the phrase `\textit{see} \meta{text}', 
while the \cmd{\seealso} command adds `\textit{see also} \meta{text}' 
to the entry. 
For example, in the source for this manual I have
\begin{lcode}
\index{chapter!style|see{chapterstyle}}
\index{figure|seealso{float}}
\end{lcode}
A \cmd{\see} or \cmd{\seealso}
should be used once only for a particular entry. The `see' texts for 
\cmd{\see} and \cmd{\seealso} are stored in \cmd{\seename}
and \cmd{\alsoname}, whose default definitions are:
\begin{lcode}
\newcommand*{\seename}{see}
\newcommand*{alsoname}{see also}
\end{lcode}

\subsubsection{The \texttt{"} and \texttt{\bs} characters}

    If, for some reason, you want to index something that includes one
of the \texttt{!}, \texttt{@}, \texttt{|} or \texttt{"} characters there
is the difficulty of persuading \Lmakeindex\ to ignore the special
meaning. This is solved by the \texttt{quote} specifier, which is
normally the \texttt{"} character\index{\" (qs)?\texttt{"} (quote specifier)}. 
The character
immediately after \texttt{"} is treated as non-special. For example,
if you needed to index the \texttt{@} and \texttt{!} characters:
\begin{lcode}
\index{"@ (commercial at)}
\index{"! (exclamation)}
\end{lcode}
The leading \texttt{"} is stripped off before entries are alphabetized.

    The \texttt{escape} specifier is used to strip the special meaning
from the \texttt{quote} specifier. This is usually the \texttt{\bs}
character\index{"\ (es)?\texttt{\bs} (escape specifier)}. 
So, to index the double quote character itself:
\begin{lcode}
\index{\" (double quote)}
\end{lcode}

\subsubsection{Example of using the special characters}

    Here is a short example of indexing the special characters. Given an
input like this in the document
\begin{lcode}
\index{exclamation mark ("!)}
\index{vicious|see{circle}}
\index{atsign@\texttt{"@} sign|\textbf}
\index{quote!double ("")}
\index{circle|see{vicious}}
\end{lcode}
then an index could eventually be produced that looks like:
\begin{quote}
\texttt{@} sign, \textbf{30}\\
circle, \textit{see} vicious\\
exclamation mark (!), 21 \\
quote \\
\hspace*{1.5em} double ("), 47 \\
vicious, \textit{see} circle\\
\end{quote}


%%\index{MakeIndex?\Pmakeindex!raw data|)}
\Iprogsub{MakeIndex}{raw data|)}%

\subsection{Controlling MakeIndex output}

%%\index{MakeIndex?\Pmakeindex!output styling|(}
\Iprogsub{MakeIndex}{output styling|(}%

Table~\ref{tab:configout} lists the parameters that control \Pmakeindex's
output, except for the keywords that control the setting of page numbers. 
The special characters and strings are not fixed within the
\Lmakeindex\ program. The program will read an \pixfile{ist} file
in which you can redefine all of \Lmakeindex's defaults.

\begin{table}
\begin{adjustwidth}{-1.5cm}{-1.5cm}
\centering
\caption{\Pmakeindex\ configuration file output parameters} \label{tab:configout}
\begin{tabular}{llp{0.5\textwidth}}\toprule
\multicolumn{1}{c}{Keyword} & \multicolumn{1}{c}{Default} & \multicolumn{1}{c}{Description} \\ \midrule
\kwd{preamble} \kty{s} & \verb?"\\begin{theindex}\n"? &
  Text for the start of the output file \\
\kwd{postamble} \kty{s} & \verb?"\n\n\\end{theindex}\n"? &
  Text at the end of the output file \\          \midrule
%\kwd{setpage\_prefix} \kty{s} & \verb?"\n\\setcounter{page}{"? &
%  Prefix for the command setting the page number \\ 
%\kwd{setpage\_suffix} \kty{s} & \verb?"}\n"? &
%  Suffix for the command setting the page number \\  \midrule
\kwd{group\_skip} \kty{s} & \verb?"\n\n\\indexspace\n"? &
  Vertical space before a new letter group \\
\kwd{heading\_prefix} \kty{s} & \verb?""? &
  Prefix for heading for a new letter group \\
\kwd{heading\_suffix} \kty{s} & \verb?""? &
  Suffix for heading for a new letter group \\
\kwd{headings\_flag} \kty{n} & \verb?0? &
  A value $= 0$ inserts nothing between letter groups. 
  A value $>0$ includes an uppercase instance of the new symbol,
  while a value $<0$ includes a lowercase instance, all
  within \kwd{heading\_prefix} and \kwd{heading\_suffix} \\ \midrule
\kwd{item\_0} \kty{s} & \verb?"\n\item "? &
  Command inserted in front of a level 0 entry \\
\kwd{item\_1} \kty{s} & \verb?"\n \subitem "? &
  As above for a level 1 entry \\
\kwd{item\_2} \kty{s} & \verb?"\n  \subsubitem "? &
  As above for a level 2 entry \\
\kwd{item\_01} \kty{s} & \verb?"\n \subitem "? &
  Command inserted in front of a level 1 entry starting at level 0 \\
\kwd{item\_12} \kty{s} & \verb?"\n  \subsubitem "? &
  Command inserted in front of a level 2 entry starting at level 1 \\
\kwd{item\_x1} \kty{s} & \verb?"\n \subitem "? &
  Command inserted in front of a level 1 entry when the parent level
  has no page numbers \\
\kwd{item\_x2} \kty{s} & \verb?"\n \subitem "? &
  As above for a level 2 entry \\                  \midrule
\kwd{delim\_0} \kty{s} & \verb?", "? &
  Delimiter between level 0 entry and first page number \\
\kwd{delim\_1} \kty{s} & \verb?", "? &
  As above for level 1 entry \\
\kwd{delim\_2} \kty{s} & \verb?", "? &
  As above for level 2 entry \\
\kwd{delim\_n} \kty{s} & \verb?", "? &
  Delimiter between page numbers \\
\kwd{delim\_r} \kty{s} & \verb?"-"? &
  Designator for a page range \\                  \midrule
\kwd{encap\_prefix} \kty{s} & \verb?"\\"? &
  Prefix in front of a page encapsulator \\
\kwd{encap\_infix} \kty{s} & \verb?"{"? &
  Infix for a page encapsulator \\
\kwd{encap\_suffix} \kty{s} & \verb?"}"? &
  Suffix for a page encapsulator \\                \midrule
\kwd{page\_precedence} \kty{s} & \verb?"rnaRA"? &
  Page number precedence for sorting. 
  \texttt{r} and \texttt{R} are lower- and uppercase roman;
  \texttt{a} and \texttt{A} are lower- and uppercase alphabetic;
  \texttt{n} is numeric \\                         \midrule
\kwd{line\_max} \kty{n} & \verb?"72"? &
  Maximum length of an output line  \\
\kwd{indent\_space} \kty{s} & \verb?"\t\t"? &
  Indentation commands for wrapped lines  \\
\kwd{indent\_length} \kty{n} & \verb?"16"? &
  Indentation length for wrapped lines  \\
\bottomrule
\multicolumn{3}{c}{\kty{s} of type string, \kty{n} of type number,
   \texttt{"\bs n"} and \texttt{"\bs t"} are newline and tab.} 
\end{tabular}
\end{adjustwidth}
\end{table}

    I have used a file called \file{memman.ist} for configuring
\Lmakeindex\ for this manual. Here it is:
\begin{lcode}
% MakeIndex style file  memman.ist

% @ is a valid character in some entries, use ? instead
actual '?'

% output main entry <entry> as: \item \idxmark{<entry>}, 
item_0  "\n\\item \\idxmark{"
delim_0 "}, "
% not forgetting the subitem case
item_x1 "} \n \\subitem "

% Wrap and uppercase head letters
headings_flag 1
heading_prefix "\\doidxbookmark{"
heading_suffix "}"
\end{lcode}

    Many items that I need to index include \texttt{@} as part of their
names, which is one of the special characters.
The \texttt{actual} line says that the character \texttt{?} performs 
the same function as the default \texttt{@} (and by implication, \texttt{@}
is not a special character as far as \Lmakeindex\ is concerned).

    The \verb?item_0? line says that a main entry in the generated index
starts 
\begin{lcode}
\item \idxmark{
\end{lcode}
and the \verb?delim_0? and \verb?item_x1? lines say that the main entry ends
\begin{lcode}
}, % or
}
    \subitem
\end{lcode}
Thus, main entries will appear in an \pixfile{ind} file like
\begin{lcode}
\item \idxmark{a main entry}, <list of page numbers> 
\item \idxmark{a main entry with no page numbers}
    \subitem subitem, <list of page numbers>
\end{lcode}

%%\index{MakeIndex?\Pmakeindex!output styling|)}
\Iprogsub{MakeIndex}{output styling|)}%


 Read the \Lmakeindex\ manual~\cite{CHEN88} for full details
on how to get \Lmakeindex\ to do what you want.

\LMnote{2009/06/30}{described \doidxbookmark}
The \verb?\doidxbookmark? that is used to wrap around the letter group
headers, can be used to not only style the group header, but can also
be used to add the headers in the bookmarks list. This can be done using
\begin{lcode}
\newcommand{\doidxbookmark}[1]{{\def\@tempa{Symbols}\def\@tempb{#1}%
  \centering\bfseries \ifx\@tempa\@tempb %
  Analphabetics 
  \phantomsection%
  \pdfbookmark[0]{Analphabetics}{Analphabetics-idx}%
%  \label{AnalphabeticsAnalphabeticsAnalphabetics-idx}%
  \else 
  #1%
  \phantomsection%
  \pdfbookmark[0]{#1}{#1-idx}%
%  \label{#1#1#1-idx}%
  \fi%
  \vskip\onelineskip\par}}
\end{lcode}
The labels are generally not needed but can be used to add a visual
representation of the index bookmarks into the index itself.


\subsection{Indexing and the \Lpack{natbib} package}

    The \Lpack{natbib} package~\cite{NATBIB} will make an index 
of citations if
\cmd{\citeindextrue} is put in the preamble after the \Lpack{natbib}
package is called for.

\begin{syntax}
\cmd{\citeindexfile} \\
\end{syntax}
\glossary(citeindexfile)%
  {\cs{citeindexfile}}%
  {File name for the citation index.}
The name of the file for the citation index is stored in the
macro \cmd{\citeindexfile}. This is initially defined as:
\begin{lcode}
\newcommand{\citeindexfile}{\jobname}
\end{lcode}
That is, the citation entries will be written to the default 
\pixfile{idx} file.
This may be not what you want so you can change this, for example to:
\begin{lcode}
\renewcommand{\citeindexfile}{names}
\end{lcode}
If you do change \cmd{\citeindexfile} then you have to put
\begin{lcode}
\makeindex[\citeindexfile]
\end{lcode}
\emph{before}
\begin{lcode}
\usepackage[...]{natbib}
\end{lcode}

    So, there are effectively two choices, either along the lines of
\begin{lcode}
\renewcommand{\citeindexfile}{authors} % write to authors.idx
\makeindex[\citeindexfile]
\usepackage{natbib}
\citeindextrue
...
\renewcommand{\indexname}{Index of citations}
\printindex[\citeindexfile]
\end{lcode}
or along the lines of
\begin{lcode}
\usepackage{natbib}
\citeindextrue
\makeindex
...
\printindex
\end{lcode}

\section{Glossaries}

    Unlike indexes, \ltx\ provides less than minimal support for 
glossaries. It provides a \cmd{\makeglossary} command for initiating a glossary
and a \cmd{\glossary} command which puts its argument, plus the page number,
into a \file{glo} file, and that's it. \Mname, combined with the
\Lmakeindex\ program~\cite{CHEN88}, enables you to generate 
and print a glossary in 
your document. The commands for creating a glossary are similar to those
for indexes.

\begin{syntax}
\cmd{\makeglossary}\oarg{file} \\
\end{syntax}
\glossary(makeglossary)%
  {\cs{makeglossary}\oarg{file}}%
  {Opens file \cs{jobname.glo}, or \cs{file.glo}, for glossary entries}%

You have to put \cmd{\makeglossary} in your preamble if you want a glossary.
This opens a file called by default \verb?\jobname.glo?. If you use the 
optional \meta{file} argument the file \verb?file.glo? will be opened.
A glossary \file{glo} file is analagous to an index \file{idx} file.

\begin{syntax}
\cmd{\printglossary}\oarg{file} \\
\end{syntax}
\glossary(printglossary)%
  {\cs{printglossary}\oarg{file}}%
  {Prints the glossary from file \cs{jobname.gls}, or \cs{file.gls}}%
To print a glossary call \cmd{\printglossary} which will print the glossary
from file \verb?\jobname.gls?, or from \verb?file.gls? if the optional 
argument is used. A glossary \file{gls} file is analagous to an
index \file{ind} file.

\begin{syntax}
\cmd{\glossary}\oarg{file}\parg{key}\marg{term}\marg{desc} \\
\end{syntax}
\glossary(glossary)%
  {\cs{glossary}\oarg{file}\parg{key}\marg{term}\marg{description}}%
  {Adds \meta{term} and its description, \meta{desc}, to a glossary file ---
   \cs{jobname.glo} by default or to \cs{file.glo}. The optional argument
   \meta{key} can be used to provide a different sort key for \meta{term}.}

Use the \cmd{\glossary} command to add a \meta{term} and its description,
\meta{desc},
to a glossary file. By default this will be \verb?\jobname.glo? but if the
optional \meta{file} argument is given then the information will be written
to \verb?file.glo?. The \parg{key} argument is optional. If present then
\meta{key} will be added to the file to act as a sort key for the \meta{term},
otherwise \meta{term} will be used as the sort key.

    By using the optional \meta{file} arguments you can have several 
glossaries, subject to \tx's limitations on the number of files that can
be open at any one time.

   A simple glossary entry might be:
\begin{lcode}
\glossary{glossary}{A list of terms and their descriptions.}
\end{lcode}

    The glossary facilites are designed so that the \Lmakeindex\ program
can be used to convert the raw glossary data in a \file{glo} file into
the printable glossary in a \file{gls} file.

\begin{syntax}
\senv{theglossary} entry list \eenv{theglossary} \\
\end{syntax}
\glossary(theglossary)%
  {\senv{theglossary}}%
  {Environment for typesetting a glossary.}%

Glossary entries are typeset in a \Ie{theglossary} environment. It is assumed
that a \file{gls} file will contain a complete \Ie{theglossary} environment,
from \senv{theglossary} all the way through to \eenv{theglossary}.

\begin{syntax}
\cmd{\glossitem}\marg{term}\marg{desc}\marg{ref}\marg{num} \\
\end{syntax}
\glossary(glossitem)%
  {\cs{glossitem}\marg{term}\marg{desc}\marg{ref}\marg{num}}%
  {Glossary entry used in a \Pe{theglossary} environment}%

A \cmd{\glossitem} is a glossary entry within a \Ie{theglossary} environment
for a \meta{term} with \meta{description}. The \meta{num} argument is the
page or section where the corresponding \cmd{\glossary} was issued. The
\meta{ref} argument, if not empty, might be the section or page number 
corresponding to the \meta{num} page or section number. The default definition
is
\begin{lcode}
\newcommand{\glossitem}[4]{#1 #2 #3 #4}
\end{lcode}
which is not very exciting. You may well prefer to use your own definition.

\subsection{Controlling the glossary}

\subsubsection{Setting up makeindex}

    If you just run \Lmakeindex\ on a \file{glo} file you will get lots
of errors; \Lmakeindex\ has to be configured to read a \file{glo}
file and generate a useful \file{gls} file as by default it expects to read
an index \file{idx} file and produce an index \file{ind} file. A configuration
file like an index \file{ist} file will be needed. There is no recommended
extension for such a file but I have come to favour \file{gst}. The
command line for \Lmakeindex\ to create a sorted glossary from the raw
data in a \file{glo} file, say \texttt{fred.glo}, using a configuration 
file called, say \texttt{basic.gst}, is
\begin{lcode}
makeindex -s basic.gst -o fred.gls fred.glo
\end{lcode}
For other jobs just change the file names appropriately.

    So, what is in a \file{gst} file? The potential contents were described
earlier, but at a minimum you need this:
\begin{lcode}
%%% basic.gst basic makindex glossary style file 
%%% Output style parameters
preamble "\\begin{theglossary}"
postamble "\n\\end{theglossary}\n"
item_0    "\n\\glossitem"
delim_0   "{\\memglonum{"
encap_suffix "}}}"
headings_flag 1
heading_prefix "\\doglobookmark{"
heading_suffix "}"
%%% Input style parameters
keyword "\\glossaryentry"
\end{lcode}

The \verb?keyword? line says that each entry in an input (\file{glo}) file
will be of the form:
\begin{lcode}
\glossaryentry{entry text}{number}
\end{lcode}
and by a miracle of coding, this is what \Pclass{memoir} will put in a 
\file{glo} file for each \cmd{\glossary} command.

    The \verb?preamble? and \verb?postamble? lines tell the program to start
and end its output file with \senv{theglossary} and \eenv{theglossary},
respectively.
The \verb?item_0? tells the program to start each output entry with
\cmd{\glossitem}. The \verb?delim_0? says that \verb?{\memglonum{?
should be put between the end of the entry text and the (page) number. Finally
\verb?encap_suffix? requests \verb?}}}? to be put after any `encapsulated'
(page) number.

    A complete listing of the possible entries in a configuration file,
also called a style file, for \Lmakeindex{} is in 
\tablerefname~\ref{tab:configin} and~\ref{tab:configout} with the exception
of the output file page number setting keywords.

\LMnote{2009/06/30}{Added bookmarks for letter groups in the glossary}
The \verb?\doglobookmark? macro can be used to add bookmarks for the
letter groups. In the case of this manual we do not write anything,
just add the letters to the glossary entry in the bookmark list. In
\Lpack{memsty} \verb?\doglobookmark? is defined as
\begin{lcode}
\newcommand\doglobookmark[1]{%
  \def\@tempa{Symbols}\def\@tempb{#1}%
  \ifx\@tempa\@tempb %
  \phantomsection\pdfbookmark[0]{Analphabetics}{Analphabetics-glo}%
  \else%
  \phantomsection\pdfbookmark[0]{#1}{#1-glo}%
  \fi%
}
\end{lcode}
\Lmakeindex\ uses the word 'Symbols' to specify the group that does not
start with a letter.


\subsubsection{Raw input data}

\begin{syntax}
\cmd{\@@wrglom@m}\marg{file}\marg{key}\marg{term}\marg{desc}\marg{ref}\marg{num}\\
\end{syntax}
The \cmd{\glossary} macro writes its arguments to the \file{aux} file
in the form of arguments to the \cmd{\@@wrglom@m} internal macro. In turn 
this calls a series of other macros that eventually write the data
to the \meta{file} \file{glo} file 
in the format (where \verb+@+ is the actual flag):
\begin{lcode}
\glossaryentry{key@{\memgloterm{term}} {\memglodesc{desc}}{\memgloref{ref}}
               |memglonumf}{num}
\end{lcode}
which \Lmakeindex\ then effectively converts into
\begin{lcode}
\glossitem{\memgloterm{term}}{\memglodesc{desc}}{\memgloref{ref}}
           {\memglonum{\memglonumf{num}}}
\end{lcode}

\begin{syntax}
\cmd{\memgloterm}\marg{term} \\
\cmd{\memglodesc}\marg{desc} \\
\cmd{\memgloref}\marg{ref} \\
\cmd{\memglonum}\marg{num} \\
\end{syntax}
\glossary(memgloterm)%
  {\cs{memgloterm}\marg{term}}%
  {Wrapper round a glossary term.}%
\glossary(memglodesc)%
  {\cs{memglodesc}\marg{desc}}%
  {Wrapper round a glossary description.}%
\glossary(memgloref)%
  {\cs{memgloref}\marg{ref}}%
  {Wrapper round a glossary ref.}%
\glossary(memglonum)%
  {\cs{memglonum}\marg{num}}%
  {Wrapper round glossary numbers.}%
These macros can be redefined to format the various parts of a glossary entry.
Their default definitions are simply
\begin{lcode}
\newcommand{\memgloterm}[1]{#1}
\newcommand{\memglodesc}[1]{#1}
\newcommand{\memgloref}[1]{#1}
\newcommand{\memglonum}[1]{#1}
\end{lcode}
For example, if you wanted the term in bold, the description in italics,
 and no numbers:
\begin{lcode}
\renewcommand{\memgloterm}[1]{\textbf{#1}}
\renewcommand{\memglodesc}[1]{\textit{#1}}
\renewcommand{\memglonum}[1]{}
\end{lcode}

   There are several macros that effect a glossary entry 
but which must not be directly modified (the \cs{memglonumf} shown above
as part of the \cmd{\glossaryentry} is one of these).
Each of the following \cs{changegloss...} macros takes an optional \meta{file}
argument. The changes to the underlying macro apply only to the 
glossary of that particular \meta{file} (or the \cs{jobname} file
if the argument is not present.
\begin{syntax}
\cmd{\changeglossactual}\oarg{file}\marg{char} \\
\cmd{\changeglossref}\oarg{file}\marg{thecounter} \\
\cmd{\changeglossnum}\oarg{file}\marg{thecounter} \\
\cmd{\changeglossnumformat}\oarg{file}\marg{format} \\
\end{syntax}
\glossary(changeglossactual)%
  {\cs{changeglossactual}\oarg{file}\marg{char}}%
  {Specifies \meta{char} as the \texttt{actual} character for 
   glossary \meta{file}.}%
\glossary(changeglossref)%
  {\cs{changeglossref}\oarg{file}\marg{thecounter}}%
  {Specifies \meta{thecounter} as the \meta{ref} for 
   glossary \meta{file}.}%
\glossary(changeglossnum)%
  {\cs{changeglossnum}\oarg{file}\marg{thecounter}}%
  {Specifies \meta{thecounter} as the \meta{num} for 
   glossary \meta{file}.}%
\glossary(changeglossnumformat)%
  {\cs{changeglossnumformat}\oarg{file}\marg{format}}%
  {Specifies \meta{format} as the format for \meta{num} for 
   glossary \meta{file}.}%

\cmd{\changeglossactual} sets \meta{char} as the \texttt{actual} character
for the \meta{file} glossary. It is initially \verb+@+. This must match 
with the \texttt{actual} specified for the \file{gst} file that will 
be applied.

\cmd{\changeglossref} specifies that \meta{thecounter} should be used
to generate the \meta{ref} for the \meta{file} glossary. It is
initially nothing.

\cmd{\changeglossnum} specifies that \meta{thecounter} should be used
to generate the \meta{num} for the \meta{file} glossary. It is
initially \cs{thepage}.

\cmd{\changeglossnumformat} specifies that \meta{format} should be used
to format the \meta{num} for the \meta{file} glossary. The format
of \meta{format} is \verb?|form?, where \verb?|? is the \texttt{encap}
character specified in the \file{gst} file, and \verb?form? is a
formatting command, taking one argument (the number), without any backslash. 
For example
\begin{lcode}
\changeglossnumformat{|textbf}
\end{lcode}
 to get bold numbers. It is
initially set as \verb?|memjustarg?, where this is defined as:
\begin{lcode}
\newcommand{\memjustarg}[1]{#1}
\end{lcode}
There must be a format defined for the \meta{num} otherwise the arguments
to \cmd{\glossitem} will not be set correctly.


    The \cmd{\makeglossary} command uses the \cs{change...}
commands to define the initial versions, so only use the \cs{change...}
macros \emph{after} \cmd{\makeglossary}.
In this document an early version of the glossary was set up by
\begin{lcode}
\makeglossary
\changeglossactual{?}
\makeatletter 
\changeglossnum{\@currentlabel} 
\makeatother
\changeglossnum{\thepage}
\end{lcode}
The first call of \cmd{\changeglossnum} makes the number the current 
numbered chapter, or numbered section, or numbered \ldots. I didn't 
like that when I tried it, so the second call resets the number to 
the page number.

\subsubsection{The listing}

    The final glossary data in the \file{gls} file is typeset in the
\Ie{theglossary} environment, which is much like the \Ie{theindex}
and \Ie{thebibliography} environments.

    The environment starts off with a chapter-style unnumbered title.
There are several macros for specifying what happens after that.

\begin{syntax}
\cmd{\glossaryname} \\
\cmd{\glossarymark} \\
\cmd{\glossaryintoc} \cmd{\noglossaryintoc} \\
\end{syntax}
\glossary(glossaryname)%
  {\cs{glossaryname}}%
  {Name for a glossary.}%
\glossary(glossarymark)%
  {\cs{glossarymark}}%
  {Redefine to specify marks for headers.}%
\glossary(glossaryintoc)%
  {\cs{glossaryintoc}}%
  {Declaration to add glossary title to the ToC.}%
\glossary(noglossaryintoc)%
  {\cs{noglossaryintoc}}%
  {Declaration to prohibit adding glossary title to the ToC.}%

The title for the glossary is \cmd{\glossaryname} whose initial definition
is 
\begin{lcode}
\newcommand*{\glossaryname}{Glossary}
\end{lcode}
\cmd{\glossarymark}, which by default does nothing, can be redefined to
set marks for headers. The glossary title will be added to the ToC
if the \cmd{\glossaryintoc} declaration is in force, but will not be
added to the ToC following the \cmd{\noglossaryintoc}.

\begin{syntax}
\cmd{\preglossaryhook} \\
\end{syntax}
\glossary(preglossaryhook)%
  {\cs{preglossaryhook}}%
  {Vacuous macro called after a glossary title is typeset.}
The macro \cmd{\preglossaryhook} is called after the glossary title 
has been typeset. By default it does nothing, but you could redefine
it to, for example, add some explanatory material before the entries
start.

\begin{syntax}
\cmd{\onecolglossary} \cmd{\twocolglossary} \\
\lnc{\glossarycolsep} \lnc{\glossaryrule} \\
\end{syntax}
\glossary(onecolglossary)%
  {\cs{onecolglossary}}%
  {Declaration for a single column glossary.}%
\glossary(onecolglossaryfalse)%
  {\cs{twocolglossary}}%
  {Declaration for a two column glossary.}%
\glossary(glossarycolsep)%
  {\cs{glossarycolsep}}%
  {Columns separation in a two column glossary.}%
\glossary(glossaryrule)%
  {\cs{glossaryrule}}%
  {Width of inter-column rule in a two column glossary.}%

The glossary can be typeset in two columns (\cmd{\twocolglossary})
but by default (\cmd{\onecolglossary}) it is set in one column.
When two columns are used, the length \lnc{\glossarycolsep} is the
distance between the columns and the length \lnc{\glossaryrule} is
the width (default 0) of a vertical rule between the columns.

\begin{syntax}
\cmd{\begintheglossaryhook} \\
\cmd{\atendtheglossaryhook} \\
\end{syntax}
\glossary(begintheglossaryhook)%
  {\cs{begintheglossaryhook}}%
  {Vacuous macro called as the last thing by \senv{theglossary}.}
\glossary(atendtheglossaryhook)%
  {\cs{atendtheglossaryhook}}%
  {Vacuous macro called as the first thing by \eenv{theglossary}.}

The last thing that \senv{theglossary} does is call 
\cmd{\begintheglossaryhook}. Similarly, the first thing that is done at
the end of the environment is to call \cmd{\atendtheglossaryhook}.
By default these macros do nothing but you can redefine them.

    For example, if you wanted the glossary in the form of a description
list, the following will do that.
\begin{lcode}
\renewcommand*{\begintheglossaryhook}{\begin{description}}
\renewcommand*{\atendtheglossaryhook}{\end{description}}
\renewcommand{\glossitem}[4]{\item[#1:] #2 #3 #4}
\end{lcode}

\subsubsection{The glossary for this document}

    The following is the code I have used to produce the glossary
in this document.

This is the code in the \file{sty} file that I used.
\begin{lcode}
\makeglossary
\changeglossactual{?}
\changeglossnum{\thepage}
\changeglossnumformat{|hyperpage}%% for hyperlinks
\renewcommand*{\glossaryname}{Command summary}
\renewcommand*{\glossarymark}{\markboth{\glossaryname}{\glossaryname}}
\renewcommand{\glossitem}[4]{%
  \sbox\@tempboxa{#1 \space #2 #3 \makebox[2em]{#4}}%
  \par\hangindent 2em
  \ifdim\wd\@tempboxa<0.8\linewidth
    #1 \space #2 #3 \dotfill \makebox[2em][r]{#4}\relax
  \else
    #1 \dotfill \makebox[2em][r]{#4}\\
    #2 #3
  \fi}
\end{lcode}

    The redefinition of \cmd{\glossitem} works as follows (it is similar
to code used in the setting of a \cmd{\caption}):
\begin{enumerate}
\item Put the whole entry into a temporary box.
\item Set up a hanging paragraph with 2em indentation after the first line.
\item Check if the length of the entry is less than 80\% of the linewidth.
\item For a short entry set the name, description, and any reference then
      fill the remainder of the line with dots with the number at the right
      margin.
\item For a longer entry, set the title and number on a line, separated
      by a line of dots, then set the description (and reference) on
      the following lines.
\end{enumerate}

    The \file{gst} file I have used for this document has a few more items
than the basic one.
\begin{lcode}
%%% memman.gst makindex glossary style file for memman and friends
%%% Output style parameters
preamble "\\begin{theglossary}"
postamble "\n\\end{theglossary}\n"
group_skip "\n\\glossaryspace\n"
item_0    "\n\\glossitem"
delim_0   "{\\memglonum{"
encap_suffix "}}}"
indent_space "\t"
indent_length 2
%%% Input style parameters
keyword "\\glossaryentry"
actual '?'
page_compositor "."
\end{lcode}

The \verb?group_skip? line asks that \verb?\glossaryspace? be put between the 
last entry for one letter and the first for the next letter. 
The \verb?indent_space? and \verb?indent_length? give a smaller indent for
continuation lines in the output than the default.

    The \verb?actual? entry says that the input file will use \verb+?+ instead
of the default \verb+@+ as the flag for separating a key from the start of 
the real entry. The \verb?page_compositor? indicates that any compound numbers
will be like \verb?1.2.3? instead of the default \verb?1-2-3?.

In the document the raw data is collected by the \cmd{\glossary} commands 
in the body of the text. For instance, although I have not actually used
the first two:
\begin{lcode}
\glossary(cs)%
  {\cs{cs}\marg{name}}%
  {Typesets \texttt{name} as a macro name with preceding backslash,
   e.g., \cs{name}.}%
\glossary(gmarg)%
  {\cs{gmarg}\marg{arg}}%
  {Typesets \texttt{arg} as a required argument, e.g., \marg{arg}.}
\glossary(glossaryname)%
  {\cs{glossaryname}}%
  {Name for a glossary}%
\glossary(memgloterm)%
  {\cs{memgloterm}\marg{term}}%
  {Wrapper round a glossary term.}%
\end{lcode}

    Any change to the glossary entries will be reflected in the
\file{glo} produced from that LaTeX run. \Lmakeindex\ has to be run
the \file{glo} file using the appropriate \file{gst} configuration file, 
and then LaTeX run again to get the corrected, sorted and formatted result
printed by \cmd{\printglossary}.

    In particular, for this document, which also includes an index so that
can be processed when the glossary is processed.
\begin{lcode}
pdflatex memman
makeindex -s memman.gst -o memman.gls memman.glo
makeindex -s memman.ist memman     %%% for the index
makeindex lines                    %%% for the index of first lines
pdflatex memman
\end{lcode} 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\LMnote{2013/05/02}{Section about endnotes moved page-notes.tex}



%#% extend
%#% extstart include miscellaneous.tex

\svnidlong
{$Ignore: $}
{$LastChangedDate: 2018-04-05 11:07:48 +0200 (Thu, 05 Apr 2018) $}
{$LastChangedRevision: 596 $}
{$LastChangedBy: daleif@math.au.dk $}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\clearpage
%\pagestyle{Ruled}
%%\chapterstyle{demo}
%\chapterstyle{veelo}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Miscellaneous} \label{chap:misc}

\setlength{\prechapterprecisshift}{-\onelineskip}

\chapterprecis{In which we talk of many things, but not shoes
               or ships or sealing wax, nor cabbages and kings.}

\noindent    This chapter started with the \cmd{\chapterprecis} command to add
the above text, which is also added to the \prtoc.

    The class provides a miscellany of minor facilities, which are described
here.

\section{Draft documents}

  The \Lopt{draft} option marks any overfull lines with black rectangles,
otherwise the appearance is the same as for a \Lopt{final} document.

\begin{syntax}
\piif{ifdraftdoc} \\
\end{syntax}
\glossary(ifdraftdoc)%
  {\cs{ifdraftdoc}}%
  {\ptrue\ if the \Popt{draft} class option has been used.}
The \piif{ifdraftdoc} macro is provided so that you can add extra
things that you might want to happen when processing a draft; for example
you might want to have each page header\index{header} (or footer\index{footer}) include the word `DRAFT'.
The code to do this can be put into a construct like the following:
\begin{lcode}
\ifdraftdoc
  % special things for a draft document
\else
  % perhaps special things for a non-draft document
\fi
\end{lcode}


\section{Change marks}

    When preparing a manuscript it normally goes through several iterations.
The macros described in this section can be used to identify changes made to 
a document throughout its lifecycle.

   The commands below implement a simplified version of the change
marking in the \Lclass{iso} class~\cite{ISOCLASS}.

\begin{syntax}
\cmd{\changemarks} \cmd{\nochangemarks} \\
\end{syntax}
\glossary(changemarks)%
  {\cs{changemarks}}%
  {Print change marks.}
\glossary(nochangemarks)%
  {\cs{nochangemarks}}%
  {Do not print change marks.}
The change marking macros only work properly when the \Lopt{draft} class
option is used. Additionally, the marks are only printed when the 
\cmd{\changemarks} declaration is in effect. Using \cmd{\nochangemarks}
switches off any marking.

\begin{syntax}
\cmd{\added}\marg{change-id} \\
\cmd{\deleted}\marg{change-id} \\
\cmd{\changed}\marg{change-id} \\
\end{syntax}
\glossary(added)%
  {\cs{added}\marg{change-id}}%
  {Change mark for someting added; \meta{change-id} is put in the margin.}
\glossary(deleted)%
  {\cs{deleted}\marg{change-id}}%
  {Change mark for someting deleted; \meta{change-id} is put in the margin.}
\glossary(changed)%
  {\cs{changed}\marg{change-id}}%
  {Change mark for someting changed; \meta{change-id} is put in the margin.}
Each of these macros puts a symbol and \meta{change-id} into the 
margin\index{margin} near
where the command is given. The \cmd{\added} macro indicates that something
has been added to the manuscript and uses $\oplus$ as its symbol. The
\cmd{\deleted} macro is for indicating that something has been deleted and uses
the $\neq$ symbol. The macro \cmd{\changed} uses the $\Leftrightarrow$ symbol
to indicate that something has been changed.

    These marking commands should be attached to some word or punctuation
mark in the text otherwise extraneous spaces may creep into the typeset
document.

\section{Trim marks}

    When the class \Lopt{showtrims} option is used, trim
marks can be placed on each page, usually to indicate where the stock should
be trimmed to obtain the planned page size. 

\begin{syntax}
\cmd{\showtrimsoff} \cmd{\showtrimson} \\
\end{syntax}
\glossary(showtrimsoff)%
  {\cs{showtrimsoff}}%
  {Switch off any trim marks.}
\glossary(showtrimson)%
  {\cs{showtrimson}}%
  {If the \Popt{showtrims} option has been used, switch on any trim marks 
  (this is the default).}
If the \Lopt{showtrims} class option has been used then the \cmd{\showtrimsoff}
declaration switches off the trim marks; the \cmd{\showtrimson} declaration,
which is the default, switches on the trim marks. These declarations do
nothing if the \Lopt{showtrims} option has not been used.

\LMnote{2013/05/01}{added caveat}
\begin{caveat}
  Most modern \LaTeX\ editors make use of the \emph{synctex} features
  in, say, pdf\LaTeX\ to enable \emph{reverse search} from the PDF
  previewer back to the source code in the editor. That is, click in a
  certain manner in the PDF previewer and you will be taken to the
  corresponding (or there about) line in the source code.

  Apparently the \emph{synctex} feature does not like the trimmarks
  the class provide, or the \pstyle{showlocs} page style. The code
  line one is referred back to may be off by tens of lines.

  Currently, there is no known workarounds for this deficiency.
\end{caveat}



    Trim marks can be placed at each corner of the (trimmed) page, and also
at the middle of each side of the page.

\begin{syntax}
\cmd{\trimXmarks} \\
\cmd{\trimLmarks} \\
\cmd{\trimFrame} \\
\cmd{\trimNone} \\
\cmd{\trimmarkscolor} \\
\end{syntax}
\glossary(trimXmarks)%
  {\cs{trimXmarks}}%
  {Trim marks of crosses at the four corners of the trimmed page.}
\glossary(trimLmarks)%
  {\cs{trimLmarks}}%
  {Trim marks of `L' shapes at the four corners of the trimmed page.}
\glossary(trimFrame)%
  {\cs{trimFrame}}%
  {Trim mark of a frame drawn round the trimmed page boundary.}
\glossary(trimNone)%
  {\cs{trimNone}}%
  {No trim marks.}
\glossary(trimmarkscolor)%
  {\cs{trimmarkscolor}}%
  {Empty macro that can be redefined to give a specific color to the trimmarks.}

Some predefined trimming styles are provided. After the declaration
\cmd{\trimXmarks} marks in the shape of a cross are placed at the four
corners of the page. The declaration \cmd{\trimLmarks} calls for corner marks
in the shape of an `L', in various orientations depending on the particular
corner. After \cmd{\trimFrame} a frame will be drawn around each page, 
coinciding with the page boundaries. The declaration \cmd{\trimNone}
disables all kinds of trim marking. All three plus \cs{quarkmarks}
(described below) is visibly shown on \fref{fig:trimmarks}.

The macro \cs{trimmarkscolor} is despite its name a normal (empty)
macro. By redefining it one can change the color of the trimmarks,
handy for example if the document has a dark background color. To make
them blue use
\begin{lcode}
\newcommand*{\trimmarkscolor}{\color{blue}}
\end{lcode}


\begin{syntax}
\cmd{\trimmarks} \\
\cmd{\tmarktl} \cmd{\tmarktr} \cmd{\tmarkbr} \cmd{\tmarkbl} \\
\cmd{\tmarktm} \cmd{\tmarkmr} \cmd{\tmarkbm} \cmd{\tmarkml} \\
\end{syntax}
\glossary(trimmarks)%
  {\cs{trimmarks}}%
  {Displays 8 (in)visible trim marks round the boundary of the trimmed page.}
\glossary(tmarktl)%
  {\cs{tmarktl}}%
  {Trim mark for top left of trimmed page.}
\glossary(tmarktm)%
  {\cs{tmarktm}}%
  {Trim mark for top middle of trimmed page.}
\glossary(tmarktr)%
  {\cs{tmarktr}}%
  {Trim mark for top right of trimmed page.}
\glossary(tmarkmr)%
  {\cs{tmarkmr}}%
  {Trim mark for middle right of trimmed page.}
\glossary(tmarkbr)%
  {\cs{tmarkbr}}%
  {Trim mark for bottom right of trimmed page.}
\glossary(tmarkbm)%
  {\cs{tmarkbm}}%
  {Trim mark for bottom middle of trimmed page.}
\glossary(tmarkbl)%
  {\cs{tmarkbl}}%
  {Trim mark for bottom left of trimmed page.}
\glossary(tmarkml)%
  {\cs{tmarkml}}%
  {Trim mark for middle left of trimmed page.}
\glossary(tmarktl)%
  {\cs{tmarktl}}%
  {Trim mark for top left of trimmed page.}
The \cmd{\trimmarks} macro is responsible for displaying up to 8 marks. The
marks are defined as zero-sized pictures which are placed strategically
around the borders of the page. 

    The command \cmd{\trimmarks} places the pictures \cmd{\tmarktl}, 
\cmd{\tmarktr},
\cmd{\tmarkbl}, and \cmd{\tmarkbr} at the top left, top right,
bottom right and bottom left corners of the page. The pictures
\cmd{\tmarktm}, \cmd{\tmarkmr}, \cmd{\tmarkbm}, and \cmd{\tmarkml} are placed
at the top middle, middle right, bottom middle and middle left of the
edges of the page. All these \verb?\tmark..? macros should expand to zero-sized
pictures.

\begin{syntax}
\cmd{\trimmark} \\
\end{syntax}
\glossary(trimmark)%
  {\cs{trimmark}}%
  {Cross mark used by \cs{trimXmarks}.}
The declaration \cmd{\trimXmarks} uses \cmd{\trimmark} for the corner 
crosses. This is defined as
\begin{lcode}
\newcommand{\trimmark}{%
  \begin{picture}(0,0)
    \setlength{\unitlength}{1cm}\thicklines
    \put(-2,0){\line(1,0){4}}
    \put(0,-2){\line(0,1){4}}
  \end{picture}}
\end{lcode}
which produces a zero-sized picture of a 4cm cross. Then \cmd{\trimXmarks}
is defined as:
\begin{lcode}
\newcommand*{\trimXmarks}{%
  \let\tmarktl\trimmark
  \let\tmarktr\trimmark
  \let\tmarkbr\trimmark
  \let\tmarkbl\trimmark}
\end{lcode}


    As an example, to draw short lines marking the half-height of the page, 
try this:
\begin{lcode}
\renewcommand*{\tmarkml}{%
  \begin{picture}(0,0)%
    \unitlength 1mm
    \thinlines
    \put(-2,0){\line(-1,0){10}}
  \end{picture}}
\renewcommand*{\tmarkmr}{%
  \begin{picture}(0,0)%
    \unitlength 1mm
    \thinlines
    \put(2,0){\line(1,0){10}}
  \end{picture}}
\end{lcode}
Thin horizontal lines of length 10mm will be drawn at the middle left and
middle right of the page, starting 2mm outside the page boundary. This
is what we do (now) by default for all four middle parts.


\begin{syntax}
\cmd{\quarkmarks} \\
\cmd{\registrationColour}\marg{mark} \\
\end{syntax}
\glossary(quarkmarks)%
  {\cs{quarkmarks}}%
  {Trim marks in the style of Quark Xpress registration marks, typeset with
   \cs{registrationColour}.}
\glossary(registrationColour)%
  {\cs{registrationColour}\marg{mark}}%
  {Typesets \cs{quarkmarks}.}
Following the declaration \cmd{\quarkmarks} and trim marks will be in
the style of Quark Xpress registration marks.\footnote{The code for this
was donated by William Adams\index{Adams, William}.} The marks will be
typeset using \cmd{\registrationColour}. The default definition is simply
\begin{lcode}
\newcommand*{\RegistrationColour}[1]{#1}
\end{lcode}
but you can change that to, say, print the marks in particular
color. See \fref{fig:trimmarks}.



\section{Sheet numbering}

    One purpose of trim marks is to show a printer where the stock
should be trimmed. In this application it can be useful to also note the
sheet number on each page, where the sheet number is 1 for the first page 
and increases by 1 for each page thereafter. The sheet number is independent
of the page number.

\begin{syntax}
\Icn{sheetsequence} \\
\cmd{\thesheetsequence} \\
\end{syntax}
\glossary(sheetsequence)%
  {\Pcn{sheetsequence}}%
  {Counter for sheets (similar to \Pcn{page} for pages).}
\glossary(thesheetsequence)%
  {\cs{thesheetsequence}}%
  {Typesets the current sheet sequence number.}
The macro \cmd{\thesheetsequence} typesets the current sheet sequence number
and is analogous to the \cmd{\thepage} macro.

\begin{syntax}
\Icn{lastsheet} \\
\Icn{lastpage} \\
\end{syntax}
\glossary(lastsheet)%
  {\Pcn{lastsheet}}%
  {Counter holding the number of sheets processed during the \emph{previous}
   \ltx\ run.}
\glossary(lastpage)%
  {\Pcn{lastpage}}%
  {Counter holding the number of the last page processed during the \emph{previous}
   \ltx\ run.}
The counter \Icn{lastsheet} holds the number of sheets processed during
the \emph{previous} run of LaTeX. Similarly, the counter \Icn{lastpage}
holds the number of the last page processed during the previous run.
Note that the last page number is not necessarily the same as the last
sheet number. For example: \\
\textit{In this document this is 
        sheet \thesheetsequence\ of \thelastsheet\ sheets, 
        and page \thepage\ of \thelastpage.}

The previous sentence was the result of processing the following
code 
\begin{lcode}
\textit{In this document this is 
        sheet \thesheetsequence\ of \thelastsheet\ sheets, 
        and page \thepage\ of \thelastpage.}
\end{lcode}

    You may wish to use the sheet and/or page numbers as part of some
trim marks. The following will note the sheet numbers above the page.
\begin{lcode}
\newcommand*{\trimseqpage}{%
  \begin{picture}(0,0)
    \unitlength 1mm
    \put(0,2){\makebox(0,0)[b]{Sheet: \thesheetsequence\ of \thelastsheet}}
  \end{picture}}
\let\tmarktm\trimseqpage
\end{lcode}

\section{Gatherings or signatures}

    Sometimes publishers request that they be supplied with a total number of
pages that meet their planned \emph{gatherings}\index{gathering}.\footnote{There
was a thread on \ctt, \textit{pagenumber mod 4?} about this in 2008.}
 For instance
a gathering may consist of 8 leaves, and as there are two pages to a leaf this
is equivalent to 16 pages. To meet this particular requirement there must be 
a total of $8N$ leaves, or equivalently $16N$ pages, where $N$ will be 
the number of gatherings.

\begin{syntax}
\cmd{\leavespergathering}\marg{num} \\
\end{syntax}
\glossary(leavespergathering)%
  {\cs{leavespergathering}\marg{num}}%
  {Ensure that the correct number of pages are output to make up gatherings 
   of \meta{num} leaves each.}
The command \cmd{\leavespergathering} ensures that there will be exactly the
right number of pages output to make a complete set of gatherings of \meta{num}
leaves (2\meta{num} pages) each --- if necessary  blank pages will be output 
at the end to make up the correct tally. If \meta{num} is less than two (the default)
then no additional pages will be output.


\section{Time}

\begin{syntax}
\cmd{\printtime} \cmd{\printtime*} \\
\cmd{\hmpunct} \cmd{\amname} \cmd{\pmname} \\
\end{syntax}
\glossary(printtime)%
  {\cs{printtime}}%
  {Prints the time of day using a 24 hour clock.}
\glossary(printtime*)%
  {\cs{printtime*}}%
  {Prints the time of day using a 12 hour clock.}
\glossary(hmpunct)%
  {\cs{hmpunct}}%
  {Punctuation between hours and minutes in \cs{printtime} (default :)}
\glossary(amname)%
  {\cs{amname}}%
  {Abbreviation for ante meridiem used in \cs{printtime*} (default am)}
\glossary(pmname)%
  {\cs{pmname}}%
  {Abbreviation for post meridiem used in \cs{printtime*} (default am)}

The \cmd{\printtime} command\footnote{I based the code on a similar macro
in \btitle{\tx\ for the Impatient}~\cite{IMPATIENT}.} 
prints the time of day when the document is 
processed using the 24 hour clock while \cmd{\printtime*} uses a 12
hour clock. For example, the effect of the 
next piece of code is shown below.
\begin{lcode}
This document was processed on: \today\ at \printtime\ (\printtime*).
\end{lcode}
This document was processed on: \today\ at \printtime\ (\printtime*).

    The punctuation between the hours and minutes is \cmd{\hmpunct} which
defaults to a colon (:). The macros \cmd{\amname} and \cmd{\pmnane} hold 
the abbreviations for \textit{ante meridiem} and \textit{post meridiem}, 
respecitively; the defaults are `\amname' and `\pmname'. 

    According to the \btitle{Chicago Manual of Style}~\cite{CMS} there 
should be no punctuation between the hours and minutes in the 24 hour system.
For the 12 hour system it recommends that small caps be used for the
divisions of the day (e.g., \textsc{a.m.} and \textsc{p.m.}) and also
that the American practice is to use a colon as the separator between
hours and minutes whereas the English practice is to use a period (known
to the English as a `full stop'). I don't know what the traditions are
in other orthographies.

    The \cmd{\quarkmarks} declaration uses \cmd{\printtime}, so be careful
if you change it.

    Nicola Talbot's \Lpack{datetime} package~\cite{DATETIME} provides
a much more comprehensive collection of styles for printing the time;
also for dates.

\section{Page breaks before lists}

   A sentence or two may be used to introduce a list (e.g., \Ie{itemize})
and it can be annoying if there is a page break between the introductory words
and the first item.
\begin{syntax}
\cmd{\noprelistbreak} \\
\end{syntax}
\glossary(noprelistbreak)%
  {\cs{noprelistbreak}}%
  {Putting this immediately before an \Pe{itemize} (or \Pe{enumerate}, or \ldots) 
   environment should prevent a pagebreak.}

Putting \cmd{\noprelistbreak} immediately before the \verb?\begin{itemize}?
should prevent a page break. Ideally, there should be no blank lines
between the end of the introduction and the start of the list. 

\section{Changing counters}

    This is effectively a bundling of the \Lpack{chngcntr} 
package~\cite{CHNGCNTR}.

\begin{syntax}
\cmd{\newcounter}\marg{ctr}\oarg{within} \\
\cmd{\thectr} \\
\end{syntax}
\glossary(newcounter)%
  {\cs{newcounter}\marg{ctr}\oarg{within}}%
  {Creates a new counter \Pcn{ctr}, optionally reset when counter \Pcn{within}
   changes.}
\glossary(thectr)%
  {\cs{thectr}}%
  {Typesets the value of the counter \Pcn{ctr}.}
    In \ltx\ a new counter called, say \Pcn{ctr}, is created by the 
\cmd{\newcounter} command as \verb?\newcounter{ctr}?. 
If the optional \meta{within}
argument is given, the counter \Pcn{ctr} is reset to zero each time the 
counter called \Pcn{within} is changed; the \Pcn{within} counter 
must exist before it is used as the optional argument. The command 
\verb?\thectr? typesets the value
of the counter \Pcn{ctr}. This is automatically defined for you by the 
\cmd{\newcounter} command to typeset arabic numerals.

\begin{syntax}
\cmd{\counterwithin}\marg{ctr}\marg{within} \\
\cmd{\counterwithin*}\marg{ctr}\marg{within} \\
\end{syntax}
\glossary(counterwithin)%
  {\cs{counterwithin}\marg{ctr}\marg{within}}%
  {Makes the counter \Pcn{ctr} (created via \cs{newcounter}) act as though 
   it had been initially defined to be reset by counter \Pcn{within}.
   It also redefines \cs{thectr} to include \cs{thewithin}.}
\glossary(counterwithin*)%
  {\cs{counterwithin*}\marg{ctr}\marg{within}}%
  {Makes the counter \Pcn{ctr} (created via \cs{newcounter}) act as though 
   it had been initially defined to be reset by counter \Pcn{within}, leaving
   the original definition of \cs{thectr}.}
The \cmd{\counterwithin} macro makes a \meta{ctr} that has been initially
defined by \verb?\newcounter{ctr}? act as though it had been defined by
\verb?\newcounter{ctr}[within]?. It also redefines the \cs{thectr} command
to be \verb?\thewithin.\arabic{ctr}?. The starred version of the command
does nothing to the original definition of \cs{thectr}.

\begin{syntax}
\cmd{\counterwithout}\marg{ctr}\marg{within} \\
\cmd{\counterwithout*}\marg{ctr}\marg{within} \\
\end{syntax}
\glossary(counterwithout)%
  {\cs{counterwithout}\marg{ctr}\marg{within}}%
  {Makes the counter \Pcn{ctr} (created via 
   \cs{newcounter}\marg{ctr}\oarg{within}) act as though 
   it had been initially defined via \cs{newcounter}\marg{ctr}.
   It also redefines \cs{thectr} to typeset as arabic numerals.}
\glossary(counterwithout*)%
  {\cs{counterwithout*}\marg{ctr}\marg{within}}%
  {Makes the counter \Pcn{ctr} (created via 
   \cs{newcounter}\marg{ctr}\oarg{within}) act as though 
   it had been initially defined via \cs{newcounter}\marg{ctr},
   leaving the original definition of \cs{thectr}.}
The \cmd{\counterwithout} macro makes the \Pcn{ctr} counter that has been 
initially
defined by \verb?\newcounter{ctr}[within]? act as though it had been defined by
\verb?\newcounter{ctr}?. It also redefines the \cs{thectr} command
to be \verb?\arabic{ctr}?. The starred version of the command
does nothing to the original definition of \verb?\thectr?.

    Any number of \verb?\counterwithin{ctr}{...}? and \verb?\counterwithout{ctr}{...}?
commands can be issued for a given counter \Pcn{ctr} if you wish to toggle
between the two styles. The current value of \Pcn{ctr} is unaffected by these
commands. If you want to change the value use \cmd{\setcounter}, and to change
the typesetting style use \cmd{\renewcommand} on \cs{thectr}.


\begin{caveat}
  As of 2018 \cmd{\counterwithout} and \cmd{\counterwithin} will be
  provided by the \LaTeX-kernel, thus we only provide it if it does
  not already exist.
\end{caveat}





\LMnote{2010/01/30}{Added \cs{letcountercounter}}
\begin{syntax}
  \cmd{\letcountercounter}\marg{counterA}\marg{counterB}\\
  \cmd{\unletcounter}\marg{counterA}\\
\end{syntax}
At times it is handy to `let' one counter act as if it was a
different counter. Say you have two constructions, each with their
own counter A and B, now you want them to cooperate, counting in
unison. This can be done using the \verb?\letcountercounter?.

\cs{letcountercounter}\marg{counterA}\marg{counterB} \cs{let}s 
(make the same) \meta{counterA} to \meta{counterB}. The
original of \meta{counterA} is kept, such that you can unlet it later.

\cs{unletcounter}\marg{counterA} restores \meta{counterA} to its un\cs{let}
condition.

This feature can be quite handy. Say for instance you want figures and
tables to counter within the same counter (say table), then we need
each change to the \verb?figure? counter to actually act on the
\verb?table? counter. \verb?\letcountercounter{figure}{table}? solves
the problem.



\section{New new and provide commands}

\begin{syntax}
\cmd{\newloglike}\marg{cmd}\marg{string} \\
\cmd{\newloglike*}\marg{cmd}\marg{string} \\
\end{syntax}
\glossary(newloglike)%
  {\cs{newloglike}\marg{cmd}\marg{string}}%
  {Creates a new log-like function command \meta{cmd} typesetting 
   \meta{string}.}
\glossary(newloglike*)%
  {\cs{newloglike}\marg{cmd}\marg{string}}%
  {Creates a new log-like function command \meta{cmd} typesetting 
   \meta{string}, which can take limits.}
The class provides means of creating new math log-like functions. For
example you might want to do
\begin{lcode}
\newloglike{\Ei}{Ei}
\end{lcode}
if you are using the exponential integral function in your work.
The starred version of the command creates a function that takes limits
(like the \cmd{\max} function).

    The \ltx\ kernel defines the \cmd{\providecommand} macro that acts
like \cmd{\newcommand} if the designated macro has not been defined
previously, otherwise it does nothing. The class adds to that limited
repertoire.

\begin{syntax}
\cmd{\provideenvironment}\marg{name}\oarg{numargs}\oarg{optarg}\marg{begindef}\marg{enddef} \\
\cmd{\providelength}\marg{cmd} \\
\cmd{\providecounter}\marg{ctr}\oarg{within} \\
\cmd{\provideloglike}\marg{cmd}\marg{string} \\
\cmd{\provideloglike*}\marg{cmd}\marg{string} \\
\end{syntax}
\glossary(provideenvironment)%
  {\cs{provideenvironment}\marg{name}\oarg{numarks}\oarg{optarg}\marg{begindef}\marg{enddef}}%
  {A `provide' version of \cs{(re)newenvironment}.}
\glossary(providelength)%
  {\cs{providelength}\marg{cmd}}%
  {A `provide' version of \cs{newlength}.}
\glossary(providecounter)%
  {\cs{providecounter}\marg{ctr}\oarg{within}}%
  {A `provide' version of \cs{newcounter}.}
\glossary(provideloglike)%
  {\cs{provideloglike}\marg{cmd}\marg{string}}%
  {A `provide' version of \cs{newloglike}.}
\glossary(provideloglike*)%
  {\cs{provideloglike*}\marg{cmd}\marg{string}}%
  {A `provide' version of \cs{newloglike*}.}
    The macros \cmd{\provideenvironment}, \cmd{\providelength}
and \cmd{\providecounter} take the same arguments as their \verb?\new...?
counterparts. If the environment, length or counter has not been defined
then it is defined accordingly, otherwise the macros do nothing except
produce a warning message for information purposes.

   The \cmd{\provideloglike} commands are for math log-like functions,
but they do not produce any warning messages.

\section{Changing macros} \label{sec:addtodef}

     Commands are provided for extending simple macro 
definitions.\index{extend a macro}\index{add to a macro}

\begin{syntax}
\cmd{\addtodef}\marg{macro}\marg{prepend}\marg{append} \\
\cmd{\addtoiargdef}\marg{macro}\marg{prepend}\marg{append} \\
\end{syntax}
\glossary(addtodef)%
  {\cs{addtodef}\marg{macro}\marg{prepend}\marg{append}}%
  {Inserts \meta{prepend} at the start of the current definition of 
   \meta{macro} and \meta{append} at the end, treating the result
   as if it had been defined by \cs{renewcommand}.}
\glossary(addtoiargdef)%
  {\cs{addtoiargdef}\marg{macro}\marg{prepend}\marg{append}}%
  {Inserts \meta{prepend} at the start of the current definition of 
   \meta{macro} (which takes a single argument) and \meta{append} at the 
    end, treating the result as if it had been defined by \cs{renewcommand}.}
The macro \cmd{\addtodef} inserts \meta{prepend} at the start of the
current definition of \meta{macro} and puts \meta{append} at the end,
where \meta{macro} is the name of a macro (including the backslash) which 
takes no arguments. The \cmd{\addtoiargdef} macro is similar except that
\meta{macro} is the name of a macro that takes one argument.

 For example the following are two equivalent
definitions of \verb?\mymacro?:
\begin{lcode}
\newcommand{\mymacro}[1]{#1 is a violinist in spite of being tone deaf}
\end{lcode}
and
\begin{lcode}
\newcommand{\mymacro}[1]{#1 is a violinist}
\addtoiargdef{\mymacro}{}{ in spite of being tone deaf}
\end{lcode}

    The \cmd{\addtoiargdef} (and \cmd{\addtodef}) commands
can be applied several times to the same \meta{macro}. Revising the
previous example we could have
\begin{lcode}
\newcommand{\mymacro}[1]{#1 is a violinist}
\addtoiargdef{\mymacro}{Although somewhat elderly, }%
                       { in spite of being tone deaf}
\addtoiargdef{\mymacro}{}{ and a bagpiper}
\end{lcode}
which is equivalent to
\begin{lcode}
\newcommand{\mymacro}[1]{%
  Although somewhat elderly, #1 is a violinist
  in spite of being tone deaf and a bagpiper}
\end{lcode}

The \meta{prepend} and \meta{append} arguments may include \ltx\ code, 
as shown in this extract from the class code:
\begin{lcode}
\addtoiargdef{\date}{}{%
  \begingroup
    \renewcommand{\thanks}[1]{}
    \renewcommand{\thanksmark}[1]{}
    \renewcommand{\thanksgap}[1]{}
    \protected@xdef\thedate{#1}
  \endgroup}
\end{lcode}
Note that in the case of \cmd{\addtoiargdef} an argument can also refer
to the original argument of the \meta{macro}.

\begin{syntax}
\cmd{\addtodef*}\marg{macro}\marg{prepend}\marg{append} \\
\cmd{\addtoiargdef*}\marg{macro}\marg{prepend}\marg{append} \\
\end{syntax}
\glossary(addtodef*)%
  {\cs{addtodef*}\marg{macro}\marg{prepend}\marg{append}}%
  {Inserts \meta{prepend} at the start of the current definition of 
   \meta{macro} and \meta{append} at the end, treating the result as if it had
   been defined by \cs{renewcommand*}.}
\glossary(addtoiargdef*)%
  {\cs{addtoiargdef*}\marg{macro}\marg{prepend}\marg{append}}%
  {Inserts \meta{prepend} at the start of the current definition of 
   \meta{macro} (which takes a single argument) and \meta{append} at the 
   end, treating the result as if it had been defined by \cs{renewcommand*}.}
These starred versions are for use when the original \meta{macro}
was defined via \cmd{\newcommand*}. Using the starred versions is
like using \cmd{\renewcommand*} and the unstarred versions are like
having used \cmd{\renewcommand}. It is the version (starred or unstarred)
of a sequence of \verb?\addto...? commands that counts when determining whether
the equivalent \verb?\renew...? is treated as starred or unstarred.

    The \verb?\addto...? macros cannot be used to delete any code from 
\meta{macro} nor to add anything except at the start and end. Also,
in general, they cannot be used to change the definition of a macro that
takes an optional argument, or a starred macro.

\begin{syntax}
\cmd{\patchcommand}\marg{macro}\marg{start-code}\marg{end-code} \\
\end{syntax}
\glossary(patchcommand)%
  {\cs{patchcommand}\marg{macro}\marg{start-code}\marg{end-code}}%
  {Inserts \meta{start-code} before the current definition of the 
   \meta{macro} and \marg{end-code} at the end of the current definition.}%

The \cmd{\patchcommand} is from the late 
Michael Downes'\index{Downes, Michael}
\Lpack{patchcmd} package~\cite{PATCHCMD}. 
It inserts the \meta{start-code} at 
the start of the current definition of the macro \meta{macro},
and inserts \meta{end-code} at the end of its current definition.
The \meta{macro} can have zero to nine parameters. If \meta{macro}
uses \cmd{\futurelet} (e.g., it is a starred command or takes an
optional argument) only \meta{start-code} is useful --- 
\meta{end-code} must be empty otherwise things get messed up. If
\meta{macro} has any delimited arguments then \cmd{\patchcommand}
cannot be used.

\section{String arguments}

    In the code for the class I have sometimes used macro arguments
that consist of a `string', like the \texttt{*} arguments in the page layout
macros (e.g., \cmd{\settypeblocksize}), or the \texttt{flushleft}, 
\texttt{center} and \texttt{flushright} strings for the 
\cmd{\makeheadposition} macro.

\begin{syntax}
\cmd{\nametest}\marg{str1}\marg{str2} \\
\piif{ifsamename} \\
\end{syntax}
\glossary(nametest)%
  {\cs{nametest}\marg{str1}\marg{str2}}%
  {Sets \cs{ifsamename} \ptrue\ if \meta{str1} is the same as \meta{str2},
  otherwise \pfalse.}
\glossary(ifsamename)%
  {\cs{ifsamename}}%
  {Result from \cs{nametest}.}
The macro \cmd{\nametest} takes two strings 
as the arguments \meta{str1} and \meta{str2}. It sets \piif{ifsamename}
\ptrue\ if \meta{str1} is the same as \meta{str2}, otherwise it sets
\piif{ifsamename} \pfalse. For the purposes of \cmd{\nametest}, a string is a
sequence of characters which may include spaces and may include
the \verb?\? backslash character; strings are equal if and only if their
character sequences are identical.

    Typically, I have used it within macros for checking on argument
values. For example:
\begin{lcode}
\newcommand{\amacro}[1]{%
  \nametest{#1}{green}
  \ifsamename
%    code for green
  \fi
  \nametest{#1}{red}
  \ifsamename
%    code for red
  \fi
  ...
}
\end{lcode}

\section{Odd/even page checking}

It is difficult to check robustly if the current page is odd or even
but the class does provide a robust method based on writing out a
label and then checking the page reference for the label. This
requires at least two \ltx\ runs to stabilise. This has been extracted
from the original \Lpack{chngpage} package (which is no longer
available). (The class code and \Lpack{chngpage} code is similar but
not identical. There is a later package,
\Lpack{changepage}~\cite{CHANGEPAGE} which contains code that is
identical to the class.)


\begin{syntax}
\cmd{\checkoddpage} \\
\piif{ifoddpage} \\
\cmd{\strictpagecheck} \cmd{\easypagecheck} \\
\end{syntax}
\glossary(checkoddpage)%
  {\cs{checkoddpage}}%
  {Sets \cs{ifoddpage} \ptrue\ if called on an odd-numbered page, otherwise
   \pfalse.}
\glossary(ifoddpage)%
  {\cs{ifoddpage}}%
  {Result of \cs{checkoddpage}.}
\glossary(strictpagecheck)%
  {\cs{strictpagecheck}}%
  {\cs{checkoddpage} will use an accurate but time and space consuming method
   for checking for an  odd page number.}
\glossary(easypagecheck)%
  {\cs{easypagecheck}}%
  {\cs{checkoddpage} will use a possibly inaccurate but fast method
   for checking for an  odd page number.}
The macro \cmd{\checkoddpage} sets \piif{ifoddpage} to \ptrue\ if the current
page number 
is odd, otherwise it sets it to \pfalse\ (the page number is even). The robust
checking method involves writing and reading labels, which is what is done
after the command \cmd{\strictpagecheck} is issued; it may take more than 
one run before everything settles down. The simple method 
is just
to check the current page number which, because of TeX's asynchronous page
breaking algorithm, may not correspond to the actual page number where the
\cmd{\checkoddpage} command was issued. The simple, but faster, page checking
method is used after the \cmd{\easypagecheck} command is issued.

\begin{syntax}
\cmd{\cplabel} \\
\end{syntax}
\glossary(cplabel)%
  {\cs{cplabel}}%
  {Prefix for labels used by \cs{checkoddpage} odd/even page checking.}
When strict page checking is used the labels consist of a number preceded
by the value of \cmd{\cplabel}, whose default definition is \verb?^_? (e.g.,
a label may consist of the characters \verb?^_21?). If this
might clash with any of your labels, change \cmd{\cplabel} with 
\cmd{\renewcommand}, but
the definition of \cmd{\cplabel} must be constant for any given document.

\section{Moving to another page} \label{sec:moving}

   Standard \ltx\ provides the \cmd{\newpage}, \cmd{\clearpage}
and \cmd{\cleardoublepage} commands for discontinuing the current 
page and starting a new one. The following is a bundling of the
\Lpack{nextpage} package~\cite{NEXTPAGE}.

\begin{syntax}
\cmd{\needspace}\marg{length} \\
\end{syntax}
\glossary(needspace)%
  {\cs{needspace}\marg{length}}%
  {Starts a new page, leaving the current page short, unless there is 
   estimated \meta{length} vertical space left on the current page.}
This macro decides if there is \meta{length} space at the bottom of the 
current page. If there is, it does nothing, otherwise it starts a new page.
This is useful if \meta{length} amount of material is to be kept together
on one page. The \cmd{\needspace} macro 
depends on penalties for deciding what to do which means that the reserved
space is an approximation. However, except for the odd occasion, the
macro gives adequate results. 

\begin{syntax}
\cmd{\Needspace}\marg{length} \\
\cmd{\Needspace*}\marg{length} \\
\end{syntax}
\glossary(Needspace)%
  {\cs{Needspace}\marg{length}}%
  {Starts a new page, leaving the current page short, unless there is 
   actually at least \meta{length} vertical space left on the current page. }
\glossary(Needspace*)%
  {\cs{Needspace*}\marg{length}}%
  {Starts a new page, leaving the current page short unless \cs{flushbottom} 
   is in effect, unless there is 
   actually at least \meta{length} vertical space left on the current page.}
    Like \cmd{\needspace}, the \cmd{\Needspace} macro checks if there is
\meta{length} space at the bottom of the current page and if there is not
it starts a new page. The command should only be used between paragraphs;
indeed, the first thing it does is to call \cs{par}. The \cmd{\Needspace}
command checks for the actual space left on the page and is more exacting
than \cmd{\needspace}.

    If either \cmd{\needspace} or \cmd{\Needspace} produce a short page it
will be ragged bottom even if \cmd{\flushbottom} is in effect. With
the starred \cmd{\Needspace*} version, short pages will be flush bottom
if \cmd{\flushbottom} is in effect and will be ragged bottom
when \cmd{\raggedbottom} is in effect.

    Generally speaking, use \cmd{\needspace} in preference to \cmd{\Needspace}
unless it gives a bad break or the pages must be flush bottom.


\begin{syntax}
\cmd{\movetoevenpage}\oarg{text} \\
\cmd{\cleartoevenpage}\oarg{text} \\
\end{syntax}
\glossary(movetoevenpage)%
  {\cs{movetoevenpage}\oarg{text}}%
  {Stops the current page to start typesetting on the next even page.
   The optional \meta{text} is put on the skipped page (if there is one).}
The \cmd{\movetoevenpage} stops the current page and starts typesetting on the
next even numbered page. The \verb?\clear...? version flushes out all 
floats\index{float} before
going to the next even page. The optional \meta{text} is put on the skipped
page (if there is one).

\begin{syntax}
\cmd{\movetooddpage}\oarg{text} \\
\cmd{\cleartooddpage}\oarg{text} \\
\end{syntax}
\glossary(movetooddpage)%
  {\cs{movetooddpage}\oarg{text}}%
  {Stops the current page to start typesetting on the next odd page.
   The optional \meta{text} is put on the skipped page (if there is one).}
\glossary(cleartoevenpage)%
  {\cs{cleartooddpage}\oarg{text}}%
  {Flushes any pending floats to then start typesetting on the next odd page.
   The optional \meta{text} is put on the skipped page (if there is one).}
These macros are similar to the \verb?\...evenpage? ones except that they jump
to the next odd numbered page.

    A likely example for the optional \meta{text} argument is
\begin{lcode}
\cleartooddpage[\vspace*{\fill}THIS PAGE LEFT BLANK\vspace*{\fill}]
\end{lcode}
which will put `THIS PAGE LEFT BLANK' in the centre of any
potential skipped (empty) even numbered page.

\begin{syntax}
\cmd{\cleartorecto} \cmd{\cleartoverso} \\
\end{syntax}
\glossary(cleartorecto)%
  {\cs{cleartorecto}}%
  {Simpler form of \cs{cleartooddpage}.}
\glossary(cleartoverso)%
  {\cs{cleartoverso}}%
  {Simpler form of \cs{cleartoevenpage}.}
These are slightly simpler forms\footnote{Perhaps more robust.} of
\cmd{\cleartooddpage} and \cmd{\cleartoevenpage}. For example, if you wanted
the \toc\ to start on a verso page, like in 
\btitle{The TeXbook} \cite{TEXBOOK}, then do this:
\begin{lcode}
\cleartoverso
\tableofcontents
\end{lcode}

\section{Number formatting}

    Several methods are provided for formatting numbers\index{number}. 
Two classes of number representations\indextwo{number}{representation} 
are catered for. 
A `numeric number'\indextwo{numeric}{number} is typeset using arabic 
digits and a `named number'\indextwo{named}{number} is typeset using
words.

    The argument to the number formatting macros is a `number'\index{number}, 
essentially something that resolves to a series of arabic digits. Typical
arguments might be:
\begin{itemize}
\item Some digits, e.g., \verb?\ordinal{123} ->? 
      \ordinal{123} 
\item A macro expanding to digits, e.g., \verb?\def\temp{3}\ordinal{\temp} ->? 
      \begingroup\def\temp{3}\ordinal{\temp}\endgroup % \\

%      Or even, for example, \verb?\ordinal{\pageref{chap:numf}} ->? 
%      \ordinal{\pageref{chap:numf}}
\item The value of a counter, e.g., \verb?\ordinal{\value{page}} ->? 
      \ordinal{\value{page}} 
\item The arabic representation of a counter, e.g., \verb?\ordinal{\thepage} ->? 
      \ordinal{\thepage} 

However, if the representation of a counter is not completely in arabic 
digits, such as \verb?\thesection? which here prints as \thesection, it will 
produce odd errors or peculiar results if it is used as the argument.
For instance: \\
\verb?\ordinal{\thesection} ->? \ordinal{\thesection}

\end{itemize}

\subsection{Numeric numbers}
\indextwo{numeric}{number}

\begin{syntax}
\cmd{\cardinal}\marg{number} \\
\cmd{\fcardinal}\marg{number} \\
\cmd{\fnumbersep} \\
\end{syntax}
\glossary(cardinal)%
  {\cs{cardinal}\marg{number}}%
  {Typesets \marg{number} as a cardinal number.}
\glossary(fcardinal)%
  {\cs{fcardinal}\marg{number}}%
  {Typesets \marg{number} as a cardinal number, with \cs{fnumbersep} between
   each triple of digits.}
\glossary(fnumbersep)%
  {\cs{fnumbersep}}%
  {Separator between digit triples in numbers.}
The macro \cmd{\fcardinal} prints its \meta{number} argument formatted using
\cmd{\fnumbersep} between each triple of digits. The default definition
of \cmd{\fnumbersep} is:
\begin{lcode}
\newcommand{\fnumbersep}{,}
\end{lcode}

    Here are some examples: \\
\verb?\fcardinal{12} ->? \fcardinal{12} \\
\verb?\fcardinal{1234} ->? \fcardinal{1234} \\
\verb?\fcardinal{1234567} ->? \fcardinal{1234567} \\
\verb?\renewcommand*{\fnumbersep}{\:}\fcardinal{12345678} ->?
\renewcommand*{\fnumbersep}{\:}\fcardinal{12345678} \\
\verb?\renewcommand*{\fnumbersep}{,\:}?
\renewcommand*{\fnumbersep}{,\:}

    The \cmd{\cardinal} macro is like \cmd{\fcardinal} except that there
is no separation between any of the digits.

\begin{syntax}
\cmd{\ordinal}\marg{number} \\
\cmd{\fordinal}\marg{number} \\
\cmd{\ordscript}\marg{chars} \\
\end{syntax}
\glossary(ordinal)%
  {\cs{ordinal}\marg{number}}%
  {Typesets \marg{number} as an ordinal number.}
\glossary(fordinal)%
  {\cs{fordinal}\marg{number}}%
  {Typesets \marg{number} as an ordinal number, with \cs{fnumbersep} between
   each triple of digits.}
\glossary(ordscript)%
  {\cs{ordscript}\marg{chars}}%
  {Typesets the ordinal characters \meta{chars}.}

The \cmd{\fordinal} macro typesets its \meta{number} argument as a formatted
ordinal, using \cmd{\fnumbersep} as the separator. The macro \cmd{\ordinal}
is similar except that there is no separation between any of the digits.

    Some examples are: \\
\verb?\fordinal{3} ->? \fordinal{3} \\
\verb?\fordinal{12341} ->? \fordinal{12341} \\
\verb?\renewcommand{\ordscript}[1]{\textsuperscript{#1}}? \\
\verb?\fordinal{1234567} ->?
  \renewcommand{\ordscript}[1]{\textsuperscript{#1}}\fordinal{1234567} \\
\verb?\ordinal{1234567} ->? \ordinal{1234567} \\
\verb?This is the \ordinal{\value{chapter}} chapter. ->? 
  This is the \ordinal{\value{chapter}} chapter.


    The characters denoting the ordinal (ordination?) are typeset as 
the argument of \cmd{\ordscript}, whose default definition is:
\begin{lcode}
\newcommand{\ordscript}[1]{#1}
\end{lcode}
As the above examples show, this can be changed to give a different
appearance.

\begin{syntax}
\cmd{\nthstring} \cmd{\iststring} \cmd{\iindstring} \cmd{\iiirdstring} \\
\end{syntax}
\glossary(nthstring)%
  {\cs{nthstring}}%
  {Ordinal characters for `th', e.g., as in 6th.}
\glossary(iststring)%
  {\cs{iststring}}%
  {Ordinal characters for `st', e.g., as in 1st.}
\glossary(iindstring)%
  {\cs{iindstring}}%
  {Ordinal characters for `nd', e.g., as in 2nd.}
\glossary(iiirdstring)%
  {\cs{iiirdstring}}%
  {Ordinal characters for `rd', e.g., as in 3rd.}
The ordinal characters are the values of the macros \cmd{\nthstring}
(default: th) for most ordinals, \cmd{\iststring} (default: st) for
ordinals ending in 1 like \ordinal{21}, \cmd{\iindstring} (default: nd)
for ordinals like \ordinal{22}, and \cmd{\iiirdstring} (default: rd)
for ordinals like \ordinal{23}.


\subsection{Named numbers}
\indextwo{named}{number}


\begin{syntax}
\cmd{\numtoname}\marg{number} \\
\cmd{\numtoName}\marg{number} \\
\cmd{\NumToName}\marg{number} \\
\end{syntax}
\glossary(numtoname)%
  {\cs{numtoname}\marg{number}}%
  {Typesets \meta{number} as a cardinal using lowercase words.}
\glossary(numtoName)%
  {\cs{numtoName}\marg{number}}%
  {Typesets \meta{number} as a cardinal using lowercase words, but uppercase for the initial
   letter of the first word.}
\glossary(NumtoName)%
  {\cs{NumtoName}\marg{number}}%
  {Typesets \meta{number} as a cardinal using lowercase words, but uppercase for the initial
   letter of each word.}
The macro \cmd{\numtoname} typesets its \meta{number} argument using 
lowercase words. The other two macros are similar, except that 
\cmd{\numtoName} uses uppercase for the initial letter of the first word and
\cmd{\NumToName} uses uppercase for the initial letters of all the words.

    As examples: \\
\verb?\numtoname{12345} ->? \numtoname{12345} \\
\verb?\numtoName{12345} ->? \numtoName{12345} \\
\verb?\NumToName{12345} ->? \NumToName{12345} \\
\begin{egsource}{eg:minnum}
The minimum number in TeX is \numtoname{-2147483647}
(i.e., \fcardinal{-2147483647})
\end{egsource}
\begin{egresult}[\tx's minimum number in words (English style)]{eg:minnum}
  The minimum number in TeX is \numtoname{-2147483647} 
  (i.e., \fcardinal{-2147483647})
\end{egresult}

\begin{syntax}
\cmd{\ordinaltoname}\marg{number} \\
\cmd{\ordinaltoName}\marg{number} \\
\cmd{\OrdinalToName}\marg{number} \\
\end{syntax}
\glossary(ordinaltoname)%
  {\cs{ordinaltoname}\marg{number}}%
  {Typeset \meta{number} as an ordinal using lowercase words.}
\glossary(ordinaltoName)%
  {\cs{ordinaltoName}\marg{number}}%
  {Typeset \meta{number} as an ordinal using lowercase words, but uppercase the
   initial letter of the first word.}
\glossary(OrdinaltoName)%
  {\cs{OrdinaltoName}\marg{number}}%
  {Typeset \meta{number} as an ordinal using lowercase words, but uppercase the
   initial letter of each word.}
These three macros are similar to \cmd{\numtoname}, etc., except that they
typeset the argument as a wordy ordinal.

    For example: \\
\verb?This is the \ordinaltoname{\value{chapter}} chapter. ->? 
  This is the \ordinaltoname{\value{chapter}} chapter.

\begin{syntax}
\cmd{\namenumberand} \cmd{\namenumbercomma} \cmd{\tensunitsep} \\
\end{syntax}
\glossary(namenumberand)%
  {\cs{namenumberand}}%
  {The conjunction in named numbers, default ` and '.}
\glossary(namenumbercomma)%
  {\cs{namenumbercomma}}%
  {The `comma' in named numbers, default `, '.}
\glossary(tensunitsep)%
  {\cs{tensunitsep}}%
  {The separator/conjoiner between tens and units in named numbers, default `-'.}
By default some punctuation and conjunctions are used in the representation
of named numbers. According to both American and English practice, a hyphen
should be inserted between a `tens' name (e.g., fifty) and a following 
unit name (e.g., two). This is represented by the value of \cmd{\tensunitsep}.
English practice, but not American, is to include commas (the value of
\cmd{\namenumbercomma}) and conjunctions (the value of \cmd{\namenumberand})
in strategic positions in the typesetting. These macros are initially
defined as:
\begin{lcode}
\newcommand*{\namenumberand}{ and }
\newcommand*{\namenumbercomma}{, }
\newcommand*{\tensunitsep}{-}
\end{lcode}
The next example shows how to achieve American typesetting.
\begin{egsource}{eg:maxnum}
\renewcommand*{\namenumberand}{ }
\renewcommand*{\namenumbercomma}{ }
The maximum number in TeX is \numtoname{2147483647} 
(i.e., \cardinal{2147483647}).
\end{egsource}
\begin{egresult}[\tx's maximum number in words (American style)]{eg:maxnum}
\renewcommand*{\namenumberand}{ }\renewcommand*{\namenumbercomma}{ }%
The maximum number in TeX is \numtoname{2147483647} 
(i.e., \cardinal{2147483647}). 
\end{egresult}
\renewcommand*{\namenumberand}{ and }
\renewcommand*{\namenumbercomma}{, }

\begin{syntax}
\cmd{\minusname} \cmd{\lcminusname} \cmd{\ucminusname} \\
\end{syntax}
\glossary(minusname)%
  {\cs{minusname}}%
  {Typeset for `minus' before negative named numbers.}
\glossary(lcminusname)%
  {\cs{lcminusname}}%
  {Lowercase `minus' name, default `minus'.}
\glossary(ucminusname)%
  {\cs{ucminusname}}%
  {Lowercase `minus' name with initial uppercase letter, default `Minus'.}
    When a named number is negative, \cmd{\minusname} is put before the
spelled out number. The definitions of the above three comands are:
\begin{lcode}
\newcommand*{\lcminusname}{minus }
\newcommand*{\ucminusname}{Minus }
\let\minusname\lcminusname
\end{lcode}
which means that `minus' is normally all lowercase. To get `minus'
typeset with an initial uppercase letter simply:
\begin{lcode}
\let\minusname\ucminusname
\end{lcode}

    Only one version of \cmd{\namenumberand} is supplied as I consider that
it is unlikely that `and' would ever be typeset as `And'. If the initial
uppercase is required, renew the macro when appropriate.

    There is a group of macros that hold the names for the numbers. To
typeset named numbers in a language other than English these will have to be
changed as appropriate. You can find them in the class and patch code. 
The actual picking and ordering of the names is done by an internal macro
called \cmd{\n@me@number}. If the ordering is not appropriate for a
particular language, that is the macro to peruse and modify. Be prepared,
though, for the default definitions to be changed in a later release in case
there is a more efficient way of implementing their functions.

    If you want to express numbers that fall outside \tx's range, Edward
Reingold has produced a set of macros that can write out in words any number
within the range $-10^{66} to 10^{66}$, that is, up to a thousand 
vigintillion~\cite{REINGOLD07}.

\subsection{Fractions}

    When typesetting a simple fraction in text there is usually a choice
of two styles, like 3/4 or $\frac{3}{4}$, which do not necessarily look 
as though they fit in with their surroundings. These fractions were
typeset via:
\begin{lcode}
... like 3/4 or $\frac{3}{4}$ ...
\end{lcode}

\begin{syntax}
\cmd{\slashfrac}\marg{top}\marg{bottom} \\
\cmd{\slashfracstyle}\marg{num} \\
\end{syntax}
\glossary(slashfrac)%
  {\cs{slashfrac}\marg{top}\marg{bottom}}%
  {Typesets like \slashfrac{3}{4}, using the \cs{slashfracstyle} font.}
\glossary(slashfracstyle)%
  {\cs{slashfracstyle}\marg{num}}%
  {Typesets \meta{num} in a particular (font, size) style.}
The class provides the \cmd{\slashfrac} command which typesets its
arguments like \slashfrac{3}{4}. Unlike the \cmd{\frac} command which
can only be used in math mode, the \cmd{\slashfrac} command can be
used in text and math modes.

    The \cmd{\slashfrac} macro calls the \cmd{\slashfracstyle} command to
reduce the size of the numbers in the fraction. You can also use
\cmd{\slashfracstyle} by itself.
\begin{egsource}{eg:fractions}
In summary, fractions can be typeset like 3/4 or $\frac{3}{4}$
or \slashfrac{3}{4} or \slashfracstyle{3/4} because several choices
are provided.
\end{egsource}
\begin{egresult}[Varieties of fractions in text]{eg:fractions}
In summary, fractions can be typeset like 3/4 or $\frac{3}{4}$
or \slashfrac{3}{4} or \slashfracstyle{3/4} because several choices
are provided.
\end{egresult}

\begin{syntax}
\cmd{\textsuperscript}\marg{super} \\
\cmd{\textsubscript}\marg{sub} \\
\end{syntax}
\glossary(textsuperscript)%
  {\cs{textsuperscript}\marg{super}}%
  {Typesets \meta{super} as a superscript.}
\glossary(textsubscript)%
  {\cs{textsubscript}\marg{sub}}%
  {Typesets \meta{sub} as a subscript.}
While on the subject of moving numbers up and down, the kernel provides
the \cmd{\textsuperscript} macro for typesetting its argument as though it
is a superscript. The class also provides the \cmd{\textsubscript} macro
for typesetting its argument like a subscript.

\begin{egsource}{eg:textsupsub}
In normal text you can typeset superscripts like H\textsuperscript{+} and 
subscripts like H\textsubscript{2}O without going into math mode.
\end{egsource}
\begin{egresult}[Super- and subscripts in text]{eg:textsupsub}
In normal text you can typeset superscripts like H\textsuperscript{+} and 
subscripts like H\textsubscript{2}O without going into math mode.
\end{egresult}

\section{An array data structure}

   The class includes some macros for supporting the \Ie{patverse}
environment which may be more generally useful. 

\begin{syntax}
\cmd{\newarray}\marg{arrayname}\marg{low}\marg{high} \\
\end{syntax}
\glossary(newarray)%
  {\cs{newarray}\marg{arrayname}\marg{low}\marg{high}}%
  {Defines a new indexed array datastructure called \meta{arrayname}
  with the (integer) index ranging from \meta{low} to \meta{high}.}
 
\cmd{\newarray} defines
the \meta{arrayname} array, where \meta{arrayname} is a name like
\texttt{MyArray}. The lowest and highest array indices are set to
\meta{low} and \meta{high} respectively, where both are integer numbers.

\begin{syntax}
\cmd{\setarrayelement}\marg{arrayname}\marg{index}\marg{text} \\
\cmd{\getarrayelement}\marg{arrayname}\marg{index}\marg{result} \\
\end{syntax}
\glossary(setarrayelement)%
  {\cs{setarrayelement}\marg{arrayname}\marg{index}\marg{text}}%
  {Makes \meta{text} the contents of the \marg{index} location in 
   array \meta{arrayname}.}
\glossary(getarrayelement)%
  {\cs{getarrayelement}\marg{arrayname}\marg{index}\marg{result}}%
  {Sets the parameterless macro \meta{result} to the contents of 
   the \marg{index} location in array \meta{arrayname}.}

The \cmd{\setarrayelement} macro
sets the \meta{index} location in the \meta{arrayname} array to be 
\meta{text}. Conversely, \cmd{\getarrayelement} sets the parameterless
macro \meta{result} to the contents of
the \meta{index} location in the \meta{arrayname} array. 
For example: 
\begin{lcode}
\setarrayelement{MyArray}{23}{$2^{23}$}
\getarrayelement{MyArray}{23}{\result}
\end{lcode}
will result in \verb?\result? being defined as \verb?\def\result{$2^{23}$}?.

\begin{syntax}
\cmd{\checkarrayindex}\marg{arrayname}\marg{index} \\
\piif{ifbounderror} \\
\end{syntax}
\glossary(checkarrayindex)%
  {\cs{checkarrayindex}\marg{arrayname}\marg{index}}%
  {Checks if \meta{index} is a valid index value for the array 
   \meta{arrayname}. Sets \cs{ifbounderror} \ptrue\ if there is a problemn
   otherwise \pfalse.}
\cmd{\checkarrayindex} checks if
\meta{arrayname} is an array and if \meta{index} is a valid index for
the array. If both conditions hold then \piif{ifbounderror} is set
\pfalse, but if either \meta{arrayname} is not an array or, if it is,
\meta{index} is out of range then \piif{ifbounderror} is set \ptrue.

\begin{syntax}
\cmd{\stringtoarray}\marg{arrayname}\marg{string} \\
\cmd{\arraytostring}\marg{arrayname}\marg{result} \\
\end{syntax}
\glossary(stringtoarray)%
  {\cs{stringtoarray}\marg{arrayname}\marg{string}}%
  {Puts each character from \meta{string} sequentially into array 
   \meta{arrayname}, starting at index 1.}
\glossary(arraytostring)%
  {\cs{arraytostring}\marg{arrayname}\marg{result}}%
  {Defines the macro \meta{result} to be the sequence of characters
   in the array \meta{arrayname}.}
The macro \cmd{\stringtoarray} puts each character
from \meta{string} sequentially into the \meta{arrayname} array, starting
at index 1.
The macro \cmd{\arraytostring} assumes
that \meta{arrayname} is an array of characters, and defines the macro
\meta{result} to be that sequence of characters. For example: \\
\begin{lcode}
\stringtoarray{MyArray}{Chars}
\arraytostring{MyArray}{\MyString}
\end{lcode}
is equivalent to 
\begin{lcode}
\def\MyString{Chars}
\end{lcode}

\begin{syntax}
\cmd{\checkifinteger}\marg{num} \\
\piif{ifinteger} \\
\end{syntax}
\glossary(checkifinteger)%
  {\cs{checkifinteger}\marg{num}}%
  {If \meta{num} is an integer and not less than zero, sets \cs{ifinteger}
   \ptrue, otherwise \pfalse.}
The command \cmd{\checkifinteger} ckecks if \meta{num} is an integer 
(not less than zero). If it is then \piif{ifinteger} is set \ptrue, 
otherwise it is set \pfalse.
%
\begin{note}
  Please note that \cmd{\checkifinteger} may only work on simple input.
\end{note}


\section{Checking the processor}

\subsection{Checking for pdfLaTeX}

    Both \ltx\ and \pixpdfltx\ can be run on the same document. \ltx\ produces
a \file{.dvi} file as output, while \pixpdfltx\ can produce either a
\file{.dvi} or a \file{.pdf} file. 
    On modern systems \pixpdfltx\ produces a \file{pdf} file by default.

If you want a \file{dvi} file output use \ltx\ and if you want a
\file{pdf} file use \pdfltx.

\begin{syntax}
\piif{ifpdf} ... \verb?\fi? \\
\end{syntax}
The class provides \piif{ifpdf} (by autoloading the \Lpack{ifpdf}
package) which is \ptrue\ when the document is
being processed by \pixpdfltx\ and \pfalse\ otherwise. You can use it like this:
\begin{lcode}
\ifpdf
  code for pdfLaTeX only 
\else
  code for LaTeX only
\fi
\end{lcode}
If there is no \ltx\ specific code then don't write the \verb?\else? part.

\subsection{Checking for etex}

    Modern \ltx\ distributions use \pixetx, which is an extended version
of \tx, as the underlying engine. \pixetx\ provides some more primitives
than \tx, which may be useful, but not everybody has \pixetx\
available (Though, as of 2018, this is \emph{very} rare).

\begin{syntax}
\piif{ifetex} \\
\end{syntax}
\glossary(ifetex)%
{\cs{ifetex}}%
{\ptrue\ if \etx\ is the underlying engine, otherwise \pfalse.}
\piif{ifetex} can be used to determine if \pixetx\ is being used as
the underlying engine; it is analagous to \piif{ifpdf} which tests for
\pixpdfltx\ (provided by autoloading the \Lpack{ifetex} package). For
example:
\begin{lcode}
\ifetex
  %%% code only processible by etex
\else
  \typeout{etex is not available}
\fi
\end{lcode}


\subsection{Checking for XeTeX}

    You have been able to use \cs{ifpdf} to check if \pixpdfltx\ is being used 
to process the document.

\begin{syntax}
\piif{ifxetex} \\
\end{syntax}
\glossary(ifxetex)%
  {\cs{ifxetex}}%
  {\ptrue\ if \xetx\ is being used to process the document.}

In a similar manner you can use \piif{ifxetex} to check if the document
is being processed by \pixxetx\ (provided by autoloading the
\Lpack{ifxetex} package).

\begin{syntax}
\cmd{\RequireXeTeX} \\
\end{syntax}
\glossary(RequireXeTeX)%
{\cs{RequireXeTeX}}%
{Generates an error if the document is not being processed by \xetx.}
The \Lpack{ifxetex} package also provides \cmd{\RequireXeTeX}, which
generates an error if \pixxetx\ is not being used to process the
document. This can be useful if you make your own class building upon
\Lclass{memoir}.

\subsection{Checking for LuaTeX}
\label{sec:checking-lualatex}

Similarly you can use 
\begin{syntax}
\piif{ifluatex} \\
\end{syntax}
\glossary(ifluatex)%
  {\cs{ifluatex}}%
  {\ptrue\ if \luatx\ is being used to process the document.}
to check if the doc is being process by  \luatx.


\section{Leading}

    LaTeX automatically uses different leading\index{leading} for different
font sizes. 
\begin{syntax}
\lnc{\baselineskip} \lnc{\onelineskip} \\
\end{syntax}
\glossary(onelineskip)%
  {\ls{onelineskip}}%
  {Distance between baselines of the document's main font and size.}

At any point in a document the standard LaTeX \lnc{\baselineskip} length
contains the current value of the leading\footnote{This statement ignores
any attempts to stretch the baseline.}. The class provides the length
\lnc{\onelineskip} which contains the initial leading for the normal
font. This value is useful if you are wanting to specify length values
in terms of numbers of lines of text.

\section{Minor space adjustment}

    The kernel provides the \cmd{\,} macro for inserting a thin space in both
text and math mode. There are
other space adjustment commands, such as \pixabang\ for negative thin space, 
and \cmd{\:} and \cmd{\;} for medium
and thick spaces, which can only be used in math mode.

\begin{syntax}
\cmd{\thinspace} \cmd{\medspace} \cmd{\:} \pixabang \\
\end{syntax}
\glossary(thinspace)%
  {\cs{thinspace}}%
  {A thin space (3/18 em).}
\glossary(medspace)%
  {\cs{medspace}}%
  {A medium space (4/18 em).}
\glossary(:)%
  {\cs{:}}%
  {A medium space (4/18 em).}
\glossary(!)%
  {\cs{!}}%
  {A negative thin space (-3/18 em).}
On occasions I have found it useful to be able to tweak spaces in text by some
fixed amount, just as in math mode. The kernel macro \cmd{\thinspace}
specifies a thin space, which is 3/18\,em. 
The class \cmd{\medspace} specifies a medium space of 4/18\,em. 
As mentioned, the kernel macro \cmd{\:} inserts
a medium space in math mode. The class version can be used in both math and
text mode to insert a medium space. Similarly, the class version of 
\pixabang{}
can be used to insert a negative thin space in both text and math mode.

    The math thick space is 5/18\,em. 
To specify this amount of space
in text mode you can combine spacing commands as:
\begin{lcode}
\:\:\!
\end{lcode}
which will result in an overall space of 5/18\,em 
(from $(4 + 4 - 3)/18$).

\begin{comment}
\section{Cross references}\label{sec:xrefthis}  \label{sec:xref}

    LaTeX supplies the \cmd{\ref} and \cmd{\pageref} commands for cross
referencing to a label or a page which has a label on it.

\begin{syntax}
\cmd{\fref}\marg{label} \cmd{\figurerefname} \\
\cmd{\tref}\marg{label} \cmd{\tablerefname} \\
\cmd{\pref}\marg{label} \cmd{\pagerefname} \\
\end{syntax}
 
    The class provides these more particular named references to a figure\index{figure!reference},
table\index{table!reference} or page\index{page!reference}. For example the default definitions of \cmd{\fref} and 
\cmd{\pref} are
\begin{lcode}
\newcommand{\fref}[1]{\figurerefname~\ref{#1}}
\newcommand{\pref}[1]{\pagerefname~\pageref{#1}}
\end{lcode}
and can be used as 
\begin{lcode}
\ldots footnote parameters are shown in~\fref{fig:fn} on~\pref{fig:fn}.
\end{lcode}
which in this document prints as: 
\begin{syntax}
\ldots footnote parameters are shown in~\fref{fig:fn} on~\pref{fig:fn}. \\
\end{syntax}

\begin{syntax}
\cmd{\Pref}\marg{label} \cmd{\partrefname} \\
\cmd{\Cref}\marg{label} \cmd{\chapterrefname} \\
\cmd{\Sref}\marg{label} \cmd{\sectionrefname} \\
\end{syntax}

    Also provided are named references to labelled 
Part (\cmd{\Pref}), 
Chapter (\cmd{\Cref}) and 
sectional (\cmd{\Sref}) divisions.
These are all defined like
\begin{lcode}
\newcommand{\Sref}[1]{\sectionrefname\ref{#1}}
\end{lcode}
with no tie between the name and the \cmd{\ref}. 

    In this document
\begin{lcode}
`In \Cref{chap:misc} there is a section 
(\Sref{sec:xrefthis}) about cross references.' 
\end{lcode}
is typeset as: 
\begin{syntax}
`In \Cref{chap:misc} there is a section 
(\Sref{sec:xrefthis}) about cross references.' \\
\end{syntax}
 
    It can be useful to refer to parts of a document by name rather than
number, as in
\begin{lcode}
The chapter \textit{\titleref{chap:bringhurst}} describes \ldots
\end{lcode}
The chapter \textit{\titleref{chap:bringhurst}} describes \ldots

    There are two packages, \Lpack{nameref}~\cite{NAMEREF} and 
\Lpack{titleref}~\cite{TITLEREF},
 that let you refer to things by name instead of number.

    Name references were added to the class as a consequence of adding
a second optional argument to the sectioning commands. I found
that this broke the \Lpack{nameref} package, and hence the
\Lpack{hyperref} package as well, so they had to be fixed. The change 
also broke Donald Arseneau's \Lpack{titleref} package, and it turned out
that \Lpack{nameref} also clobbered \Lpack{titleref}. The class also
provides titles, like \cmd{\poemtitle}, that are not recognised by
either of the packages. From my viewpoint the most efficient
thing to do was to enable the class itself to provide name 
referencing.

\begin{syntax}
\cmd{\label}\marg{key} \cmd{\ref}\marg{key} \cmd{\pageref}\marg{key} \\
\cmd{\titleref}\marg{key} \\
\cmd{\headnamereftrue} \cmd{\headnamereffalse} \\
\end{syntax}
The macro \cmd{\titleref} is an addition to the usual set of cross referencing
commands. Instead of typesetting a number it typesets the title associated
with the labelled number. This is, of course, only useful if there is an
associated title, such as from a \cmd{\caption} or \cmd{\section} command.
As a bad example:
\begin{lcode}
Labelling for \verb?\titleref? may be applied to:
\begin{enumerate}
\item Chapters, sections, etc.       \label{sec:xref:item1}
...
\item Items in numbered lists, etc. \ldots \label{sec:xref:item3}
\end{enumerate}
Item \ref{sec:xref:item2} in section~\ref{sec:xref} mentions captions
while item \titleref{sec:xref:item3} in the same section 
\textit{\titleref{sec:xref}} lists other things.
\end{lcode}
Labelling for \verb?\titleref? may be applied to:
\begin{enumerate}
\item Chapters, sections, etc.       \label{sec:xref:item1}
\item Captions                       \label{sec:xref:item2}
\item Legends
\item Poem titles
\item Items in numbered lists, etc.  \label{sec:xref:item3}
\end{enumerate}
Item \ref{sec:xref:item2} in section~\ref{sec:xref} mentions captions
while item \titleref{sec:xref:item3} in the same section 
\textit{\titleref{sec:xref}} lists other things.


    As the above example shows, you have to be a little careful in using
\cmd{\titleref}.
Generally speaking, \cmd{\titleref}\marg{key} produces the last named 
thing before the \cmd{\label} that defines the \meta{key}. 

    Chapters, and the lower level sectional divisions, may have three
different title texts --- the main title, the title in the ToC, and a third
in the page header. By default (\cmd{\headnamereffalse}) the ToC title
is produced by \cmd{\titleref}. Following the declaration
\cmd{\headnamereftrue} the text intended for page headers will be produced.

\Note{} Specifically with the \Lclass{memoir} class, 
do not put a \cmd{\label} command inside an
argument to a \cmd{\chapter} or \cmd{\section} or \cmd{\caption}, etc.,
command. Most likely it will either be ignored or referencing it will
produce incorrect values. This restriction does not apply to the standard
classes, but in any case I think it is good practice not to embed any 
\cmd{\label} commands.

\begin{syntax}
\cmd{\currenttitle} \\
\end{syntax}
    If you just want to refer to the current title you can do so with
\cmd{\currenttitle}. This acts as though there had been a label associated
with the title and then \cmd{\titleref} had been used to refer to that label.
For example:
\begin{lcode}
This sentence in the section titled `\currenttitle' is an example of the
use of the command \verb?\currenttitle?.
\end{lcode}
This sentence in the section titled `\currenttitle' is an example of the
use of the command \verb?\currenttitle?.


\begin{syntax}
\cmd{\theTitleReference}\marg{num}\marg{text} \\
\end{syntax}
Both \cmd{\titleref} and \cmd{\currenttitle} use the \cmd{\theTitleReference}
to typeset the title. This is called with two arguments --- 
the number, \meta{num}, and the text, \meta{text}, of the title. The
default definition is:
\begin{lcode}
\newcommand{\theTitleReference}[2]{#2}
\end{lcode}
so that only the \meta{text} argument is printed. You could, for example,
change the definition to
\begin{lcode}
\renewcommand{\theTitleReference}[2]{#1\space \textit{#2}}
\end{lcode}
to print the number followed by the title in italics. If you do this, only use
\cmd{\titleref} for numbered titles, as a printed number for an 
unnumbered title (a) makes no sense, and (b) will in any case be 
incorrect.

    The commands \cmd{\titleref}, \cmd{\theTitleReference} and 
\cmd{\currenttitle} are direct equivalents of those in the \Lpack{titleref}
package~\cite{TITLEREF}.

\begin{syntax}
\cmd{\namerefon} \cmd{\namerefoff} \\
\end{syntax}
   Implementing name referencing has had an unfortunate side effect of
turning some arguments into moving ones; the argument to the \cmd{\legend}
command is one example. If you don't need name referencing you can turn
it off by the \cmd{\namerefoff} declaration; the \cmd{\namerefon}
declaration enables name referencing.

\end{comment}

\section{Adding a period}

    Much earlier, when showing the code for the sectional division styles
for this document, I used the macro \cmd{\addperiod}.

\begin{syntax}
\cmd{\addperiod}\marg{text} \\
\end{syntax}
This puts a period (a full stop) at the end of \meta{text}. I used it to
add a period at the end of the \cmd{\paragraph} and \cmd{\subparagaph} titles.
When sectional titles, like \cmd{\paragraph} are run-in, it is customary to
end them with a period (or occasionally a colon).



\section{Words and phrases}

    The class provides several macros that expand into English words or 
phrases. To typeset in another language these need to be changed, or an
author or publisher may want some changes made to the English versions. 
Table~\ref{tab:defwordsphrases} lists the macros, their default values, 
and where they used.
\begin{comment}
\begin{itemize}
\item[\cmd{\abstractname}]     \abstractname\ --- title for \Ie{abstract} environment
\item[\cmd{\alsoname}]         \alsoname\ --- used by \cmd{\seealso}
\item[\cmd{\amname}]           \amname\ --- used in printing time of day
\item[\cmd{\appendixname}]     \appendixname\--- name for an appendix heading
\item[\cmd{\appendixpagename}] \appendixpagename\ --- name for an \cmd{\appendixpage}
\item[\cmd{\appendixtocname}]  \appendixtocname\ --- ToC entry announcing appendices
\item[\cmd{\bibname}]          \bibname\ --- title for \cmd{\thebibliography} title
\item[\cmd{\bookname}]         \bookname\ --- name for \cmd{\book} heading
\item[\cmd{\bookrefname}]      \bookrefname\ --- used by \cmd{\Bref}
     (defined as \verb?\newcommand{\bookrefname}{Book~}?)

\item[\cmd{\chaptername}]      \chaptername\ --- name for \cmd{chapter} heading
\item[\cmd{\chapterrefname}]   \chapterrefname\ --- used by \cmd{\Cref}
     (defined as \verb?\newcommand{\chapterrefname}{Chapter~}?)
\item[\cmd{\contentsname}]     \contentsname\ --- title for \cmd{\tableofcontents}

\item[\cmd{\figurename}]       \figurename\ --- name for figure \cmd{\caption}
\item[\cmd{\figurerefname}]    \figurerefname\ --- used by \cmd{\fref}

\item[\cmd{\glossaryname}]     Glossary --- title for \cmd{\theglossary}

\item[\cmd{\indexname}]        \indexname\ --- title for \cmd{\theindex}

\item[\cmd{\lcminusname}]      \lcminusname\ --- used in named number formatting
\item[\cmd{\listfigurename}]   \listfigurename\ --- title for \cmd{\listoffigugres}
\item[\cmd{\listtablename}]    \listtablename\ --- title for \cmd{\listoftables}

\item[\cmd{\minusname}]        \minusname\ --- used in named number formatting

\item[\cmd{\namenumberand}]    \namenumberand\ --- used in named number formatting
\item[\cmd{\namenumbercomma}]  \namenumbercomma\ --- used in named number formatting
\item[\cmd{\notesname}]        \notesname\ --- title of \cmd{\notedivision}

\item[\cmd{\pagename}]         \pagename\ --- for your use
\item[\cmd{\pagerefname}]      \pagerefname\ --- used by \cmd{\pref}
\item[\cmd{\partname}]         \partname\ --- name for \cmd{\part} heading
\item[\cmd{\partrefname}]      \partrefname\ --- used by \cmd{\Pref}
     (defined as \verb?\newcommand{\partrefname}{Part~}?)
\item[\cmd{\pmnane}]           \pmname\ --- used in printing time of day

\item[\cmd{\sectionrefname}]   \sectionrefname\ --- used by \cmd{\Sref}
     (defined as \verb?\newcommand{\sectionrefname}{\S}?)
\item[\cmd{\seename}]          \seename\ --- used by \cmd{\see}

\item[\cmd{\tablename}]        \tablename\ --- name for table \cmd{\caption}
\item[\cmd{\tablerefname}]     \tablerefname\ --- used by \cmd{\tref}

\item[\cmd{\ucminusname}]      \ucminusname\ --- used in named number formatting

\end{itemize}
\end{comment}

\begin{table}
\centering
\caption{Defined words and phrases}\label{tab:defwordsphrases}
\begin{tabular}{lll}\toprule
Macro & Default & Usage \\ \midrule
\cmd{\abstractname}     & \abstractname\     & title for \Ie{abstract} environment \\
\cmd{\alsoname}         & \alsoname\         & used by \cmd{\seealso} \\
\cmd{\amname}           & \amname\           & used in printing time of day \\
\cmd{\appendixname}     & \appendixname\     & name for an appendix heading \\
\cmd{\appendixpagename} & \appendixpagename\ & name for an \cmd{\appendixpage} \\
\cmd{\appendixtocname}  & \appendixtocname\  & ToC entry announcing appendices \\
\cmd{\bibname}          & \bibname\          & title for \cmd{\thebibliography} \\
\cmd{\bookname}         & \bookname\         & name for \cmd{\book} heading \\
\cmd{\bookrefname}      & \bookrefname\      & used by \cmd{\Bref} \\
\cmd{\chaptername}      & \chaptername\      & name for \cmd{\chapter} heading \\
\cmd{\chapterrefname}   & \chapterrefname\   & used by \cmd{\Cref} \\
\cmd{\contentsname}     & \contentsname\     & title for \cmd{\tableofcontents} \\
\cmd{\figurename}       & \figurename\       & name for figure \cmd{\caption} \\
\cmd{\figurerefname}    & \figurerefname\    & used by \cmd{\fref} \\
\cmd{\glossaryname}     & Glossary           & title for \cmd{\theglossary} \\
\cmd{\indexname}        & \indexname\        & title for \cmd{\theindex} \\
\cmd{\lcminusname}      & \lcminusname\      & used in named number formatting \\
\cmd{\listfigurename}   & \listfigurename\   & title for \cmd{\listoffigugres} \\
\cmd{\listtablename}    & \listtablename\    & title for \cmd{\listoftables} \\
\cmd{\minusname}        & \minusname\        & used in named number formatting \\
\cmd{\namenumberand}    & \namenumberand\    & used in named number formatting \\
\cmd{\namenumbercomma}  & \namenumbercomma\  & used in named number formatting \\
\cmd{\notesname}        & \notesname\        & title of \cmd{\notedivision} \\
\cmd{\pagename}         & \pagename\         & for your use \\
\cmd{\pagerefname}      & \pagerefname\      & used by \cmd{\pref} \\
\cmd{\partname}         & \partname\         & name for \cmd{\part} heading \\
\cmd{\partrefname}      & \partrefname\      & used by \cmd{\Pref} \\
\cmd{\pmnane}           & \pmname\           & used in printing time of day \\
\cmd{\sectionrefname}   & \sectionrefname\   & used by \cmd{\Sref} \\
\cmd{\seename}          & \seename\          & used by \cmd{\see} \\
\cmd{\tablename}        & \tablename\        & name for table \cmd{\caption} \\
\cmd{\tablerefname}     & \tablerefname\     & used by \cmd{\tref} \\
\cmd{\ucminusname}      & \ucminusname\      & used in named number formatting \\
\bottomrule
\end{tabular}
\end{table}

Most, if not all, of the tabulated definitions are simple --- for example
\begin{lcode}
\newcommand*{\partname}{Part}
\newcommand*{\partrefname}{Part~}
\end{lcode} 
and so can be also changed simply.

 The definitions of the macros for the names of numbers are more complex 
--- for example for the number 11 (eleven) 
\begin{lcode}
\newcommand*{\nNamexi}{\iflowertonumname e\else E\fi leven}
\end{lcode}
That is, each definition includes both a lowercase and an uppercase initial
letter, so a bit more care has to be taken when changing these. For specifics
read the documentation of the class code.

\section{Symbols}

    LaTeX lets you typeset an enormous variety of symbols.\index{symbol}
The class adds
nothing to the standard LaTeX capabilities in this respect.
If you want to see what symbols are available then get a copy
of Scott Pakin's 
\textit{The Comprehensive LaTeX Symbol List}~\cite{SYMBOLS}.
You may have to do a little experimentation to get what you want, though.

    For example, the \cmd{\texttrademark} command 
produces the trademark\index{trademark} symbol\texttrademark,
but the \cmd{\textregistered} command produces\textregistered.
When I wanted to use the registered trademark\index{registered trademark}
 symbol it needed to be 
typeset like a superscript
instead of on the baseline. The \cmd{\textsuperscipt} macro typesets
its argument like a superscript\index{superscript}, so using
\begin{lcode}
\textsuperscript{\textregistered}
\end{lcode}
gave the required result\textsuperscript{\textregistered}.




\section{Two simple macros}

    There are two trivial macros that can be generally useful.
\begin{syntax}
\cmd{\memjustarg}\marg{text} \\
\cmd{\memgobble}\marg{text} \\
\end{syntax}
\glossary(memjustarg)%
  {\cs{memjustarg}\marg{text}}%
  {Definition is just \meta{text}. Do \emph{not} redefine it.}%
\glossary(memgobble)%
  {\cs{memgobble}\marg{text}}%
  {Gobbles its argument. Do \emph{not} redefine it.}%

    The \cmd{\memjustarg} macro just uses its argument and is defined as:
\begin{lcode}
\newcommand*{\memjustarg}[1]{#1}
\end{lcode}

  The \cmd{\memgobble} macro gobbles down and swallows its argument. 
Its definition is:
\begin{lcode}
\newcommand{\memgobble}[1]{}
\end{lcode}

    Do \emph{not} redefine either \cmd{\memjustarg} or \cmd{\memgobble}; if
you do various pieces of code will behave in unexpected ways that you
will not like.

\section{Vertical centering}

\indextwo{vertical}{centering}
    Earlier there was a description of a method for centering text vertically.
The \Ie{vplace} environment provides a simpler and more general way.
\begin{syntax}
\senv{vplace}\oarg{num} text \eenv{vplace} \\
\end{syntax}
\glossary(vplace)%
  {\senv{vplace}\oarg{num}}%
  {The contents of this environment are centered vertically. The optional
  \meta{num} argument can be used to specify the ratio of the upper space 
   to the lower space.}%

    The contents of the \Ie{vplace} environment are vertically centered. 
The optional \meta{num} argument can be used to specify the ratio of the 
upper space to the lower space. You can put other text on the page above
or below the centered text. The environment may be useful for 
title pages\index{title page}.

\section{For package writers}

    The facilities described in this section are for anyone to use but
I suspect that they may be most useful to package developers.

\subsection{Emulating packages}

\begin{syntax}
\cmd{\EmulatedPackage}\marg{package}\oarg{date} \\
\cmd{\EmulatedPackageWithOptions}\marg{optionlist}\marg{package}\oarg{date} \\
\end{syntax}
\glossary(EmulatedPackage)%
  {\cs{EmulatedPackage}\marg{package}\oarg{date}}%
  {Claim that the \meta{package} package has been loaded.}%
\glossary(EmulatedPackageWithOptions)%
  {\cs{EmulatedPackageWithOptions}\marg{optionlist}\marg{package}\oarg{date}}%
  {Claim that the \meta{package} package has been loaded with options
  \meta{optionlist}.}%
These commands are for package writers; they are based on a conversation with
Donald Arseneau\index{Arseneau, Donald} on \ctt. They fool \ltx\ into 
thinking that the \meta{package} has already been loaded so it won't
try loading it again. These are probably only useful if your
package includes the actual code for \meta{package}. 

\Mname\ does include code from several packages and uses
a similar internal command to ensure that the packages are not
loaded following some later \cmd{\usepackage} command. The names of the
emulated packages are written to the \pixfile{log} file. At the time
of writing the emulated packages are:
\Lpack{abstract}, \Lpack{appendix}, \Lpack{array}, \Lpack{booktabs}, 
\Lpack{ccaption}, \Lpack{chngcntr}, \Lpack{crop}, \Lpack{dcolumn}, 
\Lpack{delarray}, \Lpack{enumerate}, \Lpack{epigraph}, %%%%%% \Lpack{framed}, 
\Lpack{ifmtarg}, \Lpack{ifpdf}, \Lpack{index}, \Lpack{makeidx}, 
\Lpack{moreverb}, \Lpack{needspace}, \Lpack{newfile}, \Lpack{nextpage}, 
\Lpack{pagenote}, \Lpack{patchcmd}, \Lpack{parskip}, \Lpack{setspace}, \Lpack{shortvrb}, \Lpack{showidx}, 
\Lpack{tabularx}, \Lpack{titleref}, \Lpack{tocbibind}, \Lpack{tocloft}, 
\Lpack{verbatim}, 
and
\Lpack{verse}.
As well as the emulated packages \Mname\ provides functions 
equivalent to those in the following packages, although the class does not 
prevent you from using them:
\Lpack{fancyhdr}, \Lpack{framed}, \Lpack{geometry}, \Lpack{sidecap}, 
\Lpack{subfigure}, and \Lpack{titlesec}.


\begin{syntax}
\cmd{\DisemulatePackage}\marg{package} \\
\end{syntax}
\glossary(DisemulatePackage)%
  {\cs{DisemulatePackage}\marg{package}}%
  {Undo a previous \cs{EmulatedPackage} or \cs{EmulatedPackageWithOptions}
   for the \meta{package} package.}%
This command undoes any prior \cmd{\EmulatedPackage} or
\cmd{\EmulatedPackageWithOptions} for the \meta{package} package. For example,
if you wish to use the \Lpack{index} package instead of \Mname's
emulation then put
\begin{lcode}
\DisemulatePackage{index}
\usepackage{index}
\end{lcode}
in your preamble.



\subsection{Inserting code before and after a file, package or class}

    The kernel provides two commands, \cmd{\AtBeginDocument}
and \cmd{\AtEndDocument} which can only be used in the preamble, 
for inserting code at the start and end
of the \Ie{document} environment. 

    The kernel also provides the macros 
\cmd{\AtEndOfPackage}\marg{code} and \cmd{\AtEndOfClass}\marg{code}
 for inserting code at the end of the current package or class. More precisely,
these macros call the \meta{code} after the package or class file has been
input via \cmd{\InputIfFileExists}.

The class provides a more comprensive set of macros for code 
insertions, which should be used before the relevant file is called for.

\begin{syntax}
\cmd{\AtBeginFile}\marg{file}\marg{code} \\
\cmd{\AtEndFile}\marg{file}\marg{code} \\
\end{syntax}
\glossary(AtBeginFile)%
  {\cs{AtBeginFile}\marg{file}\marg{code}}%
  {Inserts \meta{code} just before the \meta{file} is input 
   (or included, etc.).}%
\glossary(AtEndFile)%
  {\cs{AtEndFile}\marg{file}\marg{code}}%
  {Inserts \meta{code} just after the \meta{file} is input 
   (or included, etc.).}%
The \cmd{\AtBeginFile} macro inserts \meta{code} just before the \meta{file}
file is \cmd{\input} (or \cmd{\include}d, etc.). Similarly
\cmd{\AtEndFile} inserts the \meta{code} immediately after the 
\meta{file}. The \meta{file} argument must be the same as used in the
corresponding \cmd{\input} command. If \meta{file} includes an 
extension, for example \texttt{fred.def}, then that is taken as 
the complete name, otherwise if there is no extension, 
for instance \texttt{fred}, then the \texttt{.tex} extension is 
automatically appended making the full name \texttt{fred.tex}.

    The \cs{At...File} commands 
must be issued \emph{before} the corresponding \meta{file} is input 
otherwise nothing will happen.

\begin{syntax}
\cmd{\AtBeginPackage}\marg{pack}\marg{code} \\
\cmd{\AtEndPackage}\marg{pack}\marg{code} \\
\cmd{\RequireAtEndPackage}\marg{pack}\marg{code} \\
\end{syntax}
\glossary(AtBeginPackage)%
  {\cs{AtBeginPackage}\marg{pack}\marg{code}}%
  {Inserts \meta{code} just before the \meta{pack} package is used.}%
\glossary(AtEndPackage)%
  {\cs{AtEndPackage}\marg{pack}\marg{code}}%
  {Inserts \meta{code} just after the \meta{pack} package is used.}%
\glossary(RequireAtEndPackage)%
  {\cs{RequireAtEndPackage}\marg{pack}\marg{code}}%
  {Inserts \meta{code} just after the \meta{pack} package is used,
  or immediately if \meta{pack} has already been used.}%
The \cmd{\AtBeginPackage} command will insert \meta{code} just before the 
\meta{pack} package is used. Similarly
\cmd{\AtEndPackage} will insert the \meta{code} immediately after the 
\meta{pack}. The \meta{pack} argument must be the same as used in the
corresponding \cmd{\usepackage} command, that is, without any 
extension. The \cs{At...Package} commands 
must be issued \emph{before} the corresponding \meta{pack} is used
otherwise nothing will happen.

    The \cmd{\RequireAtEndPackage} command will, 
like \cmd{\AtEndPackage}, insert \meta{code} 
at the end of the \meta{pack} package if it has not yet been used.
If the package has already been used then the \meta{code} is 
called immediately.


\begin{syntax}
\cmd{\AtBeginClass}\marg{class}\marg{code} \\
\cmd{\AtEndClass}\marg{class}\marg{code} \\
\cmd{\RequireAtEndClass}\marg{class}\marg{code} \\
\end{syntax}
\glossary(AtBeginClass)%
  {\cs{AtBeginClass}\marg{pack}\marg{code}}%
  {Inserts \meta{code} just before the \meta{class} class is used.}%
\glossary(AtEndClass)%
  {\cs{AtEndClass}\marg{class}\marg{code}}%
  {Inserts \meta{code} just after the \meta{class} class is used.}%
\glossary(RequireAtEndClass)%
  {\cs{RequireAtEndClass}\marg{class}\marg{code}}%
  {Inserts \meta{code} just after the \meta{class} class is used,
  or immediately if \meta{class} has already been used.}%
The \cmd{\AtBeginClass} command will insert \meta{code} just before the 
\meta{class} class is used. Similarly
\cmd{\AtEndClass} will insert the \meta{code} immediately after the 
\meta{class}. The \meta{class} argument must be the same as used in the
corresponding \cmd{\LoadClass} command, that is, without any 
extension. The \cs{At...Class} commands 
must be issued \emph{before} the corresponding \meta{class} is used
otherwise nothing will happen.

    The \cmd{\RequireAtEndClass} command will, 
like \cmd{\AtEndClass}, insert \meta{code} 
at the end of the \meta{class} class if it has not yet been used.
If the class has already been used then the \meta{code} is 
called immediately.

    There is an unfortunate interaction between the kernel's 
\cmd{\AtEndOfPackage} and the class's \cmd{\AtEndPackage}, and similarly
for the \cmd{\AtEndOfClass} and \cmd{\AtEndClass}. I discovered this when
I tried to automate using the \Lpack{memhfixc} package if \Lpack{hyperref}
was being used by putting the following into the \Pclass{memoir} code
\begin{lcode}
\AtEndPackage{hyperref}{\usepackage{memhfixc}}
\end{lcode}
which caused all sorts of problems.

    The kernel scheme looks like this:
\begin{lcode}
\newcommand{\usepackage}[1]{%
  ...
  \InputIfFileExists{#1}
<AtEndOfPackage code>}
\end{lcode}

    The basic mechanism for implementing the class macros is by modifying
the kernel's \cmd{\InputIfFileExists} macro, which internally uses a form of
\cs{input} to read in the file, so that the inserted \meta{code} comes 
immediately before and after the \cs{input}, somewhat like:
\begin{lcode}
\renewcommand{\InputIfFileExists}[1]{%
  ...
  <before code> \input{#1} <after code>}
\end{lcode}

    If \cmd{\AtEndPackage} is applied to a package that has an internal
\cmd{\AtEndOfPackage} then the result can be sketched as:
\begin{lcode}
\newcommand{\usepackage}[1]{%
  ...
  <before code>
  \input{#1}
  <after code>
  <AtEndOfPackage code>
}
\end{lcode}
In other words the body of the package is read in, the \cmd{\AtEndPackage} code
is called, and then \emph{after} that the \cmd{\AtEndOfPackage} code is called.

    The \Lpack{hyperref} package internally uses \cmd{\AtEndOfPackage} to read
some files and \Lpack{memhfixc} had to be input after these. A way to automate
\Lpack{memhfixc} after \Lpack{hyperref} is:
\begin{lcode}
\AtEndPackage{hyperref}{%
  \AtBeginDocument{\usepackage{memhfixc}}}
\end{lcode}
but this seems more trouble than it's worth especially since 
Heiko\index{Oberdiek, Heiko} Oberdiek has kindly updated \Lpack{hyperref} 
so that versions after 2006/11/15  will automatically load the 
\Lpack{memhfixc} package.



\renewcommand{\memsecinfo}[5]{\edef\Margi{#1}\edef\Margii{#2}%
                              \edef\Margiii{#3}\edef\Margiv{#4}%
                              \edef\Margv{#5}}
\section{Heading hooks}

    On 2nd September 2005 I posted two messages to the 
\texttt{comp.text.tex} newsgroup
saying that I was creating a new version of \Pclass{memoir} and
that I would consider inserting hooks into the class code
that package writers
might find useful. I got no requests for any hooks or anything
else from package writers. I therefore assume that no package
author sees any problems if a \Pclass{memoir} class document 
author uses the package.

    However, I have provided macros that may be useful for those 
who want to do things with the contents of section headings, 
captions, and the like. The macros are called within the 
relevant heading or caption code, and by default are defined 
to do nothing.

    Hooks for the \cmd{\book} and \cmd{\book*} commands.
\begin{syntax}
\cmd{\membookinfo}\marg{thebook}\marg{fortoc}\marg{title} \\
\cmd{\membookstarinfo}\marg{title} \\
\end{syntax}
\glossary(membookinfo)%
  {\cs{membookinfo}\marg{thebook}\marg{fortoc}\marg{title}}%
  {Code hook into \cs{book}}%
\glossary(membookstarinfo)%
  {\cs{membookstarinfo}\marg{title}}%
  {Code hook into \cs{book*}}%


    Hooks for the \cmd{\part} and \cmd{\part*} commands.
\begin{syntax}
\cmd{\mempartinfo}\marg{thepart}\marg{fortoc}\marg{title} \\
\cmd{\mempartstarinfo}\marg{title} \\
\end{syntax}
\glossary(mempartinfo)%
  {\cs{mempartinfo}\marg{thepart}\marg{fortoc}\marg{title}}%
  {Code hook into \cs{part}}%
\glossary(mempartstarinfo)%
  {\cs{mempartstarinfo}\marg{title}}%
  {Code hook into \cs{part*}}%

   In many cases a \verb?\mem...info? macro includes an argument
related to the heading's number (\meta{thepart} for \cmd{\mempartinfo}). In certain circumstances, such as a \cmd{\chapter} in the
\cmd{\frontmatter}, there might not be a number even though the
normal unstarred version of the command is used. In these cases
the number argument (\meta{thechapter} in the case of
\cmd{\memchapinfo}) is left empty.

Hooks for the \cmd{\chapter} and \cmd{\chapter*} commands. Note
that regular chapters and those as appendices are treated 
differently.
\begin{syntax}
\cmd{\memchapinfo}\marg{thechapter}\marg{fortoc}\marg{forhead}\marg{title} \\
\cmd{\memchapstarinfo}\marg{fortoc}\marg{title} \\
\cmd{\memappchapinfo}\marg{thechapter}\marg{fortoc}\marg{forhead}\marg{title} \\
\cmd{\memappchapstarinfo}\marg{fortoc}\marg{title} \\
\end{syntax}
\glossary(memchapinfo)%
  {\cs{memchapinfo}\marg{thechapter}\marg{fortoc}\marg{forhead}\marg{title}}%
  {Code hook into \cs{chapter}}%
\glossary(memchapstarinfo)%
  {\cs{memchapstarinfo}\marg{fortoc}\marg{title}}%
  {Code hook into \cs{chapter*}}%
\glossary(memappchapinfo)%
  {\cs{memappchapinfo}\marg{thechapter}\marg{fortoc}\marg{forhead}\marg{title}}%
  {Code hook into an appendix \cs{chapter}}%
\glossary(memappchapstarinfo)%
  {\cs{memappchapstarinfo}\marg{fortoc}\marg{title}}%
  {Code hook into an appendix \cs{chapter*}}%

Hooks for \cmd{\section}, \cmd{\subsection}, etc., and their
starred versions. \meta{name} is the type of section (e.g.,
\texttt{section}, or \texttt{subsection}, or 
\texttt{subsubsection} or \ldots
\begin{syntax}
\cmd{\memsecinfo}\marg{name}\marg{thename}\marg{fortoc}\marg{forhead}\marg{title} \\
\cmd{\memsecstarinfo}\marg{name}\marg{title} \\
\end{syntax}
\glossary(memsecinfo)%
  {\cs{memsecinfo}\marg{name}\marg{thename}\marg{fortoc}\marg{forhead}\marg{title}}%
  {Code hook into the \cs{name} section command}%
\glossary(memsecstarinfo)%
  {\cs{memsecstarinfo}\marg{name}\marg{title}}%
  {Code hook into the \cs{name*} section command}%

Hooks for appendix-like page headings.
\begin{syntax}
\cmd{\memapppageinfo}\marg{title} \\
\cmd{\memapppagestarinfo}\marg{title} \\
\cmd{\memleadpageinfo}\marg{pstyle}\marg{cmdname}\marg{title} \\
\cmd{\memleadpagestarinfo}\marg{pstyle}\marg{cmdname}\marg{title} \\
\end{syntax}
\glossary(memapppageinfo)%
  {\cs{memapppageinfo}\marg{title}}%
  {Code hook into \cs{appendixpage}.}%
\glossary(memapppagestarinfo)%
  {\cs{memapppagestarinfo}\marg{title}}%
  {Code hook into \cs{appendixpage*}.}%
\glossary(memleadpageinfo)%
  {\cs{memleadpageinfo}\marg{pstyle}\marg{cmdname}\marg{title}}%
  {Code hook into \cs{newleadpage} and \cs{renewleadpage}.}%
\glossary(memleadpagestarinfo)%
  {\cs{memleadpageinfo}\marg{pstyle}\marg{cmdname}\marg{title}}%
  {Code hook into \cs{newleadpage*} and \cs{renewleadpage*}.}%

Hooks for \cmd{\poemtitle}, \cmd{\PoemTitle}, and their 
starred versions.
\begin{syntax}
\cmd{\mempoeminfo}\marg{title} \\
\cmd{\mempoemstarinfo}\marg{title} \\
\cmd{\memPoemTitleinfo}\marg{thepoem}\marg{fortoc}\marg{forhead}\marg{title} \\
\cmd{\memPoemTitlestarinfo}\marg{fortoc}\marg{title} \\
\end{syntax}
\glossary(mempoeminfo)%
  {\cs{mempoeminfo}\marg{title}}%
  {Code hook into \cs{poemtitle}}%
\glossary(mempoemstarinfo)%
  {\cs{mempoemstarinfo}\marg{title}}%
  {Code hook into \cs{poemtitle*}}%
\glossary(memPoemTitleinfo)%
  {\cs{memPoemTitleinfo}\marg{thepoem}\marg{fortoc}\marg{forhead}\marg{title}}%
  {Code hook into \cs{PoemTitle}}%
\glossary(memPoemTitlestarinfo)%
  {\cs{memPoemTitlestarinfo}\marg{fortoc}\marg{title}}%
  {Code hook into \cs{PoemTitle*}}%

Hooks for the several kinds of \cmd{\caption} and \cmd{\legend}
commands.
\begin{syntax}
\cmd{\memcaptioninfo}\marg{type}\marg{thetype}\marg{fortoc}\marg{title} \\
\cmd{\memlegendinfo}\marg{title} \\
\cmd{\memnamedlegendinfo}\marg{fortoc}\marg{title} \\
\cmd{\membitwonumcaptioninfo}\marg{type}\marg{thetype}\marg{fortoc1}\marg{title1} \\
\hspace*{1.8in} \marg{name2}\marg{fortoc2}\marg{title2} \\
\cmd{\membionenumcaptioninfo}\marg{type}\marg{thetype}\marg{fortoc1}\marg{title1} \\ 
\hspace*{1.8in} \marg{name2}\marg{fortoc2}\marg{title2} \\
\cmd{\membicaptioninfo}\marg{type}\marg{thetype}\marg{fortoc1}\marg{title1}\marg{name2}\marg{title2} \\
\end{syntax}
\glossary(memcaptioninfo)%
  {\cs{memcaptioninfo}\marg{type}\marg{thetype}\marg{fortoc}\marg{title}}%
  {Code hook into \cs{caption}}%
\glossary(memlegendinfo)%
  {\cs{memlegendinfo}\marg{title}}%
  {Code hook into \cs{legend}}%
\glossary(memnamedlegendinfo)%
  {\cs{memnamedlegendinfo}\marg{fortoc}\marg{title}}%
  {Code hook into \cs{namedlegend}}%
\glossary(membitwonumcaptioninfo)%
  {\cs{membitwonumcaptioninfo}\marg{type} \marg{thetype} \marg{fortoc1} 
   \marg{title1} \marg{name2} \marg{fortoc2} \marg{title2}}%
  {Code hook into \cs{membitwonumcaption}.}%
\glossary(membionenumcaptioninfo)%
  {\cs{membionenumcaptioninfo}\marg{type} \marg{thetype} \marg{fortoc1}
   \marg{title1} \marg{name2} \marg{fortoc2} \marg{title2}}%
  {Code hook into \cs{membionenumcaption}.}%
\glossary(membicaptioninfo)%
  {\cs{membicaptioninfo}\marg{type} \marg{thetype} \marg{fortoc1} 
   \marg{title1} \marg{name2} \marg{title2}}%
  {Code hook into \cs{membicaption}.}%


    As an example of how one of these macros might be used, 
just before the start of this section I put
\begin{lcode}
\renewcommand{\memsecinfo}[5]{\edef\Margi{#1}\edef\Margii{#2}%
                              \edef\Margiii{#3}\edef\Margiv{#4}%
                              \edef\Margv{#5}}
\end{lcode}
and now I'm putting
\begin{lcode}
The arguments are: (1) `\Margi', (2) `\Margii', (3) `\Margiii', 
                   (4) `\Margiv', (5) `\Margv'.
\end{lcode}
The arguments are: (1) `\Margi', (2) `\Margii', (3) `\Margiii', 
                   (4) `\Margiv', (5) `\Margv'.

\LMnote{2010/07/01}{This is a large problem with subsubsection titles
  if the \cs{memsecinfo} above is used, added a warning, and made sure
  the test stops here.}
\fancybreak{}

\textbf{Warning:} Be very careful with the fifth argument of this
macro when using \Lpack{hyperref}, this argument will then contain a
hyper link anchor, whih may cause problems when used out of context.

\renewcommand\memsecinfo[5]{}
  
\section{Documenting \ltx\ commands}

    The class provides a few macros to help you if you want to describe
\ltx\ commands.

\begin{syntax}
\cmd{\bs} \cmd{\cs}\marg{name} \cmd{\cmdprint}\marg{cmd} \cmd{\cmd}\marg{cmd} \\
\end{syntax}
\glossary(bs)%
  {\cs{bs}}%
  {prints \bs.}
\glossary(cs)%
  {\cs{cs}\marg{name}}%
  {prints \cs{name}.}
\glossary(cmdprint)%
  {\cs{cmdprint}\marg{cmd}}%
  {where \meta{cmd} is a macro name like \cs{cmd}, prints \cs{cmd}.}
\glossary(cmd)%
  {\cs{cmd}\marg{cmd}}%
  {where \meta{cmd} is a macro name like \cs{cmd}, prints and indexes \cs{cmd}.}

The macro \cs{bs} simply prints the `\bs' backslash.

The macro \cs{cs} prints its argument, putting a backslash in front of it. For
example \verb?\cs{name}? prints \cs{name}.

The argument to \cs{cmdprint} should be the name of a macro, including the 
backslash. It is then printed as is. For instance \verb?\cmdprint{\amacro}?
prints \cmdprint{\amacro}.

The argument to \cs{cmd} should be the name of a macro, including the 
backslash. It is then printed, using \cs{cmdprint}, and also added to the 
index file with the assumption that \verb!?! will be used as the `actual' 
character (the default is \verb!@! which is not of much use if you are trying
to index macro names that have \verb!@! as part of their names).

\begin{syntax}
\cmd{\meta}\marg{arg} \cmd{\marg}\marg{arg} \cmd{\oarg}\marg{arg} \cmd{\parg}\marg{arg} \\
\end{syntax}
\glossary(meta)%
  {\cs{meta}\marg{arg}}%
  {prints \meta{arg}.}
\glossary(marg)%
  {\cs{marg}\marg{arg}}%
  {prints \marg{arg}.}
\glossary(oarg)%
  {\cs{oarg}\marg{arg}}%
  {prints \oarg{arg}.}
\glossary(parg)%
  {\cs{parg}\marg{arg}}%
  {prints \parg{arg}.}

The macro \cs{meta}\marg{arg} prints \meta{arg} for an argument to a macro.

The macro \cs{marg}\marg{arg} prints \marg{arg} for a required argument.

The macro \cs{oarg}\marg{arg} prints \oarg{arg} for an optional argument.

The macro \cs{parg}\marg{arg} prints \parg{arg} for a parenthesized argument.

\PWnote{2009/07/27}{Added chapter `For package users'}


%#% extend
%#% extstart include for-package-users.tex

\svnidlong
{$Ignore: $}
{$LastChangedDate: 2013-04-24 17:14:15 +0200 (Wed, 24 Apr 2013) $}
{$LastChangedRevision: 442 $}
{$LastChangedBy: daleif $}

\chapter{For package users} \label{chap:packageusers}

    Many packages work just as well with \Pclass{memoir} as with any of the
standard classes. In some instances, though, there may be a problem. In other
instances the class and package have been designed to work together but
you have to be careful about any code that you might write.

\section{Class/package name clash} \label{sec:nameclash}

    A typical indication of a problem is an error message saying that a 
command has already been defined\index{Command \cs{...} already defined ...} 
(see \pref{alreadydefined}).

    When the class and a package both use the same name for a macro that
they define something has to give. For the sake of an example, assume that
memoir has defined a macro called \cs{foo} and a package \Ppack{pack} 
that is used in the
document also defines \cs{foo}. There are several options that you can 
choose which might resolve the difficulty.

\begin{enumerate}

\item Just keep the class definition:
\begin{lcode}
\documentclass{...}
\let\classfoo\foo   % save the class' definition
\let\foo\relax      % `undefine' \foo
\usepackage{pack}   % defines \foo
\let\foo\classfoo   % restore \foo to the class definition
...
\foo...             % the class \foo
\end{lcode}

\item Just keep the package definition:
\begin{lcode}
\documentclass{...}
\let\foo\relax      % `undefine' \foo
\usepackage{pack}   % defines \foo
...
\foo...             % the package \foo
\end{lcode}

\item Keep the class definition and rename the package definition:
\begin{lcode}
\documentclass{...}
\let\classfoo\foo   % save the class' definition
\let\foo\relax      % `undefine' \foo
\usepackage{pack}   % defines \foo
\let\packfoo\foo    % rename pack's \foo 
\let\foo\classfoo   % restore \foo to the class definition
...
\foo...             % the class \foo
\packfoo            % the package \foo
\end{lcode}

\item Keep the package definition and rename the class definition:
\begin{lcode}
\documentclass{...}
\let\classfoo\foo   % save the class' definition
\let\foo\relax      % `undefine' \foo
\usepackage{pack}   % defines \foo
...
\foo...             % the package \foo
\classfoo...        % the class \foo
\end{lcode}

\end{enumerate}

    A potential problem with these options can occur after the package is
loaded and there are class or package commands that you use that, 
knowingly or not, 
call \cs{foo} expecting to get the class or the package definition, one of
which is now not available (except under a different name).

    The \Ppack{memoir} class has been available since 2001. It seems likely
that if older packages clash with \Ppack{memoir} then, as eight years have
gone by, the authors are unlikely to do anything about it. If a newer 
package clashes then contact the author of the package. 

    If all else fails, ask for help on the \pixctt\ newsgroup.

\section{Support for bididirectional typesetting}

    The \Lpack{bidi} system~\cite{BIDI} provides means of bidirectional 
typesetting. The class has built in support for \Lpack{bidi} but this means 
that if you are defining your own macros there are some things you need 
to be aware of.

    When dealing with bidirectional texts the left-to-right\index{LTR} 
(LTR) direction
is the familiar one and \ltx\ is set up for this. When typesetting
right-to-left (RTL)\index{RTL} \Lpack{bidi} interchanges left and right. 
The support in \Ppack{memoir} consists of replacing many, but not all, of 
the right- and left-specific constructs. The replacement macros are:

\begin{syntax}
\cmd{\memRTLleftskip} \cmd{\memRTLrightskip} \\
\cmd{\memRTLvleftskip} \cmd{\memRTLvrightskip} \\
\cmd{\memRTLraggedright} \cmd{\memRTLraggedleft} \\
\end{syntax}
\glossary(memRTLleftskip)%
  {\cs{memRTLleftskip}}%
  {RTL (bidi) replacement for \cs{leftskip}}
\glossary(memRTLrightskip)%
  {\cs{memRTLrightskip}}%
  {RTL (bidi) replacement for \cs{rightskip}}
\glossary(memRTLvleftskip)%
  {\cs{memRTLvleftskip}}%
  {RTL (bidi) replacement for \cs{vleftskip}}
\glossary(memRTLrightskip)%
  {\cs{memRTLvrightskip}}%
  {RTL (bidi) replacement for \cs{vrightskip}}
\glossary(memRTLraggedleft)%
  {\cs{memRTLraggedleft}}%
  {RTL (bidi) replacement for \cs{raggedleft}}
\glossary(memRTLraggedright)%
  {\cs{memRTLraggedright}}%
  {RTL (bidi) replacement for \cs{raggedright}}

    In certain places, but not everywhere: \\
\cmd{\memRTLleftskip} is used instead of \cmd{\leftskip} \\
\cmd{\memRTLrightskip} is used instead of \cmd{\rightskip} \\
\cmd{\memRTLvleftskip} is used instead of \cmd{\vleftskip} \\
\cmd{\memRTLvrightskip} is used instead of \cmd{\vrightskip} \\
\cmd{\memRTLraggedleft} is used instead of \cmd{\raggedleft} \\
\cmd{\memRTLraggedright} is used instead of \cmd{\raggedright} \\

    So, if you are defining any macros that use the \cs{...skip} or
\cs{ragged...} macros you may have to use the \cs{memRTL...} version
instead. The \Ppack{memoir} definitions of these macros are simply:
\begin{lcode}
\newcommand*{\memRTLleftskip}{\leftskip}
\newcommand*{\memRTLrightskip}{\rightskip}
...
\newcommand*{\memRTLraggedleft}{\raggedleft}
\end{lcode}
The \Lpack{bidi} system redefines them to suit its purposes. If your
work will only be set LTR there is no need to use the \cs{memRTL...}
macros in any of your code. If you might ever be producing a bidirectional
document then you may have to use the \cs{memRTL...} versions of the standard
commands in your code. To determine where you might have to use them
you will have to consult the \Lpack{bidi} documentation as not every use
of the standard commands needs to be replaced. 




%#% extend
%#% extstart include an-example-book-design.tex

\svnidlong
{$Ignore: $}
{$LastChangedDate: 2013-04-24 17:14:15 +0200 (Wed, 24 Apr 2013) $}
{$LastChangedRevision: 442 $}
{$LastChangedBy: daleif $}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\LMnote{2010/07/01}{This belongs here}
\clearpage

\makeatletter
\begin{comment}
%% Bringhurst chapter style
\makechapterstyle{bringhurst}{%
  \renewcommand{\chapterheadstart}{}
  \renewcommand{\printchaptername}{}
  \renewcommand{\chapternamenum}{}
  \renewcommand{\printchapternum}{}
  \renewcommand{\afterchapternum}{}
  \renewcommand{\printchaptertitle}[1]{%
    \raggedright\Large\scshape\MakeLowercase{##1}}
  \renewcommand{\afterchaptertitle}{%
    \vskip\onelineskip \hrule\vskip\onelineskip}
}
\end{comment}

\setsecheadstyle{\raggedright\scshape\MakeLowercase}
  \setbeforesecskip{-\onelineskip}
  \setaftersecskip{\onelineskip}

%%\setsubsecheadstyle{\renewcommand\@hangfrom[1]{\noindent ##1}\raggedright\itshape}
\setsubsecheadstyle{\sethangfrom{\noindent ##1}\raggedright\itshape}
  \setbeforesubsecskip{-\onelineskip}
  \setaftersubsecskip{\onelineskip}

%% Bringhurst page style
\makepagestyle{bringhurst}
\makeevenfoot{bringhurst}{\thepage}{}{}
\makeoddfoot{bringhurst}{}{}{\thepage}
\setlength{\pwlayi}{\headsep} % \verb?\setlength{\pwlayi}{\headsep}? headsep=\printlength{\headsep}, pwlayi = \printlength{\pwlayi}.
\addtolength{\pwlayi}{\topskip} % \verb?\addtolength{\pwlayi}{\topskip}? topskip=\printlength{\topskip}, pwlayi=\printlength{\pwlayi}.
\addtolength{\pwlayi}{7.3\onelineskip} % \verb?\addtolength{\pwlayi}{7.3\onelineskip}? onelineskip=\printlength{\onelineskip}, pwlayi=\printlength{\pwlayi}.
\newcommand{\bringpicr}[1]{%
  \setlength{\unitlength}{1pt}
  \begin{picture}(0,0)
    \put(\strip@pt\marginparsep, -\strip@pt\pwlayi){%
      \begin{minipage}[t]{\marginparwidth}
         \raggedright\itshape #1
      \end{minipage}}
  \end{picture}
}

\setlength{\pwlayii}{\marginparsep} % \verb?\setlength{\pwlayii}{\marginparsep}? marginparsep=\printlength{\marginparsep}, pwlayii=\printlength{\pwlayii}.
\addtolength{\pwlayii}{\marginparwidth} % \verb?\addtolength{\pwlayii}{\marginparwidth}?  marginparwidth=\printlength{\marginparwidth}, pwlayii=\printlength{\pwlayii}.
\newcommand{\bringpicl}[1]{%
  \setlength{\unitlength}{1pt}
  \begin{picture}(0,0)
    \put(-\strip@pt\pwlayii, -\strip@pt\pwlayi){%
      \begin{minipage}[t]{\marginparwidth}
        \raggedleft\itshape #1
      \end{minipage}}
  \end{picture}
}

\makepsmarks{bringhurst}{%
  \def\chaptermark##1{\markboth{##1}{##1}}
  \def\sectionmark##1{\markright{##1}}
}
\makeevenhead{bringhurst}{\bringpicl{\rightmark}}{}{}
\makeoddhead{bringhurst}{}{}{\bringpicr{\leftmark}}


\renewcommand{\cftchapterfont}{\normalfont}
\renewcommand{\cftchapterpagefont}{\normalfont}
\renewcommand{\cftchapterpresnum}{\bfseries}
\renewcommand{\cftchapterleader}{}
\renewcommand{\cftchapterafterpnum}{\cftparfillskip}
%%%\settocdepth{chapter}

\makeatother


\cleardoublepage
\pagestyle{bringhurst}
%%%\chapterstyle{bringhurst}
\headstyles{bringhurst}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\PWnote{2009/07/05}{Added `book' to example design chapter title}
\chapter{An example book design} \label{chap:bringhurst}
 
%unitlength=\printlength{\unitlength}, \\
%pwlayi=\printlength{\pwlayi}, \\
%pwlayii=\printlength{\pwlayii}.

\section{Introduction}

    In this chapter I will work through a reasonably complete design
exercise. Rather than trying to invent something myself I am taking the design
of Bringhurst's 
\textit{The Elements of Typographic Style}~\cite{BRINGHURST99}
as the basis of the
exercise. This is sufficiently different from the normal LaTeX appearance
to demonstrate most of the class capabilities, and also it is a design by
a leading proponent of good typography.

    As much as possible, this chapter is typeset according to the results
of the exercise to provide both a coding and a graphic example.

\section{Design requirements}

    The \textit{Elements of Typographic Style} is typeset using 
Minion\facesubseeidx{Minion} as the text font and Syntax\facesubseeidx{Syntax} 
(a sans font) 
for the captions. 
%The page layout has been
%shown diagramatically in \fref{fb:1} on \pref{fb:1}, but further details need
%to be described for those not fortunate enough to have a copy of their own.

    The trimmed page size is 23 by 13.3cm. The foredge is 3.1cm and the
top margin\index{margin!upper} is 1.9cm.

    As already noted, the font for the main text is Minion\index{Minion}, 
with 12pt leading
on a 21pc measure with 42 lines per page. For the purposes of this exercise
I will assume that Minion can be replaced by the font used for this
manual. The captions to figures\index{figure} and tables\index{table} are 
unnamed and 
unnumbered and typeset in Syntax\index{Syntax}. The captions give the 
appearance of being
in a smaller font size than the main text, which is often the case. I'll
assume that the \cmd{\small}\cmd{\sfseries} font will reasonably do for the
captions. 

    The footer\index{footer} is the same width as the 
typeblock\index{typeblock} and the folio\index{folio} is placed 
in the footer\index{footer} at the \foredge. There are two blank lines between 
the bottom of the typeblock\index{typeblock} and the folio\index{folio}.

    There is no header\index{header} in the usually accepted sense of the 
term but the chapter title is put on recto pages and section titles are on 
verso pages. The running titles are placed in the \foredge\ 
margin\index{margin!foredge?\foredge} 
level with the seventh line of the text in the typeblock\index{typeblock}. 
The recto headers\index{header} are typeset raggedright
and the verso ones raggedleft.

Bringhurst also uses many marginal\index{marginalia} notes,
their maximum width being about 51pt, and typeset raggedright in a smaller
version of the textfont.

    Chapter titles are in small caps, lowercase, in a larger font than for 
the main text, and a rule is placed between the title and the 
typeblock\index{typeblock}. The total vertical space used by a chapter 
title is three text lines. Chapters are not numbered in the text but are 
in the \toc.

    Section titles are again in small caps, lowercase, in the same size as the
text font. The titles are numbered, with both the chapter and section number.

    A subsection title, which is the lowest subdivision in the book, is in
the italic form of the textfont and is typeset as a numbered non-indented
paragraph\index{paragraph}. These are usually multiline as Bringhurst 
sometimes uses them like an enumerated list, so on occasion there is a 
subsection title with no following text.

    Only chapter titles are put into the \toc, and these are set raggedright 
with the page numbers immediately after the titles. There is no \lof\ or
\lot.

    Note that unlike the normal \ltx\ use of fonts, essentially only three
sizes of fonts are used --- the textfont size, one a bit larger for the
chapter titles, and one a bit smaller for marginal\index{marginalia} notes 
and captions. Also, bold fonts are not used except on special occasions, 
such as when he is comparing font families and uses large bold
versions to make the differences easier to see.

\section{Specifying the page and typeblock}

    The first and second things to do are to specify the sizes of the page
after trimming and the typeblock\index{typeblock}. The trimmed size is 
easy as we have the dimensions.
\begin{lcode}
\settrimmedsize{23cm}{13.3cm}{*}
\end{lcode}
We want 42 lines of text, so that's what we set as the height of the 
typeblock\index{typeblock}; however, we have to remember to ask for 
\texttt{lines} as the optional \meta{algorithm} argument when we 
finally call \cmd{\checkandfixthelayout}.
\begin{lcode}
\settypeblocksize{42\onelineskip}{21pc}{*}
\end{lcode}

    To make life easier, we'll do no trimming of the top of the 
stock\index{stock}
\begin{lcode}
\setlength{\trimtop}{0pt}
\end{lcode}
but will trim the \foredge. The next set of calculations first sets the 
value of the \lnc{\trimedge} to be the \lnc{\stockwidth}; subtracting the
trimmed \lnc{\paperwidth} then results in \lnc{\trimedge} being the amount
to trim off the foredge.
\begin{lcode}
\setlength{\trimedge}{\stockwidth}
\addtolength{\trimedge}{-\paperwidth}
\end{lcode}

    The sizes of the trimmed page and the typeblock\index{typeblock} have 
now been specified. The typeblock\index{typeblock} is now positioned on 
the page. The sideways positioning is
easy as we know the \foredge\ margin\index{margin!foredge!\foredge} 
to be 3.1cm.
\begin{lcode}
\setlrmargins{*}{3.1cm}{*}
\end{lcode}
The top margin\index{margin!top} is specified as 1.9cm, which is very 
close to 
four and a half lines of text. Just in case someone might want to use a 
different font size, I'll specify the top margin\index{margin!top} 
so that it 
is dependent on the font size. The
\lnc{\footskip} can be specified now as well (it doesn't particularly matter
what we do about the header-related lengths as there isn't anything above
the typeblock\index{typeblock}).
\begin{lcode}
\setulmargins{4.5\onelineskip}{*}{*}
\setheadfoot{\onelineskip}{3\onelineskip}
\setheaderspaces{\onelineskip}{*}{*}
\end{lcode}

    Lastly define the dimensions for any marginal\index{marginalia} notes.
\begin{lcode}
\setmarginnotes{17pt}{51pt}{\onelineskip}
\end{lcode}

    If this was for real, the page layout would have to be checked and
implemented.
\begin{lcode}
\checkandfixthelayout[lines]
\end{lcode}

    It is possible to implement this layout just for this chapter but
I'm not going to tell you either how to do it, or demonstrate it. Except
under exceptional circumstances it is not good to make such drastic changes
to the page layout in the middle of a document. However, the picture on
\pref{fig:bplayout} illustrates
how this layout would look on US letterpaper\index{paper!size!letterpaper} 
stock\index{stock}. Looking at the illustration suggests that the layout 
would look rather odd unless the stock\index{stock} was trimmed down
to the page size --- another reason for not switching the layout here.

\begin{figure}
\captiontitlefont{\small\sffamily}
\captionstyle{\centerlastline}
\setstocksize{11in}{8.5in}
\settrimmedsize{23cm}{13.3cm}{*}
\settypeblocksize{41\onelineskip}{21pc}{*}
\setlength{\trimtop}{0pt}
\setlength{\trimedge}{\stockwidth}
\addtolength{\trimedge}{-\paperwidth}
\setlrmargins{*}{3.1cm}{*}
\setulmargins{4.5\onelineskip}{*}{*}
\setheadfoot{\onelineskip}{3\onelineskip}
\setheaderspaces{\onelineskip}{*}{*}
\setmarginnotes{17pt}{51pt}{\onelineskip}
\checkandfixthelayout
\currentstock
\oddpagelayouttrue
\twocolumnlayoutfalse
\drawmarginparstrue
\drawparametersfalse
\drawstock
\legend{An illustration of Bringhurst's page layout style when printed
on US letter paper stock. Also shown are the values used for the
page layout parameters for this design.} \label{fig:bplayout}
\end{figure}

\section{Specifying the sectional titling styles}

\subsection{The chapter style}

    Recapping, chapter titles are in small caps, lowercase, in a larger 
font than for the main text, and a rule is placed between the title and the 
typeblock\index{typeblock}.
The total vertical space used by a chapter title is three text lines.
Chapters are not numbered in the text but are in the \toc.
Titles in the \toc\ are in mixed case.

    The definition of the chapterstyle is remarkably simple, as shown below.
\begin{lcode}
%% Bringhurst chapter style
\makechapterstyle{bringhurst}{%
  \renewcommand{\chapterheadstart}{}
  \renewcommand{\printchaptername}{}
  \renewcommand{\chapternamenum}{}
  \renewcommand{\printchapternum}{}
  \renewcommand{\afterchapternum}{}
  \renewcommand{\printchaptertitle}[1]{%
    \raggedright\Large\scshape\MakeLowercase{##1}}
  \renewcommand{\afterchaptertitle}{%
    \vskip\onelineskip \hrule\vskip\onelineskip}
}
\end{lcode}

    Most of the specification consists of nulling the majority of the normal
LaTeX specification, and modifying just two elements. 

The chapter title (via \cmd{\printchaptertitle}) 
is typeset raggedright using the \cmd{\Large} smallcaps fonts. The 
\cmd{\MakeLowercase} macro is used to ensure that the entire title is 
lowercase before typesetting it. Titles are input in mixed case.

    After the title is typeset the \cmd{\afterchaptertitle} macro
specifies that one line is skipped, a horizontal rule
is drawn and then another line is skipped.

\subsection{Lower level divisions}

    Section titles are in small caps, lowercase, in the same size as the
text font. The titles are numbered, with both the chapter and section number.

The specification is:
\begin{lcode}
\setsecheadstyle{\raggedright\scshape\MakeLowercase}
  \setbeforesecskip{-\onelineskip}
  \setaftersecskip{\onelineskip}
\end{lcode}

    The macro \cmd{\setsecheadstyle} lowercases the title and typesets it
small caps. 

The default skips before and after titles are rubber lengths but this does
not bode well if we are trying to line something up with a particular line
of text --- the presence of section titles may make slight vertical 
adjustments to the text lines because of the flexible spacing. So, we have
to try and have fixed spacings.
A single blank line is used before (\cmd{\setbeforesecskip)}
and after (\cmd{\setaftersecskip}) the title text. 

    A subsection title, which is the lowest subdivision in the book, is in
the italic form of the textfont and is typeset as a numbered non-indented
paragraph\index{paragraph}. The code for this is below.

\begin{lcode}
\setsubsecheadstyle{\sethangfrom{\noindent ##1}\raggedright\itshape}
  \setbeforesubsecskip{-\onelineskip}
  \setaftersubsecskip{\onelineskip}
\end{lcode}

    As in the redefinition of the \cmd{\section} style, there are fixed
spaces before and after the title text. The title is typeset 
(\cmd{\setsubsecheadstyle}) raggedright in a normal sized italic font.
The macro \cmd{\sethangfrom} is used to to redefine the internal
\cmd{\@hangfrom} macro so that the title and number are typeset as a block 
paragraph\index{paragraph!block} instead of the default hanging 
paragraph\index{paragraph!hanging} style. Note the use of
the double \verb?##? mark for denoting the position of the argument to 
\cmd{\@hangfrom}.

\section{Specifying the pagestyle}

    The pagestyle is perhaps the most interesting aspect of the exercise.
Instead of the chapter and section titles being put at the top of the
pages they are put in the margin\index{margin} starting about seven lines 
below the top of the typeblock\index{typeblock}. The folios\index{folio} 
are put at the bottom of the page aligned with the outside of the 
typeblock\index{typeblock}.

    As the folios\index{folio} are easy, we'll deal with those first.
\begin{lcode}
%% Bringhurst page style
\makepagestyle{bringhurst}
\makeevenfoot{bringhurst}{\thepage}{}{}
\makeoddfoot{bringhurst}{}{}{\thepage}
\end{lcode}

    Putting text at a fixed point on a page is typically done by
first putting the text into a zero width picture (which as far as LaTeX
is concerned takes up zero space) and then placing the picture at the
required point on the page. This can be done by hanging it from the
header\index{header}.

    We might as well treat the titles so that they will align with any 
marginal\index{marginalia} notes, which are \lnc{\marginparsep} (17pt) 
into the margin\index{margin} 
and \lnc{\marginparwidth} (51pt) wide. Earlier in the manual I defined
two lengths called \lnc{\pwlayi} and \lnc{\pwlayii} which are no longer used.
I will use these as scratch lengths in 
performing some of the necessary calculations.

    For the recto page headers\index{header} the picture will be 
the \meta{right} part of the header\index{header} and for the verso pages 
the picture will be the \meta{left}
part of the header\index{header}, all other parts being empty. 

    For the picture on the \meta{right} the text must be 17pt to
the right of the origin, and some distance below the origin.
From some experiments, this distance turns out to be the \lnc{\headsep}
plus the \cmd{\topskip} plus 7.3 lines, which is calculated as follows:
\begin{lcode}
\setlength{\pwlayi}{\headsep}
\addtolength{\pwlayi}{\topskip}
\addtolength{\pwlayi}{7.3\onelineskip}
\end{lcode}

    There is a nifty internal LaTeX macro called \cmd{\strip@pt} which you
probably haven't heard about, and I have only recently come across. What it
does is strip the `pt' from a following length, reducing it to a plain 
real number. Remembering that the default \lnc{\unitlength} is 1pt we can
do the following, while making sure that the current \lnc{\unitlength}
\emph{is} 1pt:
\begin{lcode}
\makeatletter
\newcommand{\bringpicr}[1]{%
  \setlength{\unitlength}{1pt}
  \begin{picture}(0,0)
    \put(\strip@pt\marginparsep, -\strip@pt\pwlayi){%
      \begin{minipage}[t]{\marginparwidth}
        \raggedright\itshape #1
      \end{minipage}}
  \end{picture}
}
\makeatother
\end{lcode}
The new macro \cmd{\bringpicr}\marg{text} puts \meta{text} 
into a \Ie{minipage} of width \lnc{\marginparwidth}, 
typeset raggedright in an italic font, and puts the top
left of the minipage at the position (\lnc{\marginparsep}, -\lnc{\pwlayi}) 
in a zero width picture.

    We need a different picture for the \meta{left} as the text needs to be
typeset raggedleft with the right of the text 17pt from the left of the
typeblock\index{typeblock}. I will use the length \lnc{\pwlayii} 
to calculate the sum of \lnc{\marginparsep}
and \lnc{\marginparwidth}. Hence:
\begin{lcode}
\makeatletter
\setlength{\pwlayii}{\marginparsep}
\addtolength{\pwlayii}{\marginparwidth}
\newcommand{\bringpicl}[1]{%
  \setlength{\unitlength}{1pt}
  \begin{picture}(0,0)
    \put(-\strip@pt\pwlayii, -\strip@pt\pwlayi){%
      \begin{minipage}[t]{\marginparwidth}
        \raggedleft\itshape #1
      \end{minipage}}
  \end{picture}
}
\makeatother
\end{lcode}
The new macro \cmd{\bringpicl}\marg{text} puts \meta{text} 
into a \Ie{minipage} of width \lnc{\marginparwidth}, 
typeset raggedleft in an italic font, and puts the top
left of the minipage at the position 
(-(\lnc{\marginparsep} + \lnc{\marginparwidth}), -\lnc{\pwlayi}) 
in a zero width picture.


    Now we can proceed with the remainder of the pagestyle specification.
The next bit puts the chapter and section titles into the \verb?\...mark? 
macros.
\begin{lcode}
\makeatletter
\makepsmarks{bringhurst}{%
  \def\chaptermark##1{\markboth{##1}{##1}}
  \def\sectionmark##1{\markright{##1}}
}
\makeatother
\end{lcode}

    Finally, specify the evenhead using \cmd{\bringpicl} with the section
title as its argument, and the oddhead using \cmd{\bringpicr} with the
chapter title as its argument.
\begin{lcode}
\makeevenhead{bringhurst}{\bringpicl{\rightmark}}{}{}
\makeoddhead{bringhurst}{}{}{\bringpicr{\leftmark}}
\end{lcode}


\section{Captions and the \prtoc}

    The captions to figures\index{figure} and tables\index{table} are set 
in a small sans font and are neither named nor numbered, and there is no 
\lof\ or \lot. Setting the caption titles in the desired font is simple:
\begin{lcode}
\captiontitlefont{\small\sffamily}
\end{lcode}

    There are two options regarding table\index{table} and figure\index{figure}
captioning: either
use the \cmd{\legend} command (which produces an anonymous unnumbered title)
instead of the \cmd{\caption} command, or
use the \cmd{\caption} command with a modified definition. Just in case
the design might change at a later date to required numbered captions, 
it's probably best to use 
a modified version of \cmd{\caption}. In this case this is simple, just give
the \cmd{\caption} command the same definition as the \cmd{\legend} command.
\begin{lcode}
\let\caption\legend
\end{lcode}

    An aside: I initially used the default caption style (block paragraph) for
the diagram on \pref{fig:bplayout}, but this looked unbalanced so now it
has the last line centered. As a float\index{float} environment, 
like any other environment, forms a group, you can make local changes within 
the float\index{float}. I actually did it like this:
\begin{lcode}
\begin{figure}
\captiontitlefont{\small\sffamily}
\captionstyle{\centerlastline}
...
\legend{...} \label{...}
\end{figure} 
\end{lcode}
For fine typesetting you may wish to change the style of particular captions.
The default style for a single line caption works well, but for a caption with
two or three lines either the \texttt{centering} or \texttt{centerlastline}
style might look better. A very long caption is again probably best done in 
a block paragraph style.

    Only chapter titles are included in the \toc. To specify this we
use the \cmd{\settocdepth} command.
\begin{lcode}
\settocdepth{chapter}
\end{lcode}

    The \toc\ is typeset raggedright with no leaders and the page numbers 
coming immediately after the chapter title. This is specified via:
\begin{lcode}
\renewcommand{\cftchapterfont}{\normalfont}
\renewcommand{\cftchapterpagefont}{\normalfont}
\renewcommand{\cftchapterpresnum}{\bfseries}
\renewcommand{\cftchapterleader}{}
\renewcommand{\cftchapterafterpnum}{\cftparfillskip}
\end{lcode}

\section{Preamble or package?}


    When making changes to the document style, or just defining a new
macro or two, there is the question of where to put the changes --- in
the preamble\index{preamble} of the particular document or into a separate 
package\index{package}?

    If the same changes/macros are likely to be used in more than one
document then I suggest that they be put into a package. 
If just for the single document then the choice remains open.

    I have presented the code in this chapter as though it would be  put
into the preamble\index{preamble}, hence the use of \cmd{\makeatletter} and 
\cmd{\makeatother} to surround macros that include the 
\texttt{@}\idxatincode\ character (\seeatincode). The
code could just as easily be put into a package\index{package} called, say, 
\Lpack{bringhurst}. That is, by putting all the code, except for the
\cmd{\makeatletter} and \cmd{\makeatother} commands, into a file called
\file{bringhurst.sty}. It is a good idea also to end the code in the file
with \cmd{\endinput}; LaTeX stops reading the file at that point and 
will ignore any possible garbage after \cmd{\endinput}.

    You then use the \Lpack{bringhurst} package just like any other by
putting
\begin{lcode}
\usepackage{bringhurst}
\end{lcode}
in your document's preamble\index{preamble}.

%#% extend


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%% revert to the regular styles
\clearpage
%%%\memmansecheads
%%%\chapterstyle{demo3}
\headstyles{memman}
\pagestyle{ruled}

%#% extstart include an-example-thesis-design.tex

\svnidlong
{$Ignore: $}
{$LastChangedDate: 2014-03-31 11:34:44 +0200 (Mon, 31 Mar 2014) $}
{$LastChangedRevision: 480 $}
{$LastChangedBy: daleif $}

\PWnote{2009/07/05}{Added thesis design chapter}
\PWnote{2009/07/08}{Revised thesis design chapter}
\chapter{An example thesis design} \label{chap:thesis}

    Many universities in the United States have strict regulations about 
the typography of theses.
The title and administrative pages are inherently specific to a particular 
university, but often the design for the body of the thesis clashes 
with normally accepted typographic practice. This chapter presents 
fairly typical guidelines for some US universities and code intended 
to meet them. Let's call the university in question the 
\emph{Archibald Smythe University}, or ASU for short. 

    The requirements that are listed below are not from any single
university but I have, over the years, seen each one of them. In reality
there are likely to be many more nit-picking rules than I have shown.

    It amuses me that I have never seen a printed set of requirements that 
followed the rules laid down therein.

    Universities outside the US tend to be more relaxed with the result
that theses from these establishments are very often more attractive (certainly
less bulky) and more readable. The ASU requirements lead to an exceptionally
dull and unattractive appearance.

\section{Example US thesis typographic requirements}

\subsection{General}  

\begin{description}
\item[Paper size] The thesis shall be printed on 8.5 by 11 inch plain
white paper.

\item[Single-sided] The thesis shall be printed single-sided; that is,
one side of each sheet of paper will be blank.

\item[Margins] Every page of the document shall meet the requirements of
a 1.5~inch margin on the left and a 1~inch margin at the top, right, and 
bottom of the page. Nothing shall appear in any margin.

\item[Fonts] The thesis may be set in 10, 11 or 12pt 
Arial\index{Arial}, 
Century\index{Century}, 
Garamond\index{Garamond},
Lucida Bright\index{Lucida Bright} (10pt only), 
Tahoma\index{Tahoma}, 
Times\index{Times}, or 
Verdana\index{Verdana}. 
The same font and size shall be used throughout the thesis. 

    There shall be no bold type.

 Italic type (or underlining) is limited to the names of species, genera, 
book titles, musical compositions, or foreign words.

\item[Line Spacing] All text shall be double-spaced, except material in tables
and the optional biographical sketch (which must be single-spaced). You shall
single-space individual footnotes and endnotes with a double space between
each entry.
\end{description}

\subsection{Preliminary matter}

The preliminary matter consists of the following pages in this
order:
\begin{enumerate}
\item Title page
\item Approval page
\item Abstract
\item Dedication (optional)
\item Acknowledgements (optional)
\item Table of contents
\item List of tables (if there are any tables)
\item List of figures (if there are any figures)
\item Other lists (e.g., nomenclature, definitions, glossary of terms, etc.)
\item Preface (optional but must be less than ten pages)
\item Under special circumstances further sections may be allowed
\end{enumerate}

    The heading for each preliminary page (except the Dedication which shall
not have a heading) is centered between the margins, in all capital letters,
double-spaced and begin on the first line below the top margin.

    The title and approval page are counted as pages one and two, but
no page numbers shall appear on them. All subsequent preliminary pages are 
paginated with lowercase Roman numerals. Starting with `iii' on the abstract
page, place all page numbers at the bottom of the page, centered between
the left and right margins and upon the 1~inch bottom margin. Continue
numbering consecutively on the subsequent pages up to the first page
of the main text. 

\subsubsection{Title page}

\begin{enumerate}
\item All text shall be centered between the side margins.

\item Set the title in all capital letters, double-spaced, 
starting at the top of the page (but below the top margin).
\item On a new line (double-spaced) type `by' in lowercase letters.
\item On a new line (double-spaced) type your full legal name.
\item At the center of the page type the appropriate description for
your degree with the exact wording and line breaks as shown, and single-spaced:
\begin{quote} \centering
A \rule{1in}{0.4pt} Presented in Partial Fulfillment \\
of the Requirements for the Degree \\
\rule{2in}{0.4pt}
\end{quote}
    Replace the blanks with the appropriate wording: Thesis and Master
of Arts or Dissertation and Doctor of Philosophy.
\item At the bottom of the page type `ARCHIBALD SMYTHE UNIVERSITY' in all 
     capitals.
\item Type the month and year of the date you will graduate, with the
month in title case and no comma between the month and year.
\item The space between your name and the degree description should equal
the space between the degree description and the name of the University.
\end{enumerate}

\subsubsection{Approval page}

\begin{enumerate}
\item All text shall be centered between the side margins.

\item Set the title in all capital letters, double-spaced, 
starting at the top of the page (but below the top margin).
\item On a new line (double-spaced) type `by' in lowercase letters.
\item On a new line (double-spaced) type your full legal name in
title-cased letters.
\item Add two double-spaced lines (four single-spaced lines) and type
`has been aproved' in lowercase
\item Add a double-space.
\item Type the month and year of your oral defense, with the
month in title case and no comma between the month and year.

\item At about the center of the page type `Graduate Supervisory Committee:'
\item A blank (double-spaced) line
\item Type the members' names, without titles, one per line, 
      single-spaced, as follows:
  \begin{enumerate}
  \item If you have one chair, type: the chair's name, comma, space `Chair'
  \item If two chairs, type: comma, space, `Co-Chair' after the first two names
  \item Follow with the other members' names.
  \end{enumerate}
\item At the bottom of the page, type `ACCEPTED BY THE GRADUATE COLLEGE'
\item The space between the date and `Graduate Supervisory Committe' lines
should equal the space between the last member's name and the `ACCEPTED\ldots'
line.
\end{enumerate}

\subsubsection{Abstract page}

    Center the title `ABSTRACT' at the top of the page. Number the page
at the bottom, centered with the Roman numeral `iii'. If there is a second 
page, number it similarly with `iv'.

\subsubsection{Dedication and Acknowledgements (optional)}

\begin{itemize}
\item  The dedication and acknowledgements together must not exceed three 
pages.
\item The dedication page is not titled and the text should be centered both
vertically and horizontally.
\item The heading for the acknowledgements page is `ACKNOWLEDGEMENTS', centered
and at the top of the page.
\item Continue the page numbering in lowercase Roman, at the bottom and 
centered.
\end{itemize}

\subsection{Table of contents}

\begin{enumerate}
\item Type `TABLE OF CONTENTS' centered at the top of the page.
\item On the next line type the word `Page' right justified
\item Begin listing any preliminary pages that follow the table of contents
(e.g., lists) in ALL CAPS. The title is left justified, the page number is
right justified and a dotted line fills the gap between.
\item Double space between entries.
\item Chapter headings and subheadings to three levels shall be listed, 
with a lower level being indented with respect to a higher level. 
\item The wording of headings shall correspond exactly to those in
the main body.
\item The page number is centered at the bottom of the page.
\item If the listing continues for more than one page, subsequent pages
shall be headed with one line consisting of `Chapter' left justified 
and `Page' right justified.
\end{enumerate}

\subsection{Lists}

    For a given kind of list (often figures or tables) called, say, `things':
\begin{enumerate}
\item Type `LIST OF THINGS' centered at the top of the page.
\item On the next line type `Thing' left justified and `Page' right justified.
\item List, double-spaced, the caption or title of the thing left justified
and the page number right justified, with a dotted line between them.
\item Use Roman lowercase to number the page(s) at the bottom, centered.
\item If the listing continues for more than one page, subsequent pages
shall be headed with one line consisting of `Thing' left justified 
and `Page' right justified.
\end{enumerate}

\subsection{Main text}

    Nothing shall appear in the margins.

    The top line on a page is the line immediately below the top margin.
The top text line is the one following that (i.e. the second line below
the margin).

\subsubsection{Page numbering}

    All pages are counted, but the first page of each chapter is not 
numbered (paginated); other pages are paginated. The first page of the 
main text is counted as number 1. Numbered pages have the number right 
justified on the top line.

\subsubsection{Headings}

   Chapter headings shall be centered. On the top line type `Chapter' followed
by the number. On the top text line type the heading in all uppercase. 
Type the text on the subsequent lines.

   Subheadings, consisting of the number and title (not in all caps), 
shall be centered, with one blank line before and after.

\subsubsection{Captions}

Table captions, which are left justified, shall be put before the table 
itself. The first line consists of `Table' followed by the number; the caption
wording commences on the next line.

Captions for figures are similar, except that they shall be put below the 
figure and `Table' replaced by `Figure'.

Tables and figures shall be single-spaced.

\subsubsection{Notes}

    Notes may be placed at the bottom of the page (i.e., footnotes), or
grouped in the backmatter (i.e., endnotes) before the reference list.

    All notes shall be introduced by a superior number in the text, with
the same number used for the text of the note. Notes should be single spaced,
with double spacing between them.

\subsection{Backmatter}

    The backmatter consists of the following pages, in order (all of which
are optional).
\begin{enumerate}
\item Notes (if you are using endnotes and grouping them at the end)
\item References (AKA `Bibliography' or `Works Cited')
\item Appendices
\item Biographical sketch (optional)
\end{enumerate}

    Pagination continues from the main text; but as with chapters, the first
pages of any notes, references, or appendices are not numbered. A biographical
sketch, if it is included, is the last page and is neither counted
nor paginated.

    Headings for the backmatter sections shall be in uppercase, centered, and
on the top line.

\subsubsection{Notes}

    The section for endnotes should begin on a new, unnumbered page. Subsequent
pages should be numbered.

    Use `NOTES', centered and at the top, as the heading for the notes section.

\subsubsection{References}

    Use the reference heading appropriate for your discipline, in uppercase,
centered and at the top of the page. Individual refences 
should be single-spaced with the second and later lines of a multiline
reference indented with respect to the first line. 
There should be double-spacing between references.

\subsubsection{Appendices}

    The heading for an appendix consists of the word `APPENDIX' followed by 
the uppercase letter signifying its position in the sequence of appendices
(e.g., A or B or C or \ldots).
This shall be centered on the top line. The title of the appendix, in 
uppercase, is centered on the following line. This page is not numbered.
Subsequent pages are numbered and the text commences on the top text line
of the following page.

\subsubsection{Biography}

    The title for the optional biographical page is `BIOGRAPHICAL SKETCH', 
in the usual position. The text shall not exceed the one page.

\section{Code}

Given the above set of requirements we can produce code that,
hopefully, will generate documents that will not fall foul of the
inspectorate.  For simplicity I'll do the code in the form of a
package called \verb?pwasu.sty?.  I will be using some \ltx\ kernel
commands that you won't normally come across. Some of the macros
include \idxatincode\texttt{@} as part of their name but this is safe
as they are in a package, otherwise they would have to be within a
\cmd{\makeatletter} \ldots \cmd{\makeatother} grouping (\seeatincode).

\subsection{Initialisation}

    First, identify the package and its basic requirements.
\begin{lcode}
%%%% file pwasu.sty
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{pwasu}[2009/04/18 v0.3 ASU thesis]
\end{lcode}
This is only going to work with memoir, so check if the class is being
used, and if not then give an error message and stop reading the package code.
\begin{lcode}
%% Only works with the memoir class!!!!!!!!!!!!!!!
\@ifclassloaded{memoir}{\let\endpwasu\relax}{\let\endpwasu\endinput
  \PackageError{pwasu}{The pwasu package only works with the memoir class}%
               {\@ehd}}
\endpwasu

\end{lcode}

    ASU is very strict about only using a single font in a single size. 
It is probable that
at least one reference will be made to a location on the web. With \ltx\
such references are set using the \Lpack{url} package, which defaults
to using a monospaced font for urls. For ASU we have to make sure that
they will be made using the body font (and the same applies to any verbatim
text, such as computer code listings, for which we can use the 
\cmd{\setverbatimfont} command).
\begin{lcode}
\usepackage{url}
\urlstyle{same}
\setverbatimfont{\normalfont\rmfamily}% make verbatims use the body font
\end{lcode}
Ensuring that footnotes use the body font is a simple matter of redefining
\cmd{\foottextfont}.
\begin{lcode}
\renewcommand*{\foottextfont}{\normalfont\normalsize}

\end{lcode}


    Noticing that the requirements can involve switching between double
and single spacing, some of which will be done internally in the package,
give the user a chance to change the default double spacing. The argument
to \cs{setasuspacing} can be either \cmd{\OnehalfSpacing} or \cmd{\DoubleSpacing}.
 The result sets \cs{AsuSpacing} to be one of these commands.
\begin{lcode}
% To enable spacing to be changed if neccesary by the user
\newcommand*{\setasuspacing}[1]{%
  \let\AsuSpacing#1
  \AsuSpacing}
\setasuspacing{\DoubleSpacing}
\end{lcode}

\subsection{Page layout}

    As this is for an American University on letterpaper sized paper
we'll assume letterpaper stock, so
no cropping will be needed. Setting the side margins is easy:
\begin{lcode}
% left, right margins and textwidth
\setlrmarginsandblock{1.5in}{1in}{*}
\end{lcode}


Setting the top and bottom margins requires more thought. \ltx\ provides the 
header and footer areas for page numbers. However, the requirements state
that page numbers must be either on the top or bottom line (of the textblock)
with the text extending down to the bottom line or up to the top line (of
the textblock). I'll organise it according to the layout for the main body.
Here, the top of the header is 1 inch below the top of the paper and the
bottom of the text is 1 inch above the bottom of the paper (with the footer
below that).
\begin{lcode}
%% for main body, bottom of text at 1in, footer below
%% top of header at 1in, first text line double spaced 
%% below base of header
\newlength{\linespace}
\setlength{\linespace}{\baselineskip} % current equivalent of \onelineskip
\setlength{\headheight}{\onelineskip}
\setlength{\headsep}{\linespace}
\addtolength{\headsep}{-\topskip}
\setlength{\uppermargin}{1in}
\addtolength{\uppermargin}{\headheight}
\addtolength{\uppermargin}{\headsep}
\end{lcode}
And for the bottom margin:
\begin{lcode}
%% and for the bottom
\setlength{\lowermargin}{1in}
\setlength{\textheight}{\paperheight}
\addtolength{\textheight}{-\uppermargin}
\addtolength{\textheight}{-\lowermargin}
\end{lcode}
And finally for footnotes:
\begin{lcode}
%% footnote settings
\setlength{\footskip}{\onelineskip}
\setlength{\footnotesep}{\onelineskip}

\end{lcode}
The layout on the preliminary pages is different, so I'll need
some handy lengths in order to change the layout as appropriate.
The user can also make adjustments with these if necessary.
\begin{lcode}
%% the fiddle lengths (..ta.. for title/approval page, others for prelims)
\newlength{\toptafiddle} \setlength{\toptafiddle}{2\linespace}
\newlength{\bottafiddle} \setlength{\bottafiddle}{0pt}
\newlength{\topfiddle}   \setlength{\topfiddle}{\toptafiddle}
\newlength{\botfiddle}   \setlength{\botfiddle}{\onelineskip}
\end{lcode}
That's it for the general layout, except for increasing the paragraph 
indentation as the line spacing is larger than normal.
\begin{lcode}
\setlength{\parindent}{2em}
\checkandfixthelayout[nearest]

\end{lcode}

    As the layout is set up, the bottom of the text is one inch above the
bottom of the paper. This is fine for the main text and the Title and Approval
pages but the text height must be decreased, temporarily, for the other
pages in the prelims. Changes to the page layout\index{page layout!change} 
may be accomplished by
the following sneaky procedure.
First change from one- to two-column (or vice-versa), which starts a new 
page, make the changes, then change from two- to one-column (or vice-versa)
which starts the same new page again but with the layout changes implemented.
The following code implements this for the \cs{textheight} in a one
column document, which is what we are dealing with here.
\begin{lcode}
\newcommand*{\addtotextheight}[1]{%
  \twocolumn
  \addtolength{\textheight}{#1}%
  \onecolumn}
\end{lcode}

\subsection{Page styles}

    Next I'll tackle the page styles. The style for the main body is simple,
with the page number top right, and the \pstyle{empty} style is the one for 
chapter pages. The page number for the preliminary pages is centered
at the bottom, and the \pstyle{plain} page style provides that. For the main
text define the \pstyle{asu} page style.
\begin{lcode}
%%%% pagestyles
%% the main text
\makepagestyle{asu}
  \makeevenhead{asu}{\thepage}{}{}
  \makeoddhead{asu}{}{}{\thepage}
\end{lcode}

    Any `continuation' pages for the \toc, etc., have a header that consists 
of a name at the left and the word `Page' at the right. We need a header for
each kind of listing.
\begin{lcode}
%% for continuation pages of the ToC, LoF, LoT
\makepagestyle{toc}
  \makeevenfoot{toc}{}{\thepage}{}
  \makeoddfoot{toc}{}{\thepage}{}
  \makeevenhead{toc}{Chapter}{}{Page}
  \makeoddhead{toc}{Chapter}{}{Page}
\makepagestyle{lof}
  \makeevenfoot{lof}{}{\thepage}{}
  \makeoddfoot{lof}{}{\thepage}{}
  \makeevenhead{lof}{Figure}{}{Page}
  \makeoddhead{lof}{Figure}{}{Page}
\makepagestyle{lot}
  \makeevenfoot{lot}{}{\thepage}{}
  \makeoddfoot{lot}{}{\thepage}{}
  \makeevenhead{lot}{Table}{}{Page}
  \makeoddhead{lot}{Table}{}{Page}
\end{lcode}

\subsection{The ToC and friends}

    While we're at it, do the code for the \lof\ and \lot, which is simpler
than that needed for the \toc. We have to specify our new pagestyles which
can be done by extending the \cs{listof...} macros. The \cmd{\addtodef}
macro makes this rather easy.
\begin{lcode}
%%%% The LoF
\renewcommand{\listfigurename}{LIST OF FIGURES}
\addtodef{\listoffigures}{\clearpage\pagestyle{lof}}{}
\end{lcode}
For the titles, these have to be moved up into the header area, so that
they come just below the top margin, and set the initial pagestyle as 
\pstyle{plain}. After the title we can insert the relevant column headers.
\begin{lcode}
\renewcommand*{\lofheadstart}{\vspace*{-\topfiddle}}
\renewcommand*{\afterloftitle}{\thispagestyle{plain}%
  \par\nobreak {\normalfont Figure \hfill Page}\par\nobreak}

\end{lcode}
And the same for the \lot.
\begin{lcode}
%%% The LoT
\renewcommand{\listtablename}{LIST OF TABLES}
\addtodef{\listoftables}{\clearpage\pagestyle{lot}}{}
\renewcommand*{\lotheadstart}{\vspace*{-\topfiddle}}
\renewcommand*{\afterlottitle}{\thispagestyle{plain}%
  \par\nobreak {\normalfont Table \hfill Page}\par\nobreak}

\end{lcode}

    The \toc\ is similar but we also have to deal with the entries themselves.
\begin{lcode}
%%%% Do the ToC
\renewcommand{\contentsname}{TABLE OF CONTENTS}
\addtodef{\tableofcontents}{\clearpage\pagestyle{toc}}{}
\renewcommand*{\tocheadstart}{\vspace*{-\topfiddle}}
\renewcommand*{\aftertoctitle}{\thispagestyle{plain}%
  \par\nobreak \mbox{}\hfill{\normalfont Page}\par\nobreak}
\end{lcode}
And the changes to the entries, all of which are set in the normal font
and with dotted leaders, with no extra space between any of the entries.
\begin{lcode}
\renewcommand*{\cftchapterfont}{\normalfont}
\renewcommand*{\cftchapterpagefont}{\normalfont}
\renewcommand*{\cftchapterleader}{%
  \cftchapterfont\cftdotfill{\cftchapterdotsep}}
\renewcommand*{\cftchapterdotsep}{\cftdotsep}
\end{lcode}
Unlike the typical \ltx\ \toc\ there must be no additional space before
chapter entries; also, there should be no additional space inserted by
the chapters in the \lof\ or \lot\ which just requires a simple redefinition
of \cmd{\insertchapterspace}..
\begin{lcode}
%%% no extra space before the entry, or in the LoF/LoT
\setlength{\cftbeforechapterskip}{0pt plus 0pt}
\renewcommand*{\insertchapterspace}{}
\end{lcode}

\subsection{Chapter styling}

    Moving on to styling the chapter titles, the first line must be moved up
into the header area, and other spacings set to give blank lines. The fonts
are just the regular body font. Call the chapterstyle \cstyle{asu} and make
sure that the \pstyle{empty} pagestyle is used for it.

\begin{lcode}
%% chapter style
\makechapterstyle{asu}{%
  \setlength{\beforechapskip}{-\topfiddle}
  \setlength{\midchapskip}{1.0\onelineskip}
  \setlength{\afterchapskip}{1.0\onelineskip}
  \renewcommand*{\chapnamefont}{\normalfont}
  \renewcommand*{\chapnumfont}{\chapnamefont}
  \renewcommand*{\printchapternum}{\centering\chapnumfont \thechapter}
  \renewcommand*{\chaptitlefont}{\normalfont\centering}
  \renewcommand*{\printchapternonum}{}}
\aliaspagestyle{chapter}{empty}

\end{lcode}

   The chapterstyle for any appendices is slightly different as the title,
all in uppercase, is
on one page by itself and the text starts on the following page. Call
this the \cstyle{asuappendix} chapterstyle.

\begin{lcode}
%% chapter style for appendices, text comes on following page
\makechapterstyle{asuappendix}{%
  \setlength{\beforechapskip}{-\topfiddle}
  \setlength{\midchapskip}{1.0\onelineskip}
  \setlength{\afterchapskip}{1.0\onelineskip}
  \renewcommand*{\chapnamefont}{\normalfont}
  \renewcommand*{\chapnumfont}{\chapnamefont}
  \renewcommand*{\printchaptername}{%
    \chapnamefont\MakeUppercase{\@chapapp}}
  \renewcommand*{\printchapternum}{\centering\chapnumfont \thechapter}
  \renewcommand*{\chaptitlefont}{\normalfont\centering}
  \renewcommand*{\printchapternonum}{}
  \renewcommand*{\afterchaptertitle}{\clearpage}}

\end{lcode}

   We have to extend the \cmd{\appendix} command to use the new chapter
style, and also to ensure that double spacing will be used (certain elements
that come before the appendices are single spaced).

\begin{lcode}
%%% different chapter style for appendices, (and double spaced)
\addtodef{\appendix}{}{\chapterstyle{asuappendix}\AsuSpacing}
\end{lcode}

\subsection{Section, etc., styling}

    Set up the section headings so that they are centered, use the normal
font, and have a blank line before and after.

\begin{lcode}
%%% (subsub)section styles
\setsecheadstyle{\centering\normalfont}
\setbeforesecskip{-1\onelineskip plus -1ex minus -.2ex}
\setaftersecskip{1\onelineskip plus .2ex}
\setsubsecheadstyle{\centering\normalfont}
\setbeforesubsecskip{-1\onelineskip plus -1ex minus -.2ex}
\setaftersubsecskip{1\onelineskip plus .2ex}
\end{lcode}


\subsection{Captions}

The captions are set flushleft and raggedright with the name and number
on one line and the title on the following line. Fortunately floats are 
automatically set single spaced, which is what the requirements specify.

\begin{lcode}
%% Captions
\captiontitlefont{\normalfont}% title font
\precaption{\raggedright}% for Caption N
\captiondelim{\newline}% newline
\captionstyle{\raggedright}% for title 
\setlength{\belowcaptionskip}{\onelineskip}
\end{lcode}

\subsection{The bibliography}

    The requirements imply that the title is likely to be `REFERENCES'. 
The bibliography is set single spaced but with a blank line between
the entries. 

\begin{lcode}
%% for REFERENCE section
\renewcommand*{\bibname}{REFERENCES}
\setlength{\bibitemsep}{\onelineskip}
\end{lcode}

    The second and later lines of any entry are to be indented. We use the
\cmd{\biblistextra} hook for setting this up.
\begin{lcode}
\renewcommand*{\biblistextra}{%
  \setlength{\itemsep}{\bibitemsep}
  \setlength{\labelwidth}{0pt}
  \setlength{\leftmargin}{3em}% hanging indent
  \setlength{\itemindent}{-\leftmargin}}
\end{lcode}

The title for the bibliography is set via the \cmd{\bibsection} macro.
The heading is unnumbered but is added to the \toc. To get the spacing
right the heading, set as a \cs{chapter*}, which must be called double spaced,
and then single spacing is called for after that.
\begin{lcode}
\renewcommand*{\bibsection}{%
  \AsuSpacing
  \chapter*{\bibname}\addcontentsline{toc}{chapter}{\bibname}
  \SingleSpacing}
\end{lcode}


\subsection{End notes}

    The heading for the Notes section is similar to the bibliography
heading.
\begin{lcode}
%% endnotes
\renewcommand*{\notesname}{NOTES}
\renewcommand*{\notedivision}{%
  \AsuSpacing
  \chapter*{\notesname}
  \addcontentsline{toc}{chapter}{\notesname}
  \SingleSpacing}
\end{lcode}

    The rest of the code for endnotes\index{endnotes} ensures that they are 
numbered
continuously throughout the text, the number is set as a superscript, that
there is a blank line between each entry, and that there are no subdivisions
within the listing.
\begin{lcode}
\continuousnotenums 
\renewcommand*{\notenuminnotes}[1]{\textsuperscript{#1}\space}
\renewcommand{\noteinnotes}[1]{#1\\}
\renewcommand*{\pagenotesubhead}[3]{}% no subheads
\end{lcode}

\subsection{Preliminary headings}

    There can be any number of sections in the prelims. The
titles for these are located in the \ltx\ header area. Here's a general 
macro for setting these.

\begin{lcode}
%%% general macro for Abstract, etc., headings
\newcommand*{\pretoctitle}[1]{{\clearpage\centering 
  \vspace*{-\topfiddle}#1\par}}
%%% Start the ACKNOWLEDGEMENTS
\newcommand{\asuacknowledgements}{\pretoctitle{ACKNOWLEDGEMENTS}}

\end{lcode}

    The Abstract is the
first section after the title and approval pages. At this point we must reduce
the textheight in order to raise the footer area.
\begin{lcode}
%%% Start the ABSTRACT
\newcommand{\asuabstract}{%
  \addtotextheight{-\botfiddle}%
  \pretoctitle{ABSTRACT}}
\end{lcode}
    While we are at this, the textheight must be reset to its default value
just before the first chapter in the main matter. A simple addition to
\cmd{\mainmatter} handles this.
\begin{lcode}
\addtodef{\mainmatter}{\addtotextheight{\botfiddle}{}

\end{lcode}

    The dedication, if any, does not have a heading and the text is centered
horizontally and vertically. 
\begin{lcode}
%% make it easy to center any dedication
\newcommand{\asudedication}[1]{%
  {\clearpage\mbox{}\vfill\centering #1 \par\vfill\clearpage}}

\end{lcode}

    There may be sections in the prelims that come after the \toc, and
the titles of these are added to the \toc.
\begin{lcode}
%% for any headings after the tocloft and before the main body
\newcommand{\prelimtitle}[1]{%
  \pretoctitle{#1}\addcontentsline{toc}{chapter}{#1}}
\end{lcode}

\subsection{Components of the title and approval pages}

    There are several items that are set on the title and approval pages.
In order to separate the information from the particular layout, I've 
defined a macro for defining each item.
\begin{lcode}
%%%% for the title page and approval page. 
% your title
\newcommand{\settitle}[1]{\def\asutitle{#1}}
% you
\newcommand{\setauthor}[1]{\def\asuauthor{#1}}
% document type (e.g., thesis)
\newcommand{\setdoctype}[1]{\def\asudoctype{#1}}
% possible degree
\newcommand{\masters}{\def\asudegree{Master of Arts}}
\newcommand{\doctors}{\def\asudegree{Doctor of Philosophy}}
% defence date
\newcommand{\setdefdate}[1]{\def\asudefdate{#1}}
% graduation date
\newcommand{\setgraddate}[1]{\def\asugraddate{#1}}
% committe chair
\newcommand{\setchair}[1]{\def\asuchair{#1, Chair}}
% committe co-chairs
\newcommand{\setchairs}[2]{%
  \def\asuchair{#1, Co-chair \\ #2, Co-chair}}
% other members (separated by \\s)
\newcommand{\setmembers}[1]{\def\asumembers{#1\par}}

\end{lcode}

    Just for fun, create some default settings for these. The successful 
user will have changed them all!
\begin{lcode}
%% Use them like this, and if you don't change them you will
%% get unacceptable title and/or approval pages
\settitle{AN INCREDIBLE PIECE OF WORK OVER WHICH I HAVE STRUGGLED
DAY AND NIGHT FOR FAR TOO LONG AND NOW IT IS OVER}
\setauthor{A. N. Author}
\setdoctype{Polemic}
\masters  % going for a Masters degree
%% \doctors % going for a PhD
\setdefdate{April 2018}
\setgraddate{May 2021}
% \setchair{A. Jones}           % this one
\setchairs{A. Jones}{B. Doe}  % or this one
\setmembers{C. Smith \\ D. Somebody \\ Some One Else \\ Yet Another}
\end{lcode}

\subsection{The title and approval pages}

\PWnote{2009/07/09}{Added 2 ASU figures}
An example of a title page is shown in \fref{fig:titleASUt} and 
an example of the corresponding approval page is in \fref{fig:titleASUa}.

\begin{figure}
\centering
\begin{showtitle}
  \titleASUt
\end{showtitle}
\caption{Example Archibald Smythe University title page}\label{fig:titleASUt}
\end{figure}

\begin{figure}
\centering
\begin{showtitle}
  \titleASUa
\end{showtitle}
\caption{Example Archibald Smythe University approval page}\label{fig:titleASUa}
\end{figure}

    Now we can set up the layouts for the title and approval pages. The
information typeset on these pages is obtained from the previous set of 
commands. Note that the last line on each of these pages has to be set
upon the bottom margin. The ASU inspectorate is likely to be very
keen on this, perhaps using a ruler to measure the actual distance from 
the bottom of the page to ensure that it is the magic 1~inch. I have
included an \cmd{\enlargethispage} by the amount \cs{bottafiddle} so the
user can make any fine adjustment that might be requested. Similarly, the
length \cs{toptafiddle} may be altered to fine tune the position of the
title. Hopefully, neither of these tweaks will be needed, but if so, then use
\cmd{\addtolength} instead of \cmd{\setlength} to make an adjustement.

\begin{lcode}
%%% typesets the TITLE page
\newcommand{\thetitlepage}{{%
  \clearpage
  \thispagestyle{empty}
  \centering
  \vspace*{-\toptafiddle}
  \asutitle \\ by \\ \asuauthor
  \vfill

  {\SingleSpace
  A \asudoctype\ Presented in Partial Fulfillment \\
  of the Requirements for the Degree \\
  \asudegree\par}

  \vfill
  ARCHIBALD SMYTHE UNIVERSITY \\
  \asugraddate 
  \par
  \enlargethispage{\bottafiddle}
  \clearpage}}

\end{lcode}

    And similary for the approval page.

\begin{lcode}
%%% typesets the APPROVAL page
\newcommand{\approvalpage}{{%
  \thispagestyle{empty}
  \centering
  \vspace*{-\toptafiddle}
  \asutitle \\ by \\ \asuauthor \\[3\onelineskip]
  has been approved \\
  \asudefdate

  \vfill

  Graduate Supervisory Committee: \\[-0.5\onelineskip]
  {\SingleSpacing
  \asuchair \\
  \asumembers}

  \vfill
  ACCEPTED BY THE GRADUATE COLLEGE 
  \par
  \enlargethispage{\bottafiddle}
  \clearpage}}
\end{lcode}

\subsection{The last bits}

    The biographical sketch has a title (which is not added to
the \toc), the text is single spaced and there is no page number. 
It is easiest to provide this as an environment.
\begin{lcode}
%%% put your biographical text in this environment
%% \begin{biosketch} I'm a person who has accomplished .... \end{biosketch}
\newenvironment{biosketch}{%
  \pretoctitle{BIOGRAPHICAL SKETCH}\thispagestyle{empty}\SingleSpacing}%
  {}
\end{lcode}

    Make sure that the requisite initial page style and appropriate
chapter style is used.
\begin{lcode}
%% use the asu chapterstyle and plain pagestyle
\chapterstyle{asu}
\pagestyle{plain}

%%%%%%%%%%%%%%% end of *.sty file
\endinput
%%%%%%%%%%%%%%%
\end{lcode}

\section{Usage}

    This is a sketch of how an ASU thesis could be written. 

  With the wide textblock, 12pt is too small for reading ease, so best not
to use 11pt or 10pt.

    Times Roman\index{Times Roman} comes with \ltx, but you are 
effectively writing a book, 
not a newspaper column. If you have Garamond\index{Garamond} 
or Lucida Bright\index{Lucida Bright} then 
seriously consider using one or other of them.\footnote{Garamond is a 
commercial font and, for example, is available along with many other fonts 
from FontSite (\url{http://www.fontsite.com})
with \ltx\ support from \url{http://contrapunctus.net/fs500tex}.
Lucida Bright, another commercial font,
is available from TUG at \url{http://tug.org/store/lucida} and is supported
by several \ltx\ packages.} Lucida Bright is probably more appropriate if
your thesis includes mathematics while Garamond is perhaps more in keeping
if your thesis topic falls into the humanities area.
If the requirements did not limit your choices then there are other
fonts that might better express your work. In any case
I suggest that you do not use a sans font (e.g.,
Arial\index{Arial},
Tahoma\index{Tahoma} or
Verdana\index{Verdana} from the ASU list).

\begin{lcode}
\documentclass[oneside,12pt]{memoir}
\usepackage{mathptmx}  % Times New Roman
\usepackage{pwasu}     % the package

\end{lcode}

    The general sequence in your document, after you have set the data for
the TITLE and APPROVAL pages and any other specifics and packages in the 
preamble, is:
\begin{lcode}
%  if you can get away without the default \DoubleSpacing, then
%\setasuspacing{\OnehalfSpacing}
%% if you use endnotes, then
   \makepagenote
\begin{document}
\maxtocdepth{subsection} % put 3 levels into the ToC
\frontmatter
\thetitlepage
\approvalpage
\asuabstract 
   abstract text
%% if you have any acknowledgements, then
  \asuacknowledgements
    acknowledgements text
% \asudedication{ text } % if you want a dedication
\tableofcontents
% \listoffigures  % if you have any figures
% \listoftables   % if you have any tables
%%% if you have more prelim sections, then
%%% \clearpage
%%% \pagestyle{plain}
%%% \prelimtitle{title} text % for each section before main text
\mainmatter
\pagestyle{asu}
\chapter{...} % start of your main text
... report on lots of incredible work, now you are on your
own until...

%% if endnotes then
   \printpagenotes
%% if a bibliography then
   \begin{thebibliography}...\end{thebibliography}
%% if appendices, then
  \appendix
  \chapter{...}
  ...
%% if Biographical sketch then
   \begin{biosketch} ... \end{biosketch}
\end{document}

\end{lcode}

    If you actually try any of the above code and it does not work, then
I may have made a typo or two, or maybe you have, or perhaps we both have.
In any event, the code is more of a sketch of what might be needed than
a prescription of how it must be done.

\section{Comments}

    Having read through the requirements you will have realised
that whatever committees set them had not advanced beyond the 19th century
technology of the typewriter\index{typewriter}.\footnote{Remington sold 
their first commercial typewriter in 1873 which even then had the QWERTY 
keyboard layout. By 1910 typewriter designs were pretty well standardised.} 
When I wrote my thesis some forty years ago
it was, of necessity, single sided so that carbon copies could be made
by the typist\index{typist} (who would have objected strongly to having 
to type the hundred
and fifty or so pages six times). I must admit, though, that the sixth copy
was almost too faint and blurry to be read comfortably even though the typist
had used thin paper and kept replacing the carbon paper. 
In this day of double sided printers and double sided copiers I see no 
reason except inertia to keep a single sided requirement. Many students, 
and faculty members, have beaten their heads against
the diehards and very rarely have they managed to prevail.

\PWnote{2009/07/09}{Added comments on Sneep's thesis}
   In contrast to the ASU style I have a copy of a doctoral
thesis~\cite{SNEEP04} for Vrije Universiteit, Amsterdam. This is a
professionally printed 100 page, double sided, glossy paperbound book with an 
attractive coloured 
photograph of a sunset on the front and rear covers. The page size is 40.5pc by
57pc with spine and top margins of 5pc and foredge and bottom margins of
7pc.\footnote{Professional printers use points and picas for their 
measurements.}  The textblock, then, is 28.5 by 45pc set with 45 lines of 
a 10pt Lucida Bright seriffed font.
Chapter and section heads are in a sans font, with the chapter heads larger
than the section heads. Caption names are a bold sans with the caption text 
in an italic. Headers on the verso pages are the chapter title with the section
title as the recto header. The page numbers are in the footers by the foredge
margin. Altogether, a much more appealing production 
than Archibald Smythe University will permit.

%#% extend

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%% appendices
\appendix
\appendixpage*
%%\pagestyle{ruled}

%%\chapterstyle{normal}
%%\chapterstyle{section}
%%\chapterstyle{demo3}

%#% extstart include packages-and-maros.tex

\svnidlong
{$Ignore: $}
{$LastChangedDate: 2018-09-06 15:05:23 +0200 (Thu, 06 Sep 2018) $}
{$LastChangedRevision: 612 $}
{$LastChangedBy: daleif@math.au.dk $}

\chapter{Packages and macros}

    The \Mname\ class does not provide for everything that you
have seen in the manual. I have used some packages that you are very likely
to have in your \ltx\ distribution, and have supplemented these with some
additional macros, some of which I will show you.

\section{Packages}

    The packages that I have used that you are likely to have, and if
you do  not have them please consider getting them, are:
\begin{itemize}
\item \Lpack{etex} lets you take advantage of e\tx's extended support
      for counters and such.

      Note that from 2015 and onwards, the allocation of extra
      registers have now been build into the LaTeX kernel. Thus in
      most cases the \Lpack{etex} package is no longer
      necessary. There are how ever extra very special features left
      in \Lpack{etex} that \emph{some} users may need. In that case
      please remember to load \Lpack{etex} by placing
      \verb|\RequirePackage{etex}| \emph{before} \cs{documentclass}! 
\item \Lpack{url}~\cite{URL} is for typesetting URL's without worrying
  about special characters or line breaking.
\item \Lpack{fixltx2e}~\cite{FIXLTX2E} eliminates some infelicities
      of the original LaTeX kernel. In particular it maintains the order
      of floats\index{float} on a twocolumn\index{column!double} page 
      and ensures the correct marking
      on a twocolumn\index{column!double} page.

      Note that as of 2015, the functionality of this package has been
      merged into the \LaTeX{} kernel. Loading this package does nothing.

      
\item \Lpack{alltt}~\cite{ALLTT} is a basic package which provides a 
      verbatim-like environment but \verb?\?, \verb?{?, and \verb?}? have their
      usual meanings (i.e., \ltx\ commands are not disabled).
\item \Lpack{graphicx}~\cite{GRAPHICX} is a required package for
      performing various kinds of graphical functions. 
\item \Lpack{color}~\cite{COLOR} is a required package for using color,
       or \Lpack{xcolor}~\cite{XCOLOR} is an enhanced version of \Lpack{color}.
\item \Lpack{latexsym} gives access to some extra symbols.
\item \Lpack{amsmath} for when you are doing anything except the
       simplest kind of maths typeseting.
\item \Lpack{fontenc} for using fonts with anything other than the
      original \texttt{OT1} encoding (i.e., for practically any font).
\item \Lpack{pifont} for typesetting Pifonts 
       (i.e., Symbol\facesubseeidx{Symbol} and 
               Zapf Dingbats\facesubseeidx{Zapf Dingbats})
\end{itemize}

    Apart from the packages that are supplied as part of the \Mname\ 
distribution, the packages that I used and you most likely do not have are:
\begin{itemize}
\item \Lpack{layouts}~\cite{LAYOUTS}. I used it for all the layout diagrams. 
For example, \fref{fig:displaysechead} and \fref{fig:runsechead} 
were drawn simply by:
\begin{lcode}
\begin{figure}
\centering
\setlayoutscale{1}
\drawparameterstrue
\drawheading{}
\caption{Displayed sectional headings} \label{fig:displaysechead}
\end{figure}

\begin{figure}
\centering
\setlayoutscale{1}
\drawparameterstrue
\runinheadtrue
\drawheading{}
\caption{Run-in sectional headings} \label{fig:runsechead}
\end{figure}
\end{lcode}
The package also lets you try experimenting with different layout 
parameters and draw diagrams showing what the results would be in a document.

    The version of \Lpack{layouts} used for this manual is 
v2.4 dated 2001/04/30. Earlier versions will fail when attempting
to draw some figures 
( e.g., to draw \fref{fig:oddstock}).

\item \Lpack{fonttable}~\cite{FONTTABLE}. I used this for the font tables 
(e.g., \tref{tab:symbolglyphs}). 
You must have at least version 1.3 dated April 2009
for processing the manual (earlier versions are likely to produce errors
in the number formatting area with minor, but odd looking, effect on 
the printed result).

\end{itemize}


\section{Macros}

    Originally the preamble\index{preamble} of the manual contained many macro 
definitions, probably more than most documents would because:
\begin{itemize}
\item I am having to typeset many \ltx\ commands, which require
      some sort of special processing;
\item I have tried to minimize the number of external packages needed
      to \ltx\ this manual satisfactorily, and so have copied various
      macros from elsewhere;
\item I wanted to do some automatic indexing\index{index};
\item I wanted to set off the syntax specifications and the code examples
      from the main text.
\end{itemize}
I have since put the majority of these into a package file called 
\file{memsty.sty}. 
To get the whole glory you will have to read the preamble\index{preamble}, 
and the \Lpack{memsty} package file but I show a few of the macros below 
as they may be of more general interest.

\begin{syntax}
\cmd{\Ppstyle}\marg{pagestyle} \cmd{\pstyle}\marg{pagestyle} \\
\end{syntax}
The command \cmd{\Ppstyle} prints its argument in the font used to indicate
pagestyles and the command \cmd{\pstyle} prints its pagestyle argument and also
makes a pagestyle entry in the index\index{index}. Its definition is
\begin{lcode}
\newcommand*{\pstyle}[1]{\Ppstyle{#1}%
  \index{#1 pages?\Ppstyle{#1} (pagestyle)}%
  \index{pagestyle!#1?\Ppstyle{#1}}}
\end{lcode}
The first part prints the argument in the text and the second adds two
entries to the \file{idx} file. The fragment \verb?#1 pages? is what 
the \Lmakeindex\ program will use for sorting entries, and the 
fragment following the \texttt{?} character is what will be put into the 
index\index{index}.

\begin{syntax}
\cmd{\Pcstyle}\marg{chapterstyle} \cmd{\cstyle}\marg{chapterstyle} \\
\end{syntax}
The command \cmd{\Pcstyle} prints its argument in the font used to indicate
chapterstyles and \cmd{\cstyle} prints its chapterstyle argument 
and also makes a chapterstyle entry in the 
index\index{index}. Its definition is
\begin{lcode}
\newcommand*{\cstyle}[1]{\Pcstyle{#1}%
  \index{#1 chaps?\Pcstyle{#1} (chapterstyle)}%
  \index{chapterstyle!#1?\Pcstyle{#1}}}
\end{lcode}
which is almost identical to \cmd{\pstyle}. 

    There is both a \cstyle{companion} chapterstyle and a \pstyle{companion}
pagestyle. The strings used for sorting the index\index{index} entries for 
these are
\texttt{companion chaps} and \texttt{companion pages} respectively, so 
the chapterstyle will come before the pagestyle in the index\index{index}. 
The reason for distinguishing between the string used for sorting and the 
actual entry is
partly to distinguish between different kinds of entries for a single name
and partly to avoid any formatting commands messing up the sorted order.

\begin{syntax}
\senv{syntax} syntax \eenv{syntax} \\
\end{syntax}
The \Ie{syntax} environment is for specifying command and environment
syntax. Its definition is
\begin{lcode}
\newcommand*{\tightcenter}{%
  \topsep=0.25\onelineskip\trivlist \centering\item\relax}
\def\endtigthcenter{\endtrivlist}
\newenvironment{syntax}{\begin{tightcenter}
                        \begin{tabular}{|p{0.9\linewidth}|} \hline}%
                       {\hline
                        \end{tabular}
                        \end{tightcenter}}
\end{lcode}
It is implemented in terms of the \Ie{tabular} environment, centered within
the typeblock, which forms
a box that will not be broken across a pagebreak. The box frame
is just the normal horizontal and vertical lines that you can use with
a \Ie{tabular}. The width is fixed at 90\% of the text width. As it
is a \Ie{tabular} environment, each line of syntax must be ended with
\cmd{\\}. Note that normal \ltx\ processing occurs within the \Ie{syntax}
environment, so you can effectively put what you like inside it.
The \Ie{center} environment is defined in terms of a \Ie{trivlist} and
\cmd{\centering}. I wanted to be able to control the space before and
after the `\cmd{\centering}' so I defined the \Ie{tightcenter} environment 
which enabled me to do this.


\begin{syntax}
\senv{lcode} LaTeX code \eenv{lcode} \\
\end{syntax}
I use the \Ie{lcode} environment for showing examples of \ltx\ code. It
is a special kind of \Ie{verbatim} environment where the font size is
\cmd{\small} but the normal \lnc{\baselineskip} is used, and each line
is indented. 

    At the bottom the environment is defined in terms of a \Ie{list}, 
although that is not obvious from the code; for details see the 
class code~\cite{MEMCODE}. I wanted the environment to be a tight list 
and started off by defining two helper items.
\begin{lcode}
% \@zeroseps sets list before/after skips to minimum values
\newcommand*{\@zeroseps}{\setlength{\topsep}{\z@}
                         \setlength{\partopsep}{\z@}
                         \setlength{\parskip}{\z@}}
% \gparindent is relative to the \parindent for the body text
\newlength{\gparindent} \setlength{\gparindent}{0.5\parindent}
\end{lcode}
The macro \cmd{\@zeroseps} sets the before, after and middle skips in
a list to 0pt (\cmd{\z@} is shorthand for 0pt). The length \lnc{\gparindent}
will be the line indentation in the environment.
\begin{lcode}
% Now we can do the new lcode verbatim environment. 
% This has no extra before/after spacing.
\newenvironment{lcode}{\@zeroseps
  \renewcommand{\verbatim@startline}%
    {\verbatim@line{\hskip\gparindent}}
  \small\setlength{\baselineskip}{\onelineskip}\verbatim}%
  {\endverbatim
   \vspace{-\baselineskip}\noindent}
\end{lcode}

    The fragment \verb?{\hskip\gparindent}? puts \lnc{\gparindent} space at 
the start of each line.

    The fragment \verb?\small\setlength{\baselineskip}{\onelineskip}? sets the
font size to be \cmd{\small}, which has a smaller \lnc{\baselineskip}
than the normal font, but this is corrected for by changing the local
\lnc{\baselineskip} to the normal skip, \lnc{\onelineskip}. At the end
of the environment there is a negative space of one line to compensate
for a one line space that LaTeX inserts.

%%% \Sref{sec:versal} is in the design manual
\begin{comment}
    The two versals in \Sref{sec:versal} were typeset with macros defined
in \Lpack{memsty}. The poorer of the two used the \cmd{\drop}
macro which was written for \ltx\ v2.09 by David Cantor and Dominik Wujastyk 
in 1998. The better used the \cmd{\versal} macro. Now, if you want
to try your hand at this sort of thing there are some more packages
on CTAN. I have found that the \Lpack{lettrine} package~\cite{LETTRINE} 
serves my needs.
\end{comment}


%#% extend
%#% extstart include showcases.tex

\svnidlong
{$Ignore: $}
{$LastChangedDate: 2010-05-13 17:10:00 +0200 (Thu, 13 May 2010) $}
{$LastChangedRevision: 210 $}
{$LastChangedBy: daleif $}

\chapter{Showcases}
\label{cha:showcases}

The \theclass\ memoir class has several features that involve a
\emph{style} and it provide several of these styles. This chapter is
used to showcase these styles.

\begingroup
% because of hyperref warnings


\section{Chapter styles}
\label{sec:chapter-styles}

\index{chapterstyle|(}

For more about defining chapter styles, see
section~\ref{sec:chapter-headings}, page~\pageref{sec:chapter-headings}.

\begin{demochap}[-3\onelineskip]{default}\end{demochap}

\begin{demochap}[2\onelineskip]{section}\end{demochap}

\begin{demochap}[2\onelineskip]{hangnum}\end{demochap}

\begin{demochap}[2\onelineskip]{companion}\end{demochap}

\begin{demochap}[-1\onelineskip]{article}\end{demochap}

\begin{demochap}[-2\onelineskip]{bianchi}\end{demochap}

\begin{demochap}{bringhurst}\end{demochap}

\begin{demochap}[-2\onelineskip]{brotherton}\end{demochap}

\begin{demochap}{chappell}\end{demochap}

\begin{demochap}[-2\onelineskip]{crosshead}\end{demochap}

\begin{demochap}[-\onelineskip]{culver}\end{demochap}

\begin{demochap}[-4\onelineskip]{dash}\end{demochap}

\begin{demochap}[-\onelineskip]{demo2}\end{demochap}

\begin{demochap}[-2\onelineskip]{dowding}\end{demochap}

\begin{demochap}{ell}\end{demochap}

\begin{demochap}[-4\onelineskip]{ger}\end{demochap}

\begin{demochap}[-2\onelineskip]{komalike}\end{demochap}

\begin{demochap*}[-2\onelineskip]{lyhne}\end{demochap*}

\clearpage

\begin{demochap*}[-2\onelineskip]{madsen}\end{demochap*}

\begin{demochap}[-3\onelineskip]{ntglike}\end{demochap}

\begin{demochap}[-\onelineskip]{southall}\end{demochap}

\begin{demochap}[-1\onelineskip]{tandh}\end{demochap}

\begin{demochap}{thatcher}\end{demochap}

\begin{demochap*}[-2\onelineskip]{veelo}\end{demochap*}

\begin{demochap}{verville}\end{demochap}

\FloatBlock


\begin{demochap}[-1\onelineskip]{wilsondob}\end{demochap}


The code for some of these styles is given in below.  For details of
how the other chapter styles are defined, look at the documented class
code. This should give you ideas if you want to define your own style.

Note that it is not necessary to define a new chapterstyle if you want
to change the chapter headings --- you can just change the individual
macros without putting them into a style.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\subsection{Chappell}

    A style that includes rules is one that I based on the chapter heads
in~\cite{CHAPPELL99} and which I have called \cstyle{chappell} after the
first author. The style, which is shown in \fref{dcchappell}, can easily form
the basis for general heads in non-technical books.
\begin{lcode}
\makechapterstyle{chappell}{%
  \setlength{\beforechapskip}{0pt}
  \renewcommand*{\chapnamefont}{\large\centering}
  \renewcommand*{\chapnumfont}{\large}
  \renewcommand*{\printchapternonum}{%
    \vphantom{\printchaptername}%
    \vphantom{\chapnumfont 1}%
    \afterchapternum
    \vskip -\onelineskip}
  \renewcommand*{\chaptitlefont}{\Large\itshape}
  \renewcommand*{\printchaptertitle}[1]{%
    \hrule\vskip\onelineskip \centering\chaptitlefont ##1}}
\end{lcode}


The style centers the chapter number, draws a rule across the page under
it, and below that comes the title, again centered. All the fiddling
in the \cs{printchapternonum} macro is to try and ensure that the rule
above the title is at the same height whether or not the chapter is numbered
(the ToC being an example of an unnumbered heading).

\subsection{Demo, Demo2 and demo3}

    I created a \cstyle{demo} chapterstyle quite a time ago and used it 
on occasions in earlier editions of this Manual. Here is the original code.
\begin{lcode}
\makechapterstyle{demo}{%
  \renewcommand*{\printchaptername}{\centering}
  \renewcommand*{\printchapternum}{\chapnumfont \numtoName{\c@chapter}}
  \renewcommand*{\chaptitlefont}{\normalfont\Huge\sffamily}
  \renewcommand*{\printchaptertitle}[1]{%
    \hrule\vskip\onelineskip \raggedleft \chaptitlefont ##1}
  \renewcommand*{\afterchaptertitle}%
                {\vskip\onelineskip \hrule\vskip \afterchapskip}
}% end demo
\end{lcode}

This has one serious failing and what I now believe is a poor design 
decision. The failing is that if you have any appendices that use the
\cstyle{demo} chapterstyle then they are numbered instead of being lettered.
The poor design is that the position of the title with respect to the top
of the page is not the same for numbered and unnumbered chapters.
    The \cstyle{demo2} chapterstyle below fixes both of these at the expense
of simplicity (at least for me).
\begin{lcode}
\makechapterstyle{demo2}{%
  \renewcommand*{\printchaptername}{\centering}
  \renewcommand*{\printchapternum}{\chapnumfont 
     \ifanappendix \thechapter \else \numtoName{\c@chapter}\fi}
  \renewcommand*{\chaptitlefont}{\normalfont\Huge\sffamily}
  \renewcommand*{\printchaptertitle}[1]{%
    \hrule\vskip\onelineskip \raggedleft \chaptitlefont ##1}
  \renewcommand*{\afterchaptertitle}{%
    \vskip\onelineskip \hrule\vskip \afterchapskip}
  \setlength{\beforechapskip}{3\baselineskip}
  \renewcommand*{\printchapternonum}{%
    \vphantom{\chapnumfont One}
    \afterchapternum%
    \vskip\topskip}
  \setlength{\beforechapskip}{2\onelineskip}
}% end{demo2}
\end{lcode}
    You may find it instructive to compare the code for the \cstyle{demo} and 
\cstyle{demo2} chapterstyles.

    Thec \cstyle{demo} chapterstyle is still available in the class for
backward compatibility reasons, but I strongly advise against anyone using it.

    By chance I inadvertantly typest a chapterstyle that was a mixture
of the \cstyle{pedersen} and \cstyle{demo2} styles. As a result there is
now a \cstyle{demo3} chapterstyle as well. The only difference between the
two styles is in the definition of \cs{chapnumfont} which in \cstyle{demo3}
is:
\begin{lcode}
\renewcommand*{\chapnumfont}{\normalfont\HUGE\itshape}
\end{lcode}

\subsection{Pedersen}

    I have modified Troels Pedersen's original code to make it a little more
efficient and flexible. 

\begin{lcode}
\newcommand*{\colorchapnum}{}
\newcommand*{\colorchaptitle}{}
\makechapterstyle{pedersen}{%
  \setlength{\beforechapskip}{-20pt}
  \setlength{\afterchapskip}{10pt}
  \renewcommand*{\chapnamefont}{\normalfont\LARGE\itshape}
  \renewcommand*{\chapnumfont}{\normalfont\HUGE\itshape\colorchapnum}
  \renewcommand*{\chaptitlefont}{\normalfont\huge\itshape\colorchaptitle}
  \renewcommand*{\afterchapternum}{}
  \renewcommand*{\printchaptername}{}
  \setlength{\midchapskip}{20mm}
  \renewcommand*{\chapternamenum}{}
  \renewcommand*{\printchapternum}{%
    \sidebar{\raisebox{0pt}[0pt][0pt]{\makebox[0pt][l]{%
      \resizebox{!}{\midchapskip}{\chapnumfont\thechapter}}}}}
  \renewcommand*{\printchaptertitle}[1]{\chaptitlefont ##1}
}
\end{lcode}
The chapter number is scaled up from its normal size and set in a 
sidebar\index{sidebar}.

\begin{syntax}
\cmd{\colorchapnum} \cmd{\colorchaptitle} \\
\end{syntax}
\glossary(colorchapnum)
  {\cs{colorchapnum}}%
  {Color for the number in the \Pcstyle{pedersen} chapterstyle.}
\glossary(colorchaptitle)
  {\cs{colorchaptitle}}%
  {Color for the title in the \Pcstyle{pedersen} chapterstyle.}
  The title is set with \cmd{colorchaptitle} and the number with
\cmd{colorchapnum}, both of which default to doing nothing. 
Lars Madsen\index{Madsen, Lars}
has suggested an attractive red color for these:
\begin{lcode}
\usepackage{color}
\definecolor{ared}{rgb}{.647,.129,.149}
\renewcommand{\colorchapnum}{\color{ared}}
\renewcommand{\colorchaptitle}{\color{ared}}
\chapterstyle{pedersen}
\end{lcode}

    The uncolored version is used for the chaptersyle for this chapter;
because of setting the number in a sidebar\index{sidebar} it does not
display well anywhere other than as a real chapter head.

\subsection{Southall}

    On 2006/01/08 Thomas Dye\index{Dye, Thomas} posted his \cstyle{southall} 
chapterstyle on \url{comp.text.tex} and kindly gave me permission to 
include it here. It is based on the headings in a Cambridge Press 
book\footnote{Which I haven't seen} by Aidan Southall.
It produces a simple numbered heading with the title set as a block paragraph,
and with a horizontal rule underneath. His original code called for lining
figures for the number but I have commented out that bit. I also changed
the code to eliminate the need for the two new lengths that Thomas used.

\begin{lcode}
\makechapterstyle{southall}{%
  \setlength{\afterchapskip}{5\baselineskip}
  \setlength{\beforechapskip}{36pt}
  \setlength{\midchapskip}{\textwidth}
  \addtolength{\midchapskip}{-\beforechapskip}
  \renewcommand*{\chapterheadstart}{\vspace*{2\baselineskip}}
  \renewcommand*{\chaptitlefont}{\huge\rmfamily\raggedright}
  \renewcommand*{\chapnumfont}{\chaptitlefont}
  \renewcommand*{\printchaptername}{}
  \renewcommand*{\chapternamenum}{}
  \renewcommand*{\afterchapternum}{}
  \renewcommand*{\printchapternum}{%
    \begin{minipage}[t][\baselineskip][b]{\beforechapskip}
      {\vspace{0pt}\chapnumfont%%%\figureversion{lining} 
                   \thechapter}
    \end{minipage}}
  \renewcommand*{\printchaptertitle}[1]{%
    \hfill\begin{minipage}[t]{\midchapskip}
      {\vspace{0pt}\chaptitlefont ##1\par}\end{minipage}}
  \renewcommand*{\afterchaptertitle}{%
    \par\vspace{\baselineskip}%
    \hrulefill \par\nobreak\noindent \vskip\afterchapskip}}
\end{lcode}

The resulting style is shown in \fref{dcsouthall}.


\subsection{Veelo}

    Bastiaan Veelo 
posted the code for a new chapter style to \pixctt\ on 2003/07/22 under the
title \textit{[memoir] [contrib] New chapter style}. His code, which
I have slightly modified and changed the name to \cstyle{veelo},
is below. I have also exercised editorial privilege on his comments.

\begin{quote}
 I thought I'd share a new chapter style to be used with the memoir class. 
 The style is tailored for documents that are to be trimmed to a smaller 
 width. When the bound document is bent, black tabs will appear on the 
 fore side at the places where new chapters start as a navigational aid.
 We are scaling the chapter number, which most DVI viewers
 will not display accurately. \\[0.5\onelineskip]
Bastiaan.
\end{quote}

    In the style as I modified it, \lnc{\beforechapskip} is used as the 
height of the number and \lnc{\midchapskip} is used as the length of the
black bar.
\begin{lcode}
\newlength{\numberheight}
\newlength{\barlength}
\makechapterstyle{veelo}{%
  \setlength{\afterchapskip}{40pt}
  \renewcommand*{\chapterheadstart}{\vspace*{40pt}}
  \renewcommand*{\afterchapternum}{\par\nobreak\vskip 25pt}
  \renewcommand*{\chapnamefont}{\normalfont\LARGE\flushright}
  \renewcommand*{\chapnumfont}{\normalfont\HUGE}
  \renewcommand*{\chaptitlefont}{\normalfont\HUGE\bfseries\flushright}
  \renewcommand*{\printchaptername}{%
    \chapnamefont\MakeUppercase{\@chapapp}}
  \renewcommand*{\chapternamenum}{}
  \setlength{\beforechapskip}{18mm}
  \setlength{\midchapskip}{\paperwidth}
  \addtolength{\midchapskip}{-\textwidth}
  \addtolength{\midchapskip}{-\spinemargin}
  \renewcommand*{\printchapternum}{%
    \makebox[0pt][l]{\hspace{.8em}%
      \resizebox{!}{\numberheight}{\chapnumfont \thechapter}%
      \hspace{.8em}%
      \rule{\midchapskip}{\beforechapskip}%
     }}%
   \makeoddfoot{plain}{}{}{\thepage}}
\end{lcode}


    If you use this style you will also need to use the \Lpack{graphicx} 
package~\cite{GRAPHICX} because of the \cmd{\resizebox} macro. 
The \cstyle{veelo} style works best for chapters that start 
on recto pages.

\index{chapterstyle|)}

\endgroup


%#% extend
%#% extstart include sniplets.tex


\svnidlong
{$Ignore: $}
{$LastChangedDate: 2015-03-05 18:49:59 +0100 (Thu, 05 Mar 2015) $}
{$LastChangedRevision: 516 $}
{$LastChangedBy: daleif $}


\defaultlists


\LMnote{2010/02/09}{Started the sniplet chapter}
\chapter{Sniplets}
\label{cha:sniplets}

\cftinserthook{toc}{start-sniplets}


This chapter is (over time) meant to hold various pieces of code for
\theclass\ that we have gathered over the years or others have
contributed, and which we think might be useful for others.  In some
cases they will have been moved from the text to this place, in order
to make the manual less cluttered.


If you have some \theclass\ related code you would like to share, feel
free to send it to \verb?daleif@math.au.dk?.



\sniplettoc


\begin{sniplet}[Mirroring the output]\label{snip:1}
  The \theclass\ class is not quite compatible with the \Lpack{crop}
  package. This is usually not a problem as we provide our own
  crop marks. But \Lpack{crop} provide one feature that we do not:
  mirroring of the output. The following sniplet was posted on
  \textsc{ctt} by Heiko Oberdiek (2009/12/05, thread \textit{
    Memoir and mirrored pdf output })
  \begin{lcode}
    \usepackage{atbegshi} 
    \usepackage{graphicx}
    \AtBeginShipout{%
      \sbox\AtBeginShipoutBox{%
        \kern-1in\relax
        \reflectbox{%
          \rlap{\kern1in\copy\AtBeginShipoutBox}%
          \kern\stockwidth
        }%
      }%
    } 
  \end{lcode}
\end{sniplet}

\begin{sniplet}[Remove pagenumber if only one page]\label{snip:2}
  Memoir counts all the pages used. You can use this information
  in various ways. For example, say you are preparing a setup to write
  small assignments in, these may or may not be just one page. How do
  we remove the footer automatically if there is only one page?

  Easy, place the following in the preamble (compile at least twice):
  \begin{lcode}
    \AtEndDocument{\ifnum\value{lastsheet}=1\thispagestyle{empty}\fi}
  \end{lcode}
\end{sniplet}

\begin{sniplet}[A kind of draft note]\label{snip:veelo}
  Bastiaan Veelo\index{Veelo, Bastiaan} has kindly provided example code 
  for another form of a side note, as follows.
\begin{lcode}
%% A new command that allows you to note down ideas or annotations in
%% the margin of the draft. If you are printing on a stock that is wider
%% than the final page width, we will go to some length to utilise the
%% paper that would otherwise be trimmed away, assuming you will not be
%% trimming the draft. These notes will not be printed when we are not
%% in draft mode.
\makeatletter
   \ifdraftdoc
     \newlength{\draftnotewidth}
     \newlength{\draftnotesignwidth}
     \newcommand{\draftnote}[1]{\@bsphack%
       {%% do not interfere with settings for other marginal notes
         \strictpagecheck%
         \checkoddpage%
         \setlength{\draftnotewidth}{\foremargin}%
         \addtolength{\draftnotewidth}{\trimedge}%
         \addtolength{\draftnotewidth}{-3\marginparsep}%
         \ifoddpage
           \setlength{\marginparwidth}{\draftnotewidth}%
           \marginpar{\flushleft\textbf{\textit{\HUGE !\ }}\small #1}%
         \else
           \settowidth{\draftnotesignwidth}{\textbf{\textit{\HUGE\ !}}}%
           \addtolength{\draftnotewidth}{-\draftnotesignwidth}%
           \marginpar{\raggedleft\makebox[0pt][r]{%% hack around
               \parbox[t]{\draftnotewidth}{%%%%%%%%% funny behaviour
                 \raggedleft\small\hspace{0pt}#1%
               }}\textbf{\textit{\HUGE\ !}}%
           }%
         \fi
       }\@esphack}
   \else
     \newcommand{\draftnote}[1]{\@bsphack\@esphack}
   \fi
\makeatother
\end{lcode}
Bastiaan also noted that it provided an example of using the
\lnc{\foremargin} length.  If you want to try it out, either put the
code in your preamble, or put it into a package (i.e., \file{.sty}
file) without the \cs{makeat...} commands.
\end{sniplet}


\LMnote{2010/03/12}{Added this sniplet inspired by a thread on ctt}
\begin{sniplet}[Adding indentation to footnotes]

At times a document design calls for a footnote configuration equal to
the default but everything indented more to the right. This can be
achieved via
\begin{lcode}
  \newlength\myextrafootnoteindent
  \setlength\myextrafootnoteindent{\parindent}
  \renewcommand\makefootmarkhook{%
    \addtolength{\leftskip}{\myextrafootnoteindent}} 
\end{lcode}
In this example we indent the footnotes to match the overall paragraph
indentation. We need to save the current value of \verb?\parindent?
since it is reset in the footnotes.
  
\end{sniplet}


\LMnote{2010/03/12}{Added this sniplet inspired by a thread on ctt}
\begin{sniplet}[Background image and trimmarks]
This sniplet comes from another problem described in \textsc{ctt}. If
one use the \Lpack{eso-pic} package to add a background image, this
image ends up on top of the trim marks. To get it \emph{under} the
trim marks Rolf Niepraschk suggested the following trick
\begin{lcode}
\RequirePackage{atbegshi}\AtBeginShipoutInit
\documentclass[...,showtrims]{memoir}
...
\usepackage{eso-pic}
...
\end{lcode}
  
\end{sniplet}


\LMnote{2012/09/21}{Sniplet showcasing autoadjusting numwidths in the toc}
\begin{sniplet}[Autoadjusted number widths in the ToC]
  \label{snip:autotoc}

  When the \toc{} is typeset the chapter, section etc. number is
  typeset within a box of a certain fixed with (one width for each
  sectional type).  If this width is too small for the current
  document, the user have to manually adjust this width.

  In this sniplet we present a method where we automatically record
  the widest.

  It a later \theclass\ version, we may add similar code to the core.

  There are two ways to record the widest entries of the various
  types, either preprocess the entire \toc{} or measure it as a part
  of the \toc{} typesetting, store it in the \texttt{.aux} and reuse
  it on the next run. We will use the later approach. There is one
  caveat: The \texttt{.aux} file is read at \verb|\begin{document}|,
    so we need to postpone our adjustments via \verb|\AtBeginDocument|.

  The following solution use some \toc{} related hooks within the
  class, plus the \Lpack{etoolbox} and \Lpack{calc} packages.

  First we create some macros to store information within the
  \texttt{.aux} file, and retrieve it again.

  \begin{lcode}
    \makeatletter
    \newcommand\mem@auxrestore[2]{\csgdef{stored@value@#1}{#2}}
    \newcommand\memstorevalue[2]{%
      \@bsphack%
      \immediate\write\@mainaux{\string\mem@auxrestore{#1}{#2}}%
      \@esphack}
    \newcommand\RetrieveStoredLength[1]{%
      \ifcsdef{stored@value@#1}{\csuse{stored@value@#1}}{0pt}}%
    \makeatletter
  \end{lcode}
  Here \cs{RetrieveStoredLength} can be used in most \cmd{\setlength}
  cases, at least when the \Lpack{calc} package is loaded. The
  argument will be the name of the variable one asked to be stored. If
  no corresponding value has been found for a given name, 0\,pt is returned.

  Next we need to prepare the hooks. In this case we will show how to
  take care of \cmd{\chapter}, \cmd{\section} and \cmd{\subsection}.
  \cmd{\chapter} is relatively easy:\footnote{In some cases you may
    want to use \texttt{%
      \{%
      \cs{@chapapp@head}%
      \cs{@cftbsnum} 
      \#1%
      \cs{@cftasnum}%
      \}%
    }}
  \begin{lcode}
    \newlength\tmplen        % scratch length
    \newlength\widestchapter % guess, they are zero by default
    \renewcommand\chapternumberlinehook[1]{%
      \settowidth\tmplen{\hbox{\cftchapterfont#1}}%
      \ifdimgreater\tmplen\widestchapter{%
        \global\widestchapter=\tmplen}{}}
  \end{lcode}
  We use an alternative syntax to make the \cs{widestchapter} global.

  Handling \cmd{\section} and \cmd{\subsection} is slightly more
  tricky, as they both use \cmd{numberline}. Instead we rely on the
  local value of the magic macro \cmd{\cftwhatismyname}. 
  \begin{lcode}
    \newlength\widestsection
    \newlength\widestsubsection
    \renewcommand\numberlinehook[1]{%
      % use a loop handler to loop over a list of possible
      % types. \forcsvlist comes from etoolbox
      \forcsvlist{\ToCHookListHandler{#1}}{section,subsection,subsubsection,%
        paragraph,subparagraph,figure,table}}
    % the actual handler.
    \newcommand\ToCHookListHandler[2]{%
      \edef\tmpstr{#2}%
      \ifdefstrequal{\cftwhatismyname}{\tmpstr}{%
        \settowidth\tmplen{\hbox{\csuse{cft\cftwhatismyname font}#1}}%
        \ifcslength{widest#2}{% is this length defined?
          \ifdimgreater\tmplen{\csuse{widest#2}}{%
            \global\csuse{widest#2}=\tmplen}{}}{}}{}}
  \end{lcode}
  Even though the list mention more macros, we only use those we have
  added corresponding lengths for.

  Next we need to store the values at the end of the document
  \begin{lcode}
    \AtBeginDocument{\AtEndDocument{
        \memstorevalue{widestchapter}{\the\widestchapter}
        \memstorevalue{widestsection}{\the\widestsection}
        \memstorevalue{widestsubsection}{\the\widestsubsection}
      }}
  \end{lcode}

  Here is how to get the standard class setup for a three level
  TOC. We also add a little extra padding to the boxes. Remember that
  it may take a few compilations before the \toc{} settles down.
  \begin{lcode}
    \newlength\cftnumpad         % padding
    \setlength\cftnumpad{0.5em}
    \AtBeginDocument{
      \cftsetindents{chapter}{0pt}{%
        \RetrieveStoredLength{widestchapter}+\cftnumpad}
      \cftsetindents{section}{%
        \cftchapterindent+\cftchapternumwidth}{%
        \RetrieveStoredLength{widestsection}+\cftnumpad}
      \cftsetindents{subsection}{%
        \cftsectionindent+\cftsectionnumwidth}{%
        \RetrieveStoredLength{widestsubsection}+\cftnumpad}
    }
  \end{lcode}
\end{sniplet}


\begin{sniplet}[Using class tools to make a chapter ToC]
  \label{snip:chaptertoc}

  By using a few hooks, we will be able to create a simple chapter
  toc. First a few notes:
  \begin{enumerate}[(a)]
    \setlength\itemsep{0.5em}
  \item In this class, the TOC data can be reused, thus we can load
    the TOC data as many times as we would like.
  \item Data in the TOC is stored as arguments the \cs{contentsline}
    macro, say (see also \fref{fig:tocloflotfiles} on
    page~\pageref{fig:tocloflotfiles})
\begin{verbatim}
\contentsline{chapter}{\chapternumberline {1}Test}{3}
\end{verbatim}
   where the first argument determins which macro is used to process
   the data. Each of these macros look at the value of the \Pcn{tocdepth}
   counter to know whether to typeset or not. 
 \item Using some hooks we can insert local changes to \Pcn{tocdepth}
   in order to only typeset the sections from the current chapter.
 \end{enumerate}
 
The idea is to be able to add hooks at key points in the \toc{} data,
and then use these hooks to enable and disable typesetting.

We will need to add hooks just after a chapter line (like the one
above), and we will need to be able to insert hooks just before items
that mark the end of a chapter, that is the next \cmd{\chapter},
\cmd{\part}, \cmd{\book}, plus a macro like \cmd{\appendixpage} which
also write to the \toc{}.





 
  First we define hooks that add hooks into the TOC. We use a counter
  to make each start and end hook unique. We add \emph{end markers}
  above the \toc{} entries for \cs{chapter}, \cs{part} and
  \cs{book}.
\begin{lcode}
\newcounter{tocmarker}
\renewcommand\mempreaddchaptertotochook{\cftinserthook{toc}{end-\thetocmarker}}
\renewcommand\mempreaddparttotochook   {\cftinserthook{toc}{end-\thetocmarker}}
\renewcommand\mempreaddbooktotochook   {\cftinserthook{toc}{end-\thetocmarker}}
\renewcommand\mempreaddapppagetotochook{\cftinserthook{toc}{end-\thetocmarker}}
% start marker
\renewcommand\mempostaddchaptertotochook{%
  \stepcounter{tocmarker}\cftinserthook{toc}{start-\thetocmarker}}
\let\normalchangetocdepth\changetocdepth % for later
\end{lcode}
The hooks inserted into the TOC file, does nothing by default. You
will notice that the line above will now look like:
\begin{verbatim}
\cftinsert {end-0}
\contentsline{chapter}{\chapternumberline {1}Test}{3}
\cftinsert {start-1}
...
\cftinsert {end-1}
\contentsline{chapter}{\chapternumberline {2}Test}{5}
\end{verbatim}
Thus to get a chapter toc command we need to make sure that (1) all
entries are disabled, (2) at \texttt{start-1} we reenable TOC entries,
and (3) at \texttt{end-1} disable TOC entries again. Here is the rest
of the code, explained via comments.
\begin{lcode}
\makeatletter
\newcommand\chaptertoc{
  % make changes local, remember counters a global
  \begingroup
  % store current value, to be restored later
  \setcounter{@memmarkcntra}{\value{tocdepth}}
  % when ever \settocdepth is used, it adds the new value to the 
  % ToC data. This cause problems when we want to disable all
  % entries. Luckily the data is added via a special macro, we we
  % redefine it, remember we stored the original value earlier.
  \let\changetocdepth\@gobble
  % disable all entries (using our copy from above)
  \normalchangetocdepth{-10}
  % enable toc data within our block, we go as far as subsubsection
  \cftinsertcode{start-\thetocmarker}{\normalchangetocdepth{3}}
  % when the block is done, disable the remaining
  \cftinsertcode{end-\thetocmarker}{\normalchangetocdepth{-10}}
  % remove the spacing above the toc title
  \let\tocheadstart\relax
  % remove the toc title itself
  \let\printtoctitle\@gobble
  % remove space below title
  \let\aftertoctitle\relax
  % reformat TOC entries:
  \setlength{\cftsectionindent}{0pt}
  \setlength{\cftsubsectionindent}{\cftsectionnumwidth}
  \setlength{\cftsubsubsectionindent}{\cftsubsectionindent}
  \addtolength{\cftsubsubsectionindent}{\cftsubsectionnumwidth}
  \renewcommand\cftsectionfont{\small}
  \renewcommand\cftsectionpagefont{\small}
  \renewcommand\cftsubsectionfont{\small}
  \renewcommand\cftsubsectionpagefont{\small}
  \renewcommand\cftsubsubsectionfont{\small}
  \renewcommand\cftsubsubsectionpagefont{\small}
  % include the actual ToC data
  \tableofcontents*
  \endgroup
  % restore tocdepth
  \setcounter{tocdepth}{\value{@memmarkcntra}}
  % to indent or not after the chapter toc
  \m@mindentafterchapter
  % space between chapter toc and text
  \par\bigskip
  % handles indentation after the macro
  \@afterheading}
\makeatother
\end{lcode}
\end{sniplet}

Note that if the \cmd{\chapterprecistoc} or \cmd{\chapterprecis} has
been used then that data is also added to the \toc{} data, and we will
need to locally disable it in the chapter \toc{}. This can be done by
adding
\begin{lcode}
  \let\precistoctext\@gobble
\end{lcode}
to the \cmd{\chaptertoc} definition above, just make sure it is added
before calling
before \cmd{\tableofcontents*}.


%%%%%
%%  Appendix ToC
%%%%


\begin{sniplet}[An appendix ToC]
  \label{snip:apptoc}
  Here we assume a structure like
\begin{verbatim}
\tableofcontents*
\chapter
\chapter
\chapter
\appendix
\appendixpage
\appendixtableofcontents
\chapter
\chapter
\chapter
\end{verbatim}
where the first \toc{} should just show until (and including) 
\cmd{\appendixpage}, and \cmd{\appendixtableofcontents} should only
list the appendices. 

We also assume that no \cmd{\settocdepth}'s have been issued after
\cmd{\appendixpage}.


We only need a single hook after \cmd{\appendixpage}.
\begin{lcode}
\renewcommand\mempostaddapppagetotochook{\cftinserthook{toc}{BREAK}}
\cftinsertcode{BREAK}{\changetocdepth{-10}}
\let\normalchangetocdepth\changetocdepth     % needed for later
\end{lcode}
Then the definition of the actual appendix \toc{}:
\begin{lcode}
\makeatletter
\newcommand\appendixtableofcontents{
  \begingroup
  \let\changetocdepth\@gobble
  \normalchangetocdepth{-10}
  \cftinsertcode{BREAK}{\normalchangetocdepth{3}}
  \renewcommand\contentsname{Appendices overview}
  \tableofcontents*
  \endgroup
}
\makeatother
\end{lcode}


\end{sniplet}




\cftinserthook{toc}{end-sniplets}

%#% extend
%#% extstart include pictures.tex

\svnidlong
{$Ignore: $}
{$LastChangedDate: 2014-03-31 11:34:44 +0200 (Mon, 31 Mar 2014) $}
{$LastChangedRevision: 480 $}
{$LastChangedBy: daleif $}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\LMnote{2010/02/08}{Added this entire chapter from PW sources}


\chapter{Pictures}  \label{chap:lpic}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\LMnote{2010/02/08}{Added this intro to show the motivation for adding
this}
\LMnote{2010/02/17}{fixed typo from Adriano Pascoletti}
There are many freely available \ltx\ introductions on \ctan\ and
other places. One thing that these apparently are not covering is the
traditional picture environment. It can be very handy in many
applications, though for more complex drawings the reader might be
better of with TiKz/pgf or PSTricks. For the benefit of the general
reader we here provide a lesson in the standard picture environment.

\LMnote{2010/02/08}{Added a writers note as not to change the text too
much, the most important thing about this note is the mentioning of
the picture package by Heiko, which enables us to use something like
\cs{put}(5mm, 5cm)}
\emph{Writers comment:} There are many extensions to the stock picture
environment provided by the \ltx\ kernel. We have chosen not to deal
with them in this chapter but instead concentrate on what you get as
is from the kernel. But there are a few handy packages that the reader
might want to explore: picture (by Heiko Oberdiek) which extends the
\cs{put} syntax to include arbitrary lengths, like 50mm; pict2e which
is mentioned in \cite{GCOMPANION} but just recently was released;
eepic. All packages are available from \ctan.



\fancybreak{}


    This chapter describes how to draw diagrams\index{diagram} and 
pictures\index{picture} using \ltx.
Pictures are drawn in the \Ie{picture} environment. You can draw\index{draw} 
straight
lines, arrows and circles; you can also put text into your pictures.

    Most often pictures are drawn within a \Ie{figure}\index{figure} 
environment, but
they may also be drawn as part of the normal text.




\section{Basic principles}

    The positions of picture elements are specified in terms of a 
two-dimensional cartesian coordinate\index{coordinate system} system. 
A \emph{coordinate}\index{coordinate} is a
number, such as \texttt{7}, \texttt{-21} or \texttt{1.78}. In the cartesian coordinate
system, a pair of coordinates (i.e., a pair of numbers) specifies a
position relative to the position designated as \texttt{(0,0)}. This special
position is called the \emph{origin}. 
The first of the coordinate pair\index{coordinate pair}
gives the value of the horizontal distance from the origin to the position.
A positive coordinate is an offset to the right and a negative number is
an offset to the left. The first value of a coordinate pair is called the
\emph{x coordinate}\index{coordinate}. 
The second value of a coordinate pair is called the
\emph{y coordinate}\index{coordinate} 
and gives the vertical offset from the origin (positive
upwards and negative downwards).

\begin{syntax}
\lnc{\unitlength} \\
\end{syntax}
\glossary(unitlength)
{\cs{unitlength}}{The unit of length in a picture environment. Default 1pt.}
    To draw a picture we also need to specify the units of measurement.
By default, \ltx\ takes the printer's point (there are 72.27 points to
an inch) as the measurement of length. The value of the unit of 
length\index{unit length} measurement
within a \Ie{picture} environment is actually given by the value
of the \lnc{\unitlength} length declaration.
 This can be changed
to any length that you like via the \cmd{\setlength} command. For example, \\
\verb?\setlength{\unitlength}{2mm}? \\
will make the value of \lnc{\unitlength} to be two millimeters.

    Figure~\ref{flpic:coords} shows the positions of some points and their
coordinate values. Coordinate pairs are typed as a pair of numbers, separated
by a comma, and enclosed in parentheses.

\begin{figure}
\setlength{\unitlength}{1mm}
\centering
\begin{picture}(80,70)
  \thicklines
% x axis
  \put(10,30){\begin{picture}(60,10)
    \thicklines \put(-5,0){\vector(1,0){65}}
    \thinlines  \multiput(0,0)(10,0){6}{\line(0,1){3}}
    \put(0,-3){\makebox(0,0)[t]{-20}}
    \put(10,-3){\makebox(0,0)[t]{-10}}
    \put(23,-3){\makebox(0,0)[t]{0}}
    \put(30,-3){\makebox(0,0)[t]{10}}
    \put(40,-3){\makebox(0,0)[t]{20}}
    \put(50,-3){\makebox(0,0)[t]{30}}
    \put(63,0){\makebox(0,0){x}}
    \end{picture}}
% y axis
  \put(30,10){\begin{picture}(10,60)
    \thicklines \put(0,-5){\vector(0,1){60}}
    \thinlines \multiput(0,0)(0,10){6}{\line(1,0){3}}
    \put(-3,0){\makebox(0,0)[r]{-20}}
    \put(-3,10){\makebox(0,0)[r]{-10}}
    \put(-3,30){\makebox(0,0)[r]{10}}
    \put(-3,40){\makebox(0,0)[r]{20}}
    \put(-3,50){\makebox(0,0)[r]{30}}
    \put(0,58){\makebox(0,0)[b]{y}}
    \end{picture}}

  \put(50,50){\begin{picture}(10,10)
    \put(0,0){\circle*{1}}
    \put(2,2){\makebox(0,0)[bl]{\texttt{(20,20)}}}
    \end{picture}}

  \put(15,45){\begin{picture}(10,10)
    \put(0,0){\circle*{1}}
    \put(-2,2){\makebox(0,0)[br]{\texttt{(-15,15)}}}
    \end{picture}}

  \put(15,20){\begin{picture}(10,10)
    \put(0,0){\circle*{1}}
    \put(-2,-2){\makebox(0,0)[tr]{\texttt{(-15,-10)}}}
    \end{picture}}

  \put(40,20){\begin{picture}(10,10)
    \put(0,0){\circle*{1}}
    \put(2,-2){\makebox(0,0)[tl]{\texttt{(10,-10)}}}
    \end{picture}}


\end{picture}
\setlength{\unitlength}{1pt}
\caption{Some points in the cartesian coordinate system}
\label{flpic:coords}
\end{figure}


\begin{syntax}
\cmd{\thinlines} \\
\cmd{\thicklines} \\
\cmd{\linethickness}\marg{len} \\
\end{syntax}
\glossary(thinlines)
{\cs{thinlines}}{Picture declaration for lines to be thin.}
\glossary(thicklines)
{\cs{thicklines}}{Picture declaration for lines to be thick.}
\glossary(linethickness)
{\cs{linethickness}\marg{len}}{Picture declaration for vertical and 
  horizontal lines to be \meta{len} thick.}

   In general, \ltx\ can draw lines of only two 
thicknesses\indextwo{thickness}{line}, 
thin and thick. The required
thickness is specified via either a \cmd{\thicklines} or a \cmd{\thinlines}
declaration, with the latter being the default. 

There is another declaration, \cmd{\linethickness}, which can be used 
to change the thickness of horizontal and vertical lines only.
It sets the thickness of these lines to \meta{len}, but has no effect on
any sloping lines.

    A \Ie{picture} environment has a required size pair argument that
specifies the width and height of the picture, in terms of the value
of \cmd{\unitlength}.
\begin{syntax}
\senv{picture}\parg{width, height} 
\meta{contents} 
\eenv{picture} \\
\senv{picture}\parg{width, height}\parg{llx, lly} 
\meta{contents} 
\eenv{picture} \\
\end{syntax}
\glossary(picture)
{\senv{picture}\parg{width, height}}{Creates a box of \meta{width} times 
  \meta{height} (in terms of \cs{unitlength}) in which you can use drawing
   commands. The origin is at (0,0).}
\glossary(picturex)
{\senv{picture}\parg{width, height}\parg{llx,lly}}{Creates a box of \meta{width} times 
  \meta{height} (in terms of \cs{unitlength}) in which you can use drawing
  commands. The origin is at (\meta{llx},\meta{lly}).}
 The environment creates a box\indextwo{box}{picture} 
of size \meta{width} by \meta{height}, which will not be
split\index{box!unbreakable} across pages. The default position of
the origin in this environment is at the lower left hand corner of the box.
For example,
\begin{lcode}
\begin{picture}(80,160)
\end{lcode}
creates a picture box of width 80 and height 160 whose lower left hand corner
is at \texttt{(0,0)}. There is also an optional coordinate pair argument (which
comes after the required argument) that specifies the coordinates of the
lower left hand corner of the box if you do not want the default origin.
\begin{lcode}
\begin{picture}(80,160)(10,20)
\end{lcode}
specifies a picture box of width 80 and height 160, as before, but with
the bottom left hand corner having coordinates of \texttt{(10,20)}. Thus, the
top right hand corner will have coordinates \texttt{(90,180)}. Note that the
optional argument is enclosed in parentheses not square brackets as is 
ordinarily the case. Typically, the optional argument is used when you
want to shift everything in the picture. \ltx\ uses the required argument
to determine the space required for typesetting the result. 

    You are not limited to drawing within the box, but if you do draw 
outside the box the result might run into other text on the page, or even 
run off the page altogether. \ltx\ only reserves the space you specify
for the picture and does not know if anything protrudes. In particular
\begin{lcode}
\begin{picture}(0,0)
\end{lcode}
creates a zero-sized\index{picture!zero-sized} picture which takes no
space at all. This can be very useful if you need to position
things on the page.


\LMnote{2010/02/17}{fixed typo from Adriano Pascoletti}
    Within the \Ie{picture} environment, \ltx\ is in a special \emph{picture}
mode\indextwo{mode}{picture} (which is a restriced form of LR 
mode\indextwo{mode}{LR}).
The only commands that can appear in picture mode are  \cmd{\put}, 
\cmd{\multiput} and \cmd{\qbezier} commands, and a few
declarations such as the type style and the thickness declarations.
By the way,
you should only change the value of \cmd{\unitlength} outside 
picture mode\indextwo{mode}{picture}
otherwise \ltx\ will get confused about its measurements.

\section{Picture objects}

    In a picture everything is placed and drawn by the \cmd{\put} (or
its \cmd{\multiput} variant) command.
\begin{syntax}
\cmd{\put}\parg{x, y}\marg{object} \\
\end{syntax}
\glossary(put)
{\cs{put}\parg{x,y}\marg{object}}{Drawing command to place \meta{object}
at coordinates (\meta{x,y}). In the simplest case \meta{object} 
is just text.}
\cmd{\put} places \meta{object} in the picture with the 
object's \emph{reference point}\index{reference point}
 at position \parg{x, y}.

    The following sections describe the various picture 
objects\index{picture object}.

\subsection{Text}

    Text\index{picture object!text} is the simplest kind of picture object. 
This is typeset in LR mode\indextwo{mode}{LR} and the 
reference point\index{reference point!text} is at 
the lower left hand corner of the text.
\begin{egsource}{eg:pic1}
\setlength{\unitlength}{1mm}  % measurements in millimeters
\begin{picture}(30,10)        % define size of picture
\put(0,0){\framebox(30,10){}} % draw frame around picture
\put(10,5){Some text}         % place text 
\thicklines
\put(10,5){\vector(1,1){0}}   % mark reference point
\end{picture}
\setlength{\unitlength}{1pt}  % reset measurements to default
\end{egsource}

\begin{egresult}[Picture: text]{eg:pic1}
\vspace*{0.5\onelineskip}
\setlength{\unitlength}{1mm}
\begin{picture}(30,10)
\put(0,0){\framebox(30,10){}}
\put(10,5){Some text}
\thicklines
\put(10,5){\vector(1,1){0}}
\end{picture}
\setlength{\unitlength}{1pt}
\end{egresult}

    In the diagram, and those following, 
the reference point is indicated by an arrow. Also, a
box is drawn round the diagram at the same size as the \Ie{picture}
environment.

\subsection{Boxes} \label{slpic:boxes}

    A box\index{picture object!box} picture object is made with one of 
the box\index{box} commands. When used
in picture mode\indextwo{mode}{picture}, the box commands have a slightly 
different form than when
in normal text. The first argument of a box command is a size pair
that specifies the width and height of the box. The last argument is the
text to be placed in the box. The reference point\indextwo{reference point}{box} 
of a box is the lower left hand corner.
\begin{syntax}
\cmd{\framebox}\parg{width, height}\oarg{pos}\marg{text} \\
\cmd{\makebox}\parg{width, height}\oarg{pos}\marg{text} \\
\end{syntax}
\glossary(framebox)
{\cs{framebox}\parg{width,height}\oarg{pos}\marg{text}}{A picture
object framing \meta{text} (at position \meta{pos}) in a box \meta{width} 
by \meta{height}.}
\glossary(makebox)
{\cs{makebox}\parg{width,height}\oarg{pos}\marg{text}}{A picture
object putting \meta{text} (at position \meta{pos}) in a box \meta{width} 
by \meta{height}.}
    The \cmd{\framebox} command draws a 
framed box\indextwo{box}{framed}\index{picture object!framed box}
of the specified \parg{width, height} dimensions around
the text.

\begin{egsource}{eg:pic2}
\setlength{\unitlength}{1pc}
\begin{picture}(22,5)
\put(0,0){\framebox(22,5){}}             % empty box
\thicklines
\put(2,1){\framebox(5,2.5){center}}      % centered text
\put(2,1){\vector(1,1){0}}               % ref point
\put(9,1){\framebox(5,2)[b]{bottom}}     % bottomed text
\put(9,1){\vector(1,1){0}}               % ref point
\put(16,1){\framebox(5,3)[tl]{top left}} % cornered text
\put(16,1){\vector(1,1){0}}              % ref point
\end{picture}
\setlength{\unitlength}{1pt}
\end{egsource}

\begin{egresult}[Picture: text in boxes]{eg:pic2}
\vspace*{0.5\onelineskip}
\setlength{\unitlength}{1pc}
\begin{picture}(22,5)
\put(0,0){\framebox(22,5){}}
\thicklines
\put(2,1){\framebox(5,2.5){center}}
\put(2,1){\vector(1,1){0}}
\put(9,1){\framebox(5,2)[b]{bottom}}
\put(9,1){\vector(1,1){0}}
\put(16,1){\framebox(5,3)[tl]{top left}}
\put(16,1){\vector(1,1){0}}
\end{picture}
\setlength{\unitlength}{1pt}
\end{egresult}

    The default position\index{picture object!framed box!text position} 
of the \textit{text} is centered in the box. 
However, this can
be changed via an optional argument (which is enclosed in square brackets),
placed between the coordinate pair and the text argument. This argument 
consists of either one or two of the following letters.
\begin{itemize}
\item[\pixposarg{l}] (left) Places the contents at the left of the box.
\item[\pixposarg{r}] (right) Places the contents at the right of the box.
\item[\pixposarg{t}] (top) Places the contents at the top of the box.
\item[\pixposarg{b}] (bottom) Places the contents at the bottom of the box.
\end{itemize}
These place the text in the corresponding position in the box. In a two-letter
argument the order of the letters is immaterial. For example, \verb?[tr]?
and \verb?[rt]? will both result in the text being placed at the top right
hand corner of the box. Unlike the normal \cmd{\framebox} command, a 
\cmd{\framebox} in a \Ie{picture} environment does not add any extra space
around the text.

    Corresponding to the \cmd{\framebox} there is a \cmd{\makebox} 
command\index{picture object!unframed box} which
does not draw a frame around its contents. The \cmd{\makebox} command takes the
same arguments as the \cmd{\framebox}. Particularly interesting is when you
specify a zero sized\index{picture object!unframed box!zero size} 
\cmd{\makebox}. A \verb?\makebox(0,0){text}?
command will make the reference point the center of \texttt{text}. Similarly,
the other positioning arguments\index{picture object!unframed box!text position}
which will adjust the reference point with respect to
the box contents. This can be used for fine-tuning the position of text
in a picture.

\begin{egsource}{eg:pic3}
\setlength{\unitlength}{1pc}
\begin{picture}(16,2)
\put(0,0){\framebox(16,2){}}
\thicklines
\put(3.5,1){\makebox(0,0){center}}      % ref at text center
\put(3.5,1){\vector(0,-1){0}}
\put(7,1){\makebox(0,0)[b]{bottom}}     % ref at text bottom
\put(7,1){\vector(0,1){0}}
\put(11,1){\makebox(0,0)[tl]{top left}} % ref at text top left
\put(11,1){\vector(1,-1){0}}
\end{picture}
\setlength{\unitlength}{1pt}
\end{egsource}

\begin{egresult}[Picture: positioning text]{eg:pic3}
\vspace{0.5\onelineskip}
\setlength{\unitlength}{1pc}
\begin{picture}(16,2)
\put(0,0){\framebox(16,2){}}
\thicklines
\put(3.5,1){\makebox(0,0){center}}
\put(3.5,1){\vector(0,-1){0}}
\put(7,1){\makebox(0,0)[b]{bottom}}
\put(7,1){\vector(0,1){0}}
\put(11,1){\makebox(0,0)[tl]{top left}}
\put(11,1){\vector(1,-1){0}}
\end{picture}
\setlength{\unitlength}{1pt}
\end{egresult}

    You can draw a dashed box\index{picture object!dashed box} 
with the \cmd{\dashbox} command.
\begin{syntax}
\cmd{\dashbox}\marg{len}\parg{width, height}\oarg{pos}\marg{text} \\
\end{syntax}
\glossary(dashbox)
{\cs{dashbox}\marg{len}\parg{width,height}\oarg{pos}\marg{text}}{A picture
object framing \meta{text} (at position \meta{pos}) in a dashed box 
\meta{width} by \meta{height}. The dashes and spaces are each \meta{len} long.}
 The first argument
of this command specifies the length of each dash. The following arguments
are the same as for the other box commands.

\begin{egsource}{eg:pic4}
\setlength{\unitlength}{4mm}
\begin{picture}(7,4)
\put(0,0){\framebox(7,4){}}
\thicklines
\put(1,1){\dashbox{0.5}(5,2)[tr]{top right}}
\put(1,1){\vector(1,1){0}}
\end{picture}
\setlength{\unitlength}{1pt}
\end{egsource}

\begin{egresult}[Picture: dashed box]{eg:pic4}
\vspace{0.5\onelineskip}
\setlength{\unitlength}{4mm}
\begin{picture}(7,4)
\put(0,0){\framebox(7,4){}}
\thicklines
\put(1,1){\dashbox{0.5}(5,2)[tr]{top right}}
\put(1,1){\vector(1,1){0}}
\end{picture}
\setlength{\unitlength}{1pt}
\end{egresult}

    The appearance of the box is best when the width and height of the
box are integer multiples of the dash length. In the example the dash length
has been set to \texttt{0.5} with the width and height set as \texttt{(5,2)}; thus 
the width and height are respectively ten and four times the dash length.

    The \cmd{\frame}\index{picture object!frame} command draws a 
frame around the contents of the
box that exactly fits the contents. 
\begin{syntax}
\cmd{\frame}\marg{contents} \\
\end{syntax}
\glossary(frame)
{\cs{frame}\marg{contents}}{A picture object drawing a frame about \meta{contents}.}
It takes a single required argument
which is the contents.

\begin{egsource}{eg:pic6}
\setlength{\unitlength}{1pc}
\begin{picture}(10,3)
\put(0,0){\framebox(10,3){}}
\thicklines
\put(0.5,2){\frame{$\mathcal{FRAME}$ text}}
\put(0.5,2){\vector(1,1){0}}
\end{picture}
\setlength{\unitlength}{1pt}
\end{egsource}

\begin{egresult}[Picture: framing]{eg:pic6}
\vspace{0.5\onelineskip}
\setlength{\unitlength}{1pc}
\begin{picture}(10,3)
\put(0,0){\framebox(10,3){}}
\thicklines
\put(0.5,2){\frame{$\mathcal{FRAME}$ text}}
\put(0.5,2){\vector(1,1){0}}
\end{picture}
\setlength{\unitlength}{1pt}
\end{egresult}


    The \cmd{\shortstack} command\index{picture object!stack} 
enables you to stack\index{stacking!text} text vertically. It 
produces a box with a single column of text. As with the other boxes, the
reference point\indextwo{reference point}{stack} is at the lower left hand corner,
although no frame is 
drawn around the stack. The \cmd{\shortstack} command is an ordinary
box making command, but it is not often used outside picture 
mode\indextwo{mode}{picture}.
\begin{syntax}
\cmd{\shortstack}\oarg{pos}\marg{text} \\
\end{syntax}
\glossary(shortstack)
{\cs{shortstack}\oarg{pos}\marg{text}}{Vertically stacks each line of 
\meta{text} into a column, normally centered but can be left or
 right aligned via \meta{pos}. Usually used as a picture object, 
but can be used outside the environment.}
    Each line of \meta{text}, except for the last, is 
ended\indextwo{end}{line} by a \cmd{\\} command.
The default is to center each text line within the column. However, there
is an optional positioning argument.
 A value of \pixposarg{l} for \meta{pos} will left align the
text and a value of \pixposarg{r} will right align the text.

\begin{egsource}{eg:pic7}
\setlength{\unitlength}{1mm}
\begin{picture}(75,25)
\put(0,0){\framebox(75,25){}}
\put(3,3){\shortstack{Default \\ short \\ Stack}}
\put(3,3){\vector(1,1){0}}
\put(23,3){\shortstack[l]{Left\\aligned\\short\\Stack}}
\put(23,3){\vector(1,1){0}}
\put(43,3){\shortstack[r]{Right\\aligned\\short\\Stack}}
\put(43,3){\vector(1,1){0}}
\put(63,3){\shortstack{Extra \\[4ex] spaced \\[2ex] Stack}}
\put(63,3){\vector(1,1){0}}
\end{picture}
\setlength{\unitlength}{1pt}
\end{egsource}

\begin{egresult}[Picture: stacking]{eg:pic7}
\vspace{0.5\onelineskip}
\setlength{\unitlength}{1mm}
\begin{picture}(75,25)
\put(0,0){\framebox(75,25){}}
\put(3,3){\shortstack{Default \\ short \\ Stack}}
\put(3,3){\vector(1,1){0}}

\put(23,3){\shortstack[l]{Left\\aligned\\short\\Stack}}
\put(23,3){\vector(1,1){0}}

\put(43,3){\shortstack[r]{Right\\aligned\\short\\Stack}}
\put(43,3){\vector(1,1){0}}

\put(63,3){\shortstack{Extra \\[4ex] spaced \\[2ex] Stack}}
\put(63,3){\vector(1,1){0}}
\end{picture}
\setlength{\unitlength}{1pt}
\end{egresult}

    The rows in a stack\index{stacking!text!vertical spacing} 
are not evenly spaced. The spacing between two
rows can be changed in one of two ways.
\begin{enumerate}
\item Add a strut to a row. A strut\index{strut} is a vertical rule with
      no width.
\item Use the optional argument to the \cmd{\\} command. This optional
  argument is a length value.
  \begin{syntax}
  \cmd{\\}\oarg{len} \\
  \end{syntax}
  It has the effect of adding additional \meta{len}
  vertical space between the two lines that the \cmd{\\} separates.
\end{enumerate}

\begin{syntax}
\cmd{\newsavebox}\marg{box} \\
\cmd{\savebox}\marg{box}\parg{width, height}\oarg{pos}\marg{text} \\
\cmd{\sbox}\marg{box}\marg{text} \\
\cmd{\usebox}\marg{box} \\
\end{syntax}
\glossary(savebox)
{\cs{savebox}\meta{box}\parg{width, height}\oarg{pos}\marg{text}}{Picture
 command to save 
 \meta{text} in a (pre-existing) storage box \meta{box} making it
 size \meta{width} times \meta{height}. The optional 
  argument controls the position of the \meta{text}.}

\LMnote{2010/02/17}{fixed typo from Adriano Pascoletti}
    Just as in normal text you can save and reuse boxes. 
The \cmd{\savebox}\index{box!saved object}
macro in picture mode\indextwo{mode}{picture} is a variant of the normal
text version, but the other three commands are the same in both 
picture\indextwo{mode}{picture} and paragraph\indextwo{mode}{paragraph} modes,
and are described in \Cref{chap:boxes}. In picture mode you have to
specify the size of the storage box when saving it, via the 
\parg{width, height} argument to \cmd{\savebox}.

    A \cmd{\savebox} command can be used within a picture to store a picture
object. The first argument of \cmd{\savebox} is the name of the
storage bin to be used. The following arguments are the same as the
\cmd{\makebox} command.
The result is stored, not drawn. When you have saved 
something it can be drawn in either the same or other pictures via the
\cmd{\usebox}\index{box!using saved object} command. 
This command takes one argument, which is the name
of the storage bin.

\begin{egsource}{eg:pic8}
\setlength{\unitlength}{1pc}
\begin{picture}(18,5)
\put(0,0){\framebox(18,5){}}
\newsavebox{\Mybox}
\savebox{\Mybox}(6,3)[tr]{$\mathcal{SAVED}$}
\thicklines
\put(1,1){\frame{\usebox{\Mybox}}}
\put(11,1){\frame{\usebox{\Mybox}}}
\put(1,1){\vector(1,1){0}}
\put(11,1){\vector(1,1){0}}
\end{picture}
\setlength{\unitlength}{1pt}
\end{egsource}

\begin{egresult}[Picture: saved boxes]{eg:pic8}
\vspace{0.5\onelineskip}
\setlength{\unitlength}{1pc}
\begin{picture}(18,5)
\put(0,0){\framebox(18,5){}}
\newsavebox{\Mybox}
\savebox{\Mybox}(6,3)[tr]{$\mathcal{SAVED}$}
\thicklines
\put(1,1){\frame{\usebox{\Mybox}}}
\put(11,1){\frame{\usebox{\Mybox}}}
\put(1,1){\vector(1,1){0}}
\put(11,1){\vector(1,1){0}}
\end{picture}
\setlength{\unitlength}{1pt}
\end{egresult}

    It can take \ltx\ a long time to draw something. When a box is saved
it actually contains the typeset contents, which then just get 
printed out when the box is
used. It can save processing time if something which appears several times
is saved and then used as and where required. On the other hand, a saved
box can use up a significant amount of \ltx's internal storage space.
The \cmd{\sbox} command with an empty text argument can be used to delete
the contents of a bin. For example, 
\begin{lcode}
\sbox{\Mybox}{}
\end{lcode}
will empty the \verb?\Mybox? box. Note that this does not delete the 
storage box itself.

\subsection{Lines}

    \ltx\ can draw straight 
lines\index{picture object!line|seealso{line}}\index{line|seealso{picture object}}, 
but the range of slopes\index{line!restricted slope} for lines is
somewhat restricted. Further, very short lines\index{line!short} cannot 
be drawn.
\begin{syntax}
\cmd{\line}\parg{i, j}\marg{distance} \\
\end{syntax}
\glossary(line)
{\cs{line}\parg{dx,dy}\marg{distance}}{Picture object of a line, slope
  \meta{dx,dy} and coordinate length \meta{distance}.}
The pair \parg{i, j} specifies the 
\emph{slope}\index{slope}\indextwo{line}{slope} of the line, and \meta{distance} 
is a value that controls the length\index{line!length} of the line. The line
starts at its reference point\indextwo{reference point}{line} 
(i.e., the place where it is \cmd{\put}).
The slope\index{slope} of the line is such that if a point on the line is slid along the
line, then for every $i$ units the point moves in the horizontal direction
it will also have moved $j$ units in the vertical direction. Negative
values for $i$ or $j$ have the expected meaning. A move of -3 units in $i$
means a move of 3 units to the left, and similarly a move of -4 units in
$j$ means a move of 4 units downwards. So, a line sloping up to the right
will have positive values for $i$ and $j$, while a line sloping up to the
left will have a negative value for $i$ and a positive value for $j$.

    The \meta{distance} argument specifies the length of the line in the
$x$ (horizontal) direction. One problem with this may have occured to you:
what if the line is vertical (i.e., $i=0$)? In this case only, \meta{distance}
specifies the vertical length of the line. The \meta{distance} argument must
be a non-negative value. For horizontal and vertical lines only, the actual
length of the line is \meta{distance}. Figure~\ref{flpic:spec}, which is
produced from the code below, diagrams the line 
specification arguments.

\begin{lcode}
\begin{figure}
\centering
\setlength{\unitlength}{1mm}
\begin{picture}(70,60)
\thicklines   % draw line and ref point
  \put(10,20){\line(2,1){40}}
  \put(10,20){\vector(1,-1){0}}
\thinlines    % draw axes
  \put(0,0){\vector(1,0){60}} \put(63,0){x}
  \put(0,0){\vector(0,1){50}} \put(0,53){y}
              % draw i and j vectors
  \put(20,25){\vector(1,0){20}} 
  \put(30,22){\makebox(0,0)[t]{$i$}}
  \put(40,25){\vector(0,1){10}} 
  \put(42,30){\makebox(0,0)[l]{$j$}}
              % draw distance vector
  \put(30,10){\vector(-1,0){20}}
  \put(30,10){\vector(1,0){20}}
  \put(30,8){\makebox(0,0)[t]{\textit{distance}}}
\end{picture}
\setlength{\unitlength}{1pt}
\caption{Specification of a line or arrow}
\label{flpic:spec}
\end{figure}
\end{lcode}

\begin{figure}
\centering
\setlength{\unitlength}{1mm}
\begin{picture}(70,60)
\thicklines
  \put(10,20){\line(2,1){40}}
  \put(10,20){\vector(1,-1){0}}
\thinlines
  \put(0,0){\vector(1,0){60}} \put(63,0){x}
  \put(0,0){\vector(0,1){50}} \put(0,53){y}

  \put(20,25){\vector(1,0){20}} \put(30,22){\makebox(0,0)[t]{$i$}}
  \put(40,25){\vector(0,1){10}} \put(42,30){\makebox(0,0)[l]{$j$}}

  \put(30,10){\vector(-1,0){20}}
  \put(30,10){\vector(1,0){20}}
  \put(30,8){\makebox(0,0)[t]{\textit{distance}}}

\end{picture}
\setlength{\unitlength}{1pt}
\caption{Specification of a line or arrow}
\label{flpic:spec}
\end{figure}

    Only a fixed number of slopes\index{line!restricted slope} 
are available. This is because \ltx\ uses
a special font for drawing lines --- a line actually consists of little bits
of angled rules joined together. Thus, there is only a limited number of
values for $i$ and $j$. They must both be integers and in the range
$-6 \leq i,j \leq 6$. Also, they must have no common divisor other than 1.
In other words, the ratio between $i$ and $j$ must be in its simplest form.
You cannot, for example, have $(3,6)$; instead it would have to be $(1,2)$.
The shortest line that \ltx\ can draw is about ten points 
(1/7 inch approximately) in overall length. You can, though, draw lines that
are too long to fit on the page.

    Figure~\ref{flpic:lslope} shows the lines and arrows slanting
upwards and to the right that can be drawn in \ltx. The slope $(i,j)$
pair are shown to the right of the first set of lines and arrows, together
with the $j/i$ ratio which gives the slope of the line as a decimal number.


\subsection{Arrows}

    As shown in \fref{flpic:lslope} you can also draw a line with an 
arrowhead\index{line!arrowhead|see{vector}}\index{arrow|see{vector}} 
on it. These are specified 
by the \cmd{\vector}\index{vector|seealso{picture object}}\index{picture object!vector|seealso{vector}}
command.
\begin{syntax}
\cmd{\vector}\parg{i, j}\marg{distance} \\
\end{syntax}
\glossary(vector)
{\cs{vector}\parg{dx,dy}\marg{distance}}{Picture object of a line with an
arrowhead at the end, slope   \meta{dx,dy} and coordinate 
length \meta{distance}.}
 This works exactly
like the \cmd{\line} command and the arrowhead is put on the line at the
end away from the reference point\indextwo{reference point}{vector}. 
That is, the arrow points away from the
reference point. If the \meta{distance} argument is too small (zero,
for instance) the arrowhead only is drawn, with its point at the position
where it is \cmd{\put}.

\begin{figure}
\centering
\setlength{\unitlength}{1mm}
\begin{picture}(70,70)
% lines and arrows with slopes <= (1,1)
\thicklines \put(0,0){\vector(1,0){50}}
\thinlines \put(0,0){\line(6,1){50}}
           \put(0,0){\line(5,1){50}}
\thicklines \put(0,0){\vector(4,1){50}}
            \put(0,0){\vector(3,1){50}}
\thinlines \put(0,0){\line(5,2){50}}
\thicklines \put(0,0){\vector(2,1){50}}
\thinlines \put(0,0){\line(5,3){50}}
\thicklines \put(0,0){\vector(3,2){50}}
            \put(0,0){\vector(4,3){50}}
\thinlines \put(0,0){\line(5,4){50}}
           \put(0,0){\line(6,5){50}}
\thicklines \put(0,0){\vector(1,1){50}}
% label vertically
\put(53,0){\begin{picture}(20,60)
  \begin{footnotesize}
  \put(0,0){$(1,0)=0$}
  \put(0,7.333){$(6,1)=0.167$}
  \put(0,10){$(5,1)=0.2$}
  \put(0,12.5){$(4,1)=0.25$}
  \put(0,16.667){$(3,1)=0.333$}
  \put(0,20){$(5,2)=0.4$}
  \put(0,25){$(2,1)= 0.5$}
  \put(0,30){$(5,3)= 0.6$}
  \put(0,33.333){$(3,2)=0.667$}
  \put(0,37.5){$(4,3)=0.75$}
  \put(0,40){$(5,4)=0.8$}
  \put(0,42.667){$(6,5)=0.833$}
  \put(0,50){$(1,1)=1$}
  \end{footnotesize}
  \end{picture}}
% remaining lines and arrows
\thinlines \put(0,0){\line(5,6){41.667}}
           \put(0,0){\line(4,5){40}}
\thicklines \put(0,0){\vector(3,4){37.5}}
            \put(0,0){\vector(2,3){33.333}}
\thinlines \put(0,0){\line(3,5){30}}
\thicklines \put(0,0){\vector(1,2){25}}
\thinlines \put(0,0){\line(2,5){20}}
\thicklines \put(0,0){\vector(1,3){16.667}}
            \put(0,0){\vector(1,4){12.5}}
\thinlines \put(0,0){\line(1,5){10}}
           \put(0,0){\line(1,6){8.333}}
\thicklines \put(0,0){\vector(0,1){50}}
% label horizontally
\put(0,55){\begin{picture}(50,10)
  \begin{footnotesize}
%  \put(41.667,5){\makebox(0,0){$(5,6)=1.2$}}
%  \put(40,0){\makebox(0,0){$(4,5)=1.25$}}
%  \put(37.5,5){\makebox(0,0){$(3,4)=1.333$}}
%  \put(33.333,0){\makebox(0,0){$(2,3)=1.5$}}
%  \put(30,5){\makebox(0,0){$(3,5)=1.667$}}
  \put(25,0){\makebox(0,0){$(1,2)=2$}}
%  \put(20,5){\makebox(0,0){$(2,5)=2.5$}}
%  \put(16.667,0){\makebox(0,0){$(1,3)=3$}}
%  \put(12.5,5){\makebox(0,0){$(1,4)=4$}}
%  \put(10,0){\makebox(0,0){$(1,5)=5$}}
%  \put(8.333,5){\makebox(0,0){$(1,6)=6$}}
  \put(0,0){\makebox(0,0){$(0,1)= \infty$}}
  \end{footnotesize}
  \end{picture}}
\end{picture}
\setlength{\unitlength}{1pt}
\caption{Sloping lines and arrows} \label{flpic:lslope}
\end{figure}

    \ltx\ is even more restrictive in the number of slopes that it can draw
with arrows\index{vector!restricted slope}\indextwo{slope}{vector} 
than it is with lines. 
The $(i,j)$ slope specification pair
must lie in the range $-4 \leq i,j \leq 4$. Also, as with the \cmd{\line}
command, they must have no common divisor.



\subsection{Circles}

    \ltx\ can draw two kinds of circles\index{picture object!circle|seealso{circle}}\index{circle|seealso{picture object}}. 
One is an open circle\index{circle!open} where only
the perimeter is drawn, and the other is a solidly filled 
disk\index{circle!disk}\index{disk|see{circle}}.
\begin{syntax}
\cmd{\circle}\marg{diameter} \\
\cmd{\circle*}\marg{diameter} \\
\end{syntax}
\glossary(circle)
{\cs{circle}\marg{diam}}{Picture object of a open circle 
diameter \meta{diam}.}
\glossary(circle*)
{\cs{circle*}\marg{diam}}{Picture object of a black closed circle 
diameter \meta{diam}.}

    The reference point\indextwo{reference point}{circle} for the open circle, 
drawn by the \cmd{\circle}
command, and the disk, which is drawn by the \cmd{\circle*} command, 
is at the center
of the circle. The argument to the commands is the \meta{diameter} 
of the circle.

\begin{egsource}{eg:pic10}
\setlength{\unitlength}{1pt}
\begin{picture}(200,60)
\put(0,0){\framebox(200,60){}}
\put(30,30){\circle{40}}
\put(30,30){\vector(1,1){0}}
\put(150,50){\circle*{20}}
\end{picture}
\setlength{\unitlength}{1pt}
\end{egsource}

\begin{egresult}[Picture: circles]{eg:pic10}
\vspace{0.5\onelineskip}
\setlength{\unitlength}{1pt}
\begin{picture}(200,60)
\put(0,0){\framebox(200,60){}}
\put(30,30){\circle{40}}
\put(30,30){\vector(1,1){0}}
\put(150,50){\circle*{20}}
\end{picture}
\setlength{\unitlength}{1pt}
\end{egresult}

    Just as with the \cmd{\line} and \cmd{\vector} commands, there is only a 
limited range of circles\index{circle!restricted diameter} that can be drawn.
Typically, the maximum diamter of a \cmd{\circle} is about 40 points, while
for a \cmd{\circle*} the maximum diameter is less, being about 15 points. 
\ltx\ will choose
the nearest sized circle to the one that you specify. Either consult your
local guru to find what sized circles you can draw on your system, or
try some experiments by drawing a range of circles to see what happens.

\subsubsection{Quarter circles and boxes}

    In \ltx\ an \cmd{\oval}\index{picture object!oval|seealso{box, rounded}}%
\index{oval|seealso{picture object}} is a rectangular 
box\index{box!rounded|seealso{oval}} with rounded corners.
\begin{syntax}
\cmd{\oval}\parg{width, height}\oarg{portion} \\
\end{syntax}
\glossary(oval)
{\cs{oval}\parg{width,height}\oarg{portion}}{Picture object of a rectangular
box, size \meta{width} by \meta{height}, with rounded corners. The optional
\meta{portion} argument controls whether and which a quarter or a half of 
the object will be drawn (default is everything).}

    The \cmd{\oval} command has one required argument which specifies the
width and height of the box. The normally sharp corners of the box are
replaced by quarter circles of the maximum possible radius (which \ltx\
figures out for itself). Unlike the boxes discussed earlier, the reference
point\indextwo{reference point}{oval} is at the `center' of the oval.

\begin{egsource}{eg:pic11}
\setlength{\unitlength}{1mm}
\begin{picture}(75,20)
\thicklines
\put(0,0){\framebox(75,20){}}
\put(15,10){\oval(15,10)}     % complete oval
\put(15,10){\vector(1,1){0}}
\put(30,10){\oval(5,5)}       % small oval
\put(30,10){\vector(1,1){0}}
\put(45,10){\oval(15,10)[l]}  % left half
\put(45,10){\vector(1,1){0}}
\put(60,10){\oval(15,10)[bl]} % bottom left quarter
\put(60,10){\vector(1,1){0}}
\end{picture}
\setlength{\unitlength}{1pt}
\end{egsource}

\begin{egresult}[Picture: ovals]{eg:pic11}
\vspace{0.5\onelineskip}
\setlength{\unitlength}{1mm}
\begin{picture}(75,20)
\thicklines
\put(0,0){\framebox(75,20){}}
\put(15,10){\oval(15,10)}
\put(15,10){\vector(1,1){0}}

\put(30,10){\oval(5,5)}
\put(30,10){\vector(1,1){0}}

\put(45,10){\oval(15,10)[l]}
\put(45,10){\vector(1,1){0}}

\put(60,10){\oval(15,10)[bl]}
\put(60,10){\vector(1,1){0}}
\end{picture}
\setlength{\unitlength}{1pt}
\end{egresult}

    The \cmd{\oval} command also has one optional argument, \meta{portion}, 
which comes after
the required argument.
 Use of the optional argument enables either half\index{box!rounded!half} or
a quarter\index{box!rounded!quarter} of the complete rounded box
to be drawn. The argument is a one or two
letter code drawn from the following.
\begin{itemize}
\item[\pixposarg{l}] (left) Draw the left of the oval.
\item[\pixposarg{r}] (right) Draw the right of the oval.
\item[\pixposarg{t}] (top) Draw the top of the oval.
\item[\pixposarg{b}] (bottom) Draw the bottom of the oval.
\end{itemize}
These are similar to the optional positioning argument in the box commands.
A one letter code will draw the designated half of the oval, while a two letter
code results in the designated quarter of the oval being drawn. In all cases
the reference point is at the center of the `complete' oval.



\begin{egsource}{eg:pic12}
\setlength{\unitlength}{1mm}
\begin{picture}(30,10)
\thicklines
\put(15,5){\oval(30,10)}
\put(15,5){\makebox(0,0){Text in oval}}
\end{picture}
\setlength{\unitlength}{1pt}
\end{egsource}

\begin{egresult}[Picture: text in oval]{eg:pic12}
\vspace{0.5\onelineskip}
\setlength{\unitlength}{1mm}
\begin{picture}(30,10)
\thicklines
\put(15,5){\oval(30,10)}
\put(15,5){\makebox(0,0){Text in oval}}
\end{picture}
\setlength{\unitlength}{1pt}
\end{egresult}

    Unlike the boxes described in \Sref{slpic:boxes} there is no \meta{text}
argument for an \cmd{\oval}. If you want the rounded box to contain text, 
then you have to place the text inside the box yourself. 
The code in example~\ref{eg:pic12} shows
one way of doing this; a zero-sized box is used to center the text at
the center of the oval.


\section{Repetitions}

    The \cmd{\multiput} command is a convenient way to place regularly spaced
copies of an object\index{picture object!regular pattern} 
in a picture.
\begin{syntax}
\cmd{\multiput}\parg{x, y}\parg{dx, dy}\marg{num}\marg{object} \\
\end{syntax}
\glossary(multiput)
{\cs{multiput}\parg{x,y}\parg{dx,dy}\marg{num}\marg{object}}{Drawing
command to place \meta{num} copies of \meta{object}, starting at coordinates
\meta{x,y} and stepping \meta{dx,dy} for each copy after the first.}
As you can see, this is similar to the syntax for the \cmd{\put} command, 
except that there are two more required arguments, namely \parg{dx, dy} 
and \textit{num}.

    The \parg{dx, dy} argument is a pair of (decimal) numbers that
specify the amount that the \meta{object} shall be moved at each repetition.
The first of this pair specifies the horizontal movement and the second the
vertical movement. Positive values shift to the right or up, and negative
numbers shift to the left or down. The \meta{num} argument specifies how many
times the \meta{object} is to be drawn.

    The code below produces \fref{flpic:scales}. 
This example
also shows that a \Ie{picture} can be placed 
inside\index{picture object!picture} another \Ie{picture}.
Often it is useful to break a complex diagram up into pieces, with each
piece being a separate \Ie{picture}. The pieces can then be individually
positioned within the overall diagram.

\begin{figure}
\setlength{\unitlength}{1pc}
\centering
%\begin{picture}(21,35)
\begin{picture}(21,26)
%  Draw Pica scale
%\put(2,2){\begin{picture}(5,33)
\put(2,2){\begin{picture}(5,24)
  \put(0,-0.5){\makebox(0,0)[t]{\textbf{Picas}}}
%  \thicklines \put(0,0){\line(0,1){35}}
  \thicklines \put(0,0){\line(0,1){24.0}}
%  \thinlines \multiput(0,0)(0,1){36}{\line(1,0){1}}
%             \multiput(0,0)(0,10){4}{\line(1,0){2}}
  \thinlines \multiput(0,0)(0,1){25}{\line(1,0){1}}
             \multiput(0,0)(0,10){3}{\line(1,0){2}}
  \put(-1,0){\makebox(0,0)[br]{0}}
  \put(-1,10){\makebox(0,0)[br]{10}}
  \put(-1,20){\makebox(0,0)[br]{20}}
%  \put(-1,30){\makebox(0,0)[br]{30}}
  \end{picture}}
%  Draw Points scale
%\put(7,2){\begin{picture}(5,33)
\put(7,2){\begin{picture}(5,24)
  \put(0,-0.5){\makebox(0,0)[t]{\textbf{Points}}}
%  \thicklines \put(0,0){\line(0,1){35}}
%  \thinlines \multiput(0,0)(0,0.8333){42}{\line(1,0){1}}
%             \multiput(0,0)(0,8.333){5}{\line(1,0){2}}
  \thicklines \put(0,0){\line(0,1){24.2}}
  \thinlines \multiput(0,0)(0,0.8333){30}{\line(1,0){1}}
             \multiput(0,0)(0,8.333){3}{\line(1,0){2}}
  \put(-1,0){\makebox(0,0)[br]{0}}
  \put(-1,8.333){\makebox(0,0)[br]{100}}
  \put(-1,16.667){\makebox(0,0)[br]{200}}
%  \put(-1,25){\makebox(0,0)[br]{300}}
%  \put(-1,33.333){\makebox(0,0)[br]{400}}
  \end{picture}}
%  Draw Millimeter scale
%\put(12,2){\begin{picture}(5,33)
\put(12,2){\begin{picture}(5,24)
  \put(0,-0.5){\makebox(0,0)[t]{\textbf{Millimeters}}}
%  \thicklines \put(0,0){\line(0,1){35}}
%  \thinlines \multiput(0,0)(0,0.4742){74}{\line(1,0){1}}
%             \multiput(0,0)(0,2.3711){15}{\line(1,0){2}}
  \thicklines \put(0,0){\line(0,1){24.2}}
  \thinlines \multiput(0,0)(0,0.4742){52}{\line(1,0){1}}
             \multiput(0,0)(0,2.3711){11}{\line(1,0){2}}
  \put(-1,0){\makebox(0,0)[br]{0}}
%  \put(-1,2.371){\makebox(0,0)[br]{10}}
  \put(-1,4.742){\makebox(0,0)[br]{20}}
%  \put(-1,7.113){\makebox(0,0)[br]{30}}
  \put(-1,9.484){\makebox(0,0)[br]{40}}
%  \put(-1,11.855){\makebox(0,0)[br]{50}}
  \put(-1,14,226){\makebox(0,0)[br]{60}}
%  \put(-1,16.597){\makebox(0,0)[br]{70}}
  \put(-1,18.968){\makebox(0,0)[br]{80}}
%  \put(-1,21.339){\makebox(0,0)[br]{90}}
  \put(-1,23.71){\makebox(0,0)[br]{100}}
%  \put(-1,26.081){\makebox(0,0)[br]{110}}
%  \put(-1,28.452){\makebox(0,0)[br]{120}}
%  \put(-1,30.823){\makebox(0,0)[br]{130}}
%  \put(-1,33.194){\makebox(0,0)[br]{140}}
  \end{picture}}
%  Draw Inch scale
%\put(17,2){\begin{picture}(5,33)
\put(17,2){\begin{picture}(5,24)
  \put(0,-0.5){\makebox(0,0)[t]{\textbf{Inches}}}
%  \thicklines \put(0,0){\line(0,1){35}}
%  \thinlines \multiput(0,0)(0,0.60225){59}{\line(1,0){1}}
%             \multiput(0,0)(0,6.0225){6}{\line(1,0){2}}
  \thicklines \put(0,0){\line(0,1){24.1}}
  \thinlines \multiput(0,0)(0,0.60225){41}{\line(1,0){1}}
             \multiput(0,0)(0,6.0225){5}{\line(1,0){2}}
  \put(-1,0){\makebox(0,0)[br]{0}}
  \put(-1,6.0225){\makebox(0,0)[br]{1}}
  \put(-1,12.045){\makebox(0,0)[br]{2}}
  \put(-1,18.0675){\makebox(0,0)[br]{3}}
  \put(-1,24.09){\makebox(0,0)[br]{4}}
%  \put(-1,30.1125){\makebox(0,0)[br]{5}}
  \end{picture}}

\end{picture}
\setlength{\unitlength}{1pt}
\caption{Some measuring scales} \label{flpic:scales}
\end{figure}

\begin{lcode}
\begin{figure}
\setlength{\unitlength}{1pc}
\centering
\begin{picture}(21,26)
%  Draw Pica scale
\put(2,2){\begin{picture}(5,24)
  \put(0,-0.5){\makebox(0,0)[t]{\textbf{Picas}}}
  \thicklines \put(0,0){\line(0,1){24.0}}
  \thinlines \multiput(0,0)(0,1){25}{\line(1,0){1}}
             \multiput(0,0)(0,10){3}{\line(1,0){2}}
  \put(-1,0){\makebox(0,0)[br]{0}}
  \put(-1,10){\makebox(0,0)[br]{10}}
  \put(-1,20){\makebox(0,0)[br]{20}}
  \end{picture}}
%  Draw Points scale
\put(7,2){\begin{picture}(5,24)
  \put(0,-0.5){\makebox(0,0)[t]{\textbf{Points}}}
  \thicklines \put(0,0){\line(0,1){24.2}}
  \thinlines \multiput(0,0)(0,0.8333){30}{\line(1,0){1}}
             \multiput(0,0)(0,8.333){3}{\line(1,0){2}}
  \put(-1,0){\makebox(0,0)[br]{0}}
  \put(-1,8.333){\makebox(0,0)[br]{100}}
  \put(-1,16.667){\makebox(0,0)[br]{200}}
  \end{picture}}
%  Draw Millimeter scale
\put(12,2){\begin{picture}(5,24)
  \put(0,-0.5){\makebox(0,0)[t]{\textbf{Millimeters}}}
  \thicklines \put(0,0){\line(0,1){24.2}}
  \thinlines \multiput(0,0)(0,0.4742){15}{\line(1,0){1}}
             \multiput(0,0)(0,2.3711){11}{\line(1,0){2}}
  \put(-1,0){\makebox(0,0)[br]{0}}
  \put(-1,4.742){\makebox(0,0)[br]{20}}
  \put(-1,9.484){\makebox(0,0)[br]{40}}
  \put(-1,14,226){\makebox(0,0)[br]{60}}
  \put(-1,18.968){\makebox(0,0)[br]{80}}
  \put(-1,23.71){\makebox(0,0)[br]{100}}
  \end{picture}}
%  Draw Inch scale
\put(17,2){\begin{picture}(5,24)
  \put(0,-0.5){\makebox(0,0)[t]{\textbf{Inches}}}
  \thicklines \put(0,0){\line(0,1){24.1}}
  \thinlines \multiput(0,0)(0,0.60225){41}{\line(1,0){1}}
             \multiput(0,0)(0,6.0225){5}{\line(1,0){2}}
  \put(-1,0){\makebox(0,0)[br]{0}}
  \put(-1,6.0225){\makebox(0,0)[br]{1}}
  \put(-1,12.045){\makebox(0,0)[br]{2}}
  \put(-1,18.0675){\makebox(0,0)[br]{3}}
  \put(-1,24.09){\makebox(0,0)[br]{4}}
  \end{picture}}

\end{picture}
\setlength{\unitlength}{1pt}
\caption{Some measuring scales} \label{flpic:scales}
\end{figure}
\end{lcode}


    You can also make regular
two-dimensional\index{picture object!two-dimensional pattern} patterns 
by using a 
\cmd{\multiput} pattern inside another \cmd{\multiput}. As \ltx\ will
process each \cmd{\multiput} every time it is repeated it is often more
convenient to store the results of the first \cmd{\multiput} in a bin
and then use this as the argument to the second \cmd{\multiput}.

\begin{egsource}{eg:pic14}
\setlength{\unitlength}{1mm}
\begin{picture}(32,14)
\put(0,0){\framebox(32,14){}}
\savebox{\Mybox}(8,8){\multiput(0,0)(4,4){3}{\circle*{1}}}
\multiput(4,4)(6,0){4}{\usebox{\Mybox}}
\sbox{\Mybox}{}
\end{picture}
\setlength{\unitlength}{1pt}
\end{egsource}

\begin{egresult}[Picture: repetitions]{eg:pic14}
\vspace{0.5\onelineskip}
\setlength{\unitlength}{1mm}
\begin{picture}(32,14)
\put(0,0){\framebox(32,14){}}
\savebox{\Mybox}(8,8){\multiput(0,0)(4,4){3}{\circle*{1}}}
\multiput(4,4)(6,0){4}{\usebox{\Mybox}}
\sbox{\Mybox}{}
\end{picture}
\setlength{\unitlength}{1pt}
\end{egresult}

   Remember that
a storage bin must have been declared via a \cmd{\newsavebox} command before
it can be used. I originally declared and used
the \cs{Mybox} bin in \Sref{slpic:boxes}.
As the above example shows, you can change the contents of a storage bin
by utilising it in another \cmd{\savebox}. Storage bins can use up a 
lot of \ltx's memory. After
you have finished with a storage bin empty it via the \cmd{\sbox}
command with an empty last argument, as shown in the example.

\section{Bezier curves}

    Standard \ltx\ provides one further drawing command ---
the \cmd{\qbezier}\index{picture object!Bezier curve|seealso{Bezier curve}} 
command. 
This can be used for drawing fairly arbitrary curves.
\begin{syntax}
\cmd{\qbezier}\oarg{num}\parg{Xs, Ys}\parg{Xm, Ym}\parg{Xe, Ye} \\
\end{syntax}
\glossary(qbezier)
{\cs{qbezier}\oarg{num}\parg{Xs,Ys}\parg{Xm,Ym}\parg{Xe,Ye}}{Picture
command to draw a quadratic Bezier curve from \meta{Xs,Ys} to \meta{Xe,Ye}
passing near \meta{Xm,Ym}. If the optional argument is present exactly
\meta{num} segments will be used in drawing the curve.}
    The command will draw what geometers call a \emph{quadratic Bezier
curve}\index{Bezier curve|seealso{picture object}} from the 
point \parg{Xs, Ys} to the point \parg{Xe, Ye}. The
curve will pass somewhere near to the point \parg{Xm, Ym}. 

    Bezier curves are named after Pierre Bezier\index{Bezier, Pierre}
who first used them in 1962. They are widely used in Computer Aided 
Design (CAD)
programs and other graphics and font design systems. Descriptions, with
varying degrees of mathematical complexity, can be found in many places:
when I was a practicing geometer these included \cite{FAUX80},
\cite{MORTENSON85} and \cite{FARIN90}; no doubt there are more recent 
sources available and there is a brief review in~\cite{BEZ123}.

Figure~\ref{lpicf:bez} shows two of these curves. The figure was
produced by the code below.

%\begin{egsource}{eg11.15}
\begin{lcode}
\begin{figure}
\setlength{\unitlength}{1mm}
\centering
\begin{picture}(100,100)

\thicklines % first curve
\qbezier(10,50)(50,90)(50,50)
\thinlines % draw lines joining control points
\put(10,50){\line(1,1){40}}
\put(50,90){\line(0,-1){40}}
% label control points
\put(10,45){\makebox(0,0)[t]{\texttt{(10,50)}}}
\put(50,95){\makebox(0,0)[b]{\texttt{(50,90)}}}
\put(55,50){\makebox(0,0)[l]{\texttt{(50,50)}}}

\thicklines % second curve
\qbezier[25](50,50)(50,10)(90,50)
\thinlines % draw lines joining control points
% \put(50,50){\line(0,-1){40}}
% \put(50,10){\line(1,1){40}}
% label control points
\put(50,5){\makebox(0,0)[t]{\texttt{(50,10)}}}
\put(90,55){\makebox(0,0)[b]{\texttt{(90,50)}}}

\end{picture}
\setlength{\unitlength}{1pt}
\caption{Two Bezier curves}
\label{lpicf:bez}
\end{figure}
\end{lcode}
%\end{egsource}

\begin{figure}
\setlength{\unitlength}{1mm}
\centering
\begin{picture}(100,100)

\thicklines % first curve
\qbezier(10,50)(50,90)(50,50)
\thinlines % draw lines joining control points
\put(10,50){\line(1,1){40}}
\put(50,90){\line(0,-1){40}}
% label control points
\put(10,45){\makebox(0,0)[t]{\texttt{(10,50)}}}
\put(50,95){\makebox(0,0)[b]{\texttt{(50,90)}}}
\put(55,50){\makebox(0,0)[l]{\texttt{(50,50)}}}

\thicklines % second curve
\qbezier[25](50,50)(50,10)(90,50)
\thinlines % draw lines joining control points
% \put(50,50){\line(0,-1){40}}
% \put(50,10){\line(1,1){40}}
% label control points
\put(50,5){\makebox(0,0)[t]{\texttt{(50,10)}}}
\put(90,55){\makebox(0,0)[b]{\texttt{(90,50)}}}

\end{picture}
\setlength{\unitlength}{1pt}
\caption{Two Bezier curves}
\label{lpicf:bez}
\end{figure}

    The three points used to specify the position and shape of the
Bezier curve are called 
\emph{control points}\index{Bezier curve!control points}. 
The curve starts at
the first control point and is tangent to the line joining the first
and second control points. The curve stops at the last control point
and is tangent to the line joining the last two control points.

    In \fref{lpicf:bez} the lines joining the control points for the
first curve have been drawn in. The locations of all the control points
for the two curves are labeled. 

The second Bezier curve is the same shape
as the first one, but rotated 180 degrees. The first control point
of this curve is the same as the last control point of the first curve.
This means that the two curves are joind at this point. The line, 
although it is not drawn,
connecting the first two control points of the second curve is in the
same direction as the line joining the last two control points of the
first curve. This means that the two curves are also tangent at the
point where they join. By stringing together several Bezier curves
you can draw quite complex curved shapes.

\begin{syntax}
\cmd{\qbeziermax} \\
\end{syntax}
\glossary(qbeziermax)
{\cs{qbeziermax}}{The maximum number of segments for drawing a Bezier curve.}
    The Bezier curves are actually drawn as a 
linearized\index{Bezier curve!linearized rendition} form
using a series of rectangular
blobs of ink. Left to itself, \ltx\ will attempt to pick the number
of blobs to give the smoothest looking curve, up to a maximum number.
(Each blob takes up space in \ltx 's internal memory, and it may run
out of space if too many are used in one picture.) The maximum number
of blobs per Bezier curve is set by the \cmd{\qbeziermax} command. This
can be adjusted with the \cmd{\renewcommand} command. For example: 
\begin{lcode}
\renewcommand{\qbeziermax}{250}
\end{lcode}
will set the maximum number of blobs to be 250.

    Another method of controlling the number of blobs is by
the optional \meta{num} argument to the \cmd{\qbezier} command.
If used, it must be a positive integer number which tells \ltx\
exactly how many blobs to use for the curve.


%#% extend
%#% extstart include latex-and-tex.tex

\svnidlong
{$Ignore: $}
{$LastChangedDate: 2014-03-31 11:34:44 +0200 (Mon, 31 Mar 2014) $}
{$LastChangedRevision: 480 $}
{$LastChangedBy: daleif $}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{\ltx\ and \tx} \label{appendix:alltex}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    Strictly speaking, \ltx\ is a set of macros built on top of 
the \tx\ program originally developed by 
Donald Knuth~\cite{TEXPROGRAM,TEXBOOK} 
in the early
1980's. \tx\ is undoubtedly one of the most robust computer programs
to date. 

    Leslie Lamport says that most \tx\ commands can be used with 
\ltx\ and lists those that cannot be used~\cite[Appendix E]{LAMPORT94}.
Apart from this he says nothing about any \tx\ commands. I have used
some \tx\ macros in the code examples and so I need to talk a little
bit about these.

    I like to think of the commands and
macros as falling into one of several groups.
\begin{itemize}

\item \tx\ primitives. These are the basic constructs of the \tx\ language.

\item \tx\ commands or macros. These are part of the plain \tx\ system 
      and are
      constructed from the \tx\ primitives.

\item \ltx\ kernel commands or macros. These are defined in the \ltx\ kernel
      and are based on plain \tx\ primitives or commands. In turn, some 
      higher level kernel macros are constructed from more basic aspects
      of the kernel. The kernel does redefine some of the plain \tx\ commands.
      

\item Class command. These are mainly built up on the kernel commands but
      may use some basic \tx.

\item Package commands. These are similar to the class commands but are
      less likely to directly use \tx\ macros.

\item User commands. Typically these are limited to the commands
      provided by the class and any packages that might be called for,
      but more experienced users will employ some kernel commands,
      like \cmd{\newcommand}, to make their authoring more efficient.
\end{itemize}

    Although \tx\ is designed as a language for typesetting it is
also a `Turing complete' 
language\index{Turing complete language}\index{Turing, Alan}
which means that it can perform any function that can be programmed in
any familiar programming language. For example, an interpreter for the
BASIC language has been written in \tx, but writing this kind of program
using \tx\ is something that only an expert\footnote{Probably also a masochist
with plenty of time.} might consider.

    Nevertheless, you may have to, or wish to, write a typesetting function
of your own. This chapter presents a few of the programming aspects that
you may need for this, such as performing some simple arithmetic or comparing
two lengths. For anything else you will have to read one or more of the 
\tx\ books or tutorials.



    In England witnesses at a trial have to swear to `Tell the truth, the
whole truth, and nothing but the truth'. I will try and tell the truth
about \tx\ but, to misquote Hamlet \linenumberfrequency{0}
\settowidth{\versewidth}{There are more things in heaven and TeX, Horatio}
\begin{verse}[\versewidth]
There are more things in heaven and \tx, Horatio, \\
Than are dreamt of in your philosophy.
\end{verse}

\section{The \tx\ process}

    As we are delving deeper than normal and because at the bottom
it is the \tx\ language that does all the work,  it is useful to 
have an idea of how \tx\ processes a source file to produce a 
\pixfile{dvi} file. It is all explained in detail by 
Knuth~\cite{TEXBOOK} and also perhaps more accessibly by 
Eijkhout~\cite{TEXBYTOPIC}; 
the following is a simplified description.
Basically there are four processes involved and the output from one 
process is the input to the following one.

\begin{description}
\item[Input] The input process, which Knuth terms the `eyes', reads
  the source file and converts what it sees into \emph{tokens}\index{token}.
  There are essentially two kinds of token. A token is either a single
  character such as a letter or a digit or a punctuation mark, or 
  a token is a control sequence. 
  A \emph{control sequence}\index{control sequence} consists of a backslash
  and either all the alphabetic characters immediately following it, or
  the single non-alphabetic following it. Control sequence is the general 
  term for what I have been calling a macro or a command.

\item[Expansion] The expansion processor is what Knuth calls `\tx's mouth'.
  In this process some of the tokens from the input processor are expanded.
  Expansion replaces a token by other tokens or sometimes by no token.
  The expandible tokens include macros, conditionals, and a number of
  \tx\ primitives. 

\item[Execution] The execution process is \tx's `stomach'. This handles
  all the tokens output by the expansion processor. Control sequences
  that are not expandible are termed \emph{executable}, and the execution
  processor executes the executable tokens. Character tokens are
  neither expandible nor executable. It handles any macro defintions
  and also builds horizontal, vertical and mathematical lists.

\item[Layout] The layout processor (\tx's `bowels') breaks horizontal 
  lists into paragraphs, mathematical lists into formulae, and 
  vertical lists into pages. The final output is the \pixfile{dvi} file.

\end{description}

    In spite of the sequential nature implied by this description the 
overall process includes some feedback from a later process to an 
earlier one which may affect what that does.

    It is probably the expansion processor that needs to be best understood.
Its input is a sequence of tokens from the input processor and its output
is a sequence of different tokens.

    In outline, the expansion processor takes each input token in turn
and sees if it is expandible; if it is not it simply passes it on to the
output. If the token is expandible then it is replaced by its expansion.
The most common expandible tokens are control sequences that have been 
defined as macros. If the macro takes no arguments then the macro's name
is replaced by its definition. If the macro takes arguments, sufficient 
tokens are collected to get the values of the arguments, and then the 
macro name is replaced by the definition. The expansion processor then
looks at the first token in the replacement, and if that is expandible
it expands that, and so on. 

    Nominally, the eventual output from the expansion
processor is a stream of non-expandible tokens. There are ways,
however of controlling whether or not the expansion processor will actually
expand an expandible token, and to control the order in which things
get expanded, but that is where things get rapidly complicated.

    The layout processor works something like this. Ignoring maths,
\tx\ stores what you type in two kinds of lists, vertical and horizontal.
As it reads your words it puts them one after another in a horizontal list.
At the end of a paragraph it stops the horizontal list and adds it to the
vertical list. At the beginning of the next paragraph it starts a new
horizontal list and adds the paragraph's words to it. And so on. This
results in a vertical list of horizontal lists of words, where each 
horizontal list contains the words of a paragraph.

    It then goes through each horizontal list in turn, breaking it up into
shorter horizontal lists, one for each line in the paragraph. These are
put into another vertical list, so conceptually there is a vertical list
of paragraphs, and each paragraph is a vertical list of lines, and each
line is a horizontal list of words, or alternatively one vertical list
of lines. Lastly it chops up the vertical list of lines into page sized 
chunks and outputs them a page at a time.

    \tx\ is designed to handle arbitrary sized inserts, like those for
maths, tables, sectional divisions and so forth, in an elegant manner. 
It does this by allowing
vertical spaces on a page to stretch and shrink a little so that the
actual height of the typeblock is constant. If a page consists only of
text with no widow or orphan then the vertical spacing is regular, otherwise
it is likely to vary to some extent. Generally speaking, \tx\ is not
designed to typeset on a fixed grid, but against this
other systems are not designed
to produce high quality typeset mathematics. Attempts have been made
to tweak \ltx\ to typeset on a fixed grid but as far as I know nobody
has been completely successful.


    \tx\ works somewhat more efficiently than I have described. Instead
of reading the whole document before breaking paragraphs into lines, it 
does the line breaking at the end of each paragraph. After each paragraph
it checks to see if it has enough material for a page, and outputs a page
whenever it is full. However, \tx\ is also a bit lazy. Once it has broken
a paragraph into lines it never looks at the paragraph again, except perhaps
to split it at a page break. If you want to change, say, the width of the
typeblock on a particular page, any paragraph that spills over from a
previous page will not be reset to match the new measure. This asynchronous
page breaking\index{page break!asynchronous} also has an unfortunate effect
if you are trying to put a note in say, the outside margin, as the outside 
is unknown until after the paragraph has been set, and so the note may end
up in the wrong margin.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{\ltx\ files} \label{sec:latexfiles}

    The \pixfile{aux} file is the way \ltx\ transfers information from one
run to the next and the process works roughly like this.
\begin{itemize}
\item The \pixfile{aux} file is read at the start of the \Ie{document}
      environment. If \cmd{\nofiles} has not been specified a 
      new empty \pixfile{aux} file is then created which has the side
      effect of destroying the original \pixfile{aux} file.
\item Within the \Ie{document} environment there may be macros that write
      information to the \pixfile{aux} file, such as the sectioning or
      captioning commands. However, these macros will not write their
      information if \cmd{\nofiles} has been specified.
\item At the end of the \Ie{document} environment the contents
      of the \pixfile{aux} file are read.
\end{itemize}
Under normal circumstances new output files are produced each time \ltx\
is run, but when \cmd{\nofiles} is specified only the \pixfile{dvi} and
\pixfile{log} files will be new --- any other files are unchanged.

    In the case of the sectioning commands these write macros into the
\pixfile{aux} file that in turn write information into a \pixfile{toc}
file, and the \cmd{\tableofcontents} command reads the \pixfile{toc}
file which contains the information for the Table of Contents. To make this
a bit more concrete, as \ltx\ processes a new document through the
first two runs, the following events occur.
\begin{enumerate}
\item Initially there is neither an \pixfile{aux} nor a \pixfile{toc} file.
      At the start of the \Ie{document} environment a new empty \pixfile{aux}
      file is created.
\item During the first run the \cmd{\tableofcontents} typesets the
      Contents heading and creates a new empty \pixfile{toc}
      file.

      During
      the run sectional commands write information into the new 
      \pixfile{aux} file. At the end of the \Ie{document} environment
      the \pixfile{aux} file
      is read. Contents information in the \pixfile{aux} file is written
      to the \pixfile{toc} file. Lastly all the output files are closed.

\item For the second run the \pixfile{aux} file from the previous run is 
      read at the start of the \Ie{document} environment; no information can
      be written to a \pixfile{toc} file because the \pixfile{toc} file
      is only made available by the \cmd{\tableofcontents} command.
      The \pixfile{aux} file from the previous run is closed and the new
      one for this run is created.

        This time the \cmd{\tableofcontents} reads \pixfile{toc} file
      that was created during the previous run which contains the typesetting
      instructions for the contents, and then starts a
      new \pixfile{toc} file.

         And so the process repeats itself.
\end{enumerate}

    The \pixfile{aux} file mechanism means that, except for the simplest 
of documents, \ltx\ has to be run at least
twice in order to have all the information to hand for typesetting. 
If sections are added or deleted, two runs are necessary afterwards 
to ensure that everything is up to date. Sometimes three, or even more, 
runs are necessary to guarantee that things are settled.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\section{Syntax}

    The \ltx\ syntax that you normally see is pretty regular. 
Mandatory arguments are enclosed in curly braces and optional
arguments are enclosed in square brackets. One exception to this
rule is in the \Ie{picture} environment where coordinate and direction
pairs are enclosed in parentheses.

    The \tx\ syntax is not regular in the above sense. For example, if in
\ltx\ you said
\begin{lcode}
\newcommand*{\cmd}[2]{#1 is no. #2 of}
\cmd{M}{13} the alphabet. % prints: M is no. 13 of the alphabet
\end{lcode}
Then in \tx\ you would say
\begin{lcode}
\def\cmd#1#2{#1 is no. #2 of}
\end{lcode}
and you could then use either of the following calls:
\begin{lcode}
\cmd M{13} the alphabet.  % prints: M is no. 13 of the alphabet
\cmd{M}{13} the alphabet. % prints: M is no. 13 of the alphabet
\end{lcode}

     A simplistic explanation of the first \tx\ call of \verb?\cmd? is as 
follows. A control sequence starts with a backslash, followed by either
a single character, or one or more of what \tx\ thinks of as letters
(normally the 52 lower- and upper-case alphabetic characters);
a space or any non-letter, therefore, ends a multiletter control
sequence. \tx\ and \ltx\ discard any spaces after a macro name. 
If the macro takes any arguments, and \verb?\cmd? takes two, \tx\ will
then start looking for the first argument. An argument is either
something enclosed in braces or a single token. In the example the first
token is the character `M', so that is the value of the first argument.
\tx\ then looks for the second argument, which is the `13' enclosed
in the braces. In the second example, both arguments are enclosed in braces.

    Here are some \tx\ variations.
\begin{lcode}
\cmd B{2} the alphabet. % prints: B is no. 2 of the alphabet.
\cmd B2 the alphabet.   % prints: B is no. 2 of the alphabet.
\cmd N14 the alphabet.  % prints: N is no. 1 of4 the alphabet.
\end{lcode}
The result of \verb?\cmd B{2}? is as expected. The results of \verb?\cmd B2?
and \verb?\cmd N14? should also be expected, and if not take a moment to
ponder why. The `B' and 'N' are the first arguments to \verb?\cmd? in the
two cases because a single character is a token. Having found the first
argument \tx\ looks for the second one, which again will be a token as
there are no braces. It will find `2' and `1' as the second arguments
and will then expand the \verb?\cmd? macro. In the case of \verb?\cmd B2? this
gives a reasonable result. In the case of \verb?\cmd N14?, \tx\ expands
\verb?\cmd N1? to produce `N is in position 1 of', then continues printing
the rest of the text, which is `4 the alphabet', hence the odd looking
result.


\section{\alltx{} commands} \label{sec:alltexcommands}

    I have used some \tx\ commands in the example code and it is now time
to describe these. Only enough explanation is given to cover my use of
them. Full explanations would require a doubling in the size of the book 
and a concomitant increase in the price, so for full details consult
the \textit{\txbook} which is the definitive source, or one of the \tx\ 
manuals listed in the Bibliography. I find \textit{\tx\ by Topic}
particularly helpful.

    I have also used \ltx\ commands that are not mentioned by
Lamport. \ltx\ uses a convention for command names; any name that
includes the \texttt{@} character is an `internal' command and may be 
subject to change, or even deletion. Normal commands are meant to be 
stable --- the code implementing them may change but their effect will 
remain unaltered. In the \ltx\ kernel, and in class and package files 
the character \texttt{@} is automatically
treated as a letter so it may be used as part of a command name. 
Anywhere else you have to use 
\cmd{\makeatletter} to make \texttt{@} be treated as a letter and 
\cmd{\makeatother} to make \texttt{@} revert to its other meaning.
So, if you are defining or modifying or directly using any command 
that includes an \texttt{@}\idxatincode\
sign then this must be done in either a \file{.sty} file or if in the 
document itself it must be surrounded by \cmd{\makeatletter} and 
\cmd{\makeatother}. 

    The implication is `don't use internal commands as they may be dangerous'.
Climbing rocks is also dangerous but there are rock climbers; the live ones
though don't try climbing Half Dome in Yosemite or the North Face of the
Eiger without having first gained experience on friendlier rocks.

The \ltx\ kernel is full of internal commands and a few are mentioned
in Lamport. There is no place where you can go to get explanations of all
the \ltx\ commands, but if you run \ltx\ on the \pixfile{source2e.tex} 
file which is in the standard \ltx\ distribution you will get the commented
kernel code. The index of the commands runs to about 40 double column pages.
Each class and package introduce new commands over and above those in the
kernel. 


\ltx\ includes \cmd{\newcommand}, \cmd{\providecommand} and 
\cmd{\renewcommand} as means of (re-)defining a command, but \tx\ 
provides only one method.
\begin{syntax}
\cmd{\def}\meta{cmd}\meta{arg-spec}\marg{text} \\
\end{syntax}
\cmd{\def} specifies that within the local group\index{group}
the command \verb?\cmd? is defined as \meta{text}, and any previous definitions
of \meta{cmd} within the group are overwritten. Neither the 
\meta{text} nor any arguments can include an end-of-paragraph.
The \ltx\ equivalent to \cmd{\def} is the pair of commands
\cmd{\providecommand*} followed by \cmd{\renewcommand*}.

    The \meta{arg-spec} is a list of the argument numbers 
(e.g., \verb?#1#2?)
 in sequential
order, the list ending at the `\{' starting the \meta{text}. Any
spaces or other characters in the argument list are significant. These
must appear in the actual argument list when the macro is used.

\begin{syntax}
\cmd{\long} \cmd{\global} \\
\cmd{\gdef}\meta{cmd}\meta{arg-spec}\marg{text} \\
\cmd{\edef}\meta{cmd}\meta{arg-spec}\marg{text} \\
\cmd{\xdef}\meta{cmd}\meta{arg-spec}\marg{text} \\
\end{syntax}
If you use the \cmd{\long} qualifier before \cmd{\def} (as \verb?\long\def...?)
then the \meta{text} and arguments may include paragraphs.
The \ltx\ version of this is the unstarred \cmd{\providecommand}
followed by \cmd{\renewcommand}.

    To make a command global instead of local to the current group, 
the \cmd{\global} qualifier can be used with \cmd{\def} 
(as \verb?\global\def...?) when defining it;
\cmd{\gdef} is provided as a shorthand for this common case.

    Normally any macros within the replacement \meta{text} of a command
defined by \cmd{\def} are expanded when the command is called. 
The macro \cmd{\edef} also defines a command but in this case any macros
in the replacement \meta{text} are expanded when the command is defined.
Both \cmd{\long} and \cmd{\global} may be used to qualify \cmd{\edef},
and like \cmd{\gdef} being shorthand for \verb?\global\def?, \cmd{\xdef}
is short for \verb?\global\edef?.

    There is much more to the \cmd{\def} family of commands than I have
given; consult elsewhere for all the gory details.

\begin{syntax}
\cmd{\let}\meta{cmda}=\meta{cmdb} \\
\end{syntax}
The \cmd{\let} macro gives \meta{cmda} the same definition as \meta{cmdb}
\emph{at the time the \cmd{\let} is called}. The \Itt{=} sign is optional.
\cmd{\let} is often used when you want to save the definition of a
command.

    Here is a short example of how some of \cmd{\def} and \cmd{\let} work.
\begin{lcode}
\def\name{Alf}
\let\fred = \name
  \name, \fred.         % prints Alf, Alf.
\def\name{Fred}
  \name, \fred.         % prints Fred, Alf.
\def\name{\fred red}
  \name, \fred.         % prints Alfred, Alf.
\end{lcode}

\begin{syntax}
\cmd{\csname} \meta{string}\cmd{\endcsname} \\
\end{syntax}
If you have ever tried to define commands like \verb?\cmd1?, \verb?\cmd2? you will
have found that it does not work. \tx\ command names consists of either
a single character or a name composed solely of what \tx\ thinks
of as alphabetic characters. However, the \cmd{\csname} \cmd{\endcsname}
pair turn the enclosed \meta{string} into the control sequence \verb?\string?,
which means that you can create \verb?\cmd1? by 
\begin{lcode}
\csname cmd1\endcsname
\end{lcode}
Note that the resulting \verb?\cmd1? is not defined (as a macro).

\begin{syntax}
\cmd{\@namedef}\marg{string} \\
\cmd{\@nameuse}\marg{string} \\
\end{syntax}
The kernel \cmd{\@namedef} macro expands to \verb?\def\<string>?, where 
\meta{string} can contain any characters. You can use this to
define commands that include non-alphabetic characters. There is 
the matching \cmd{\@nameuse} macro which expands to \verb?\<string>?
which then lets you use command names that include non-alphabetic
characters. For example:
\begin{lcode}
\@namedef{fred2}{Frederick~II}
...
\makeatletter\@nameuse{fred2}\makeatother reigned from ...
\end{lcode}

\begin{comment}

    \ltx\ lets you create lengths via \cmd{\newlength}.
\begin{syntax}
\cmd{\newdimen}\meta{cmd} \\
\cmd{\newskip}\meta{cmd} \\
\end{syntax}
\tx\ has two kinds of lengths, called \emph{dimension}\index{dimension}
and \emph{glue}\index{glue}. In \ltx\ these are called 
\emph{fixed length}\index{fixed length}\index{length!fixed}
and
\emph{rubber length}\index{rubber length}\index{length!rubber}
respectively.  A new dimension is created by \cmd{\newdimen} and a new
glue by \cmd{\newskip}. It so happens that \ltx's \cmd{\newlength}
always creates a new skip --- all lengths are created as rubber lengths.

    To set a length in \ltx\ you can use any of
several commands, but \tx\ is more parsimonious.
\begin{syntax}
\meta{dimen} = \meta{length} \\
\meta{skip} = \meta{length} plus \meta{length} minus \meta{length} \\
\end{syntax}
A dimension is set by giving it a length, as in
\begin{lcode}
\mydimen = 20pt % or as the = is optional
\mydimen 20pt
\end{lcode}
A glue is also set by giving it a length, which is possibly followed
by \Itt{plus} a length optionally followed by \Itt{minus} a length.  
\begin{lcode}
\myskip = 20pt plus 5pt minus 2pt
\end{lcode}
The actual length will normally be the first specified length, but
the value is allowed to be no shorter than the given length less 
the \Itt{minus} length. The value is allowed, but only very reluctantly,
to be greater than the given length plus the \Itt{plus} length.
As in setting a dimension value the \Itt{=} sign is optional. In the example,
\verb?\myskip? can vary anywhere between 18pt and 25pt, but may possibly be
strained to be greater than 25pt.

\begin{syntax}
\cmd{\@plus} \cmd{\@minus} \\
\end{syntax}
\ltx\ supplies \cmd{\@plus} and \cmd{\@minus} which expand to \Itt{plus}
and \Itt{minus} respectively. Writing \cmd{\@plus} instead of \Itt{plus}
uses one instead of four tokens, saving three tokens, 
and \cmd{\@minus} in place of \Itt{minus}
saves four tokens --- remember that a \tx\ token is either a control 
sequence (e.g. \cmd{\@minus}) or a single character (e.g., \verb?m?). 
\tx's memory is not infinite --- it can only hold so many tokens --- and
it makes sense for kernel and class or package writers to use fewer 
rather than more to leave sufficient space for any that authors might want
to create.

\begin{syntax}
\cmd{\z@} \\
\Itt{fil} \Itt{fill} \Itt{filll} \\
\end{syntax}
\cmd{\z@} is a very useful \ltx\ command when specifying lengths.
Depending on the context it either stands for the number 0 (zero)
or 0pt (zero length). \tx\ has three kinds of infinitely stretchy 
length units that can be used in the \Itt{plus} or \Itt{minus} 
parts of a skip.
\Itt{fil} is infinitely more flexible than any fixed amount, but
\Itt{fill} is infitely more flexible than \Itt{fil} and \Itt{filll}
is infinitely more flexible than anything else at all. These infinite
glues can be used to push things around.

\begin{syntax}
\cmd{\hskip}\meta{skip} \\
\cmd{\vskip}\meta{skip} \\
\end{syntax}
The \tx\ command \cmd{\hskip} inserts \meta{skip} horizontal space
and likewise \cmd{\vskip} inserts \meta{skip} vertical space.

\begin{syntax}
\cmd{\hfil} \cmd{\hfill} \cmd{\hfilneg} \cmd{\hss} \\
\end{syntax}
These commands are all \tx\ primitives and are equivalent to horizontal 
skips with some kind of infinite glue, as indicated below (note the use
of \Itt{fil} as a length unit, it being preceeded by a number):
\begin{lcode}
\hfil     -> \hskip 0pt plus 1fil
\hfill    -> \hskip 0pt plus 1fill
\hfilneg  -> \hskip 0pt           minus 1fil
\hss      -> \hskip 0pt plus 1fil minus 1fil
\end{lcode}

\begin{syntax}
\cmd{\vfil} \cmd{\vfill} \cmd{\vfilneg} \cmd{\vss} \\
\end{syntax}
These commands are all \tx\ primitives and are equivalent to vertical 
skips with some kind of infinite glue, as indicated below:
\begin{lcode}
\vfil     -> \vskip 0pt plus 1fil
\vfill    -> \vskip 0pt plus 1fill
\vfilneg  -> \vskip 0pt           minus 1fil
\vss      -> \vskip 0pt plus 1fil minus 1fil
\end{lcode}

\end{comment}

    At any point in its processing \tx\ is in one of six 
\emph{modes}\index{mode} which can be categorized into three groups:
\begin{enumerate}
\item horizontal and restricted 
      horizontal;\index{horizontal mode}\index{mode!horizontal}\index{mode!restricted horizontal}
\item vertical and internal 
      vertical;\index{vertical mode}\index{mode!vertical}\index{mode!internal vertical}
\item math and display 
      math.\index{math mode}\index{mode!math}\index{mode!display math}
\end{enumerate}
More simply, \tx\ is in either horizontal, or vertical, or math mode.
In horizontal mode \tx\ is typically building lines of text while in
vertical mode it is typically stacking things on top of each other, 
like the lines making up a paragraph. 
Math gets complicated, and who can do with more complications
at this stage of the game?

\begin{syntax}
\cmd{\hbox} to \meta{dimen}\marg{text} \cmd{\hb@xt@}\meta{dimen}\marg{text} \\
\cmd{\vbox} to \meta{dimen}\marg{text} \\
\end{syntax}
With \cmd{\hbox}, \meta{text} is put into a horizontal box, and similarly
\cmd{\vbox} puts \meta{text} into a vertical box. The sizes of the boxes
depend on the size of the \meta{text}. The optional
\Itt{to}~\meta{dimen} phrase sets the size of the box to the fixed
\meta{dimen} value. If the
\meta{text} does not fit neatly inside a fixed size box then \tx\
will report \Itt{overfull} or \Itt{underfull} warnings. \ltx\ supplies
the \cmd{\hb@xt@} command as a shorthand for \cmd{\hbox}~\Itt{to}.

    Inside a horizontal box \tx\ is in restricted horizontal 
mode\index{mode!horizontal}
which means that everything in the box is aligned horizontally.
Inside a vertical box \tx\ is in internal vertical 
mode\index{mode!vertical} and the contents are stacked up 
and aligned vertically.

\begin{syntax}
\cmd{\dp}\meta{box} \cmd{\ht}\meta{box} \cmd{\wd}\meta{box} \\
\end{syntax}
The depth, height and width of a box are returned by the macros
\cmd{\dp}, \cmd{\ht} and \cmd{\wd} respectively.

\begin{syntax}
\cmd{\leavevmode} \\
\end{syntax}
\tx\ may be in either vertical or horizontal mode and there are
things that can be done in one mode while \tx\ reports an eror if they
are attempted in the other mode. When typesetting a paragraph \tx\
is in horizontal mode. If \tx\ is in vertical mode, \cmd{\leavevmode} 
makes it switch to horizontal mode, but does nothing if \tx\ is already
in horizontal mode. It is often used to make sure that \tx\ is in horizontal
mode when it is unclear what state it might be in.

\begin{comment}

\tx\ has various \emph{conditional}\index{conditional}
constructs of the form:
\begin{lcode}
\if something-is-true
  do-true-stuff
\else  % something is not true (i.e. it is false)
  do-false-stuff
\fi
\end{lcode}
In any of these constructs the \verb?\else do-false-stuff? phrase is
optional, and so is the \verb?do-true-stuff?.

\begin{syntax}
\piif{ifodd} \meta{number} ... \piif{else} ...  \piif{fi} \\
\end{syntax}
The command \piif{ifodd} tests whether \meta{number} is an odd number (true)
or an even number (false).

\begin{syntax}
\piif{ifnum} \meta{numbera} \Itt{>} \meta{numberb} ... \piif{else} ... \piif{fi} \\
\piif{ifnum} \meta{numbera} \Itt{=} \meta{numberb} ... \piif{else} ... \piif{fi} \\
\piif{ifnum} \meta{numbera} \Itt{<} \meta{numberb} ... \piif{else} ... \piif{fi} \\
\end{syntax}
\piif{ifnum} tests if \meta{numbera} is greater than \Itt{>}, equal to
\Itt{=} or less than \Itt{<} \meta{numberb}.
There is a similar command, \piif{ifdim}, for comparing two lengths.

\begin{syntax}
\cmd{\newif}\meta{ifcmd} \\
\end{syntax}
\cmd{\newif} creates a new conditional\index{conditional}, \meta{ifcmd}.
The \meta{ifcmd} must start with the three 
characters \verb?\if?. Two other declarations are created at the same time.
These are called \verb?\cmdtrue? and \verb?\cmdfalse?. 
Using \verb?\cmdtrue? sets the result of \verb?\ifcmd? to be true and 
using \verb?\cmdfalse? sets the result of \verb?\ifcmd? to be false. 
At creation time, \verb?\cmdfalse? is declared
so \verb?\ifcmd? is initially false. Here is an example.
\begin{lcode}
\newif\ifpeter
...
\ifpeter
  My name is Peter.
\else
  Call me Ishmael.
\fi
\end{lcode}

\end{comment}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%\input{program} % programming chapter \label{chap:program}

%% program.tex    (La)TeX programming


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%\chapter{Calculation and programming} \label{chap:program}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\makeatletter
\newcount\fib
\newcount\fibprev
\newcount\fibprevprev
\newcount\fibtogo

\newcommand*{\fibseries}[1]{%
  \fibprevprev=1\relax
  \fibprev=1\relax
  \ifnum #1>0\relax
    \@fibseries{#1}%
  \fi}

\newcommand*{\gfibseries}[3]{%
  \fibprevprev=#1\relax
  \fibprev=#2\relax
  \ifnum #3>0\relax
    \@fibseries{#3}%
  \fi}

\newcommand*{\@fibseries}[1]{%
  \fibtogo=#1\relax
  \ifnum \fibtogo=1\relax
    \the\fibprevprev
  \else
    \ifnum \fibtogo=2\relax
      \the\fibprevprev{} and \the\fibprev
    \else
      \advance\fibtogo by -2\relax
      \the\fibprevprev, \the\fibprev
      \loop
        \@fibnext
      \ifnum \fibtogo>0\relax
      \repeat
    \fi
  \fi}

\newcommand*{\@fibnext}{%
  \fib=\fibprev
  \advance\fib by \fibprevprev
  \fibprevprev=\fibprev
  \fibprev=\fib
  \printfibterm
  \advance\fibtogo by -1\relax}

\newcommand*{\printfibterm}{%
  \ifnum \fibtogo=1\relax
    \space and \else , \fi
  \the\fib}

\renewcommand*{\@fibseries}[1]{%
  \fibtogo=#1\relax
  \ifcase \fibtogo % ignore 0
  \or  % \fibtogo=1
    \the\fibprevprev
  \or  % \fibtogo=2
    \the\fibprevprev{} and \the\fibprev
  \else % fibtogo > 2
    \advance\fibtogo by -\tw@
    \the\fibprevprev, \the\fibprev
    \@whilenum \fibtogo > 0\do {% % !!! must kill space after the {
      \@fibnext}%
  \fi}

\makeatother
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{Calculation}

    \ltx\ provides some methods for manipulating numbers and these, of course,
are composed from \tx's more basic methods. Sometimes it is
useful to know what \tx\ itself provides. We have met most, if not all,
of \ltx's macros earlier but I'll collect them all here for ease of reference.

\subsection{Numbers}

    In \ltx\ a counter\index{counter} is used for storing an integer number.
\begin{syntax}
\cmd{\newcounter}\marg{counter} \\
\cmd{\setcounter}\marg{counter}\marg{number} \\
\cmd{\stepcounter}\marg{counter} \cmd{\refstepcounter}\marg{counter} \\
\end{syntax}
A new counter called \meta{counter}, without a backslash, is created using
\cmd{\newcounter}. Its value can be set to a \meta{number} by the
\cmd{\setcounter} command and \cmd{\stepcounter} increases its value by one.
If the counter is to be used as the basis for a \cmd{\label}, its
value must be set using \cmd{\refstepcounter}, neither \cmd{\stepcounter}
nor \cmd{\setcounter} will work as expected in this case.

    Internally, a \ltx\ \emph{counter} is represented by a \tx\ 
\emph{count}\index{count} --- the \cmd{\newcounter} macro creates a
\tx\ count named \cs{c@}\meta{counter}, and the other \cs{...counter}
macros similarly operate on the \cs{c@}\meta{counter} count.


\begin{syntax}
\cmd{\newcount}\meta{count} \\
\end{syntax}
The \tx\ \cmd{\newcount} command creates a new count, \meta{count}, which 
\emph{does} include an initial backslash. For example
\begin{lcode}
\newcount\mycount
\end{lcode}
\tx's method of assigning a number to a count uses nothing like 
\cmd{\setcounter}.
\begin{syntax}
\meta{count} [ \texttt{=} ] \meta{number} \\
\end{syntax}
The [ and ] enclosing the \texttt{=} sign are there only
to indicate that the \texttt{=} sign is optional. For example:
\begin{lcode}
\mycount = -24\relax  % \mycount has the value -24 
\mycount 36\relax     % now \mycount has the value 36
\end{lcode}
I have added \cmd{\relax} after the digits forming the number for safety
and efficiency. When \tx\ is reading a number it keeps on looking until
it comes across something that is not part of a number. There are things 
that \tx\ will treat as part of a number which you might not think of, 
but \cmd{\relax} is definitely not part of a number. See, for example,
\cite[chapter 7]{TEXBYTOPIC} for all the intricate details if you need them.

    There are some numbers that are used many times in the \ltx\ kernel
and class codes. To save having to use \cmd{\relax} after such numbers,
and for other reasons of efficiency, there are commands that can be used 
instead of typing the digits. These are listed in \tref{tab:intmacnum}.
The command \cmd{\z@} can be used both for the number zero and for a
length of 0pt. Do not use the commands to print a number.

\newcolumntype{A}{>{\makeatletter}r<{\makeatother}}
\begin{table}
\centering
\caption{Some internal macros for numbers} \label{tab:intmacnum}
\begin{tabular}{lrclrclr} \toprule
\cmd{\m@ne} & \makeatletter\the\m@ne\makeatother & &
%\cmd{\z@}   & \makeatletter\strip@pt\the\z@\makeatother & & 
\cmd{\z@}   & 0 & & 
\cmd{\@ne}  & \makeatletter\the\@ne\makeatother \\
\cmd{\tw@}  & \makeatletter\the\tw@\makeatother  & & 
\cmd{\thr@@} & \makeatletter\the\thr@@\makeatother & & 
\cmd{\sixt@@n} & \makeatletter\the\sixt@@n\makeatother \\
\cmd{\@xxxii} & \makeatletter\the\@xxxii\makeatother & &
\cmd{\@cclv} & \makeatletter\the\@cclv\makeatother & &
\cmd{\@cclvi} & \makeatletter\the\@cclvi\makeatother \\
\cmd{\@m} & \makeatletter\the\@m\makeatother & &
\cmd{\@Mi} & \makeatletter\the\@Mi\makeatother & &
\cmd{\@Mii} & \makeatletter\the\@Mii\makeatother \\
\cmd{\@Miii} & \makeatletter\the\@Miii\makeatother & &
\cmd{\@Miv} & \makeatletter\the\@Miv\makeatother & &
\cmd{\@MM} & \makeatletter\the\@MM\makeatother  \\
\bottomrule
\end{tabular}
\end{table}


\tx\ has a limited vocabulary for arithmetic. It can add to a count,
and can multiply and divide a count, but only by integers. The result
is always an integer. This may be disconcerting after a division where
any remainder is discarded.
The syntax for these operations is:
\begin{syntax}
\cmd{\advance}\meta{count} [ \pixkey{by} ] \meta{number} \\
\cmd{\multiply}\meta{count} [ \pixkey{by} ] \meta{number} \\
\cmd{\divide}\meta{count} [ \pixkey{by} ] \meta{number} \\
\end{syntax}
The \pixkey{by} is a \tx\ keyword and the brackets are 
just there
to indicate that it can be missed out. Some examples:
\begin{lcode}
\advance\mycount by -\mycount  % \mycount is now 0
\mycount = 15\relax            % \mycount is now 15
\divide\mycount by 4\relax     % \mycount is now 3
\multiply\mycount 4\relax      % \mycount is now 12
\advance\mycount by \yourcount % \mycount is now \yourcount + 12
\end{lcode}

The value of a count can be typeset by prepending the count by the \cmd{\the}
command, e.g., \verb?\the\mycount?.


\subsection{Lengths}

    Every length\index{length} has an associated unit. For convenience I'll use 
`\textit{dimension}'\index{dimension} as shorthand for a number and a length 
unit.
\begin{syntax}
\textit{dimension}: \meta{number}\meta{length-unit} \\
\end{syntax}
For example, a \textit{dimension} may be \texttt{10pt}, or \texttt{23mm}, 
or \texttt{1.3pc}.

    Unlike \ltx, \tx\ distinguishes two kinds of lengths. A \tx\
\cmd{\dimen} is a length that is fixed; in \ltx's terms it is a
\emph{rigid}\index{length!rigid} length. On the other hand a \tx\ \cmd{\skip}
is a length that may stretch or shrink a little; it is what \ltx\ calls 
a \emph{rubber}\index{length!rubber} length.
\begin{syntax}
\cmd{\newdimen}\meta{dimen} \cmd{\newskip}\meta{skip} \\
\end{syntax}
The \tx\ macros \cmd{\newdimen} and \cmd{\newskip} are used for creating
a new \meta{dimen} or a new \meta{skip}. For instance:
\begin{lcode}
\newdimen\mydimen
\newskip\myskip
\end{lcode}
The value of a \cmd{\dimen} is a \textit{dimension} and the value of a 
\cmd{\skip} is what \tx\ calls \textit{glue}\index{glue}. It
so happens that \ltx's \cmd{\newlength} always creates a new skip ---
all \ltx\ lengths are created as rubber\index{length!rubber} lengths. Glue
has at least one and possibly as many as three parts.
\begin{syntax}
glue: \textit{dimension} [ \pixkey{plus} \textit{dimension} ] [ \pixkey{minus} \textit{dimension} ] \\
\end{syntax}
The optional \pixkey{plus} part is the amount that the glue can 
stretch from its normal size and the optional \pixkey{minus} part 
is the amount the glue can shrink below its normal size. 
Both \pixkey{plus} and \pixkey{minus} are \tx\ keywords.
Glue can never shrink more than the \pixkey{minus} 
\textit{dimension} and it normally does not stretch more than the
\pixkey{plus} \textit{dimension}. 

\begin{syntax}
\cmd{\@plus} \cmd{\@minus} \\
\end{syntax}
\ltx\ supplies \cmd{\@plus} and \cmd{\@minus} which expand to \Itt{plus}
and \Itt{minus} respectively. Writing \cmd{\@plus} instead of \Itt{plus}
uses one instead of four tokens, saving three tokens, 
and \cmd{\@minus} in place of \Itt{minus}
saves four tokens --- remember that a \tx\ token is either a control 
sequence (e.g. \cmd{\@minus}) or a single character (e.g., \verb?m?). 
\tx's memory is not infinite --- it can only hold so many tokens --- and
it makes sense for kernel and class or package writers to use fewer 
rather than more to leave sufficient space for any that authors might want
to create.

In \tx, assigning a value to a length (\cmd{\dimen} or \cmd{\skip}) is 
rather different from the way it would be done in \ltx.
\begin{syntax}
\meta{dimen} [ \texttt{=} ] \meta{dimension} \\
\meta{skip} [ \texttt{=} ] \meta{glue} \\
\end{syntax}
The [ and ] enclosing the \texttt{=} sign are there only
to indicate that the \texttt{=} sign is optional. For example:
\begin{lcode}
\newdimen\mydimen
\mydimen = 3pt    % \mydimen has the value 3pt
\mydimen   -13pt  % now \mydimen has the value -13pt
\myskip = 10pt plus 3pt minus 2pt % \myskip can vary between
                                  % 8pt and 13pt (or more)
\myskip = 10pt plus 3pt           % \myskip can vary between
                                  % 10pt and 13pt (or more)
\myskip = 10pt minus 2pt          % \myskip can vary between
                                  % 8pt and 10pt 
\myskip = 10pt                    % \myskip is fixed at 10pt
\end{lcode}

    Like counts, the value of a length can be typeset by prepending the 
length by the \cmd{\the} command, e.g., \verb?\the\myskip?.

    \tx's lengths can be manipulated in the same way as a count, using the
\cmd{\advance}, \cmd{\multiply} and \cmd{\divide} macros. Ignoring some 
details, lengths can be added together but may only be multiplied or divided
by an integer number. 


\newdimen\Wdimen \newskip\Wskip

\begin{center}
\begin{tabular}{l}
$\rhd$  \verb?\Wdimen = 10pt? $\Rightarrow$ \\
\multicolumn{1}{r}{\global\Wdimen = 10pt \texttt{Wdimen} = \the\Wdimen} \\
$\rhd$ \verb?\Wskip = 15pt plus 5pt minus 3pt? $\Rightarrow$ \\
\multicolumn{1}{r}{ \global\Wskip = 15pt plus 5pt minus 3pt \texttt{Wskip} = \the\Wskip} \\
$\rhd$ \verb?\advance\Wskip by \Wskip? $\Rightarrow$ \\
\multicolumn{1}{r}{\global\advance\Wskip by \Wskip  \texttt{Wskip} = \the\Wskip} \\
$\rhd$  \verb?\multiply\Wskip by 3? $\Rightarrow$ \\
\multicolumn{1}{r}{\global\multiply\Wskip by 3 \texttt{Wskip} = \the\Wskip} \\
$\rhd$ \verb?\divide\Wskip by 17? $\Rightarrow$ \\
\multicolumn{1}{r}{\global\divide\Wskip by 17  \texttt{Wskip} = \the\Wskip} \\
$\rhd$ \verb?\advance\Wskip by \Wdimen? $\Rightarrow$ \\
\multicolumn{1}{r}{\global\advance\Wskip by \Wdimen  \texttt{Wskip} = \the\Wskip} \\
$\rhd$ \verb?\advance\Wdimen by \Wskip? $\Rightarrow$ \\
\multicolumn{1}{r}{\global\advance\Wdimen by \Wskip  \texttt{Wdimen} = \the\Wdimen} \\
\end{tabular}
\end{center}

    A length can be multiplied by a fractional number by prepending the
length with the number. For example:

\begin{center}
\begin{tabular}{l}
$\rhd$  \verb?\Wdimen = 0.5\Wdimen?  $\Rightarrow$ \\
  \multicolumn{1}{r}{\Wdimen = 0.5\Wdimen \texttt{Wdimen} = \the\Wdimen } \\
$\rhd$ \verb?\Wskip = 0.5\Wskip?  $\Rightarrow$ \\
\multicolumn{1}{r}{\Wskip = 0.5\Wskip  \texttt{Wskip} = \the\Wskip} \\
\end{tabular}
\end{center}

    When \cmd{\multiply} or \cmd{\divide} is applied to a \cmd{\skip}
all its parts are modified, both the fixed part and any elastic components.
However, if a \cmd{\skip} is multiplied by a fractional number then it
loses any elasticity it might have had. In the same vein, 
if a \cmd{\skip} is added to a \cmd{\dimen} any elasticity is lost. 
A \cmd{\skip} can be coerced into behaving like a \cmd{\dimen} but a
\cmd{\dimen} is always rigid. For example, typing \\
`\verb?\Wdimen = 10pt plus 2pt minus 1pt?' results in: 
`\Wdimen = 10pt plus 2pt minus 1pt'.

\begin{syntax}
\cmd{\newlength}\marg{len} \\
\end{syntax}
    \ltx's \cmd{\newlength} macro creates a new 
rubber length\index{length!rubber} (internally it uses \cmd{\newskip});
there is no \ltx\ specific macro to create a rigid length\index{length!rigid}
(i.e., a \cmd{\dimen}).

\ltx\ has a variety of macros for setting or changing its length values.
\begin{syntax}
\cmd{\setlength}\marg{len}\marg{glue} \\
\end{syntax}
The \ltx\ \cmd{\setlength} macro assigns the value \meta{glue} to the 
rubber length \meta{len}.
Some examples of this are: \newlength{\Wlen}

\begin{center}
\begin{tabular}{l}
$\rhd$ \verb?\setlength{\Wlen}{10pt}?  $\Rightarrow$ \\
\multicolumn{1}{r}{\setlength{\Wlen}{10pt} \texttt{Wlen} = \the\Wlen} \\
$\rhd$ \verb?\setlength{\Wlen}{10pt plus 2pt}?  $ \Rightarrow $ \\
\multicolumn{1}{r}{\setlength{\Wlen}{10pt plus 2pt} \texttt{Wlen} = \the\Wlen} \\
$\rhd$ \verb?\setlength{\Wlen}{10pt minus 1pt}?  $ \Rightarrow $ \\ 
\multicolumn{1}{r}{\setlength{\Wlen}{10pt minus 1pt} \texttt{Wlen} = \the\Wlen} \\
$\rhd$ \verb?\setlength{\Wlen}{10mm plus 2pt minus 1pt}?  $ \Rightarrow $ \\
 \multicolumn{1}{r}{\setlength{\Wlen}{10mm plus 2pt minus 1pt} \texttt{Wlen} = \the\Wlen} \\
\end{tabular}
\end{center}

    As shown in the last example above where both mm and pt are used as a 
length unit, the \cmd{\the} applied to a length always prints the value
in pt units.

\begin{syntax}
\cmd{\settowidth}\marg{len}\marg{text} \\
\cmd{\settoheight}\marg{len}\marg{text} \\
\cmd{\settodepth}\marg{len}\marg{text} \\
\end{syntax}
These put the \meta{text} into a box and then set the \meta{len} to the
width, height and depth respectively of the box.

\begin{syntax}
\cmd{\addtolength}\marg{len}\marg{glue} \\
\end{syntax}
\ltx's \cmd{\addtolength} macro is the equivalent of \tx's \cmd{\advance}
command. There are no equivalents to \tx's \cmd{\multiply} or \cmd{\divide}
but in any case a length can still be multiplied by prepending it with 
a fractional number.


\begin{syntax}
\cmd{\z@} \\
\Itt{fil} \Itt{fill} \Itt{filll} \\
\end{syntax}
\cmd{\z@} is a very useful \ltx\ command when specifying lengths.
Depending on the context it either stands for the number 0 (zero)
or 0pt (zero length). \tx\ has three kinds of infinitely stretchy 
length units that can be used in the \Itt{plus} or \Itt{minus} 
parts of a skip.
\Itt{fil} is infinitely more flexible than any fixed amount, but
\Itt{fill} is infitely more flexible than \Itt{fil} and \Itt{filll}
is infinitely more flexible than anything else at all. These infinite
glues can be used to push things around.

\begin{syntax}
\cmd{\hskip}\meta{skip} \\
\cmd{\vskip}\meta{skip} \\
\end{syntax}
The \tx\ command \cmd{\hskip} inserts \meta{skip} horizontal space
and likewise \cmd{\vskip} inserts \meta{skip} vertical space.

\begin{syntax}
\cmd{\hfil} \cmd{\hfill} \cmd{\hfilneg} \cmd{\hss} \\
\end{syntax}
These commands are all \tx\ primitives and are equivalent to horizontal 
skips with some kind of infinite glue, as indicated below (note the use
of \Itt{fil} as a length unit, it being preceeded by a number):
\begin{lcode}
\hfil     -> \hskip 0pt plus 1fil
\hfill    -> \hskip 0pt plus 1fill
\hfilneg  -> \hskip 0pt           minus 1fil
\hss      -> \hskip 0pt plus 1fil minus 1fil
\end{lcode}

\begin{syntax}
\cmd{\vfil} \cmd{\vfill} \cmd{\vfilneg} \cmd{\vss} \\
\end{syntax}
These commands are all \tx\ primitives and are equivalent to vertical 
skips with some kind of infinite glue, as indicated below:
\begin{lcode}
\vfil     -> \vskip 0pt plus 1fil
\vfill    -> \vskip 0pt plus 1fill
\vfilneg  -> \vskip 0pt           minus 1fil
\vss      -> \vskip 0pt plus 1fil minus 1fil
\end{lcode}



\section{Programming}

    One of the commonest programming operations is to possibly do one thing if
something is true and to possibly do another thing if it is not true. Generally
speaking, this is called an `if-then-else'\index{if-then-else} or
\emph{conditional}\index{conditional} statement.

\begin{syntax}
\cs{if...} \meta{test} \meta{true-text} [ \piif{else} \meta{false-text} ] \piif{fi} \\
\end{syntax}
\tx\ has several kinds of `if-then-else' statements which have the general
form shown above. The statement starts with an \cs{if...} and is finished
by a matching \piif{fi}. As usual, the brackets enclose optional elements, 
so there need be no \cs{else} portion. The \meta{true-text}, it it exists,
is processed if the \meta{test} is \ptrue\ otherwise the 
\meta{false-text}, if both the \piif{else} clause and \meta{false-text}
are present, is processed.

The simplest kind of \cs{if...}
is defined by the \cmd{\newif} macro.
\begin{syntax}
\cmd{\newif}\verb?\if?\meta{name} \\
\end{syntax}
\cmd{\newif} creates three new commands, the \cs{ifname} and the
two declarations, \cs{nametrue} and \cs{namefalse}, for setting the value
of \cs{ifname} to \ptrue\ or \pfalse\ respectively.
In this case the \meta{test} is embedded in the \cs{if...}.
For example:
\begin{lcode}
\newif\ifpeter
...
\ifpeter
  My name is Peter.
\else
  Call me Ishmael.
\fi
\end{lcode}
or a more likely scenario is
\begin{lcode}
\newif\ifmine
  \minetrue % or \minefalse
\newcommand{\whose}{%
  \ifmine It's mine. \else I don't know whose it is. \fi}
\end{lcode}

Here are some of the other more commonly used kinds of ifs.
\begin{syntax}
\piif{ifdim} \meta{dimen1} \meta{rel} \meta{dimen2} \\
\piif{ifnum} \meta{number1} \meta{rel} \meta{number2} \\
\piif{ifodd} \meta{number} \\
\end{syntax}
The \meta{rel} in \piif{ifnum} and \piif{ifdim} is one of the three characters:
\texttt{<} (less than), \texttt{=} (equals), or \texttt{>} (greater than).
\piif{ifdim} results in \ptrue\ if the two lengths are in the stated
relationship otherwise it results in \pfalse. Similarly \piif{ifnum}
is for the comparison of two integers. The \piif{ifodd} test is \ptrue\
if the integer \meta{number} is an odd number, otherwise it results 
in \pfalse.

    Among other things, the \ltx\ class code that organizes the page layout
checks if the length values are sensible. The following code is a snippet
from the layout algorithm. It checks that the sum of the margins and the
width of the typeblock is the same as the width of the page after trimming.
\cmd{\@tempdima} and \cmd{\@tempdimb} are two `scratch' lengths used in many
calculations.
\begin{lcode}
\@tempdimb= -1pt              % allow a difference of 1pt
\@tempdima=\paperwidth              % paperwidth
\advance\@tempdima by -\foremargin  % minus the foremargin
\advance\@tempdima -\textwidth      % minus the textwidth
\advance\@tempdima -\spinemargin    % minus the spinemargin
\ifdim\@tempdima < \@tempdimb       % should be close to zero
  %% error                          % otherwise a problem
\fi
\end{lcode}

    Changing the subject, on the offchance that you might want to see 
how the Fibonacci sequence
progresses, the first thirty numbers in the sequence are: 
\fibseries{30}.
I got \ltx\ to calculate those numbers for me, and it could have 
calculated many more. They were produced by just saying \verb?\fibseries{30}?.
The French mathematician 
\'{E}douard Lucas\index{Lucas, Edouard?Lucas, \'{E}douard} 
(1842--1891) studied sequences
like this and was the one to give it the name Fibonacci. Lucas also
invented the game called the Tower of Hanoi with  
Henri de Parville\protect\index{Parville, Henri?de Parville, Henri} (1838--1909), 
supplying the accompanying fable~\cite{PARVILLE84,ROUSEBALL}:
\begin{quotation}
In the great temple at Benares beneath the dome that marks the center of
the world, rests a brass plate in which are fixed three diamond needles, 
each a cubit high and as thick as the body of a bee. On one of these
needles, at the creation, God placed sixty-four discs of pure gold, the 
largest disc resting on the brass plate, and the others getting smaller 
and smaller up to the top one. This is the tower of Bramah. Day and night
unceasingly the priests transfer the discs from one diamond needle to
another according to the fixed and immutable laws of Bramah, which require
that the priest on duty must not move more than one disc at a time and
that he must place this disc on a needle so that there is no smaller disc
below. When the sixty-four discs shall have been thus transferred from the
needle which at creation God placed them, to one of the other needles, 
tower, temple, and Brahmins alike will crumble into dust and with a
thunderclap the world will vanish.
\end{quotation}

    The number of separate transfers of single discs is $2^{64} - 1$
or just under eighteen and a half million million moves, give or take a few,
to move the pile. At the rate of one disc per second, with no mistakes,
it would take more than 58 million million years before we would have to 
start being concerned.

    In his turn, Lucas has a number sequence named after him. There are many 
relationships between the Fibonacci 
numbers $F_{n}$ and the Lucas numbers $L_{n}$, the simplest, perhaps, being
\begin{eqnarray}
L_{n} & = & F_{n-1} + F_{n+1} \\
5F_{n} & = & L_{n-1} + L_{n+1}
\end{eqnarray}
    The first 15 numbers in the Lucas sequence are:
\gfibseries{2}{1}{15}. These were produced by saying 
\verb?\gfibseries{2}{1}{15}?. The Lucas numbers are produced in the same manner
as the Fibonacci numbers, it's just the starting pairs that differ.

However, it is the definition of the \cmd{\fibseries} and \cmd{\gfibseries}
macros that might be more interesting in this context. 

    First, create four new counts. \cs{fibtogo} is the number of terms to be
calculated, \cs{fib} is the current term, and \cs{fibprev} and \cs{fibprevprev}
are the two prior terms.
\begin{lcode}
\newcount\fib
\newcount\fibprev
\newcount\fibprevprev
\newcount\fibtogo
\end{lcode}
The argument to \cmd{\fibseries} is the number of terms. The counts
\cs{fibprevprev} and \cs{fibprev} are set to the starting pair in the sequence.
Provided the number of terms requested is one or more the macro 
\cmd{\@fibseries} is called to do the work.
\begin{lcode}
\newcommand*{\fibseries}[1]{%
  \fibprevprev=1\relax
  \fibprev=1\relax
  \ifnum #1>0\relax
    \@fibseries{#1}%
  \fi}
\end{lcode}

The macro \cmd{\@fibseries} calculates and prints the terms. 
\begin{lcode}
\newcommand*{\@fibseries}[1]{%
  \fibtogo=#1\relax
\end{lcode}
It's simple if no more than two terms have been asked for --- just print
them out.
\begin{lcode}
  \ifnum \fibtogo=\@ne
    \the\fibprevprev
  \else
    \ifnum \fibtogo=\tw@
      \the\fibprevprev{} and \the\fibprev
    \else
\end{lcode}
Three or more terms have to be calculated. We reduce the number to be 
calculated by 2, and print the first two terms.
\begin{lcode}
      \advance\fibtogo by -\tw@
      \the\fibprevprev, \the\fibprev
\end{lcode}
We now have to calculate the rest of the terms, where each term is the sum of
the two previous terms. 
The macro \cmd{\@fibnext} calculates the next term, prints it out and reduces
the number of terms left to be calculated (\cmd{\fibtogo}) by one. 
If there are terms left to be done then the process is repeated until 
they have all been printed.
\begin{lcode}
      \loop
        \@fibnext
      \ifnum \fibtogo>\z@
      \repeat
    \fi
  \fi}
\end{lcode}

The \cmd{\@fibnext} macro calculates a term in the series, uses 
\cmd{\printfibterm} to print it, and decrements the \cmd{\fibtogo} count.
\begin{lcode}
\newcommand*{\@fibnext}{%
  \fib=\fibprev
  \advance\fib by \fibprevprev
  \fibprevprev=\fibprev
  \fibprev=\fib
  \printfibterm
  \advance\fibtogo \m@ne}
\end{lcode}

The last of the macros, \cmd{\printfibterm}, typesets a term in the sequence. 
If the term is the last one print an `and' otherwise print a `,', 
then a space and the term.
\begin{lcode}
\newcommand*{\printfibterm}{%
  \ifnum \fibtogo=\@ne \space and \else , \fi 
  \the\fib}
\end{lcode}

    You have met all of the macros used in this code except for \tx's
\piif{loop} construct. I find the syntax for this a little unusual.
\begin{syntax}
\piif{loop} \meta{text1} \cs{if...} \meta{text2} \piif{repeat} \\
\end{syntax} 
The construct starts with \piif{loop} and is ended by \piif{repeat};
the \cs{if...} is any conditional test, but without the closing \piif{fi}.
\tx\ processes \meta{text1}, then if the \cs{if...} is \ptrue\
it processes \meta{text2} and repeats the sequence again starting
with \meta{text1}. On the other hand, as soon as the result of the
\cs{if...} is 
\pfalse\ the loop stops (i.e., \tx\ jumps over \meta{text2}
and goes on to do whatever is after the \piif{repeat}).

    The \cmd{\gfibseries} macro that I used for the Lucas numbers is a
generalisation of \cmd{\fibseries}, where the first two arguments are the
starting pair for the sequence and the third argument is the number
of terms; so \verb?\gfibseries{1}{1}{...}? is equivalent to
\verb?\fibseries{...}?.
\begin{lcode}
\newcommand*{\gfibseries}[3]{%
  \fibprevprev=#1\relax
  \fibprev=#2\relax
  \ifnum #3>0\relax
    \@fibseries{#3}%
  \fi}
\end{lcode}
    The calculation of the terms in the Fibonacci and in the generalised 
sequences is the same so \cmd{\@fibseries} can be used again.

    I used the \tx\ \piif{loop} construct in the \cmd{\@fibseries} macro
but \ltx\ has a similar construct.
\begin{syntax}
\cmd{\@whilenum} \meta{ifnum test} \cmd{\do} \marg{body} \\
\cmd{\@whiledim} \meta{ifdim test} \cmd{\do} \marg{body} \\
\end{syntax}
As long as the appropriate \meta{test} is \ptrue\ the \meta{body} is processed.

    In \cmd{\@fibseries} I used \cs{ifnum}s to check for 3 possible values.
There is another \cs{if...} form that can be used for this type of work.
\begin{syntax}
\piif{ifcase} \meta{number} \meta{text for 0} \piif{or} \meta{text for 1} 
  \piif{or} \meta{text for 2} \\
... \\
\piif{or} \meta{text for N} [ \piif{else} \meta{text for anything else} ] \piif{fi} \\
\end{syntax}
If the \meta{number} is 0 then \meta{text for 0} is processed, but if
\meta{number} is 1 then \meta{text for 1} is processed, but if \meta{number}
is \ldots Each \meta{text for ...} is separated by an \piif{or}. If \meta{number}
is anything other than the specified cases (i.e., less than zero or greater
than N) then if the \piif{else} is present \meta{text for anything else} is
processed. 

Here's another version of the \cmd{\@fibseries} macro using \piif{ifcase}
and \cmd{\@whilenum}.
\begin{lcode}
\renewcommand*{\@fibseries}[1]{%
  \fibtogo=#1\relax
  \ifcase \fibtogo % ignore 0
  \or  % \fibtogo=1
    \the\fibprevprev
  \or  % \fibtogo=2
    \the\fibprevprev{} and \the\fibprev
  \else % fibtogo > 2
    \advance\fibtogo by -\tw@
    \the\fibprevprev, \the\fibprev
    \@whilenum \fibtogo > \z@ \do {% must kill space after the {
      \@fibnext}%
  \fi}
\end{lcode}

    \tx\ has more programing constructs than I have shown here and these
will be explained in any good \tx\ book. \ltx\ also has more than I have shown
but in this case the best place to look for further information is in the
\ltx\ kernel code, for example in \file{ltcntrl.dtx}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%\endinput
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%#% extend
%#% extstart include the-terrors-of-errors.tex

\svnidlong
{$Ignore: $}
{$LastChangedDate: 2014-03-31 11:34:44 +0200 (Mon, 31 Mar 2014) $}
{$LastChangedRevision: 480 $}
{$LastChangedBy: daleif $}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%\input{merrors} % errors chapter \label{chap:errors}

% merrors.tex    Chapter on (La)TeX errors/warnings


\chapter{The terrors of errors} \label{chap:errors}

    No matter how conscientious you are a mistake or two will occasionally
creep into your document source. The good news is that whatever happens
\tx\ will not destroy your files --- it may produce some odd looking output,
or even no output at all, but your work is safe. The bad news is that you
have to correct any errors that \tx\ finds. To assist you in this \tx\ stops
whenever it comes across what it thinks is an error\index{error} 
and tells you about it.
If you're not sure what to do it will also provide some possibly helpful 
advice.

    \tx\ underlies \ltx\ which underlies classes and packages. You may get
messages than originate from \tx, or from \ltx, or from the class and any
packages you may be using. I'll describe the \tx, \ltx, and class messages
below.

    In general, you will see a message\index{error message!response} 
on your terminal and \ltx\ will
stop and wait for you to respond. It prints a question mark and is 
expecting you to type one of the following:
\begin{itemize}
\item \meta{return} (or \meta{enter} or what is the equivalent on your
       keyboard): \ltx\ will continue\index{error message!response!continue} 
      processing the document.
\item \texttt{H} (help): the help\index{error message!response!help}  
      message is output and \ltx\
      waits for you to respond again.
\item \texttt{S} (scroll): Continue\index{error message!response!scroll}  
      processing, outputting any
      further error messages, but not stopping.
\item \texttt{Q} (quiet): Continue\index{error message!response!quiet}
      processing without stopping
      and with no further messages.
\item \texttt{R} (run): Like\index{error message!response!run}   
      the \texttt{Q} option but not even
      stopping if your document requires some user input.
\item \texttt{I} (insert): To insert\index{error message!response!insert}
      some material for \tx\ to
      read but no changes are made to the source file.
\item \texttt{E} (edit): This\index{error message!response!edit}   
      may return you to an editor so you can
      change the file. What actually happens is system dependent.
\item \texttt{X} (exit): Stop\index{error message!response!exit}   
      this \ltx\ run.
\end{itemize}
On the system I am used to the case of the characters does not matter.
I must admit that the only ones I have used are \meta{return}, \texttt{q},
\texttt{h} and \texttt{x}, in approximately that order of frequency.

    All messages are output to the \pixfile{log} file so you can study
them later if you need to.

\section{\tx\ messages}

\index{error!TeX?\tx|(}
\index{TeX?\tx!error|(}
\index{warning!TeX?\tx|(}
\index{TeX?\tx!warning|(}

    The following is an alphabetical list of some of \tx's messages,
abbreviated in some cases, together
with their corresponding remarks. As an example of how these appear on your
terminal, if you had a line in your source that read: \\
\verb?resulting in $x^3^4$.?\\
then \tx\ would output this:
\begin{lcode}
! Double superscript
l.102 resulting in $x^3^
                        4^$.
?
\end{lcode}
If you typed \texttt{h} in response to this you would then see:
\begin{lcode}
I treat `x^1^2' essentially like `x^1{}^2'.
\end{lcode}

    \tx's messages start with \verb?!? followed by the particular message 
text. The second line starts \verb?l.?
and a number, which is the number of the line in your file where the error
is. This is followed by the text of the line itself up to the point where
the error was detected, and the next line in the report shows the rest of
the erroneous line. The last line of the report is a \verb+?+ and \tx\
awaits your response.


%% List of TeX messages
\newcommand{\textmess}[1]{\texttt{#1}}
\newcommand{\texthelp}[1]{\textit{#1}}

    In the listing I have used \textmess{this font for the error message}
and \texthelp{this font for the comment message}.
\vspace{\onelineskip}

\begin{plainlist}
%1084 
\item[\textmess{!}]\index{A box was supposed to be here} 
     \textmess{A box was supposed to be here.} \\
     \texthelp{I was expecting to see \cmd{\hbox}{} or \cmd{\vbox}{} or 
            \cmd{\copy}{} or \cmd{\box}{} or something like that. 
             So you might find
             something missing in your output. But keep trying; you can 
             fix this later.}

%395 
\item[\textmess{!}]\index{Argument of ... has an extra \rb} 
    \textmess{Argument of ... has an extra \}.} \\
    \texthelp{I've run across a `\}' that doesn't seem to match anything.
            For example,} \verb?`\def\a#1{...}'? \texthelp{and} \verb?`\a}'?
           \texthelp{would produce this error. If you simply proceed now, 
            the \piif{par} that I've just inserted will cause me to report 
            a runaway argument that might be the root of the problem. But if
            your `\}' was spurious, just type `2' and it will go away.} 

      In \ltx\ terms, the example can be translated into \\
      \verb?`\newcommand{\a}[1]{...}'? and \verb?`\a}'?.

    If you can't find the extra \} it might be that you have used a fragile
command\index{fragile} in a moving\index{moving argument} argument. 
Footnotes\index{footnote!in heading}\index{footnote!in caption} 
or math\index{math!in caption or title} in division titles 
or captions
are a fruitful source for this kind of error. You shouldn't be putting 
footnotes into titles that will get listed in the \toc. For maths, put 
\cmd{\protect} before each fragile command.

%1236 
\item[\textmess{!}]\index{Arithmetic overflow}
     \textmess{Arithmetic overflow.} \\
     \texthelp{I can't carry out that multiplication or division,
       since the result is out of range.} 

    The maximum\index{maximum number} number that \tx\
       can deal with is 2,147,483,647 and it balks at 
    dividing\index{divide by zero} by zero.


%168 \texttt{AVAIL list clobbered at \ldots}

%293/4 \texttt{BAD.}

%961 \texttt{Bad \cmd{\patterns}}
%    \texttt{(See Appendix H.)}

%1244 
%\item[\textmess{!}] \textmess{Bad \cmd{\prevgraf}.} \\
%     \texthelp{I allow only nonnegative values here.}

%432 
%\item[\textmess{!}] \textmess{Bad character code} \\
%      \texthelp{The numeric code for a character must be between 0 and 127.
%              I changed this one to zero.}

%435 
%\item[\textmess{!}] \textmess{Bad character code} \\
%      \texthelp{A character number must be between 0 and 255.
%              I changed this one to zero.}

%437 
%\item[\textmess{!}] \textmess{Bad delimter code} \\
%    \texthelp{A numeric delimeter code must be between 0 and} \verb?2^{27}-1.?
%    \texthelp{I changed this one to zero.}

%170 \texttt{Bad flag at}

%170 \texttt{Bad link, display aborted.}

%436 
%\item[\textmess{!}] \textmess{Bad math code} \\
%    \texthelp{A numeric math code must be between 0 and 32767.
%            I changed this one to zero.}

%434 
%\item[\textmess{!}] \textmess{Bad number.} \\
%    \texthelp{Since I expected to read a number between 0 and 15,
%            I changed this one to zero.}

%433 
%\item[\textmess{!}] \textmess{Bad register code} \\
%    \texthelp{A register number must be between 0 and 255.
%            I changed this one to zero.}

%1243 
%\item[\textmess{!}] \textmess{Bad space factor} \\
%     \texthelp{I allow only values in the range 1..32767 here.}

%1328 \texttt{Beginning to dump on file \ldots}

%484 \texttt{*** (cannot \cmd{\read} from terminal in nonstop modes)} fatal error

%638 \texttt{Completed box being shipped out}

%639 \texttt{Memory usage before: }

%460 
\item[\textmess{!}]\index{Dimension too large}
    \textmess{Dimension too large.} \\
    \texthelp{I can't work with sizes\index{maximum length} bigger 
           than about 19 feet.
            Continue and I'll use the largest value I can.}

%1120 
%\item[\textmess{!}] \textmess{Discretionary list is too long.} \\
%     \texthelp{Wow---I never thought anyone would tweak me here.
%             You can't seriously need such a huge discretionary list?}



%1197 
\item[\textmess{!}]\index{Display math should end with \$\$}
     \textmess{Display math should end with \$\$.} \\
     \texthelp{The `\$' that I just saw supposedly matches a previous `\$\$'.
             So I shall assume that you typed `\$\$' both times.}

    Although \$\$ is one of \tx's methods for starting and ending
display math, do \emph{not} use it in \ltx.

%1177 
\item[\textmess{!}]\index{Double subscript}
     \textmess{Double subscript.} \\
     \texthelp{I treat} \verb?`x_1_2'? \texthelp{essentially like} 
     \verb?`x_1{}_2'.? 

    This would produce $x_1{}_2$. If you were after
      say, $x_{2_{3}}$ instead, type \verb?x_{2_{3}}?.

%1177 
\item[\textmess{!}]\index{Double superscript}
     \textmess{Double superscript.} \\
     \texthelp{I treat} \verb?`x^1^2'? \texthelp{essentially like} 
     \verb?`x^1{}^2'.? 

  This would produce $x^1{}^2$. If you were after
      say, $x^{2^{3}}$ instead, type \verb?x^{2^{3}}?.

%169 \texttt{Double-AVAIL list clobbered at \ldots}

%169 \texttt{Doubly free location at ldots}

%1335 
\item[\textmess{!}]\index{end occurred inside?\cs{end} occurred inside a group ...}
     \textmess{(\cmd{\end} occurred inside a group at level ...).}

    This is message is output at the end of a run. It means that you have not
ended all the groups that you started; a group can be started by
a simple open brace (\{), but there are other starting mechanisms as well,
such as \senv{...}. If the problem is a missing \eenv{...}, \ltx\ is kind 
enough to tell you what the mismatch is.

%1335 
\item[\textmess{!}]\index{end occurred when?\cs{end} occurred when ...}
      \textmess{(\cmd{\end} occurred when ... was incomplete).}

%1335 \texttt{(\cmd{\dump} is performed only by INITEX)}

%963 \texttt{Duplicate pattern}
%    \texttt{(See Appendix H.)}

%93 \texttt{Emergency stop}

%183 \texttt{Unknown node type!}

%292 \texttt{\cs{ETC}.}

%293 \texttt{\cs{CLOBBERED}.}

%293/4 \texttt{\cs{BAD}.}

%510 
\item[\textmess{!}]\index{Extra fi?Extra \cs{fi}}%
                   \index{Extra else?Extra \cs{else}}%
                   \index{Extra or?Extra \cs{or}}
     \textmess{Extra \cs{fi}.} or  \textmess{Extra \cs{else}.} or \textmess{Extra \cs{or}.} \\
    \texthelp{I'm ignoring this; it doesn't match any \cs{if}.}

%1135 
\item[\textmess{!}]\index{Extra endcsname?Extra \cs{endcsname}}
     \textmess{Extra \cmd{\endcsname}.} \\
     \texthelp{I'm ignoring this, since I wasn't doing a \cmd{\csname}.}

%1192 
\item[\textmess{!}]\index{Extra right?Extra \cs{right}}
     \textmess{Extra \cmd{\right}.} \\
     \texthelp{I'm ignoring a \cmd{\right} that had no matching \cmd{\left}.}

%1069 
\item[\textmess{!}]\index{Extra ... or forgotten ...} 
     \textmess{Extra \}, or forgotten \cmd{\endgroup}, \$, or \cmd{\right}.} \\
     \texthelp{I've deleted a group closing symbol because it seems to be 
       spurious, as in `\$x\}\$'. But perhas the \} is legitimate and
       you forgot something else, as in} \verb?`\hbox{$x}'.? %$
       \texthelp{In such cases the way to recover is to insert both the
       forgotten and the deleted material, e.g., by typing `I\$\}'.}

       The braces or math mode delimeters didn't match. You might have
       forgotten a \texttt{\{}, \cmd{\[}, \cmd{\(} or \texttt{\$}.

%1066 
\item[\textmess{!}]\index{Extra ...}
      \textmess{Extra ...} \\
     \texthelp{Things are pretty mixed up, but I think the worst is over.}

%792 
\item[\textmess{!}]\index{Extra alignment tab ...}
    \textmess{Extra alignment tab has been changed to \cmd{\cr}.} \\
    \texthelp{You have given more \cmd{\span} or \& marks than there were
      in the preamble to the \cmd{\halign} or \cmd{\valign} now in progress.
      So I'll asume that you meant to type \cmd{\cr} instead.} 

    Internally, \ltx\ uses
      \cmd{\halign} for its \Ie{array}\index{array} and 
     \Ie{tabular}\index{tabular} environments.
      The message means that you have too many column entries in a row 
      (i.e., too many \texttt{\&} before the end of the row). Perhaps
      you have forgotten to put \cmd{\\} at the end of the preceding row.

%789 
%\item[\textmess{!}] \textmess{(interwoven alignment preambles are not allowed).} (fatal error)

%1303 
%\item[\textmess{!}] \textmess{(Fatal format file error; I'm stymied).}

%338 
\item[\textmess{!}]\index{File ended while scanning ...}%
       \index{Forbidden control sequence found ...}
     \textmess{File ended while scanning \ldots .} or 
\textmess{Forbidden control sequence found while scanning \ldots .}  \\
    \texthelp{I suspect you have forgotten a `\}', causing me
      to read past where you wanted me to stop. I'll try to recover;
      but if the error is serious you'd better type `E' or `X' now
      and fix your file.}


%579 
%\item[\textmess{!}] \textmess{Font \ldots has only \ldots fontdimen parameters.} \\
%    \texthelp{To increase the number of font parameters, you must use
%      \cmd{\fontdimen} immediately after the \cmd{\font} is loaded.}

%561 
\item[\textmess{!}]\index{Font ... not loadable ...}
 \textmess{Font \ldots not loadable: Metric (TFM) file not found.} \\
\item[\textmess{!}]\index{Font ... not loadable ...}
    \textmess{Font \ldots not loadable: Bad metric (TFM) file.} \\
    \texthelp{I wasn't able to read the size data for this font, so I will
      ignore the font specification.
      [Wizards can fix TFM files using TFtoPL/PLtoTF.]
      You might try inserting a different font spec;
      e.g., type} 
      \verb?`I\font<same font id>=<substitute font name>'.?

  \ltx\ can't find a font you have asked for.

%567 
%\item[\textmess{!}] \textmess{Font \ldots not loaded: Not enough room left.} \\
%    \texthelp{I'm afraid I won't be able to make use of this font,
%      because my memory for character-size data is too small.
%      If you're really stuck, ask a izard to enlarge me.
%      Or maybe try} 
%      \verb?`I\font<same font id>=<name of loaded font>'.?

%641 
\item[\textmess{!}]\index{Huge page cannot be shipped out}
    \textmess{Huge page cannot be shipped out.} \\
    \texthelp{The page just created is more than 18 feet tall or
      more than 18 feet wide, so I suspect something went wrong.}

%530 
\item[\textmess{!}]\index{I can't find file ...}
     \textmess{I can't find file `\ldots', please type another.} \\

  \tx\ couldn't find the file you asked it to read. You can also
  get this message with \ltx\ if you have missed the braces around
  the argument to \cmd{\input}.

%95 
\item[\textmess{!}]\index{I can't go on meeting you like this} 
   \textmess{I can't go on meeting you like this.} \\
   \texthelp{One of your faux pas seems to have wounded me deeply...
     in fact, I'm barely conscious. Plase fix it and try again.}
   

%530 
\item[\textmess{!}]\index{I can't write on file ...}
     \textmess{I can't write on file `\ldots', please type another.} \\

  \tx\ couldn't write on a file, you might have mispelled the name
   or not have permission to use it.

%535 
%\item[\textmess{!}] \textmess{I can't write on file `\ldots'.} (fatal error?)

%51 \texttt{! I can't read TEX.POOL}

%288/1258 
%\item[\textmess{!}] \textmess{Illegal magnification has been changed to 1000.} \\
%    \texthelp{The magnification ratio must be between 1 and 32768.}

%1120 
%\item[\textmess{!}] \textmess{Illegal math \cmd{\discretionary}.} \\
%     \texthelp{Sorry: The third part of a discretionary break must be empty,
%       in math formulas. I had to delete your third part.}

%479 
\item[\textmess{!}]\index{Illegal parameter number ...} 
    \textmess{Illegal parameter number in definition of \ldots .} \\
    \texthelp{You meant to type \#\# instead of \#, right?
      Or maybe a \} was forgotten somewhere earlier, and things are
      all screwed up? I'm going to assume that you meant \#\#.}

    This is probably due to a command defining command like \cmd{\newcommand}
 or \cmd{\renewcommand} or \cmd{\providecommand}, or an environment
 defining command like \cmd{\newenvironment} or \cmd{\renewenvironment}, where 
a \verb?#? has been used incorrectly. Apart from the command \cmd{\#},
a \verb?#? can only be used to indicate an argument parameter, like \verb?#3?
which denotes the third argument. You cannot use an argument parameter,
like the \verb?#3? in the last argument of either the \cmd{\newenvironment}
or the \cmd{\renewenvironment} commands.

    You get the same error if you try to include any of the above defining
commands inside another one.


%454 
\item[\textmess{!}]\index{Illegal unit of measure ...}
    \textmess{Illegal unit of measure (replaced by filll).} \\
    \texthelp{I dddon't go any higher than filll.}

    You have tried to use a \texttt{filll} with more than 3 `l's.

%456 
\item[\textmess{!}]\index{Illegal unit of measure ...}
    \textmess{Illegal unit of measure (mu inserted).} \\
    \texthelp{The unit of measurement in math glue must be mu.
      To recover gracefully from this error it's best to delete
      the erroneous units; e.g., type `2' to delete two letters.
      (See Chapter 27 of The TeXbook.)}

     \tx\ was in math mode
      and expecting a length, which must be in \texttt{mu} units.

%459 
\item[\textmess{!}]\index{Illegal unit of measure ...} 
    \textmess{Illegal unit of measure (pt inserted).} \\
    \texthelp{Dimensions can be in units of em, ex, in, pt, pc, cm, mm, dd,
      cc, bp, or sp; but yours is a new one!
      I'll assume you meant to say pt, for printers' points.
      To recover gracefully from this error it's best to delete
      the erroneous units; e.g., type `2' to delete two letters.
      (See Chapter 27 of The TeXbook.)} 

    \tx\ was expecting a length
      but it found just a number without a known length unit. For example
you wrote \verb?2ib? instead of \verb?2in?.

%1121 
%\item[\textmess{!}] \textmess{Improper discretionary list.} \\
%     \texthelp{Discretionary lists must contain only boxes and kerns.
%       The following discretionary sublist has been deleted: \ldots}

%935 
\item[\textmess{!}]\index{Improper \cs{hyphenation} ...}
    \textmess{Improper \cmd{\hyphenation} will be flushed.} \\
    \texthelp{Hyphenation exceptions must contain only letters
      and hyphens. But continue; I'll forgive and forget.}

%288 
%\item[\textmess{!}] \textmess{Incompatible magnification (\ldots); the previous value will
%            be retained.} \\
%    \texthelp{I can handle only one magnification ratio per job. So I've
%      reverted to the magnification you used earlier on this run.}

%336 
\item[\textmess{!}]\index{Incomplete ...}
    \textmess{Incomplete \ldots all text was ignored after line \ldots.} \\
    \texthelp{A forbidden control sequence occurred in skipped text.
      This kind of error happens when you say `\cs{if}...' and forget
      the matching `\cs{fi}'. I've inserted a `\cs{fi}'; this might work.}

%993 
%\item[\textmess{!}] \textmess{Insertions can only be aded to a vbox.} \\
%    \texthelp{Tut tut: You're trying to insert into a
%      box register that now contains an \cmd{\hbox}.
%      Proceed, and I'll discard its present contents.}

%826 
\item[\textmess{!}]\index{Infinite glue shrinkage ...}
    \textmess{Infinite glue shrinkage found in a paragraph.} \\
    \texthelp{The paragraph just ended includes some glue that has
       infinite shrinkability, e.g.,} \verb?`\hskip 0pt minus 1fil'.?
       \texthelp{Such glue doesn't belong there---it allows a paragraph
       of any length to fit on one line. But it's safe to proceed,
       since the offensive shrinkability has been made finite.}

%1232 
%\item[\textmess{!}] \textmess{Invalid code (\ldots) should be in the range 0 to \ldots.}
%or \textmess{Invalid code (\ldots) should be at most \ldots} \\
%     \texthelp{I'm going to use 0 instead of that illegal code value.}

%1159 
\item[\textmess{!}]\index{Limit controls ...}
     \textmess{Limit controls must follow a math operator.} \\
     \texthelp{I'm ignoring this misplaced \cmd{\limits} or \cmd{\nolimits} 
       command.}

%660 
%\item[\textmess{!}] \textmess{Loose \cmd{\hbox} (badness \ldots).}

%674 
%\item[\textmess{!}] \textmess{Loose \cmd{\vbox} (badness \ldots).}


%1195 
%\item[\textmess{!}]\textmess{Math formula deleted: Insufficient extension fonts.} \\
%     \texthelp{Sorry, but I can't typeset math unless \cmd{\textfont} 3
%       and \cmd{\scriptfont} 3 and \cmd{\scriptscriptfont} 3
%       have all the \cmd{\fontdimen} values needed in math extension fonts.}

%1195 
%\item[\textmess{!}] \textmess{Math formula deleted: Insufficient symbol fonts.} \\
%     \texthelp{Sorry, but I can't typeset math unless \cmd{\textfont} 2
%       and \cmd{\scriptfont} 2 and \cmd{\scriptscriptfont} 2
%       have all the \cmd{\fontdimen} values needed in math symbol fonts.}

%1128 
\item[\textmess{!}]\index{Misplaced \&}\index{Misplaced \cs{cr}}\index{Misplaced \cs{span}} 
      \textmess{Misplaced \&.} or \textmess{Misplaced \cmd{\cr}.} or \textmess{Misplaced \cmd{\span}.} \\
     \texthelp{I can't figure out why you would want to use a tab mark
       or \cmd{\cr} or \cmd{\span} here. 
       If you just want an ampersand the remedy is simple: Just type}
       \verb?`I\&'? 
       \texthelp{now. But if some right brace
       up above has ended a previous alignment prematurely,
       you're probably due for more error messages, and you
       might try typing `S' now just to see what is salvageable.}

     In \ltx\ the most likely of these messages is the 
     \textmess{Misplaced \&}. You can only use a naked \texttt{\&} in 
     environments like \Ie{array} and \Ie{tabular} as column separators.
     Anywhere else you have to use \cmd{\&}.


%1129 
\item[\textmess{!}]\index{Misplaced \cs{noalign}} 
     \textmess{Misplaced \cmd{\noalign}.} \\
     \texthelp{I expect to see \cmd{\noalign} only after the \cmd{\cr} of
       an alignment. Proceed, and I'll ignore this case.}

%1129 
\item[\textmess{!}]\index{Misplaced \cs{omit}} 
     \textmess{Misplaced \cmd{\omit}.} \\
     \texthelp{I expect to see \cmd{\omit} only after the tab marks or 
       the \cmd{\cr} of an alignment. Proceed, and I'll ignore this case.}

%1132 
\item[\textmess{!}]\index{Missing \cs{cr} inserted} 
     \textmess{Missing \cmd{\cr} inserted.} \\
     \texthelp{I'm guessing that you meant to end an alignment here.}
    
 You might have missed a \cmd{\\} at the end of the last row
     of a \Ie{tabular} or \Ie{array}.

%503 
\item[\textmess{!}]\index{Missing = inserted ...} 
    \textmess{Missing = inserted for \ldots .} \\
    \texthelp{I was expecting to see `$<$', `$=$', or `$>$'. Didn't.}

%783 
\item[\textmess{!}]\index{Missing \# inserted ...} 
     \textmess{Missing \# inserted in alignment preamble.} \\
    \texthelp{There should be exactly one \# between \&'s, when an 
      \cmd{\halign} or \cmd{\valign} is being set up. In this case you had
      none, so I've put one in; maybe that will work.}

    If you get this in \ltx\ then there are problems with the argument
    to an \Ie{array} or \Ie{tabular}. 

\item[\textmess{!}]\index{Missing \$ inserted}%
    \index{Missing \cs{endgroup} inserted}%
    \index{Missing \cs{right} inserted}%
    \index{Missing \rb inserted} 
    \textmess{Missing \$ inserted.} or 
    \textmess{Missing \cmd{\endgroup} inserted.} or 
    \textmess{Missing \cmd{\right} inserted.} or 
    \textmess{Missing \} inserted.} \\
     \texthelp{I've inserted something that you may have forgotten.
       (See the $<$inserted text$>$ above.)
       With luck, this will get me unwedged, But if you 
       really didn't forget anything, try typing `2' now; then
       my insertion and my current dilemma will both disappear.}

   This is a general response to the above messages. There is also a
more specific response for each of the messages, as listed below.


%1047 
\item[\textmess{!}]\index{Missing \$ inserted} 
     \textmess{Missing \$ inserted.} \\
     \texthelp{I've inserted a begin-math/end-math symbol since I think
       you left one out. Proceed with fingers crossed.}

    Certain commands can only be executed in math mode and there are 
others that cannot be used in math mode. \tx\ has come across a command that
cannot be used in the current mode, so it switches into, or out of, math
mode on the assumption that that was what you had forgotten to do.

%1065 
%373 
\item[\textmess{!}]\index{Missing \cs{endcsname} inserted} 
    \textmess{Missing \cmd{\endcsname} inserted.} \\
    \texthelp{The control sequence marked $<$to be read again$>$ should
      not appear between \cmd{\csname} and \cmd{\endcsname}.}

%403 
\item[\textmess{!}]\index{Missing \lb{} inserted} 
    \textmess{Missing \{ inserted.} \\
    \texthelp{A left brace was mandatory here, so I've put one in.
      You might want to delete and/or insert some corrections
      so that I will find a matching right brace soon.
      If you're confused by all this, try typing `I\}' now.}

%475 
\item[\textmess{!}]\index{Missing \lb{} inserted} 
    \textmess{Missing \{ inserted.} \\
    \texthelp{Where was the left brace? You said something like}
      \verb?\def\a}',?
      \texthelp{which I'm going to interpret as}
      \verb?\def\a{}'.?

     In \ltx\ terms, the example wrongdoing would be \verb?\newcommand{\a}}?

%1127 
\item[\textmess{!}]\index{Missing \lb{} inserted} 
     \textmess{Missing \{ inserted.} \\
     \texthelp{I've put in what seems becessary to fix
       the current column of the current alignment.
       Try to go on, since this might almost work.}

      It seems that a \texttt{\{} might have been missing in a \Ie{tabular}
      or \Ie{array} entry.

%1082 
%\item[\textmess{!}] \textmess{Missing `to' inserted.} \\
%     \texthelp{I'm working on} \verb?`\vsplit<box number> to <dimen>';?
%       \texthelp{will look for the $<$dimen$>$ next.}

%1207 
%\item[\textmess{!}] \textmess{Missing \$\$ inserted.} \\
%     \texthelp{Displays can use special alignments (like \cmd{eqalignno})
%       only if nothing but the alignment itself is between \$\$'s.}

%581 
%\item[\textmess{!}] \textmess{Missing character: there is no \ldots in font \ldots.}

%1215 
\item[\textmess{!}]\index{Missing control sequence inserted} 
   \textmess{Missing control sequence inserted.} \\
     \texthelp{Please don't say} \verb?`\def cs{...}',? \texthelp{say}
       \verb?`\def\cs{...}'.?
       \texthelp{I've inserted an inaccessible control sequence so that your
       definition will be completed without mixing me up too badly.
       You can recover graciously from this error, if you're
       careful; see exercise 27.2 in The TeXbook.}

%1161 
\item[\textmess{!}]\index{Missing delimeter(. inserted).} 
     \textmess{Missing delimeter(. inserted).} \\
     \texthelp{I was expecting to see something like} 
       \verb?`('? 
       \texthelp{or}
       \verb?`\{'? 
       \texthelp{or} 
       \verb?`\}'? 
       \texthelp{here. If you typed, e.g.,} 
       \verb?`{'? 
       \texthelp{instead of}
       \verb?`\{'? 
       \texthelp{you should probably delete the}
       \verb?`{'? 
       \texthelp{by typing `1' now, so that braces don't get unbalanced.
       Otherwise just proceed.
       Acceptable delimeters are characters whose \cmd{\delcode} is
       nonnegative, or you can use `\cmd{\delimeter} $<$delimeter code$>$'.}

%577 
%\item[\textmess{!}] \textmess{Missing font identifier.} \\
%    \texthelp{I was looking for a control sequence whose
%      current meaning has been defined by \cmd{\font}.}

%415/446 
\item[\textmess{!}]\index{Missing number ...}
    \textmess{Missing number, treated as zero.} \\
    \texthelp{A number should have been here; I inserted `0'.
      (If you can't figure out why I needed to see a number,
      look up `weird error' in the index to The TeXbook.)}

    In \ltx\ this is often caused by a command expecting a number or a length
argument but not finding it. You might have forgotten the argument or
an opening square bracket in the text might have been taken as the start
of an optional argument. For example, the \cmd{\\} (newline) command takes 
an optional length argument, so the following will produce this error:
\begin{lcode}
... next line\\
[Horatio:] ...
\end{lcode}
                         
%937 
\item[\textmess{!}]\index{Not a letter} 
    \textmess{Not a letter.} \\
    \texthelp{Letters in \cmd{\hyphenation} words must have \cmd{\lccode}>0.}

    One or more characters in the argument to the \cmd{\hyphenation} command
    should not be there.


%962 
%\item[\textmess{!}] \textmess{Nonletter.} \\
%    \texthelp{(See Appendix H.)}

%445 
\item[\textmess{!}]\index{Number too big} 
    \textmess{Number too big.} \\
    \texthelp{I can only go up to 2147483647 = '17777777777 = "7FFFFFFF,
      so I'm using that number instead of yours.} 

    These all represent the
      same value, firstly in decimal, secondly in octal, and lastly in
      hexadecimal notations.

%1024 
\item[\textmess{!}]\index{Output loop ...}
     \textmess{Output loop--- \ldots consecutive dead cycles.} \\
     \texthelp{I've concluded that your \cmd{\output} is awry; it never does a
       \cs{shipout}, so I'm shipping \cmd{\box255} out myself. Next time
       increase \cmd{\maxdeadcycles} if you want me to be more patient!}

       \tx\ appears to be spinning its wheels, doing nothing.

%1024 
%\item[\textmess{!}] \textmess{Output routine didn't use all of \cmd{\box255}.} \\
%     \texthelp{Your \cmd{\output} commands should empty \cmd{\box255},
%       e.g., by saying `\cs{shipout}\cmd{\box255}'.
%       Proceed; I'll discard its present contents.}

%666 
\item[\textmess{!}]\index{Overfull \cs{hbox} ...} 
    \textmess{Overfull \cmd{\hbox} (\ldots pt too wide).}

    This is a warning that \tx\ couldn't cram some text into the alloted
horizontal space.

%677 
\item[\textmess{!}]\index{Overfull \cs{vbox} ...}
    \textmess{Overfull \cmd{\vbox} (\ldots pt too high).}

    This is a warning that \tx\ couldn't find a good place for a
pagebreak, so it has put too much onto the current page.


%396 
\item[\textmess{!}]\index{Paragraph ended before ...} 
    \textmess{Paragraph ended before \ldots was complete.} \\
    \texthelp{I suspect you've forgotten a `\}', causing me to apply this
      control sequence to too much text. How can we recover?
      My plan is to forget the whole thing and hope for the best.}

      Either a blank line or a \piif{par} command appeared in the
      argument to a macro that cannot handle paragraphs (e.g.,
      a macro that was defined using \cmd{\newcommand*}).

%476 
%\item[\textmess{!}] \textmess{Parameters must be numbered consecutively.} \\
%    \texthelp{I've inserted the digit you should have used after the \#.
%      Type `1' to delete what you did use.}

%1252 \texttt{Patterns can only be loaded by INITEX}

%360 
\item[\textmess{!}]\index{Please type a command ...}  
     \textmess{Please type a command or say `\cmd{\end}'.} 

    This is the message that causes me the most trouble. My computer
always ignores whatever I say to it and even typing \cmd{\end} has
no effect. What I usually do, after having tried a few variations
like \eenv{document}, is to kill the program by whatever means the operating
system provides. Some other possible responses include:
\begin{itemize}
\item Type \cmd{\stop}
\item Type \verb?\csname @@end\endcsname? (\ltx\ stores \tx's version of
      \cmd{\end} as \cmd{\@@end})
\item Type some macro that you think is unknown, perhaps \cs{qwertyuiod},
      then respond to the error message: \textmess{Undefined control sequence.}
\item Sometimes nothing works except killing the program. If you are are sure you
      know how to kill a program, try the following highly contrived code:
\begin{lcode}
\documentclass{article}
  \newif\ifland
  \newif\ifprint
  \newcommand{\Xor}[2]{\ifx #1 #2}
\begin{document}
%  \Xor{\ifland}{\ifprint}% try uncommenting this
  \iffalse
\end{document}
\end{lcode}
\end{itemize}



%1166 
%\item[\textmess{!}] \textmess{Please use \cmd{\mathaccent} for accents in math mode.} \\
%     \texthelp{I'm changing \cmd{\accent} to \cmd{\mathaccent} here; wish 
%       me luck. Accents are not the same in formulas as they are in text.}

%306 
\item[\textmess{!}]\index{Runaway argument}%
                   \index{Runaway definition}%
                   \index{Runaway preamble}%
                   \index{Runaway text}
    \textmess{Runaway argument.} or 
    \textmess{Runaway definition.} or
    \textmess{Runaway preamble.} or 
    \textmess{Runaway text.} 

%524 
%\item[\textmess{!}] \textmess{Sorry, I can't find that format; will try PLAIN.}

%1050 
\item[\textmess{!}]\index{Sorry, but I'm not ...}
     \textmess{Sorry, but I'm not programmed to handle this case.} \\
     \texthelp{I'll just pretend that you didn't ask for it.
       If you're in the wrong mode, you might be able to
       return to the right one by typing `I\}' or `I\$' or
       `I\cs{par}'.}


%94 
\item[\textmess{!}]\index{TeX capacity exceeded ...} 
   \textmess{TeX capacity exceeded, sorry [\ldots].} \\
   \texthelp{If you absolutely need more capacity, you can ask a wizard 
     to enlarge me.}

   This is dealt with in more detail below.

%346 
\item[\textmess{!}]\index{Text line contains ...} 
    \textmess{Text line contains an invalid character.} \\
    \texthelp{A funny symbol that I can't read has just been input.
      Continue, and I'll forget that it ever happened.}

    The input file contains a nonprinting (control) character; only
printing characters should be in the file. Some programs, 
like word processors, insert invisible characters into their output file. If
you have used one of these to prepare your input file, make sure you
save it as a plain text file (also known as an ASCII file).


%82 
\item[\textmess{!}]\index{That makes 100 errors ...} 
     \textmess{That makes 100 errors; please try again.}

%95 
\item[\textmess{!}]\index{This can't happen ...} 
    \textmess{This can't happen (\ldots).} \\
   \texthelp{I'm broken. Please show this to someone who can fix can fix}

    This is the message you should never see!

%667 
%\item[\textmess{!}] \textmess{Tight \cmd{\hbox} (badness \ldots).}

%678 
%\item[\textmess{!}] \textmess{Tight \cmd{\vbox} (badness \ldots).}


%1068 
\item[\textmess{!}]\index{Too many \rb's} 
     \textmess{Too many \}'s.} \\
     \texthelp{You've closed more groups than you opened.
       Such booboos are generally harmless, so keep going.}

    There are more closing braces (\}) than there are opening braces (\{).

%1027 
\item[\textmess{!}]\index{Unbalanced output routine} 
     \textmess{Unbalanced output routine.} \\
     \texthelp{Your sneaky output routine has fewer real \{'s than \}'s.
       I can't handle that very well; good luck.}

     A package or class has done nasty things to one of \ltx's most
     delicate parts --- the output routine.

%1372 
\item[\textmess{!}]\index{Unbalanced write command} 
     \textmess{Unbalanced write command.} \\
     \texthelp{On this page there's a \cmd{\write} with fewer real \{'s 
       than \}'s. I can't handle that very well; good luck.}

%370 
\item[\textmess{!}]\index{Undefined control sequence} 
    \textmess{Undefined control sequence.} \\
    \texthelp{The control sequence at the end of the top line
      of your error message was never \cmd{\def}'ed. If you have
      misspelled it (e.g., `\cs{hobx}'), type `I' and the correct
      spelling (e.g., `I\cs{hbox}'). Otherwise just continue,
      and I'll forget whatever was undefined.}

    \tx\ has come across a macro name that it does not know about.
Perhaps you mispelled it, or it is defined in a package you did not include.
Another possibility is that you used a macro name that included the
\texttt{@} character without enclosing it between \cmd{\makeatletter}
and \cmd{\makeother} (\seeatincode)\idxatincode. 
In this case \tx\ would think that the name was 
just the portion up to the \texttt{@}.


%660 
\item[\textmess{!}]\index{Underfull \cs{hbox} ...} 
    \textmess{Underfull \cmd{\hbox} (badness \ldots).}

    This is a warning. There might be some extra horizontal space. It could
be caused by trying to use two \cmd{\newline} or \cmd{\\} commands
in succession with nothing intervening, or by using a \cmd{\linebreak}
command or typesetting with the \cmd{\sloppy} declaration.

%674 
\item[\textmess{!}]\index{Underfull \cs{vbox} ...}  
   \textmess{Underfull \cmd{\vbox} (badness \ldots).}

    This is a warning that \tx\ couldn't find a good place for a
pagebreak, so it produced a page with too much whitespace on it.

%398 
\item[\textmess{!}]\index{Use of ... doesn't match ...}
    \textmess{Use of \ldots doesn't match its definition.} \\
    \texthelp{If you say, e.g.,}
     \verb?`\def\a1{...}',?
     \texthelp{then you must always put `1' after `\cs{a}', since the control
       sequence names are made up of letters only. 
       The macro here has not been followed by the required stuff,
       so I'm ignoring it.}


%476 
%\item[\textmess{!}] \textmess{You already have nine parameters.} \\
%    \texthelp{I'm going to ignore the \# sign you just used.}



%1304 \texttt{You can't dump inside a group}
%     \texttt{`\{...\cmd{\dump}\}' is a no-no.}

%1099 
%\item[\textmess{!}] \textmess{You can't \cs{insert255}.} \\
%     \texthelp{I'm changing to \cs{insert0}; box 255 is special.}

%1095 
%\item[\textmess{!}] \textmess{You can't use `\cmd{\hrule}' here without leaders.} \\
%     \texthelp{To put a horizontal rule in an hbox or an alignment,
%       you should use \cmd{\leaders} or \cmd{\hrulefill} 
%       (see The TeXbook).}

%1213 
%\item[\textmess{!}] \textmess{You can't use `\cmd{\long}' or `\cmd{\outer}' with \ldots} \\
%     \texthelp{I'll pretend you didn't say \cmd{\long} or \cmd{\outer} here.}

%1212 
%\item[\textmess{!}] \textmess{You can't use a prefix with \ldots} \\
%     \texthelp{I'll pretend you didn't say \cmd{\long} or \cmd{\outer} 
%       or \cmd{\global}.}

%428 
%\item[\textmess{!}] \textmess{You can't use `\ldots' after \cmd{\the}.} \\
%    \texthelp{I'm forgetting what you said and using zero instead.}

%428 
%\item[\textmess{!}] \textmess{You can't use `\ldots' after `\ldots'.} \\
%    \texthelp{I'm forgetting what you said and not changing anything.}

%1049 
\item[\textmess{!}]\index{You can't use ... in ...} 
    \textmess{You can't use `\ldots' in `\ldots'.} \\

 This often manifests itself in the form \\
\textmess{You can't use `\cmd{\spacefactor}' in vertical 
 mode}\index{You can't use `\cs{spacefactor}' in vertical mode} \\
 the cause
is usually trying to use a macro with \texttt{@} in its name, typically
in the preamble (\seeatincode)\idxatincode. 
The solution is to enclose the macro within
\cmd{\makeatletter} and \cmd{\makeatother}. 

    Another version is \\
\textmess{You can't use `macro parameter character \#' in ... 
mode.}\index{You can't use `macro parameter character \#' in ... mode} \\
In this case you have used a naked \texttt{\#} in ordinary text; it can only
be used in the definition of a macro. In ordinary text you have to use 
\cmd{\#}.

%486 
%\item[\textmess{!}] \textmess{File ended within \cmd{\read}.} \\
%    \texthelp{This \cmd{\read} has unbalanced braces.}

\end{plainlist}

\index{TeX?\tx!warning|)}
\index{warning!TeX?\tx|)}

\subsection{\tx\ capacity exceeded}

\index{TeX capacity exceeded ...|(} 
    \tx\ has run out of computer space before it finished processing your
document. The most likely cause is an error in the input file rather than
there really not being enough space --- I have processed documents consisting
of more than 1400 pages without any capacity problems.

    You can very easily make \tx\ run out of space. Try inputting this:
\begin{lcode}
\documentclass{article}
\newcommand*{\fred}{Fred}          % should print `Fred'
% try to make it print `Frederick' instead
\renewcommand{\fred}{\fred erick}  
\begin{document}
  His name is \fred.
\end{document}
\end{lcode}
and \tx\ will tell you that it has run out of stack space:
\begin{lcode}
! TeX capacity exceeded, sorry [input stack size=15000].
\fred ->\fred
             erick
l.5 His name is \fred
                      .
No pages of output.
Transcript written on errors.log.
\end{lcode}

 The offending code above
tries to define \cs{fred} in terms of itself, and \tx\ just keeps chasing 
round and round trying to pin down \cs{fred} until it is exhausted.

    At the end of the \file{log} file for a run, \tx\ prints the memory space
it has used. For example:
\begin{lcode}
Here is how much of TeX's memory you used:
 2432 strings out of 60985
 29447 string characters out of 4940048
 106416 words of memory out of 8000001
 5453 multiletter control sequences out of 10000+65535
 8933 words of font info for 31 fonts out of 1000000 for 1000
 276 hyphenation exceptions out of 1000
 26i,11n,21p,210b,380s stack positions out of 
            15000i,4000n,6000p,200000b,40000s
\end{lcode}

    The error message says what kind of space it exhausted (input stack size
in the example above). The most common are:
\begin{plainlist}

\item[\texttt{buffer size}\index{buffer size}] 
   Can be caused by too long a section or caption title appearing
   in the \toc, \lof, etc. Use the optional argument to produce a 
   shorter entry.

\item[\texttt{exception dictionary}\index{exception dictionary}] There
    are too many words listed in \cmd{\hyphenation} commands. Remove any 
    that are not actually used and if that doesn't work, remove the less 
    common ones and insert \cmd{\-} in the words in the text.

\item[\texttt{hash size}\index{hash size}]
    The document defines too many command names and/or uses too many
    cross-referencing \cmd{\label}s.

\item[\texttt{input stack size}\index{input stack size}]
    Typically caused by a self-referencing macro definition.


\item[\texttt{main memory size}\index{main memory size}]
    There are three main things that  cause \tx\ to run out of main memory:
\begin{itemize}
\item Defining a lot of very long complicated macros.
\item Having too many \cmd{\index} or \cmd{\glossary} commands on a page.
\item Creating such a complicated page that \tx\ cannot hold all it needs
      to process it.
\end{itemize}
The solution to the first two problems is to simplify and eliminate. The
third is more problematic.

    Large \Ie{tabular}s, \Ie{array}s and \Ie{picture}s (the \cmd{\qbezier}
command is a memory hog) can gobble up memory. A queue of floats also demands
memory space. Try putting a \cmd{\clearpage} just before the place where the
error occurs and if it still runs out of room then there may be an error in
your file, otherwise you did exceed the capacity.

    If you have a long paragraph or a long \Ie{verbatim} environment try
breaking it up, as \tx\ keeps these in memory until it is ready to 
typeset them. If you have a queue of floats make sure that you have done
your best to help \ltx\ find a way to output them (see \Sref{sec:floatplace})
and try adding \cmd{\clearpage} at appropriate places to flush the queue.


\item[\texttt{pool size}\index{pool size}]
    Typically caused by having too many characters in command names
    and label names.

    It can also be caused by omitting the right brace that ends the
argument of a counter command (\cmd{\setcounter} or \cmd{\addtocounter})
or of a \cmd{\newenvironment} or \cmd{\newtheorem} command.

\item[\texttt{save stack size}\index{save stack size}]
   This happens if commands or environments are nested too deeply.
For instance a \Ie{picture} that contains a \Ie{picture} that includes
a \cmd{\multiput} that includes a \Ie{picture} that includes a \ldots


\index{TeX capacity exceeded ...|)} 

\end{plainlist}

\index{TeX?\tx!error|)}
\index{error!TeX?\tx|)}


\section{\ltx\ errors}

\index{LaTeX?\ltx!error|(}
\index{error!LaTeX?\ltx|(}

    \ltx\ errors introduce themselves differently from those
that \tx\ finds. For example, if you ever happended to
use the \cmd{\caption} command outside a float, like:
\begin{lcode}
\caption{Naked}
\end{lcode}
you would get the message:
\begin{lcode}
! LaTeX Error: \caption outside float.

See the LaTeX manual or LaTeX Companion for explanation.
Type H <return> for immediate help.
 ...

l.624 \caption
              {Naked}
?
\end{lcode}
If you then typed \texttt{H} in response you would get the following
helpful message:
\begin{lcode}
You're in trouble here. Try typing <return> to proceed.
If that doesn't work, type X <return> to quit.
?
\end{lcode}
The majority of \ltx's help messages follow this formula, so I have
not noted them in the alphabetical listing below.


%%%%\subsection{Errors}

\begin{plainlist}

%LTTAB
\item[]\index{\cs{<} in mid line} 
   \textmess{\cs{<} in mid line}

    A \cmd{\<} appears in the middle of a line in a \Ie{tabbing} environment;
it should only come at the start of a line.

%LTFSSDCL
\item[]\index{... allowed only in math mode} 
   \textmess{... allowed only in math mode}

    You have tried to use a math command in a non-math mode.


%%%% BBBBBBBBBBBBBBBBBB

%LTERROR
\item[]\index{Bad \cs{line} or \cs{vector} argument} 
   \textmess{Bad \cmd{\line} or \cmd{\vector} argument}

    A \cmd{\line} or \cmd{\vector} has a negative length argument or
the slope is not within the allowed range.

%LTERROR
\item[]\index{Bad math environment delimeter} 
   \textmess{Bad math environment delimeter}

    If in math mode there is a start math mode command like \cmd{\(}
or \cmd{\[} or if in LR or paragraph mode there is an end math mode
command like \cmd{\)}or \cmd{\]}. The basic problem is unmatched math
mode delimeters or unbalanced braces.

%LTERROR
\item[]\index{begin{...} ended by end{...}?\senv{...} ended by \eenv{...}} 
   \textmess{\senv{...} ended by \eenv{...}}

    The name of the \cmd{\begin} argument is not the same as the
name of the \cmd{\end} argument. This could be caused by a typo or a missing
\cmd{\end}.

%%%% CCCCCCCCCCCCCCCC

%LTERROR
\item[]\index{Can only be used in the preamble} 
    \textmess{Can only be used in the preamble}

    Some commands can only be used in the preamble\index{preamble}, such
as \cmd{\usepackage}, but
there was one of these after the \senv{document}.


%LTFLOAT
\item[]\index{caption outside float?\cs{caption} outside float} 
   \textmess{\cmd{\caption} outside float}

    You have used the \cmd{\caption} command outside a float, such as
a \Ie{figure} or \Ie{table} environment. 


%LTERROR
\item[]\index{Command \cs{...} already defined ...}
   \textmess{Command \cs{...} already defined or name \cs{end}... illegal}

    This is normally because you have used one of the \cs{new...}
commands to define a command or environment or counter name that has 
already been used; remember also that defining an environment \verb?foo?
automatically defines the macro \cs{foo}. Either choose a new name or
use the appropriate \cs{renew...}; also, see \Sref{sec:nameclash}.
In the unlikely event that you have
tried to define something beginning with \cs{end...}, choose another name.
\label{alreadydefined}



%LTERROR %LTFSSINI
\item[]\index{Command ... invalid ...} 
   \textmess{Command ... invalid in math mode}

    You have used a non-math command in math mode.

%LTFSSDCL
%\item[]\index{Command \cs{..} not defined as a math alphabet}
%     \textmess{Command \cs{..} not defined as a math alphabet} 
%       (use \cmd{\DeclareMathAlphabet} to define it)

%LTFSSINI
\item[]\index{Command ... not provided ...}
     \textmess{Command ... not provided in base LaTeX2e} 

    You have tried to use a symbol that is not part of basic \ltx.
Try loading the \Lpack{latexsym} or \Lpack{amsfonts} package which
might define the symbol.

%LTOUTENC
%\item[] \textmess{Command ... unavailable in encoding ...}

%LTFSSBAS
%\item[] \textmess{Corrupted NFSS tables}


%LTERROR
\item[]\index{Counter too large} 
   \textmess{Counter too large}

    You are using a non-numeric counter representation, such as letters
or footnote symbols, and the counter has exceeded the allowed number
(for example there are only 26 alphabetic characters).


%%%% EEEEEEEEEEEEEEEEEEEE

%LTFSSBAS
%\item[] \textmess{Encoding scheme `...' unknown}

%LTOUTENC
%\item[] \textmess{Encoding file ... not found. You might have misspelt the
%       name of the encoding.}


%LTDEFNS %LTERROR %LTMISCEN
\item[]\index{Environment ... undefined}  
    \textmess{Environment ... undefined} 

    \ltx\ does not know the name of the argument of a \cmd{\begin}.
You have probably misspelled it.


%%%% FFFFFFFFFFFFFFFFFFFFF

%LTFILES
\item[]\index{File not found ...}
     \textmess{File not found. Type X to quit or <RETURN> to proceed
       or enter new name (Default extension: ...)}

    \ltx\ cannot find the file you requested. The extension \file{tex}
results from a problematic \cmd{\input} or \cmd{\include}; the extension
\file{sty} from a \cmd{\usepackage} and an extension \file{cls}
from a \cmd{\documentclass}. 

%LTERROR %LTOUTPUT
\item[]\index{Float(s) lost} 
    \textmess{Float(s) lost}

    Usually caused by having too many \cmd{\marginpar}s on a page.

%LTFSSBAS
%\item[] \textmess{Font family `..+..' unknown}

%LTFSSTRC
%\item[] \textmess{Font ... not found}



%%%% IIIIIIIIIIIIIIIIII

%LTERROR
\item[]\index{Illegal character ...} 
    \textmess{Illegal character in array argument} 

    There is an illegal character in the argument of an \Ie{array} or
\Ie{tabular} environment, or in the second argument of a
\cmd{\multicolumn} command.

%LTFILES
\item[]\index{\cs{include} cannot be nested}
   \textmess{\cmd{\include} cannot be nested}

    A file that is \cmd{\include}d cannot \cmd{\include} any other files.


%%%%% LLLLLLLLLLLLLLLL

%LTCLASS
\item[]\index{\cs{LoadClass} in package file}
  \textmess{\cmd{\LoadClass} in package file} 

    This is an error in a package file you are using 
(you can only use \cmd{\LoadClass} in a class file). Complain to the author.

%LTLISTS
\item[]\index{Lonely \cs{item} ...}
   \textmess{Lonely \cmd{\item} --- perhaps a missing list environment}

    An \cmd{\item} command appears to be outside any list environment.


%%%% MMMMMMMMMMMMMMMM

%LTFSSBAS
%\item[] \textmess{Math alphabet identifier ...is undefined in math version `...'} 
%       (Check the spelling or use the \cmd{\SetMathAlphabet} command)

%LTFSSBAS %LTFSSDCL
%\item[] \textmess{Math version `..' is not defined} (misspelled or need a package)


%LTERROR
\item[]\index{Missing \senv{document}}  
  \textmess{Missing \cs{begin}\{document\}} 

    If you haven't forgotten \senv{document} then there is something
wrong in the preamble as \ltx\ is trying to typeset something before
the document starts. This is often caused by missing the backslash from
a command, misplaced braces round an argument, a stray character, or
suchlike.

\item[]\index{Missing @-exp ...}
  \textmess{Missing @-exp in array argument} 

    The \texttt{@} character is not followed by an \pixatexp{}
in the argument of an \Ie{array} or
\Ie{tabular} environment, or in the second argument of a
\cmd{\multicolumn} command.

\item[]\index{Missing p-arg ...}
  \textmess{Missing p-arg in array argument} 

    There is a \texttt{p} not followed by braces 
in the argument of an \Ie{array} or
\Ie{tabular} environment, or in the second argument of a
\cmd{\multicolumn} command.

%%%% NNNNNNNNNNNNNNNN

%LTERROR
\item[]\index{No counter ... defined}
  \textmess{No counter ... defined} 

    The argument to a \cmd{\setcounter} or \cmd{\addtocounter}
command, or in the optional argument to \cmd{\newcounter}
or \cmd{\newtheorem} is not the name of a counter. Perhaps you 
misspelled the name.
However, if the error occured while an \file{aux} file was being read
then you might well have used a \cmd{\newcounter} in an \cmd{\include}d file.


%LTFSSDCL
%\item[] \textmess{Not a command name: \cs{...}}

%LTFSSTRC
%\item[] \textmess{No declaration for shape ...}

%LTPLAIN
\item[]\index{No room for a new ...}
  \textmess{No room for a new ...}

    \tx\ is limited in the numbers of different things it can handle. You 
might not recognize the thing that the message mentions as some of them are
hidden in \ltx. The \ltx\ \texttt{counter} uses a \tx\ \cmd{\count} for
example, and a length is a \tx\ \cmd{\skip}. Most things are limited to a 
maximum of 256 but there can be no more than 16 files open for reading
and 16 for writing.

%LTSECT
\item[]\index{No title given?No \cs{title} given}
  \textmess{No \cmd{\title} given}

You did not put a \cmd{\title} command before using \cmd{\maketitle}.


%LTERROR
\item[]\index{Not in outer par mode}
   \textmess{Not in outer par mode}

    There is a float (e.g., a \Ie{figure} or a \cmd{\marginpar})
in math mode or in a parbox (e.g., in another float).


%%%% OOOOOOOOOOOOOOOO

%LTHYPHEN
%\item[] \textmess{OOPS! I can't find any hyphenation patterns for US English.
%       Think of getting some otherwise latex2e setup will never succeed.}


%LTCLASS
\item[]\index{Option clash for ...}
  \textmess{Option clash for ...} 

    The same package was used twice but with different options. It is possible
for one package to use another package which might be the cause if you 
can't see anything obvious.

%%%% PPPPPPPPPPPPPPPPPP

%LTOUTPUT
\item[]\index{Page height already too large} 
  \textmess{Page height already too large}

    You are trying to use \cmd{\enlargethispage} when the page is already
too large.


%LTERROR
\item[]\index{pushtabs and poptabs don't match?\cs{pushtabs} and \cs{poptabs} don't match}
   \textmess{\cmd{\pushtabs} and \cmd{\poptabs}  don't match}

    There are unmatched \cmd{\pushtabs} and \cmd{\poptabs} in a
\Ie{tabbing} environment.


%%%% RRRRRRRRRRRRRRRR

%LTCLASS
\item[]\index{RequirePackage or LoadClass in Options Section?\cs{RequirePackage} or \cs{LoadClass} in Options Section}
   \textmess{\cmd{\RequirePackage} or \cmd{\LoadClass} in Options Section}

    This is a problem in a class or package file. Complain to the author.

%%%% SSSSSSSSSSSSSSSS

%LTERROR
\item[]\index{Something's wrong ...}
  \textmess{Something's wrong --- perhaps a missing \cmd{\item}} 

   This can be caused by not starting a list environment, such as \Ie{itemize}
with a \cmd{\item} command, or by omitting the argument to the
\Ie{thebibliography} environment. There are many other non-obvious
causes, such as calling some macro that ends up using \cmd{\addvspace} 
or \cmd{\addpenalty} when not in \texttt{vmode}.

%LTOUTPUT
\item[]\index{Suggested extra height ...}
  \textmess{Suggested extra height (...) dangerously large} 

    \ltx\ is concerned that you a trying to increase the page size
    too much with the \cmd{\enlargthispage} command.


%LTFSSDCL
%\item[] \textmess{Symbol font ... not defined}

%%%% TTTTTTTTTTTTTTTT

%LTERROR %LTTAB
\item[]\index{Tab overflow}
  \textmess{Tab overflow}

    In the \Ie{tabbing} environment a \cmd{\=} has exceeded \ltx's maximum
number of tab stops.


%LTCLASS
\item[]\index{The file needs format ...}
   \textmess{The file needs format ... but this is ...}

    The document uses a document class or package that is not compatible
with the  version of \ltx\ you are using. If you are using only standard
files then there is a problem with your \ltx\ installation.

%LTFNTCMD
%\item[] \textmess{The font size command \cmd{\normalsize} is not defined:
%       there is probably something wrong with the class file}

%LTERROR
\item[]\index{There's no line to end here}
   \textmess{There's no line to end here} 

    A \cmd{\newline} or \cmd{\\} appears in vertical mode, for example 
between paragraphs. Or perhaps you have tried to put \cmd{\\} immediately 
after an \cmd{\item} to start the text on a new line. If this is the case, 
then try this:
\begin{lcode}
\item \mbox{} \\
...
\end{lcode}

%LTERROR
\item[]\index{This may be a LaTeX bug} 
  \textmess{This may be a LaTeX bug} % (in output routine)
 
    This is a message you don't want to see as it is produced by the
output routine --- perhaps the most obscure part of \ltx. It is probably
due to an earlier error. If it is the first error, though, and you can't 
see anything wrong, ask for somebody's help.

%LTFSSDCL
%\item[] \textmess{This NFSS system isn't set up properly} (For encoding scheme ...
%       .../.../... do not form a valid font shape)

%LTFSSDCL
%5\item[] \textmess{This NFSS system isn't set up properly} 
%      (The system manitainer forgot
%       to specify a suitable substitution font shape using the 
%       \cmd{\DeclareErrorFont} command)

%LTERROR
\item[]\index{Too deeply nested} 
   \textmess{Too deeply nested}

    There are too many list environments nested within each other. At least
four levels are usually available but some list environments are not obvious
(for example the \Ie{quotation} environment is actually a list).

%LTMATH
\item[]\index{Too many columns ...}
   \textmess{Too many columns in eqnarray environment}

    An \Ie{eqnarray} environment has three \texttt{\&} column separators
with no \cmd{\\} between.

%LTFSSDCL
%\item[] \textmess{Too many math alphabets used in version ...}

%LTERROR
\item[]\index{Too many unprocessed floats}
   \textmess{Too many unprocessed floats}

    There may be too many \cmd{\marginpar}s to fit on a page, but it's more
likely that \ltx\ hasn't been able to find locations for printing all the
figures or tables. If one float cannot be placed, all later ones are saved 
until \ltx\ runs out of storage space. See \Sref{sec:floatplace} for 
details on how \ltx\ decides to place a float.

%LTCLASS
\item[]\index{Two documentclass commands?Two \cs{documentclass} commands}
   \textmess{Two \cmd{\documentclass} commands} 

    Your document has two \cmd{\documentclass} commands; only one is
permitted.


%LTCLASS
\item[]\index{Two LoadClass commands?Two \cmd{\LoadClass} commands}
  \textmess{Two \cmd{\LoadClass} commands}% (only one allowed)

    This is an error in the class file. Complain to the author.

%%%% UUUUUUUUUUUUUUUUUUUUUUUUUUU

%LTFSSTRC
%\item[] \textmess{Undefined font size function ...}

%LTERROR
\item[]\index{Undefined tab position}
   \textmess{Undefined tab position}

    A \cmd{\>}, \cmd{\+}, \cmd{\-}, or \cmd{\<} tabbing command
is trying to move to a tab position that has not been defined by a 
\cmd{\=} command.

%LTCLASS
\item[]\index{Unknown option ...}
   \textmess{Unknown option ... for class/package ...} 

    You have asked for an option that the class or package does not know about.
Perhaps you have mispelled something, or omitted a comma.

%LTFSSDCL
%\item[] \textmess{Unknown symbol font ...}

%LTCLASS
\item[]\index{usepackage before documentclass?\cs{usepackage} before \cs{documentclass}}
  \textmess{\cmd{\usepackage} before \cmd{\documentclass}} 

    In general, the \cmd{\usepackage} command can only be used in the 
preamble\index{preamble}.

%%%% VVVVVVVVVVVVVVVVVVVVVVVVVVVVV

%LTMISCEN
\item[]\index{verb ended by end of line?\cs{verb} ended by end of line}
  \textmess{\cs{verb} ended by end of line}

     The argument of a \piif{verb} command runs past the end of the line.
Perhaps you forgot to put in the correct ending character.

%LTMISCEN
\item[]\index{verb illegal in command argument?\cs{verb} illegal in command argument}
  \textmess{\cs{verb} illegal in command argument}

    A \piif{verb} cannot be part of the argument to another command.


%%%%%%%%%%%%%%%%%%%%% TBD



%LTVERS
%\textmess{LaTeX source files more than 1 year old!}



%LTFSSCMP
%\textmess{*** What's this? NFSS release 0? ***}
 
%LTFSSCMP
%\textmess{*** NFSS release 1 command ... found 
%       *** Recovery not possible. Use ...}

%LTFSSCMP
%\textmess{*** NFSS release 1 command \cmd{\newmathalphabet} found
%       *** Automatic recovery not possible}

\end{plainlist}

\index{error!LaTeX?\ltx|)}
\index{LaTeX?\ltx!error|)}


\section{\ltx\ warnings}

\index{warning!LaTeX?\ltx|(}
\index{LaTeX?\ltx!warning|(}

    Most warnings are given at the point in the document where
a potential problem is discovered, while others are output
after the document has been processed.

For example, the following code
\begin{lcode}
... \ref{joe}... \cite{FRED96} ...
\end{lcode}
may produce warnings like
\begin{lcode}
Latex Warning: Reference `joe' on page 12 undefined 
               on input line 881.
Latex Warning: Citation `FRED96' on page 12 undefined 
               at lines 890--897.
\end{lcode}
during the document processing, and then at the end there will also
be the warning:
\begin{lcode}
LaTeX Warning: There were undefined references. 
\end{lcode}

Some warning messages pinpoint where a problem might lie, as in the citation
warning above, while others make no attempt to do so. In the alphabetical
listing that follows I have not included such information, even if it is
supplied.

\begin{plainlist}
%%%% AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA

%LTOUTPUT
%\item[] \textmess{Active ... character found while output routine is active.
%         This may be a bug in a package you are using}


%%%% BBBBBBBBBBBBBBBBBBBBBB


%%%% CCCCCCCCCCCCCCCCCCCCCCC

%LTBIBL
\item[]\index{Citation ... on page ...} 
  \textmess{Citation ... on page ... undefined}

    The key in a \cmd{\cite} command was not defined by any \cmd{\bibitem}.

%LTBIBL
\item[]\index{Citation ... undefined}
   \textmess{Citation ... undefined}

    The key in a \cmd{\cite} command was not defined by any \cmd{\bibitem}.

%LTDEFNS
%\item[] \textmess{Command ... has changed. Check if current package is valid} 
%  (from \cmd{\CheckCommand})

%LTFSSBAS
\item[]\index{Command ... invalid ...}
   \textmess{Command ... invalid in math mode}

    The command is not permitted in math mode but was used there anyway.
Remember that font size commands and \cmd{\boldmath} or \cmd{\unboldmath}
cannot be used in math mode.


%LTFSSTRC
%\item[] \textmess{Command \cmd{\tracingfonts} not provided. Use the 'tracefnt' 
%         package. Command found: ...}

%%%% EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE

%LTFSSDCL
%\item[] \textmess{Encoding ... has changed to ... for symbol font ...
%         in the math version ...}


%%%% FFFFFFFFFFFFFFFFFFFFFFFFFFFF

%LTCLASS
%\item[] \textmess{File ... already exits on the system. Not generating it from this source}

%LTFLOAT
\item[]\index{Float too large ...}
   \textmess{Float too large for page by ...}

     A float (table or figure) is too tall to fit properly on a page by
the given amount. It is put on a page by itself.


%LTFSSTRC
\item[]\index{Font shape ...}
   \textmess{Font shape ... in size ... not available size ... substituted}

    You asked for a font size that was not available. The message also 
says what font is being used instead.

%LTFSSBAS
\item[]\index{Font shape ...}
   \textmess{Font shape ... undefined using ... instead}

    You asked for a font shape that was not available. The message also 
says what font is being used instead.

%%%% HHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH

%LTOUTPUT
\item[]\index{h float specifier ...}\index{"!h float specifier ...}
   \textmess{h float specifier changed to ht} or 
        \textmess{!h float specifier changed to !ht}

    A float has an optional \texttt{h} or \texttt{!h} argument but
as it wouldn't fit on the curent page it has been moved to the top
pf the next page.


%%%% IIIIIIIIIIIIIIIIIIIIIIIIII

%LTFILES
%\item[] \textmess{Inputting ... instead of obsolete ...}

%%%% LLLLLLLLLLLLLLLLLLLLLLLLLLL

%LTXREF
\item[]\index{Label ... multiply defined}
   \textmess{Label ... multiply defined}

    Two \cmd{\label} or \cmd{\bibitem} commands have the same argument
(at least during the previous \ltx\ run).

%LTMISCEN
\item[]\index{Label(s) may have changed ...}
   \textmess{Label(s) may have changed. Rerun to get cross-references right}

    This is only output at the end of the run.

One of the numbers printed by \cmd{\cite}, \cmd{\ref}
or \cmd{\pageref} commands might be incorrect because the correct values
have changed since the preceding \ltx\ run.


%%%% MMMMMMMMMMMMMMMMMMMMMMMMMMMMM

%LTOUTPUT
\item[]\index{Marginpar on page ...}
   \textmess{Marginpar on page ... moved}

    A \cmd{\marginpar} was moved down the page to avoid overwriting an earlier
one. The result will not be aligned with the \cmd{\marginpar} call.

%%%% NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN

%LTSECT
\item[]\index{No author given?No \cs{author} given} 
  \textmess{No \cmd{\author} given}

    There is no \cmd{\author} command before calling \cmd{\maketitle}.

%LTOUTPUT
\item[]\index{No positions in optional float specifier ...}
  \textmess{No positions in optional float specifier.
         Default added (so using `tbp')}

    You have used an empty optional argument to a float, for example: \\
\verb?\begin{figure}[]? \\
so it has used \\
\verb?\begin{figure}[tbp]? \\
instead.

%%%% OOOOOOOOOOOOOOOOOOOOO

%LTOUTPUT
\item[]\index{Optional argument of twocolumn ...?Optional argument of \cs{twocolumn} ...}
   \textmess{Optional argument of \cmd{\twocolumn} too tall on page ...}

     The contents of the optional argument to \cmd{\twocolumn} was too
long to fit on the page.

%LTPICTUR
\item[]\index{oval, circle, or line size unavailable?\cs{oval}, \cs{circle}, or \cs{line} size unavailable}
   \textmess{\cmd{\oval}, \cmd{\circle}, or \cmd{\line} size unavailable}

    You have asked for too large (or too small) an oval or circle,
 or too short a line, in a \Ie{picture}.

%%%% RRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRR

%LTXREF
\item[]\index{Reference ... on page ...}
   \textmess{Reference ... on page ... undefined}

    The argument of a \cmd{\ref} or \cmd{\pageref} has not been defined
on the preceding run by a \cmd{\label} command.

%%%% SSSSSSSSSSSSSSSSSSSSSS

%LTFINAL
\item[]\index{Size substitutions ....}
     \textmess{Size substitutions with differences up to ... have occured.
         Please check the transcript file carefully and redo the
         format generation if necessary!}

    This is only output at the end of the run.

    Some fonts have had to be used as substitutes for requested ones and
they are a different size.

%LTFSSBAS
\item[]\index{Some shapes ...}
   \textmess{Some shapes were not available, defaults substituted}

    This is only output at the end of the run.

    At least one font had to be substituted.

%%%% TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT

%LTOUTPUT
\item[]\index{Text page ... contains only floats}
   \textmess{Text page ... contains only floats}

    The page should have included some textual material but there was
no room for it.

%LTXREF
\item[]\index{There were multiply defined labels}
   \textmess{There were multiply defined labels}

    This is only output at the end of the run.

    Two or more \cmd{\label} or \cmd{\cite} commands had the same argument.

%LTXREF
\item[]\index{There were undefined references} 
  \textmess{There were undefined references}

    This is only output at the end of the run.

    There was at least one \cmd{\ref} or \cmd{\pageref} or \cmd{\cite} 
whose argument had not been defined
on the preceding run by a \cmd{\label} or \cmd{\biblabel} command.

%%%% UUUUUUUUUUUUUUUUUUUUUUUUUUUU

%LTFILES
\item[]\index{Unused global option(s) ...} 
  \textmess{Unused global option(s) [...]}

    The listed options were not known to the document class or any packages
you used.

%%%% WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW

%LTCLASS
%\item[] \textmess{Writing text ... before \cs{end}\{...\} as last line of ...}


%%%% YYYYYYYYYYYYYYYYYYYYYYYYYYYYYY

%LTCLASS
%\item[] \textmess{You have requested class/package ... but the class/package provides ...}

%LTCLASS
\item[]\index{You have requested release ...}
   \textmess{You have requested release ... of LaTeX but only release ... is available}

    You are using a class or package that requires a later release of \ltx\
than the one you are using. You should get the latest release.

%LTCLASS
\item[]\index{You have requested version ...}
   \textmess{You have requested version ... of class/package ... but only version
      ... is available}

    You (or the class or one of the packages you are using) needs a later 
release of a class or package than the one you are using. You should get
the latest release.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%LTCLASS
%\textmess{... has been converted to Blank ...3e}


%%LTFSSCMP
%\textmess{*** NFSS release 1 command ... found 
%         *** Update by using release 2 command ...}


\end{plainlist}

\index{LaTeX?\ltx!warning|)}
\index{warning!LaTeX?\ltx|)}

\section{Class errors}

%%\index{memoir class!error|(}
\Iclasssub{memoir}{error|(}
\index{error!memoir class|(}

    The class errors introduce themselves differently from those
that \ltx\ finds. Instead of starting with \\
\verb?! LaTeX Error:?  \\
the class errors start with \\
\verb?! Class memoir Error:? \\
After that, it is indistinguishable from a \ltx\ error.
For example, if you ever happened to input the
next line as line 954 in your document you would get the error message
that follows \\
\verb?\sidecapmargin{either}? 
\begin{verbatim}
! Class memoir Error: Unrecognized argument for \sidecapmargin.

See the memoir class documentation for explanation.
Type H <return> for immediate help.
 ...

l.954 \sidecapmargin{either}
?
\end{verbatim}
If you then typed \texttt{H} (or \texttt{h}) in response you would 
get the following helpful message:
\begin{lcode}
Try typing <return> to proceed.
If that doesn't work, type X <return> to quit.
?
\end{lcode}
The majority of the help messages follow this formula, so I have
not noted them in the alphabetical listing below.


%%%%%\subsection{Errors}

\begin{plainlist}

\item[]\index{... is negative}
    \textmess{... is negative} 

    The value is negative. It should be at least zero.

\item[]\index{... is not a counter}
    \textmess{... is not a counter}

    An argument that should be the name of a counter is not.

\item[]\index{... is zero or negative}
    \textmess{... is zero or negative}

    The value must be greater than zero.


\item[]\index{>\lb...\rb at wrong position ...}
   \textmess{>\{...\} at wrong position: token ignored}

    A \verb?>{...}? in the argument to an \Ie{array} or \Ie{tabular}
is incorrectly placed and is being ignored.

\item[]\index{<\lb...\rb at wrong position ...}
   \textmess{<\{...\} at wrong position: changed to !\{...\}} 

    A \verb?<{...}? in the argument to an \Ie{array} or \Ie{tabular}
is incorrectly placed. It has been changed to \verb?!{...}? instead.

\item[]\index{A pattern has not been specified}
   \textmess{A pattern has not been specified}% (\cmd{\getstar@vsindent}

   You are trying to use the \Ie{patverse} or \Ie{patverse*} environment
without having first defined a pattern.

\item[]\index{Argument to \cs{setsidecappos} is not ...}
  \textmess{Argument to \cmd{\setsidecappos} is not t or c or b}

    The argument will be assumed to be \texttt{c}.

\item[]\index{Argument to \cs{overridesidecapmargin} neither  ...}
  \textmess{Argument to \cmd{\overridesidecapmargin} neither left nor right}

    The argument to \cmd{\overridesidecapmargin} must be either
\texttt{left} or \texttt{right}. The attempted override will be ignored.


\item[]\index{Cannot change a macro that has delimited arguments}
  \textmess{Cannot change a macro that has delimited arguments}

   You are using \cmd{patchcmd} on a macro that has delimted arguments.

\item[]\index{Empty preamble: `l' used} 
  \textmess{Empty preamble: `l' used} % (array/tabular)

    The argument to an \Ie{array} or \Ie{tabular} is empty. The
specification \verb?{l}? is being used instead.

\item[]\index{Font command ... is not supported}
   \textmess{Font command ... is not supported} 

    You have tried to use a deprecated font command. Either replace
it with the current font command or declaration or use 
the \Lopt{oldfontcommands} class option.

\item[]\index{footskip is too large ...?\cs{footskip} is too large ...}
   \textmess{\lnc{\footskip} is too large for \lnc{\lowermargin} by ...}

    The \lnc{\footskip} is too large for the \lnc{\lowermargin}. Either
increase the \lnc{\lowermargin} or decrease the \lnc{\footskip}.


\item[]\index{headheight and/or headsep are too large ...?\cs{headheight} and/or \cs{headsep} are too large ...}
   \textmess{\lnc{\headheight} and/or \lnc{\headsep} are too large for
        \lnc{\uppermargin} by ...}

        The sum of the \lnc{\headheight} and the \lnc{\headsep} is
  larger than the \lnc{\uppermargin}. Either increase the \lnc{\uppermargin}
  or reduce the others.


\item[]\index{Illegal pream-token ...}
    \textmess{Illegal pream-token (...): `c' used}

    An illegal character is used in the argument to an \Ie{array}
or \Ie{tabular}. The `c' specifier is being used instead 
(which centers the column).


\item[]\index{Index ... outside limits ...} 
    \textmess{Index ... outside limits for array ...} % (\cmd{\checkarrayindex}

    Trying to access an index for the array data structure that is not between
the low and high indices.


\item[]\index{Limits for array ... }
    \textmess{Limits for array ... are in reverse order} 

    The low index is not less than the high index in \cmd{\newarray}.


\item[]\index{Missing arg: token ignored} 
    \textmess{Missing arg: token ignored} % (array/tabular)

    The argument to a column specifier for a \Ie{array} or \Ie{tabular}
is missing.



\item[]\index{No array called ...}
    \textmess{No array called ...} % (\cmd{\checkarrayindex}

    You have tried to access an unknown array data structure.


\item[]\index{Not defined: ...}
  \textmess{Not defined: ...}

    You are using \cmd{\patchcmd} on a macro that is not defined.

\item[]\index{Not redefinable: ...}
  \textmess{Not redefinable: ...}

    You are using \cmd{\patchcmd} on a macro that it is unable to
modify.



\item[]\index{Only one column-spec. allowed}
    \textmess{Only one column-spec. allowed}% (array/tabular)

    There can only be one column specifier in a \cmd{\multicolumn}.

\item[]\index{Optional argument is not one of: ...}
  \textmess{Optional argument is not one of: classic, fixed, lines,
            or nearest. I will assume the default.}

    You have provided an unknown name for the optional argument to
\cmd{\checkthelayout}. The default \texttt{classic} will be used instead.


\item[]\index{paperheight and/or trimtop are too large ...?\cs{paperheight} and/or \cs{trimtop} are too large ...}
    \textmess{\lnc{\paperheight} and/or \lnc{\trimtop} are too large for
        \lnc{\stockheight} by ...}

        The sum of the \lnc{\paperheight} and the \lnc{\trimtop} is
  larger than the \lnc{\stockheight}. Either increase the \lnc{\stockheight}
  or reduce the others.

\item[]\index{paperwidth and/or trimedge are too large ...?\cs{paperwidth} and/or \cs{trimedge} are too large ...}
   \textmess{\lnc{\paperwidth} and/or \lnc{\trimedge} are too large for
        \lnc{\stockwidth} by ...}

        The sum of the \lnc{\paperwidth} and the \lnc{\trimedge} is
  larger than the \lnc{\stockwidth}. Either increase the \lnc{\stockwidth}
  or reduce the others.

\item[]\index{spinemargin and/or textwidth and/or foremargin are too large ...?\cs{spinemargin} and/or \cs{textwidth} and/or \cs{foremargin} are too large ...}
 \textmess{\lnc{\spinemargin} and/or \lnc{\textwidth} and/or \lnc{\foremargin}
        are too large for \lnc{\paperwidth} by ...}

        The sum of the \lnc{\spinemargin} and the \lnc{\textwidth}
  and the \lnc{\foremargin} is
  larger than the \lnc{\paperwidth}. Either increase the \lnc{\paperwidth}
  or reduce the others.


\item[]\index{The combination of argument values ...} 
   \textmess{The combination of argument values is ambiguous.
        The lengths will be set to zero} 
%    (\cmd{\setrectanglesize}, \cmd{\setfillsize})

    The combination of values in the arguments to one of the commands
for page layout does not make sense.

\item[]\index{The `extrafontsizes' option ...}
  \textmess{The `extrafontsizes' option is required to use the `...pt' option}

    If you want to use a `...pt' class option greater than \Lopt{25pt}
you also have to use the \Lopt{extrafontsizes} option. The class will
use the \Lopt{17pt} option.


\item[]\index{Unknown document division ...}
    \textmess{Unknown document division name (...)}

    You have used an unknown division name in the argument to 
\cmd{\settocdepth} or \cmd{\setsecnumdepth} and friends. If you haven't
mistyped it you will have to use \cmd{\setcounter} instead.

\item[]\index{Unknown mark setting type ...}
    \textmess{Unknown mark setting type `...' for ...mark}

    In \cmd{\createmark} or \cmd{\createplainmark} the mark setting 
type should have been \texttt{left} or \texttt{both} 
or \texttt{right}. The class will use \texttt{both}.

\item[]\index{Unknown numbering type ...}
  \textmess{Unknown numbering type ... for ...mark}

  In \cmd{\createmark} the class expected either \texttt{shownumber} or
\texttt{nonumber} for displaying the number. It will use 
\texttt{shownumber}.

\item[]\index{Unrecognized argument for \cs{sidecapmargin}}
  \textmess{Unrecognized argument for \cmd{\sidecapmargin}}

    The argument to \cmd{\sidecaption} should be \texttt{left} or 
\texttt{right} or \texttt{inner} or \texttt{outer}.

\item[]\index{uppermargin and/or textheight and/or lowermargin are too large ...?\cs{uppermargin} and/or \cs{textheight} and/or \cs{lowermargin} are too large ...}
   \textmess{\lnc{\uppermargin} and/or \lnc{\textheight} and/or 
        \lnc{\lowermargin} are too large for \lnc{\paperheight} by ...}

        The sum of the \lnc{\uppermargin} and the \lnc{\textheight}
  and the \lnc{\lowermargin} is
  larger than the \lnc{\paperheight}. Either increase the \lnc{\paperheight}
  or reduce the others.

\item[]\index{You have used the `*pt' option but file ...}
  \textmess{You have used the `*pt' option but file ... can't be found}

    You have used the \Lopt{*pt} option but the corresponding 
\pixfile{clo} file can't be found. Check your definitions of
\cmd{\anyptfilebase} and \cmd{\anyptsize}. The \pixfile{mem10.clo} 
file will be used instead.

\item[]\index{XeTeX is required to process this document}
  \textmess{XeTeX is required to process this document}

   The document needs to be processed via \pixxetx. Try using 
\texttt{xelatex} instead of \texttt{(pdf)latex}, or try removing 
any \pixxetx\ packages from the document.

    

\end{plainlist}


\index{error!memoir class|)}
%%\index{memoir class!error|)}
\Iclasssub{memoir}{error|)}

\section{Class warnings}

%%\index{memoir class!warning|(}
\Iclasssub{memoir}{warning|(}
\index{warning!memoir class|(}

    These are introduced by \verb?Class memoir Warning:? 

For example
\verb?\addtodef{alf}{\joe}{fred}? will produce a message along the lines of:
\begin{verbatim}
Class memoir Warning: `alf' is not a macro on input line 91.
\end{verbatim}
while 
\verb?\addtodef{\joe}{alf}{fred}? might produce:
\begin{verbatim}
Class memoir Warning: `\joe' is not a macro on input line 97.
\end{verbatim}

    The following is an alphabeticised list of the class warnings.

\begin{plainlist}

%%%%%%%%%%%%%%%%%%%%%%%

\item[]\index{... at index ... in pattern ...}
    \textmess{... at index ... in pattern ... is not a digit}% (\cmd{\get@vsindent}

    The character at the given position in the verse pattern is not a digit.

\item[]\index{... is not a macro}
    \textmess{... is not a macro}

    Using \cmd{\addtodef} or \cmd{\addtoiargdef} you have tried to extend 
the definition of an unknown macro.

\item[]\index{... is not an input stream}
    \textmess{... is not an input stream} 

    You are trying to access a non-existent input stream.

\item[]\index{... is not an output stream}
    \textmess{... is not an output stream}% (\cmd{\outstre@mandopen}, \cmd{\outstre@mandclosed}

    You are trying to access a non-existent output stream.

\item[]\index{Bad \cs{sidebarmargin} argument}
  \textmess{Bad \cs{sidebarmargin} argument}

   The argument to \cs{sidebarmargin} is not recognized. The class
will use \texttt{right}.


\item[]\index{Characters dropped after \eenv{...}}
    \textmess{Characters dropped after \eenv{...}} % (\cmd{\verbatim@rescan}

    At the end of a \Ie{verbatim} environment there should be no characters
after the \eenv{...} on the same line. 

\item[]\index{Column ... is already defined}
    \textmess{Column ... is already defined} % (tabulars

    The column type has been defined by a previous \cmd{\newcolumntype}.


\item[]\index{Counter ... already defined}
    \textmess{Counter ... already defined}

    For information only, the counter in \cmd{\providecounter} 
is already defined.

\item[]\index{Do not use footnote ...?Do not use \cs{footnote} ...}
   \textmess{Do not use \cmd{\footnote} in \cmd{\maketitle}. Use \cmd{\thanks} instead}

    You cannot use \cmd{\footnote} in any of the \cmd{\maketitle} elements
(i.e., \cmd{\title} or \cmd{\author} or \cmd{\date}) but you can use 
\cmd{\thanks}.

\item[]\index{Empty `thebibliography' environment}
    \textmess{Empty `thebibliography' environment}

    There are no \cmd{\bibitem}s in the \Ie{thebibliography} environment.

\item[]\index{Environment ... already defined}
    \textmess{Environment ... already defined}% (\cmd{\m@mprovenv}

    For information only, the environment in \cmd{\provideenvironment} 
is already defined.


\item[]\index{Index ... for pattern ...}
    \textmess{Index ... for pattern ... is out of bounds}% (\cmd{\get@vsindent}

    The index for the verse pattern is either too low or too high.

\item[]\index{Input stream ... is already defined}
    \textmess{Input stream ... is already defined} 

     You are trying to use \cmd{\newinputstream} to create an already existing
input stream.

\item[]\index{Input stream ... is not open}
    \textmess{Input stream ... is not open}% (\cmd{\instre@mandopen}

    You are trying to access or close an input stream that is closed.

\item[]\index{Input stream ... is open}
    \textmess{Input stream ... is open}% (\cmd{\instre@mandclosed}

    You are trying to open an input stream that is already open.

\item[]\index{Length ... already defined}
    \textmess{Length ... already defined}

    For information only, the length in \cmd{\providelength} 
is already defined.



\item[]\index{Marginpar on page ...}
    \textmess{Marginpar on page ... moved by ...}

    A marginal note has been lowered by the given amount to avoid overwriting
a previous note; the moved note will not be aligned with its \cmd{\marginpar}.
(This is a more informative message than the normal \ltx\ one.)

\item[]\index{No more to read from stream ...}
    \textmess{No more to read from stream ...}% (\cmd{\readaline})

    There is nothing left in the stream to be read.

\item[]\index{Optional argument of twocolumn ...?Optional argument of \cs{twocolumn} ...}
   \textmess{Optional argument of \cmd{\twocolumn} too tall on page ...}% (\cmd{\@topnewpage}

     The contents of the optional argument to \cmd{\twocolumn} was too
long to fit on the page.

\item[]\index{Output stream ... is already defined} 
    \textmess{Output stream ... is already defined}

     You are trying to use \cmd{\newoutputstream} to create an already existing
output stream.

\item[]\index{Output stream ... is not open}
    \textmess{Output stream ... is not open}% (\cmd{\outstre@mandopen}

    You are trying to access or close an output stream that is closed.

\item[]\index{Output stream ... is open}
    \textmess{Output stream ... is open}% (\cmd{\outstre@mandclosed}

    You are trying to open an output stream that already open.

\item[]\index{Redefining primitive column ...}
    \textmess{Redefining primitive column ...} % (tabulars

    The argument to \cmd{\newcolumntype} is one of the basic column types.



\item[]\index{Stream ... is not open}
    \textmess{Stream ... is not open}% (\cmd{stre@mverb@input} \cmd{\stre@mbvin}

    You are trying to access a stream, either input or output, that is closed.


\item[]\index{The ... font command is deprecated ...}
    \textmess{The ... font command is deprecated. Use ... or ... instead}

    You are using a deprecated font command. Consider using one of the
alternatives.

\item[]\index{The counter will not be printed ...}
    \textmess{The counter will not be printed. The label is: ...}% (\cmd{\@@enum@}

    The optional \meta{style} argument to the \Ie{enumerate} environment
does not include one of the special characters.

\item[]\index{Undefined index file ...}
    \textmess{Undefined index file ...}% (\cmd{\@index}, \cmd{\@spindex}

    You are trying to add an index entry to an unknown \file{idx} file.


\item[]\index{Unknown toclevel for ...}
  \textmess{Unknown toclevel for ...}

    The division name you have used for \cmd{\settocdepth} is not 
recognized.



\item[]\index{verb may be unreliable ...?\cs{verb} may be unreliable ...}
    \textmess{\cs{verb} may be unreliable inside tabularx} 

    A \cs{verb} in a \Ie{tabularx} may work, but may not.

\item[]\index{X columns too narrow ...} 
    \textmess{X columns too narrow (table too wide)} % (tabulars

    The width of the X columns in a \Ie{tabularx} had to be made too narrow.

\end{plainlist}

\index{warning!memoir class|)}
%%\index{memoir class!warning|)}
\Iclasssub{memoir}{warning|)}

%#% extend
%#% extstart include comments.tex

\svnidlong
{$Ignore: $}
{$LastChangedDate: 2018-04-05 11:07:48 +0200 (Thu, 05 Apr 2018) $}
{$LastChangedRevision: 596 $}
{$LastChangedBy: daleif@math.au.dk $}

\chapter{Comments}
\label{cha:comments}

\section{Algorithms}
\label{sec:algorithms}

Over time we may use this section to explain, or list some of the
algorithms for some of the macros in the class. The information may be
useful to some.

\subsection{Autoadjusting
  \texorpdfstring{\cs{marginparwidth}}{\textbackslash marginparwidth}}
\label{sec:auto-csmarg}

This algorithm is used within \cmd{\fixthelayout} unless the user have
used \cmd{\setmarginnotes}.

\noindent
\begin{framed}
  \vskip-2\baselineskip
  \begin{small}
\begin{verbatim}
if twocolumn then
  marginparwidth = min{inner margin,outer margin}
else
  if twoside then
    if marginpar always left or always right then
      marginparwidth = min{inner margin,outer margin}
    else if marginpar in outer margin then
      marginparwidth = outer margin
    else if marginpar in inner margin then
      marginparmargin = inner margin
    end if
  else
    if marginpar in left margin then
      marginparwidth = inner margin
    else
      marginparwidth = outer margin
    end if
  end if
end if
marginparwidth = marginparwidth - 2marginparsep
if marginparwidth < 1pt then
  marginparwidth = 1pt
end if
\end{verbatim}
  \end{small}
\end{framed}


%#% extend

%#% extstart input backend.tex


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%\endinput
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%% end mbooka
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% back end
\backmatter

\PWnote{2009/07/08}{Changed \cs{toclevel@section} so that Notes 
                    divisions appear in the bookmarks}
\makeatletter\renewcommand*{\toclevel@chapter}{-1}\makeatother 
\makeatletter\renewcommand*{\toclevel@section}{0}\makeatother
\clearpage
\printpagenotes
\clearpage
\pagestyle{plainmarkruled}
%%\chapterstyle{section}

\renewcommand*{\begintheglossaryhook}{\small}
%%%\glossaryintoc
\printglossary

\renewcommand{\prebibhook}{%
\ctan\ is the \cTeXan. Information on how to
access CTAN is available at \url{http://www.tug.org}.
\par\vspace{\onelineskip}}

%%%\begin{comment}
\begin{thebibliography}{GMS94A}
\small

%%% keep
\bibitem[AHK90]{IMPATIENT}
  Paul W. Abrahams, Kathryn Hargreaves and Karl Berry.
  \newblock \emph{TeX for the Impatient}.
  \newblock Addison-Wesley, 1990.
  \newblock (Available at
             \url{ftp://tug.org/tex/impatient})

\begin{comment}
\bibitem[Ado01]{ADOBEBOOK}
  \emph{How to Create Adobe PDF eBooks}.
  \newblock Adobe Systems Inc.,
  \newblock 2001.
  \newblock (Available from 
             \url{http://www.adobe.com/epaper/tips/acr5ebook/pdfs/eBook.pdf})
\end{comment}

\LMnote{2010/09/28}{Added the \cs{CTANurl}'s and verified them}

%%% keep
\bibitem[Ars99]{URL}
  Donald Arseneau.
  \newblock \emph{The url package}.
  \newblock February, 1999.
  \newblock (Available from CTAN via
             \CTANurl{/macros/latex/contrib/url/})

%%% keep
\bibitem[Ars01a]{TITLEREF}
  Donald Arseneau.
  \newblock \emph{The titleref package}.
  \newblock April, 2001.
  \newblock (Available from CTAN via
             \CTANurl{/macros/latex/contrib/titleref/})

%%% keep
\bibitem[Ars01b]{CHAPTERBIB}
  Donald Arseneau.
  \newblock \emph{The chapterbib package}.
  \newblock September, 2001.
  \newblock (Available from CTAN via 
             \CTANurl{/macros/latex/contrib/cite/})

%%% keep
\bibitem[Ars07]{FRAMED}
  Donald Arseneau.
  \newblock \emph{The framed package} v0.95.
  \newblock October, 2007.
  \newblock (Available from CTAN via
             \CTANurl{/macros/latex/contrib/framed/})

\begin{comment}
\bibitem[Bar92]{BAROLINI92}
  Helen Barolini.
  \newblock \emph{Aldus and his Dream Book}.
  \newblock Italica Press, 1992.
  \newblock ISBN 0--934977--22--4.

\bibitem[Bar01]{BARTRAM01}
  Alan Bartram.
  \newblock \emph{Five hundred years of book design}.
  \newblock Yale university Press, 2001.
  \newblock ISBN 0--300--09058--7.
  \newblock (First published 2001 by The British Library)

\bibitem[BDG89]{BIGELOW89}
  Charles Bigelow, Paul Hayden Duensing and Linnea Gentry (Eds).
  \newblock \emph{Fine Print on Type}. 1989.
  \newblock Fine Print, CA (ISBN 0--9607290-X) or
  \newblock Bedford Arts, CA (ISBN 0--938491--17--2).

\bibitem[Boh90]{BOHLE90}
  Robert Bohle.
  \newblock \emph{Publication Design for Editors}.
  \newblock Prentice-Hall,
  \newblock 1990.
\end{comment}

%%% keep
\bibitem[Ber02]{JURABIB}
  Jens Berger.
  \newblock \emph{The titlesec and titletoc packages}.
  \newblock September, 2002.
  \newblock (Available from CTAN via
             \CTANurl{/macros/latex/contrib/titlesec/})

%%% keep
\bibitem[Bez99]{TITLESEC}
  Javier Bezos.
  \newblock \emph{The titlesec and titletoc packages}.
  \newblock February, 1999.
  \newblock (Available from CTAN via 
             \CTANurl{/macros/latex/contrib/titlesec/})

\bibitem[Bir04]{BIRDSALL04}
  Derek Birdsall.
  \newblock \emph{notes on book design}.
  \newblock Yale University Press, 2004.
  \newblock ISBN 0--300--10347--6.

\begin{comment}
\bibitem[Bra94]{MAKEIDX}
  Johannes Braams \textit{et al}.
  \newblock \emph{Standard LaTeX2e packages makeidx and showidx}.
  \newblock November, 1994.
  \newblock (Available from CTAN as 
             \url{/macros/latex/base/makeindx.dtx(ins)})
\end{comment}

%%% keep
\bibitem[Bra97]{ALLTT}
  Johannes Braams.
  \newblock \emph{The alltt environment}.
  \newblock June, 1997.
  \newblock (Available as \texttt{alltt.dtx} and 
  \texttt{alltt.ins} from CTAN via  \CTANurl{/macros/latex/base/})

%%% keep
\bibitem[Bri99]{BRINGHURST99}
  Robert Bringhurst.
  \newblock \emph{The Elements of Typographic Style}.
  \newblock Hartley \& Marks, second edition,
  \newblock 1999. ISBN 0--88179--033--8.

\begin{comment}
\bibitem[Bur59]{BURT59}
  C.~L.~Burt.
  \newblock \emph{A Psychological Study of Typography}.
  \newblock Cambridge University Press,
  \newblock 1959.
\end{comment}

%%% keep
\bibitem[Car14]{DELARRAY}
  David Carlisle.
  \newblock \emph{The delarray package}.
  \newblock October, 2014.
  \newblock (Available from CTAN via
             \CTANurl{/macros/latex/required/tools/})

%%% keep
\bibitem[Car95]{AFTERPAGE}
  David Carlisle.
  \newblock \emph{The afterpage package}.
  \newblock October, 1995.
  \newblock (Available from CTAN via
             \CTANurl{/macros/latex/required/tools/})

%%% keep
\bibitem[Car98b]{LONGTABLE}
  David Carlisle.
  \newblock \emph{The longtable package}.
  \newblock May, 1998.
  \newblock (Available from CTAN via
             \CTANurl{/macros/latex/required/tools/})

%%% keep
\bibitem[Car98c]{ENUMERATE}
  David Carlisle.
  \newblock \emph{The enumerate package}.
  \newblock August, 1998.
  \newblock (Available from CTAN via
             \CTANurl{/macros/latex/required/tools/})

\begin{comment}
\bibitem[Car98d]{REMRESET}
  David Carlisle.
  \newblock \emph{The remreset package}.
  \newblock August, 1998.
  \newblock (Available from CTAN in
             \url{/macros/latex/contrib/carlisle})
\end{comment}

%%% keep
\LMnote{2018/09/06}{Updated year}
\bibitem[Car16]{TABULARX}
  David Carlisle.
  \newblock \emph{The tabularx package}.
  \newblock February, 2016.
  \newblock (Available from CTAN via
             \CTANurl{/macros/latex/required/tools/})

%%% keep
\bibitem[CR99]{GRAPHICX}
  David Carlisle and Sebastian Rahtz.
  \newblock \emph{The graphicx package}.
  \newblock February, 1999.
  \newblock (Available from CTAN via
             \CTANurl{/macros/latex/required/graphics/})

%%% keep
\LMnote{2018/09/06}{updated year}             
\bibitem[Car14]{DCOLUMN}
  David Carlisle.
  \newblock \emph{The dcolumn package}.
  \newblock May, 2001.
  \newblock (Available from CTAN via
             \CTANurl{/macros/latex/required/tools/})

\bibitem[Car04]{textcase} % casing intentional
 David Carlisle.
\newblock \emph{The \Lpack{textcase} package}.
\newblock October, 2004.
\newblock (Available from CTAN in 
      \texttt{/macros/latex/contrib/textcase})



%%% keep
\bibitem[Car05]{COLOR}
  David Carlisle.
  \newblock \emph{Packages in the graphics bundle} (includes the color package).
  \newblock November, 2005.
  \newblock (Available from CTAN via
             \CTANurl{/macros/latex/required/graphics/})

\begin{comment}
%%% keep, not anymore, the bidi package is a bit different now, Vafa
%%% is the maintainer
             \bibitem[CK09]{BIDI} Fran\c{c}ois Charette and Vafa
               Khalighi.  \newblock \emph{Bidi: A convenient interface
                 for typesetting bidirectional texts with XeLaTeX}.
               \newblock 2009.  \newblock (Available from CTAN via
               \CTANurl{/macros/latex/contrib/bidi/})
\end{comment}




%%% keep
\bibitem[CB99]{CHAPPELL99}
  Warren Chappell and Robert Bringhurst.
  \newblock \emph{A Short History of the Printed Word}.
  \newblock Hartley \& Marks, 1999.
  \newblock ISBN 0--88179--154--7.

%%% keep
\bibitem[CH88]{CHEN88}
  Pehong Chen and Michael A.~Harrison.
  \newblock `Index Preparation and Processing'.
  \newblock \emph{Software: Practice and Experience}, 19:8, pp. 897--915,
            September, 1988.
  \newblock (Available from CTAN via
             \CTANurl{/indexing/makeindex/paper/})

\begin{comment}
\bibitem[Che05]{CHENG05}
  Karen Cheng.
  \newblock \emph{Designing Type}.
  \newblock Yale University Press, 2005.
  \newblock ISBN 0--300--11150--9.
\end{comment}

%%% keep
\bibitem[Chi93]{CMS}
  \newblock \emph{The Chicago Manual of Style}, Fourteenth Edition.
  \newblock The University of Chicago, 1993.
  \newblock ISBN 0--226--10389--7.


\begin{comment}
\bibitem[Coc02]{SUBFIGURE}
  Steven Douglas Cochran.
  \newblock \emph{The subfigure package}.
  \newblock March, 2002.
  \newblock (Available from CTAN in
             \url{/macros/latex/contrib/subfigure})

\bibitem[CG96]{CONWAY96}
  John H.~Conway and Richard K.~Guy.
  \newblock \emph{The Book of Numbers}.
  \newblock Copernicus, Springer-Verlag, 1996.
  \newblock ISBN 0--387--97993--X.

\bibitem[Cra92]{CRAIG92}
  James Craig.
  \newblock \emph{Designing with Type: A Basic Course in Typography}.
  \newblock Watson-Guptill, NY,
  \newblock 1992.
\end{comment}

%%% keep
\bibitem[Dal99a]{NATBIB}
  Patrick W.~Daly.
  \newblock \emph{Natural Sciences Citations and References}.
  \newblock May, 1999.
  \newblock (Available from CTAN via
             \CTANurl{/macros/latex/contrib/natbib/})

%%% keep
\bibitem[Dal99b]{MAKEBST}
  Patrick W.~Daly.
  \newblock \emph{Customizing Bibliographic Style Files}.
  \newblock August, 1999.
  \newblock (Available from CTAN via
             \CTANurl{/macros/latex/contrib/custom-bib})

\begin{comment}
\bibitem[Deg92]{DEGANI92}
  Asaf Degani.
  \newblock \emph{On the Typography of Flight-Deck Documentation}.
  \newblock NASA Contractor Report \# 177605.
  \newblock December, 1992.
  \newblock (Available from 
             \url{http://members.aol.com/willadams/typgrphy.htm#NASA})
\end{comment}

%%% keep
\bibitem[Dow96]{DOWDING96}
  Geoffrey Dowding.
  \newblock \emph{Finer Points in the Spacing \& Arrangement of Type}.
  \newblock Hartley \& Marks, 1996.
  \newblock ISBN 0--88179--119--9.

\begin{comment}
\bibitem[Dow98]{DOWDING98}
  Geoffrey Dowding.
  \newblock \emph{An Introduction to the History of Printing Types}.
  \newblock The British Library and Oak Knoll Press, 1998.
  \newblock ISBN 0--7123--4563--9 \textsc{uk},
                  1--884718--44--2 \textsc{usa}.
\end{comment}

%%% keep
\bibitem[Dow00]{PATCHCMD}
  Michael J.~Downes.
  \newblock \emph{The patchcmd package}.
  \newblock July, 2000.
  \newblock (Available from CTAN via
             \CTANurl{/macros/latex/contrib/patchcmd/})

%%% keep
\bibitem[Eij92]{TEXBYTOPIC}
  Victor Eijkhout.
  \newblock \emph{TeX by Topic}.
  \newblock Addison-Wesley, 1992.
  \newblock ISBN 0--201--56882--9.
  \newblock (Available from \url{http://www.eijkhout.net/tbt/}).

%%% keep
\bibitem[Eij99]{COMMENT}
  Victor Eijkhout.
  \newblock \emph{comment.sty}
  \newblock October, 1999.
  \newblock (Available from CTAN via
            \CTANurl{/macros/latex/contrib/comment/})

\begin{comment}
\bibitem[Fai98]{MOREVERB}
  Robin Fairbairns.
  \newblock \emph{The moreverb package}.
  \newblock December, 1998.
  \newblock (Available from CTAN in
            \url{/macros/latex/contrib/moreverb})
\end{comment}

%%% keep
\bibitem[Fai00]{FOOTMISC}
  Robin Fairbairns.
  \newblock \emph{footmisc --- a portmanteau package for customising
                  footnotes in LaTeX2e}.
  \newblock March, 2000.
  \newblock (Available from CTAN via
            \CTANurl{/macros/latex/contrib/footmisc/})

%%% keep
\LMnote{2010/09/28}{link changed}
\bibitem[FAQ]{FAQ}
  Robin Fairbairns.
  \newblock \emph{The UK TeX FAQ}.
  \newblock (Available from CTAN via
            \url{http://faq.tug.org/})

\LMnote{2010/02/08}{Added from the main bib file}
\bibitem[Far90]{FARIN90}
Gerald Farin.
\newblock \emph{Curves and Surfaces for Computer Aided Geometric
  Design --- A Practical Guide}.
\newblock Academic Press, 2 edition, 1990.

\LMnote{2010/02/08}{Added from the main bib file}
\bibitem[FP80]{FAUX80}
I.~D. Faux and M.~J. Pratt.
\newblock {\em Computational Geometry for Design and Manufacture}.
\newblock Ellis Horwood, 1980.



%%% keep
\LMnote{2018/09/06}{Updated year}
\bibitem[Fea16]{BOOKTABS}
  Simon Fear.
  \newblock \emph{Publication quality tables in LaTeX}.
  \newblock April, 2016.
  \newblock (Available from CTAN via
            \CTANurl{/macros/latex/contrib/booktabs})

\begin{comment}
\bibitem[Fli98]{LETTRINE}
  Daniel Flipo.
  \newblock \emph{Typesetting `lettrines' in LaTeX2e documents}.
  \newblock March, 1998.
  \newblock (Available from CTAN in
             \url{/macros/latex/contrib/lettrine})
\end{comment}

%%% keep
\bibitem[Fly98]{FLYNN02}
  Peter Flynn.
  \newblock \emph{Formatting Information: A Beginner's Introduction to 
                  Typesetting with LaTeX2}.
  \newblock 2002.
  \newblock (Available from CTAN via 
             \CTANurl{/info/beginlatex/})

\begin{comment}
\bibitem[Fra00]{CROP}
  Melchior Franz.
  \newblock \emph{The crop package}.
  \newblock February, 2000.
  \newblock (Available from CTAN in 
             \url{/macros/latex/contrib/crop})

\bibitem[FOS98]{FRIEDL98}
  Friedrich Friedl, Nicolaus Ott and Bernard Stein.
  \newblock \emph{Typography: An Encyclopedic Survey of Type Designs and
                  Techniques throughout History}.
  \newblock Black Dog \& Leventhal Publishers Inc., 1998.
  \newblock ISBN 1--57912--023--7.

\bibitem[Gar66]{GARDNER66}
  Martin Gardner.
  \newblock \emph{More Mathematical Puzzles and Diversions}.
  \newblock Penguin Books, 1996.
  \newblock ISBN 0--14--020748--1.
\end{comment}

%\bibitem[GMS94]{GOOSSENS94}
%  Michel Goossens, Frank Mittelbach and Alexander Samarin.
%  \newblock \emph{The LaTeX Companion}.
%  \newblock Addison-Wesley Publishing Company, 1994
%  \newblock (ISBN 0--201--54199--8), 1994.

%%% keep
\bibitem[GM\textsuperscript{+}07]{GCOMPANION}
  Michel Goossens, Frank Mittelbach, et al.
  \newblock \emph{The LaTeX Graphics Companion: Second edition}.
  \newblock Addison-Wesley, 2007.
  \newblock ISBN 0--321--50892--0.

%%% keep
\bibitem[GR99]{WCOMPANION}
  Michel Goossens and Sebastian Rahtz (with Eitan Gurari,
  Ross Moore and Robert Sutor).
  \newblock \emph{The LaTeX Web Companion: Integrating TeX, HTML and XML}.
  \newblock Addison-Wesley, 1999.
  \newblock ISBN 0--201--43311--7.

\begin{comment}
\bibitem[Gou87]{GOULD87}
  J.~D.~Gould \textit{et al}.
  \newblock `Reading from CRT displays can be as fast as reading from paper'.
  \newblock \emph{Human Factors}, pp 497--517, 29:5, 1987.

\bibitem[HR83]{HARTLEY83}
  J.~Hartley and D.~Rooum.
  \newblock `Sir Cyril Burt and typography'.
  \newblock \emph{British Journal of Psychology}, pp 203--212, 74:2, 1983.

\bibitem[HM01]{HELLER01}
  Steven Heller and Philip B.~Meggs (Eds).
  \newblock \emph{Texts on Type: Critical Writings on Typography}.
  \newblock Allworth Press, 2001.
  \newblock ISBN 1--58115--082--2.
\end{comment}

%%% keep
\bibitem[Hoe98]{HOENIG98}
  Alan Hoenig.
  \newblock \emph{TeX Unbound: LaTeX and TeX strategies for fonts,
                  graphics, and more}.
  \newblock Oxford University Press, 1998.
  \newblock ISBN 0--19--509686--X.

\begin{comment}
\bibitem[HK75]{HVISTENDAHL75}
  J.~K.~Hvistendahl and M.~R.~Kahl.
  \newblock `Roman vs. sans serif body type: Readability and reader prference'.
  \newblock \emph{AANPA News Research Bulletin}, pp 3--11, 17 Jan., 1975.
\end{comment}

%%% keep
\bibitem[Jon95]{INDEX}
  David M.~Jones.
  \newblock \emph{A new implementation of LaTeX's indexing commands}.
  \newblock September, 1995.
  \newblock (Available from CTAN via 
  \CTANurl{/macros/latex/contrib/camel})

%%% keep
\bibitem[Keh98]{XINDY}
  Roger Kehr.
  \newblock \emph{xindy: A flexible indexing system}.
  \newblock February, 1998.
  \newblock (Available from CTAN via \CTANurl{/indexing/xindy/})

%%% keep
\bibitem[Ker07]{XCOLOR}
  Uwe Kern.
  \newblock \emph{Extending LaTeX's color facilities: the xcolor package}.
  \newblock January, 2007.
  \newblock (Available from CTAN via 
             \CTANurl{/macros/latex/contrib/xcolor/})

%%% keep, moved herer /daleif 2020/09/28
\bibitem[Kha10]{BIDI} Vafa
  Khalighi.  
  \newblock \emph{The \textsf{Bidi} package}.
  \newblock 2010.  \newblock (Available from CTAN via
  \CTANurl{/macros/latex/contrib/bidi/})



%%% keep
\bibitem[Knu84]{TEXBOOK}
  Donald E.~Knuth.
  \newblock \emph{The TeXbook}.
  \newblock Addison-Wesley, 1984.
  \newblock ISBN 0--201--13448--9.

%%% keep
\bibitem[Knu86]{TEXPROGRAM}
  Donald E.~Knuth.
  \newblock \emph{TeX: The Program}.
  \newblock Addison-Wesley, 1986.
  \newblock ISBN 0--201--13437--3.

%%% keep
\bibitem[Knu87]{CM}
  Donald E.~Knuth.
  \newblock \emph{Computer Modern Typefaces}.
  \newblock Addison-Wesley, 1987.
  \newblock ISBN 0--201--134446--2.

%%% keep
\bibitem[Knu92]{METAFONT}
  Donald E.~Knuth.
  \newblock \emph{The METAFONT Book}.
  \newblock Addison-Wesley, 1992.
  \newblock ISBN 0--201--13444--6.

%%% keep
\bibitem[Lam94]{LAMPORT94}
  Leslie Lamport.
  \newblock \emph{LaTeX: A Document Preparation System}.
  \newblock Addison-Wesley, 1994.
  \newblock ISBN 0--201--52983--1.

%%% keep
\bibitem[LEB04]{NTG}
  Leslie Lamport, Victor Eijkhout and Johannes Braams.
  \newblock \emph{NTG document classes for LaTeX version 2e}.
  \newblock June, 2004.
  \newblock (Available from CTAN via
  \CTANurl{/macros/latex/contrib/ntgclass/}) 

\begin{comment}
\bibitem[LMB99]{CLASSES}
  Leslie Lamport, Frank Mittelbach and Johannes Braams.
  \newblock \emph{Standard document classes for LaTeX version 2e}.
  \newblock September, 1999.
  \newblock (Available from CTAN as \url{/macros/latex/base/classes.dtx})

\bibitem[Law90]{LAWSON90}
  Alexander Lawson.
  \newblock \emph{Anatomy of a Typeface}.
  \newblock David R.~Godine, 1990. 
  \newblock ISBN 0--87923--333--8.

\bibitem[LA90]{LAWSONAGNER90}
  Alexander S.~Lawson with Dwight Agner.
  \newblock \emph{Printing Types: An Introduction}.
  \newblock Beacon Press, 1990. 
  \newblock ISBN 0--8070--6661--3.
\end{comment}

%%% keep
\bibitem[Lea03]{TEXFONTSITE}
  Christopher League.
  \newblock \emph{TeX support for the FontSite 500 CD}.
  \newblock May 2003.
  \newblock (Available from 
             \url{http://contrapunctus.net/fs500tex})

%%% keep
\bibitem[Leh04]{FONTINST}
  Philipp Lehman.
  \newblock \emph{The Font Installation Guide}.
  \newblock December 2004.
  \newblock (Available from CTAN via
             \CTANurl{/info/Type1fonts/fontinstallationguide})

%%% keep
\bibitem[Leu92]{LEUNEN92}
  Mary-Claire van Leunen.
  \newblock \emph{A Handbook for Scholars}.
  \newblock Oxford University Press, 1992.
  \newblock ISBN 0--19--506954--4.

\begin{comment}
\bibitem[Liv02]{LIVIO02}
  Mario Livio.
  \newblock \emph{The Golden Ratio: The Story of Phi, the World's Most
     Astonishing Number}.
  \newblock Broadway Books, 2002.
  \newblock ISBN 0--7679--0816--3.
\end{comment}

%%% keep
\bibitem[Lon91]{MULTIND}
  F.~W.~Long.
  \newblock \emph{multind}.
  \newblock August, 1991.
  \newblock (Available from CTAN as
  \CTANurl{/macros/latex209/contrib/misc/multind.sty}) 

%%% keep
\bibitem[Mad06]{CHAPSTYLES}
  Lars Madsen.
  \newblock \emph{Various chapter styles for the memoir class}.
  \newblock July, 2006.
  \newblock (Available from CTAN via
  \CTANurl{/info/latex-samples/MemoirChapStyles/}) 

%%% keep
\bibitem[Mad07]{MEMEXSUPP}
  Lars Madsen.
  \newblock \emph{The Memoir Experimental Support Package}.
  \newblock 2007.
  \newblock (Available from CTAN via
  \CTANurl{/macros/latex/contrib/memexsupp/}) 

%%% keep
\bibitem[McD98]{SECTSTY}
  Rowland McDonnell.
  \newblock \emph{The sectsty package}.
  \newblock November, 1998.
  \newblock (Available from CTAN via
             \CTANurl{/macros/latex/contrib/sectsty/})

\begin{comment}
\bibitem[McL75]{MCLEAN75}
  Ruari McLean.
  \newblock \emph{Jan Tschichold: Typographer}.
  \newblock David R.~Godine, 1975.
  \newblock ISBN 0--87923--841--0.
\end{comment}

%%% keep
\bibitem[McL80]{MCLEAN80}
  Ruari McLean.
  \newblock \emph{The Thames \& Hudson Manual of Typography}.
  \newblock Thames \& Hudson, 1980.
  \newblock ISBN 0--500--68022--1.

\begin{comment}
\bibitem[McL95]{MCLEAN95}
  Ruari McLean (Ed).
  \newblock \emph{Typographers on Type}.
  \newblock W.~W.~Norton \& Co., 1995.
  \newblock ISBN 0--393--70201--4.

\bibitem[MMc95]{MEGGS00}
  Philip B.~Meggs and Roy McKelvey (Eds).
  \newblock \emph{Revival of the Fittest: Digital Versions of the Classic Typefaces}.
  \newblock RC Publications, Inc., 2000.
  \newblock ISBN 1--883915--08--2.

\bibitem[Mit95]{DOCSHORTVRB}
  Frank Mittelbach.
  \newblock \emph{The doc and shortvrb packages}.
  \newblock May, 1995.
  \newblock (Available from CTAN in 
            \url{/macros/latex/base})
\end{comment}

%%% keep
\bibitem[Mit18]{MULTICOL}
  Frank Mittelbach.
  \newblock \emph{An environment for multicolumn output}.
  \newblock April, 2018.
  \newblock (Available from CTAN (the \texttt{multicol} package) via 
            \CTANurl{/macros/latex/required/tools/})

%%keep
\LMnote{2018/09/06}{Updated year}            
\bibitem[MC18]{ARRAY}
  Frank Mittelbach and David Carlisle.
  \newblock \emph{A new implementation of LaTeX's tabular and array environment}.  \newblock May, 2018.
  \newblock (Available from CTAN (the \texttt{array} package) via
            \CTANurl{/macros/latex/required/tools/})

%%% keep
\bibitem[MC00]{FIXLTX2E}
  Frank Mittelbach and David Carlisle.
  \newblock \emph{The fixltx2e package}.
  \newblock December, 2016.
  \newblock As of 2015 the functionality of this package has been
  merged with the \LaTeX{} kernel.
  \newblock (Available from CTAN via 
            \CTANurl{/macros/latex/base/})

%%% keep
\bibitem[MG\textsuperscript{+}04]{COMPANION}
  Frank Mittelbach, Michael Goossens, et al.
  \newblock \emph{The LaTeX Companion: Second Edition}.
  \newblock Addison-Wesley, 2004.
  \newblock ISBN 0--201--36299--6.

\begin{comment}
\bibitem[Mor99]{MORISON99}
  Stanley Morison.
  \newblock \emph{A Tally of Types}.
  \newblock David R. Godine, 1999.
  \newblock ISBN 1--56792--004--7.
\end{comment}

\LMnote{2010/02/08}{Added from the main bib file}
\bibitem[Mor85]{MORTENSON85}
Michael~E. Mortenson.
\newblock \emph{Geometric Modeling}.
\newblock John Wiley \& Sons, 1985.


%%% keep
\bibitem[NG98]{SIDECAP}
  Rolf Niespraschk and Hubert G\"{a}\ss{}lein. 
  \newblock \emph{The sidecap package}.
  \newblock June, 1998.
  \newblock (Available from CTAN via
            \CTANurl{/macros/latex/contrib/sidecap/})

%%% keep
\bibitem[Oet]{LSHORT}
  Tobias Oetiker.
  \newblock \emph{The Not So Short Introduction to LaTeX2e}.
  \newblock (Available from CTAN via 
            \CTANurl{/info/lshort/})

%%% keep
\bibitem[Oos96]{FANCYHDR}
  Piet van Oostrum.
  \newblock \emph{Page Layout in LaTeX}.
  \newblock June, 1996.
  \newblock (Available from CTAN via
            \CTANurl{/macros/latex/contrib/fancyhdr/})

%%% keep
\bibitem[Pak01]{SYMBOLS}
  Scott Pakin.
  \newblock \emph{The Comprehensive LaTeX Symbol List}.
  \newblock July, 2001.
  \newblock (Available from CTAN via
            \CTANurl{/info/symbols/comprehensive/})

%%% keep
\bibitem[dP84]{PARVILLE84}
  H.~de~Parville.
  \newblock Recreations mathematique: {La Tour d'Hanoi} et la question 
            du {Tonkin}.
  \newblock \emph{La Nature}, part {I}:285--286, Paris 1884.

%%% keep
\bibitem[Pat88a]{BIBTEX}
  Oren Patashnik.
  \newblock \emph{BibTeXing}.
  \newblock February, 1988.
  \newblock (Available from CTAN as 
            \CTANurl{/bibliography/bibtex/distribs/doc/btxdoc.tex})

%%% keep
\bibitem[Pat88b]{BIBTEXHACK}
  Oren Patashnik.
  \newblock \emph{Designing BibTeX Styles}.
  \newblock February, 1988.
  \newblock (Available from CTAN as 
            \CTANurl{/bibliography/bibtex/distribs/doc/btxhak.tex})

%%% keep
\bibitem[Pug02]{MATHPAZO}
  Diego Puga.
  \newblock \emph{The Pazo Math fonts for mathematical typesetting
                  with the Palatino fonts}.
  \newblock May, 2002.
  \newblock (Available from CTAN via
            \CTANurl{/fonts/mathpazo/})

%%% keep
\bibitem[Rahtz01]{NAMEREF}
  Sebastian Rahtz.
  \newblock \emph{Section name references in LaTeX}.
  \newblock January, 2001. 
  \newblock (Available from CTAN (the \texttt{nameref} package) via 
            \CTANurl{/macros/latex/contrib/hyperref/})

%%% keep
\bibitem[Rahtz02]{HYPERREF}
  Sebastian Rahtz.
  \newblock \emph{Hypertext marks in LaTeX}.
  \newblock May, 2002. Now maintained and frequently updated by Heiko Oberdiek.
  \newblock (Available from CTAN via 
            \CTANurl{/macros/latex/contrib/hyperref/})

%%% keep
\bibitem[Rec97]{EPSLATEX}
  Keith Reckdahl.
  \newblock \emph{Using Imported Graphics in LaTeX2e}.
  \newblock December, 1997. Updated in 2006.
  \newblock (Available from CTAN via
              \CTANurl{/info/epslatex.pdf})

\begin{comment}
\bibitem[Reh72]{REHE72}
  Rolf Rehe.
  \newblock `Type and how to make it most legible'.
  \newblock \emph{Design Research International}, 1972.
\end{comment}

%%% keep
\bibitem[Rei07]{REINGOLD07}
  Edward M. Reingold.
  \newblock `Writing numbers in words in TeX'.
  \newblock TUGboat, 28, 2 pp 256--259, 2007.

\begin{comment}
\bibitem[RAE71]{ROBINSON71}
  D.~O.~Robinson, M.~Abbamonte and S.~H.~Evans.
  \newblock `Why serifs are important: The perception of small print'.
  \newblock \emph{Visible Language}, pp 353--359, 4, 1971.

\bibitem[Rog43]{ROGERS43}
  Bruce Rogers.
  \newblock \emph{Paragraphs on Printing}.
  \newblock William E. Rudge's Sons, Inc., 1943.
  \newblock (Reissued by Dover, 1979, ISBN 0--486--23817--2)

\bibitem[Rog49]{ROGERS49}
  Bruce Rogers.
  \newblock \emph{Centaur Types}.
  \newblock October House, 1949.
\end{comment}

%%% keep
\bibitem[RBC74]{ROUSEBALL}
  W. W. Rouse Ball and H. S. M. Coxeter. 
  \newblock \emph{Mathematical Recreations and Essays}.
  \newblock University of Toronto Press, twelfth edition, 1974.

\begin{comment}
\bibitem[Ryd76]{RYDER}
  John Ryder. 
  \newblock \emph{Printing for Pleasure}. Revised edition.
  \newblock The Bodley Head, 1976.
  \newblock ISBN 0--370--10443--9.
  \newblock (In the USA published by Henry Regenery Co., Michigan, 1977.
             ISBN 0--8092--78103--3)
\end{comment}

%%% keep
\bibitem[SW94]{EBOOK}
  Douglas Schenck and Peter Wilson.
  \newblock \emph{Information Modeling the EXPRESS Way}.
  \newblock Oxford University Press, 1994.
  \newblock ISBN 0--19--508714--3.

%%% keep
\bibitem[SRR99]{VERBATIM}
  Rainer Sch\"{o}pf, Bernd Raichle and Chris Rowley.
  \newblock \emph{A New Implementation of LaTeX's verbatim
                  and verbatim* Environments}.
  \newblock December, 1999.
  \newblock (Available from CTAN via
            \CTANurl{/macros/latex/required/tools/})

\begin{comment}
\bibitem[Sch97]{SCHRIVER97}
  Karen A.~Schriver.
  \newblock \emph{Dynamics in Document Design}.
  \newblock Wiley \& Sons, 1997.

\bibitem[Sme96]{SMEIJERS96}
  Fred Smeijers.
  \newblock \emph{Counterpunch: making type in the sixteenth century,
                  designing typefaces now}.
  \newblock Hyphen Press, London, 1996.
  \newblock ISBN 0--907259--06--5.
\end{comment}


\bibitem[Sch07]{practex-2007-3-ms}
Martin Scharrer,
\newblock\emph{Version Control of LaTeX Documents with svn-multi}.
\newblock  \emph{The Prac{\TeX} Journal}, 3, 2007.
\newblock ISSN 1556-6994.

\bibitem[Sch09]{svn-multi}
Martin Scharrer, 
\newblock\emph{The \textsf{svn-multi} package}, 2009. 
\newblock (Available from CTAN via
\CTANurl{/macros/latex/contrib/svn-multi/}) 


%%% keep
\bibitem[Sne04]{SNEEP04}
  Maarten Sneep.
  \newblock \emph{The atmosphere in the laboratory: cavity ring-down
                  measurements on scattering and absorption}.
  \newblock Phd thesis,
  \newblock Vrijie Universiteit, Amsterdam, 2004. 

%%% keep
\bibitem[Tal06]{DATETIME}
  Nicola L. C. Talbot.
  \newblock \emph{datetime.sty: Formatting Current Date and Time}.
  \newblock December, 2006.
  \newblock (Available from CTAN via
            \CTANurl{/macros/latex/contrib/datetime/})

%%% keep
\bibitem[Thi98]{ORNAMENTAL}
  Christina Thiele.
  \newblock `Hey --- it works: Ornamental rules'. 
  \newblock \emph{TUGboat}, 
  \newblock vol. 19, no. 4, p 427, December 1998.

%%% keep
\bibitem[Thi99]{TTC199}
  Christina Thiele.
  \newblock `The Treasure Chest: Package tours from CTAN', 
  \newblock \emph{TUGboat}, 
  \newblock vol. 20, no. 1, pp 53--58, March 1999.

%%% keep
\bibitem[TJ05]{CALC}
  Kresten Krab Thorup, Frank Jensen (and Chris Rowley).
  \newblock \emph{The calc package --- Infix notation arithmetic in LaTeX}.
  \newblock August, 2005.
  \newblock (Available from CTAN via
            \CTANurl{/macros/latex/required/tools/})

\begin{comment}
\bibitem[Tin63]{TINKER63}
  Miles A.~Tinker.
  \newblock \emph{Legibility of Print}.
  \newblock Books on Demand (University Microfilms International), 1963.
\end{comment}

%%% keep
\bibitem[Tob00]{SETSPACE}
  Geoffrey Tobin.
  \newblock \emph{setspace.sty}.
  \newblock December, 2000.
  \newblock (Available from CTAN via
            \CTANurl{/macros/latex/contrib/setspace/})

%%% keep
\bibitem[Tsc91]{TSCHICHOLD91}
  Jan Tschichold.
  \newblock \emph{The Form of the Book}.
  \newblock Lund Humphries, 1991.
  \newblock ISBN 0--85331--623--6.

\begin{comment}
\bibitem[Tuf83]{TUFTE83}
  Edward R. Tufte.
  \newblock \emph{The Visual Display of Quantative Information}.
  \newblock Graphics Press, 1983.
\end{comment}

%%% keep
\bibitem[Ume99]{GEOMETRY}
  Hideo Umeki.
  \newblock \emph{The geometry package}.
  \newblock November, 1999.
  \newblock (Available from CTAN in
            \CTANurl{/macros/latex/contrib/geometry/})


\begin{comment}
\bibitem[Whe95]{WHEILDON95}
  Colin Wheildon.
  \newblock \emph{Type \& Layout}.
  \newblock Strathmore Press, 1995.
  \newblock ISBN 0--9624891--5--8.
\end{comment}

%%% keep
\bibitem[Wil00]{CATALOGUE}
  Graham Williams.
  \newblock \emph{The TeX Catalogue}.
  \newblock (Latest version on CTAN as 
  \CTANurl{/help/Catalogue/catalogue.html})

%%% keep
\bibitem[Wil93]{ADRIANWILSON93}
  Adrian Wilson.
  \newblock \emph{The Design of Books}.
  \newblock Chronicle Books, 1993.
  \newblock ISBN 0--8118--0304--X.


%%% keep
\bibitem[Wil99b]{TOCVSEC2}
  Peter Wilson.
  \newblock \emph{The tocvsec2 package}.
  \newblock January, 1999.
  \newblock (Available from CTAN via 
            \CTANurl{/macros/latex/contrib/tocvsec2/})

%%% keep
\bibitem[Wil00a]{EPIGRAPH}
  Peter Wilson.
  \newblock \emph{The epigraph package}.
  \newblock February, 2000.
  \newblock (Available from CTAN via
            \CTANurl{/macros/latex/contrib/epigraph/})

%%% keep
\bibitem[Wil00b]{ISOCLASS}
  Peter Wilson.
  \newblock \emph{LaTeX files for typesetting ISO standards}.
  \newblock February, 2000.
  \newblock (Available from CTAN via 
            \CTANurl{/macros/latex/contrib/isostds/iso/})

%%% keep
\bibitem[Wil00c]{NEXTPAGE}
  Peter Wilson.
  \newblock \emph{The nextpage package}.
  \newblock February, 2000.
  \newblock (Available from CTAN as 
            \CTANurl{/macros/latex/contrib/misc/nextpage.sty})

\begin{comment}
\bibitem[Wil00d]{NEEDSPACE}
  Peter Wilson.
  \newblock \emph{The needspace package}.
  \newblock March, 2000.
  \newblock (Available from CTAN as 
            \url{/macros/latex/contrib/misc/needspace.sty})
\end{comment}

%%% keep
\bibitem[Wil00e]{XTAB}
  Peter Wilson.
  \newblock \emph{The xtab package}.
  \newblock April 2000.
  \newblock (Available from CTAN via
             \CTANurl{/macros/latex/contrib/xtab})

%%% keep
\bibitem[Wil01a]{ABSTRACT}
  Peter Wilson.
  \newblock \emph{The abstract package}.
  \newblock February, 2001.
  \newblock (Available from CTAN via
            \CTANurl{/macros/latex/contrib/abstract/})

\begin{comment}
%%%  it no longer exist
\LMnote{2010/09/28}{Removed as it no longer exist}
\bibitem[Wil01b]{CHNGPAGE}
  Peter Wilson.
  \newblock \emph{The changepage package}.
  \newblock February, 2001.
  \newblock (Available from CTAN via 
            \CTANurl{/macros/latex/contrib/changepage/})

\bibitem[Wil01c]{APPENDIX}
  Peter Wilson.
  \newblock \emph{The appendix package}.
  \newblock March, 2001.
  \newblock (Available from CTAN in 
            \url{/macros/latex/contrib/appendix})
\end{comment}

%%% keep
\bibitem[Wil01d]{CCAPTION}
  Peter Wilson.
  \newblock \emph{The ccaption package}.
  \newblock March, 2001.
  \newblock (Available from CTAN via 
            \CTANurl{/macros/latex/contrib/ccaption/})

%%% keep
\bibitem[Wil01e]{CHNGCNTR}
  Peter Wilson.
  \newblock \emph{The chngcntr package}.
  \newblock April, 2001.
  \newblock (Available from CTAN via 
            \CTANurl{/macros/latex/contrib/chngcntr/})

%%% keep
\bibitem[Wil01f]{HANGING}
  Peter Wilson.
  \newblock \emph{The hanging package}.
  \newblock March, 2001.
  \newblock (Available from CTAN via 
            \CTANurl{/macros/latex/contrib/hanging/})

%%% keep
\bibitem[Wil01g]{TITLING}
  Peter Wilson.
  \newblock \emph{The titling package}.
  \newblock March, 2001.
  \newblock (Available from CTAN via 
            \CTANurl{/macros/latex/contrib/titling/})

%%% keep
\bibitem[Wil01h]{TOCBIBIND}
  Peter Wilson.
  \newblock \emph{The tocbibind package}.
  \newblock April, 2001.
  \newblock (Available from CTAN via 
            \CTANurl{/macros/latex/contrib/tocbibind/})

%%% keep
\bibitem[Wil01i]{TOCLOFT}
  Peter Wilson.
  \newblock \emph{The tocloft package}.
  \newblock April, 2001.
  \newblock (Available from CTAN via 
            \CTANurl{/macros/latex/contrib/tocloft/})


\begin{comment}
\bibitem[Wil01j]{MEMOIR}
  Peter Wilson.
  \newblock \emph{The LaTeX memoir class for configurable book 
                  typesetting: Source code}.
  \newblock July, 2001.
  \newblock (Available from CTAN in 
            \url{/macros/latex/contrib/memoir})

\bibitem[Wil01k]{VERSE}
  Peter Wilson.
  \newblock \emph{Typesetting simple verse with LaTeX}
  \newblock July, 2001.
  \newblock (Available from CTAN in 
            \url{/macros/latex/contrib/verse})

\bibitem[Wil01l]{BOOKLET}
  Peter Wilson.
  \newblock \emph{Printing booklets with LaTeX}
  \newblock August, 2001.
  \newblock (Available from CTAN in 
            \url{/macros/latex/contrib/booklet})
\end{comment}

%%% keep
\bibitem[Wil03a]{LAYOUTS}
  Peter Wilson.
  \newblock \emph{The layouts package}
  \newblock November, 2003.
  \newblock (Available from CTAN in 
            \CTANurl{/macros/latex/contrib/layouts/})

%%% keep
\bibitem[Wil03b]{LEDMAC}
  Peter Wilson.
  \newblock \emph{ledmac: A presumptuous attempt to port EDMAC and
    TABMAC to LaTeX}
  \newblock November, 2003.
  \newblock (Available from CTAN via 
            \CTANurl{/macros/latex/contrib/ledmac/})

\begin{comment}
\bibitem[Wil04a]{GLISTER3}
  Peter Wilson.
  \newblock `Glisterings'.
  \newblock TUGboat, 25, 2 pp 201--202, 2004.
\end{comment}


\LMnote{2010/02/08}{Added from the main bib file}
\bibitem[Wil04a]{BEZ123}
Peter Wilson.
\newblock \emph{The bez123 and multiply packages}, April 2004.
\newblock (Available from CTAN in  \CTANurl{/macros/latex/contrib/bez123/})


%%% keep
\bibitem[Wil04b]{PAGENOTE}
  Peter Wilson.
  \newblock \emph{The pagenote package}
  \newblock September, 2004.
  \newblock (Available from CTAN via 
            \CTANurl{/macros/latex/contrib/pagenote/})




%%% keep
\bibitem[Wil07a]{TITLEPAGES}
  Peter Wilson.
  \newblock \emph{Some Examples of Title Pages}.
  \newblock Herries Press, 2007.
  \newblock (Available from CTAN via
  \CTANurl{/info/latex-samples/TitlePages/}) 

%%% keep
\begin{comment}
    % repeated below
  \bibitem[Wil07b]{MEMCODE} Peter Wilson.  \newblock \emph{The \ltx\
      memoir class for configurable book typesetting: source code}
    \newblock November, 2007.  \newblock (Available from CTAN in
    \url{/macros/latex/contrib/memoir})
\end{comment}
%%% keep

%%% keep, outcommented, as we do not use an addendum at the moment
\LMnote{2010/09/28}{out commented as we do not provide one at the moment}
\begin{comment}
\bibitem[Wil07d]{MEMADD}
Peter Wilson.
  \newblock \emph{ADDENDUM: The Memoir Class for Configurable
    Typesetting --- User Guide} 
  \newblock November, 2007.
  \newblock (Available from CTAN in 
            \url{/macros/latex/contrib/memoir})
\end{comment}
          
%%% keep
\bibitem[Wil07e]{GLISTER07}
Peter Wilson.
  \newblock `Glisterings', \emph{TUGboat}, 28(2):229--232, 2007.

\begin{comment}
\bibitem[Wil07f]{TUGKEYNOTE07}
Peter Wilson.
  \newblock `Between then and now --- A meandering memoir', 
  \newblock \emph{TUGboat}, 28(3):280--298, 2007.
\end{comment}

%%% keep
\bibitem[Wil08a]{CHANGEPAGE}
  Peter Wilson.
  \newblock \emph{The changepage package}.
  \newblock March, 2008.
  \newblock (Available from CTAN via
            \CTANurl{/macros/latex/contrib/changepage/})

%%% keep
\bibitem[Wil08b]{GLISTER08}
Peter Wilson.
  \newblock `Glisterings', \emph{TUGboat}, 29(2):324--327, 2008.

%%% keep
\bibitem[Wil09a]{FONTTABLE}
  Peter Wilson.
  \newblock \emph{The fonttable package}
  \newblock April, 2009.
  \newblock (Available from CTAN via 
            \CTANurl{/macros/latex/contrib/fonttable/})

\bibitem[Wil09b]{MEMCODE}
Peter Wilson (with the assistance of Lars Madsen).
  \newblock \emph{The \ltx\ memoir class for configurable book
    typesetting: source code} 
  \newblock July, 2009.
  \newblock (Available from CTAN via 
            \CTANurl{/macros/latex/contrib/memoir/})

\bibitem[Wil07c]{MEMMAN}
Peter Wilson (with the assistance of Lars Madsen).
  \newblock \emph{The Memoir Class for Configurable Typesetting ---
    User Guide} 
  \newblock August, 2009. Regularly updated.
  \newblock (Available from CTAN via 
            \CTANurl{/macros/latex/contrib/memoir/})

\bibitem[Wil09d]{MEMDESIGN}
  Peter Wilson.
  \newblock \emph{A Few Notes on Book Design}
  \newblock August, 2009.
  \newblock (Available from CTAN via
            \CTANurl{/info/memdesign/})


%%% keep
\bibitem[Wil??]{RUMOUR}
Peter Wilson.
\newblock \emph{A Rumour of Humour: A scientist's commonplace book}.
\newblock To be published.


\bibitem[Wri18]{SIUNITX}
  Joseph Wright.
  \newblock \emph{Siunitx — A comprehensive (SI) units package}
  \newblock May, 2018.
  \newblock (Available from CTAN via \CTANurl{/macros/latex/contrib/siunitx})




\begin{comment}
\bibitem[Wis03]{WISHART03}
David Wishart.
\newblock \emph{The Printing of Mathematics}
\newblock in \emph{Type \& Typography: Highlights from \emph{Matrix}, the
       review for printers \& bibliophiles}.
\newblock Mark Batty Publisher, 2003.
\newblock ISBN 0--9715687--6--6.
\newblock (Originally published in \emph{Matrix 8}, 1988)

\bibitem[Wul53]{WULLING-FOOTNOTES}
  Emerson G. Wulling.
  \newblock \emph{A Comp's-Eye View of Footnotes}.
  \newblock Sumac Press, 1953.

\bibitem[Zac69]{ZACHRISSOM69}
  B.~Zachrissom.
  \newblock \emph{Studies in the Legibility of Printed Text}.
  \newblock Almqvist \& Wiksell, Stockholm, 1969.
\end{comment}

%%% keep
\bibitem[Zan98]{FANCYBOX}
  Timothy Van Zandt.
  \newblock \emph{Documentation for fancybox.sty: Box tips and tricks for 
             LaTeX}, 
  \newblock November, 1998.
  \newblock (Available from CTAN via 
            \CTANurl{/macros/latex/contrib/fancybox/})

\begin{comment}
\bibitem[Zap00]{ZAPF00}
  Hermann Zapf.
  \newblock \emph{The Fine Art of Letters}.
  \newblock The Grolier Club, 2000.
  \newblock ISBN 0--910672--35--0.
\end{comment}

\end{thebibliography}


\clearpage
\twocolindex
\pagestyle{index}
%\renewcommand{\chaptermark}[1]{}
\renewcommand{\preindexhook}{%
The first page number is usually, but not always, the primary reference to
the indexed topic.\vskip\onelineskip}
\indexintoc

%%%\raggedright  does nasty things to index entries
\printindex

\onecolindex
\renewcommand*{\preindexhook}{}
\renewcommand*{\indexname}{Index of first lines}
%%% \indexintoc


\makeatletter
\renewcommand{\doidxbookmark}[1]{{\def\@tempa{Symbols}\def\@tempb{#1}%
  \centering\bfseries \ifx\@tempa\@tempb %
  Analphabetics 
%  \phantomsection%
%  \pdfbookmark[0]{Analphabetics}{Analphabetics-idx}%
%  \label{AnalphabeticsAnalphabeticsAnalphabetics-idx}%
  \else 
  #1%
%  \phantomsection%
%  \pdfbookmark[0]{#1}{#1-idx}%
%  \label{#1#1#1-idx}%
  \fi%
  \vskip\onelineskip\par}}
\makeatother


\printindex[lines]

\cleardoublepage
\pagestyle{empty}
\null\vfil

\begin{adjustwidth}{1in}{1in}
\begin{center}
{\Large\textsf{Colophon}}
\end{center}
\begin{center}
This manual was typeset using the \ltx\ typesetting system
created by Leslie Lamport and the \Mname\ class. 
The body text is set 10/12pt on a
33pc measure with Palatino designed by Hermann Zapf, which includes 
italics and small caps. Other fonts include
Sans, Slanted and Typewriter from Donald Knuth's 
Computer Modern family.

\end{center}


\end{adjustwidth}





\vfil

%#% extend


\end{document}

\endinput


%%% Local Variables: 
%%% mode: latex
%%% TeX-master: t
%%% TeX-source-specials-mode: t
%%% TeX-PDF-mode: t
%%% End: 
